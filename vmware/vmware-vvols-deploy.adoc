---
sidebar: sidebar 
permalink: vmware/vmware-vvols-deploy.html 
keywords: tr-4400, vvols, ontap, virtual volumes, deploy, ASA r2, ASA, AFF, FAS, vSphere, VMware 
summary:  
---
= AFF、ASA、ASA R2、FASシステムへのVVOLの導入
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
仮想マシン用のVVOLストレージを作成する場合は、次のベストプラクティスに従ってください。

vVolデータストアのプロビジョニングはいくつかの手順で行います。NetAppのASA R2システムは、VMwareワークロード向けに設計されており、従来のONTAPシステムとは異なるユーザエクスペリエンスを提供します。ASA R2システムを使用している場合、ONTAP toolsバージョン10.3以降では、セットアップ手順が少なくて済み、新しいストレージアーキテクチャに合わせて最適化されたUI拡張機能とREST APIサポートが提供されます。



== ONTAP toolsを使用してvVolデータストアを作成するための準備

すでにONTAPツールを使用して、既存のVMFSまたは従来のNFSベースのストレージの管理、自動化、レポート作成を行っている場合は、導入プロセスの最初の2つの手順を省略できます。ONTAPツールの導入と設定については、この完全版を参照することもできますlink:vmware-vvols-checklist.html["チェックリスト"]。

. ストレージ仮想マシン (SVM) とそのプロトコル構成を作成します。ASA r2 システムでは通常、データ サービス用の単一の SVM が既に存在するため、これは必要ありません。NVMe/FC (ONTAPツール 9.13 のみ)、NFSv3、NFSv4.1、iSCSI、FCP、またはこれらのオプションの組み合わせを選択します。NVMe/TCP および NVMe/FC は、 ONTAPツール 10.3 以降を使用した従来の VMFS データストアにも使用できます。ONTAP System Manager ウィザードまたはクラスタ シェル コマンド ラインのいずれかを使用できます。
+
** https://docs.netapp.com/us-en/ontap/disks-aggregates/assign-aggregates-svms-task.html["ローカル階層（アグリゲート）をSVMに割り当て"]ASA R2以外のすべてのシステム
** スイッチ/ファブリック接続ごとにノードごとに少なくとも1つのLIFが必要です。FCP、iSCSI、またはNVMeベースのプロトコルを使用する場合は、ノードごとに2つ以上を作成することを推奨します。NFSベースのVVOLにはノードごとに1つのLIFで十分ですが、このLIFはLACP ifgroupで保護する必要があります。詳細については、およびを https://docs.netapp.com/us-en/ontap/networking/combine_physical_ports_to_create_interface_groups.html["物理ポートを組み合わせてインターフェイスグループを作成"]参照して https://docs.netapp.com/us-en/ontap/networking/configure_lifs_cluster_administrators_only_overview.html["LIFの設定の概要"]ください。
** テナント vCenter に SVM スコープの認証情報を使用する場合は、SVM ごとに少なくとも 1 つの管理 LIF が必要です。
** SnapMirrorを使用する場合は、ソースとターゲットを確認して https://docs.netapp.com/us-en/ontap/peering/["ONTAPクラスタとSVMのピア関係が設定されている"]ください。
** ASA r2 以外のシステムでは、この時点でボリュームを作成できますが、 ONTAPツールの _Provision Datastore_ ウィザードを使用してボリュームを作成するのがベスト プラクティスです。このルールの唯一の例外は、VMware Site Recovery Manager およびONTAPツール 9.13 でvVolsレプリケーションを使用する予定の場合です。これは、既存のSnapMirror関係を持つ既存のFlexVolボリュームを使用すると簡単に設定できます。vVolsに使用されるボリュームでは QoS を有効にしないように注意してください。これは、SPBM およびONTAPツールによって管理されることが意図されています。


. https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/deploy/ontap-tools-deployment.html["ONTAP Tools for VMware vSphereの導入"]NetAppサポートサイトからダウンロードしたOVAを使用します。
+
** ONTAPツール 10.0 以降では、アプライアンスごとに複数の vCenter サーバーがサポートされるため、vCenter ごとに 1 つのONTAPツール アプライアンスを展開する必要がなくなりました。
+
*** 複数の vCenter を単一のONTAPツール インスタンスに接続する場合は、CA 署名付き証明書を作成してインストールする必要があります。参照 https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/manage/certificate-manage.html["証明書の管理"] 手順については。


** 10.3 以降、 ONTAPツールは、ほとんどの非 vVols ワークロードに適した単一ノードの小型アプライアンスとして導入されるようになりました。




[TIP]
====
* 推奨されるベストプラクティスは https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/manage/edit-appliance-settings.html["スケールアウトONTAPツール"] 10.3 以降では、すべての本番ワークロードに対して 3 ノードの高可用性 (HA) 構成を使用できます。ラボやテストの目的では、単一ノードの展開を使用できます。
* 実稼働環境でのvVols の使用に推奨されるベスト プラクティスは、単一障害点を排除することです。ONTAPツール VM が同じホスト上で一緒に実行されないように、アンチアフィニティ ルールを作成します。初期導入後は、ストレージ vMotion を使用してONTAPツール VM を別のデータストアに配置することもお勧めします。詳細はこちら https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-resource-management-8-0/using-drs-clusters-to-manage-resources/using-affinity-rules-without-vsphere-drs.html["vSphere DRSを使用しないアフィニティルールの使用"] または https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-resource-management-8-0/using-drs-clusters-to-manage-resources/create-a-vm-vm-affinity-rule.html["VM-VMアフィニティルールの作成"]。また、頻繁にバックアップをスケジュールし、 https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/manage/backup-settings.html["組み込みの構成バックアップユーティリティを使用する"]。


====
. 環境に合わせてONTAP tools 10.3を設定します。
+
** https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-vcenter.html["vCenter Serverインスタンスの追加"]をクリックしONTAPます。
** ONTAP tools 10.3ではセキュアマルチテナンシーがサポートされます。セキュアマルチテナンシーが必要ない場合は、vCenterのONTAP toolsメニューに移動して_Storage backends_をクリックし、_add_ボタンをクリックするだけ https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-storage-backend.html["ONTAPクラスタを追加"]です。
** セキュアなマルチテナント環境で特定のStorage Virtual Machine（SVM）を特定のvCenterに委譲する場合は、次の作業を行う必要があります。
+
*** ONTAP Tools Manager UIにログインします。
*** https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-storage-backend.html["ストレージクラスタのオンボード"]
*** https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/associate-storage-backend.html["ストレージバックエンドとvCenter Serverインスタンスの関連付け"]
*** 特定の SVM 認証情報を vCenter 管理者に提供すると、管理者は vCenter のONTAPツールのストレージ バックエンド メニューで SVM をストレージ バックエンドとして追加します。






[TIP]
====
* ストレージアカウント用のRBACロールを作成することを推奨します。
* ONTAPツールには、 ONTAPツール ストレージ アカウントに必要なロール権限を含む JSON ファイルが含まれています。JSON ファイルをONTAP System Manager にアップロードすると、RBAC ロールとユーザーの作成が簡素化されます。
* ONTAP RBACロールの詳細については、を参照してください https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/configure-user-role-and-privileges.html#svm-aggregate-mapping-requirements["ONTAPユーザのロールと権限の設定"]。


====

NOTE: クラスタ全体をONTAPツール マネージャ UI にオンボードする必要がある理由は、 vVolsに使用される API の多くがクラスタ レベルでのみ使用できるためです。



== ONTAP toolsを使用したvVolデータストアの作成

ONTAP データストアを作成するホスト、クラスタ、またはデータセンターを右クリックし、_vVol tools>>_Provision Datastore_を選択します。

image:vvols-deploy-1.png["role=\"thumb\"\"データストアのプロビジョニングウィザード\"、300"]

* [VVols]を選択し、わかりやすい名前を指定してプロトコルを選択します。データストアの概要 も指定できます。
+
** ASA R2搭載のONTAP tools 10.3。




image:vvols-deploy-2.png["role=\"thumb\"\"データストアのプロビジョニングウィザード\"、300"]

* ASA R2システムSVMを選択し、_next_をクリックします。


image:vvols-deploy-3.png["role=\"thumb\"\"データストアのプロビジョニングウィザード\"、300"]

* [終了]をクリックします。


image:vvols-deploy-4.png["role=\"thumb\"\"データストアのプロビジョニングウィザード\"、300"]

* それは簡単です!
+
** ONTAPツール 10.3 とONTAP FAS、 AFF 、およびASA r2 より前のASA 。


* プロトコルを選択してください


image:vvols-deploy-5.png["role=\"thumb\"\"データストアのプロビジョニングウィザード\"、300"]

* SVMを選択し、_next_をクリックします。


image:vvols-deploy-5a.png["role=\"thumb\"\"データストアのプロビジョニングウィザード\"、300"]

* [_新しいボリュームを追加_] または [_既存のボリュームを使用_] をクリックして、属性を指定します。ONTAPツール 10.3 では、複数のボリュームを同時に作成するように要求できることに注意してください。また、複数のボリュームを手動で追加して、 ONTAPクラスタ全体でバランスをとることもできます。「次へ」をクリック


image:vvols-deploy-6.png["role=\"thumb\"\"データストアのプロビジョニングウィザード\"、300"]

image:vvols-deploy-7.png["role=\"thumb\"\"データストアのプロビジョニングウィザード\"、300"]

* [終了]をクリックします。


image:vvols-deploy-8.png["role=\"thumb\"\"データストアのプロビジョニングウィザード\"、300"]

* 割り当てられているボリュームは、データストアの[Configure]タブのONTAP tools]メニューで確認できます。


image:vvols-deploy-9.png["role=\"thumb\"\"データストアのプロビジョニングウィザード\"、300"]

* vCenter UIの_PoliciesとProfiles_menuからVMストレージポリシーを作成できるようになりました。




== 従来のデータストアからVVOLへのVMの移行

従来のデータストアからvVolデータストアへのVMの移行は、従来のデータストア間でVMを移動するだけです。VMを選択し、[Actions]リストから[Migrate]を選択し、移行タイプとして[_change storage only_]を選択します。プロンプトが表示されたら、vVolデータストアに一致するVMストレージポリシーを選択します。移行コピー処理は、vSphere 6.0以降でSAN VMFSをvVolに移行する場合はオフロードできますが、NAS VMDKからvVolにはオフロードできません。



== ポリシーによるVMの管理

ポリシーベースの管理を使用してストレージ プロビジョニングを自動化するには、必要なストレージ機能にマップする VM ストレージ ポリシーを作成する必要があります。


NOTE: ONTAP tools 10.0以降では、以前のバージョンのようなストレージ機能プロファイルは使用されなくなりました。代わりに、ストレージ機能はVMストレージポリシー自体で直接定義されます。



=== 仮想マシンストレージポリシーを作成しています

VM ストレージ ポリシーは、vSphere でストレージ I/O コントロールや vSphere 暗号化などのオプション機能を管理するために使用されます。また、 vVolsと組み合わせて使用​​して、VM に特定のストレージ機能を適用することもできます。「NetApp.clustered.Data. ONTAP .VP.vvol」ストレージ タイプを使用します。ONTAPツール VASA Provider を使用した例については、link:vmware-vvols-ontap.html#Best Practices[NFS v3 経由のvVolsを使用したネットワーク構成の例] を参照してください。「 NetApp.clustered.Data. ONTAP.VP.VASA10」ストレージのルールは、非 vVols ベースのデータストアで使用されます。

作成したストレージポリシーは、新しいVMのプロビジョニングに使用できます。

image:vmware-vvols-deploy-vmsp-01.png["role=\"thumb\"\" ONTAP tools VASA Provider 9.10\"を使用したVMストレージポリシーの作成、300"] image:vmware-vvols-deploy-vmsp-02.png["role=\"thumb\"\" ONTAP tools VASA Provider 9.10\"を使用したVMストレージポリシーの作成、300"] image:vmware-vvols-deploy-vmsp-03.png["role=\"thumb\"\" ONTAP tools VASA Provider 9.10\"を使用したVMストレージポリシーの作成、300"] image:vmware-vvols-deploy-vmsp-04.png["role=\"thumb\"\" ONTAP tools VASA Provider 9.10\"を使用したVMストレージポリシーの作成、300"] image:vmware-vvols-deploy-vmsp-05.png["role=\"thumb\"\" ONTAP tools VASA Provider 9.10\"を使用したVMストレージポリシーの作成、300"] image:vmware-vvols-deploy-vmsp-06.png["role=\"thumb\"\" ONTAP tools VASA Provider 9.10\"を使用したVMストレージポリシーの作成、300"] image:vmware-vvols-deploy-vmsp-07.png["role=\"thumb\"\" ONTAP tools VASA Provider 9.10\"を使用したVMストレージポリシーの作成、300"]



==== ONTAPツールによるパフォーマンス管理

ONTAP toolsは、独自の分散配置アルゴリズムを使用して、統合または従来のASAシステムを使用する最適なFlexVol volume、またはASA R2システムを使用するストレージアベイラビリティゾーン（SAZ）をvVolデータストア内に配置します。配置は、元のストレージとVMストレージポリシーの照合に基づいて行われます。これにより、データストアとバッキングストレージが、指定されたパフォーマンス要件を確実に満たすことができます。

最小 IOPS や最大 IOPS などのパフォーマンス機能を変更するには、特定の構成に注意する必要があります。

* *最小IOPSと最大IOPS *はVMポリシーで指定できます。
+
** ポリシー内の IOPS を変更しても、それを使用する VM に VM ポリシーが再適用されるまで、 vVolsの QoS は変更されません。または、必要な IOPS で新しいポリシーを作成し、それをターゲット VM に適用することもできます。一般的には、異なるサービス層ごとに個別の VM ストレージ ポリシーを定義し、VM 上の VM ストレージ ポリシーを変更することが推奨されます。
** ASA、 ASA r2、 AFF、およびFASパーソナリティには異なる IOP 設定があります。すべてのフラッシュ システムでは Min と Max の両方が使用できますが、 AFF以外のシステムでは Max IOP 設定のみを使用できます。


* ONTAP toolsは、現在サポートされているバージョンのONTAP に対して、共有されていないQoSポリシーを個別に作成します。そのため、個 々 のVMDKにはそれぞれ独自のIOPSが割り当てられます。




===== VMストレージポリシーを再適用しています

image:vvols-image16.png["role=\"thumb\"\"仮想マシンストレージポリシーの再適用\"、300"]
