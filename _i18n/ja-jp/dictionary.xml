<?xml version="1.0" encoding="UTF-8"?>
<blocks>
  <block id="d41d8cd98f00b204e9800998ecf8427e" category="summary"></block>
  <block id="30d965eef5ba25c6b9998ae38270b43e" category="doc">法的通知</block>
  <block id="e9c44bbfd795a5d63d74c6a77afee70d" category="paragraph">著作権に関する声明、商標、特許などにアクセスできます。</block>
  <block id="6016a2b341113bf496b719905398ecd2" category="section-title">著作権</block>
  <block id="52009bb7ee17227f566cd26a02caee56" category="inline-link-macro"><block ref="52009bb7ee17227f566cd26a02caee56" category="inline-link-rx"></block></block>
  <block id="a1a9afcf552a769c282769271829889a" category="paragraph"><block ref="a1a9afcf552a769c282769271829889a" category="inline-link-macro-rx"></block></block>
  <block id="126a02652da6de02962cf1b654fd6376" category="section-title">商標</block>
  <block id="c4ce4761e466527d26b3e3d5ed1006fd" category="paragraph">NetApp 、 NetApp のロゴ、および NetApp の商標ページに記載されているマークは、 NetApp, Inc. の商標です。その他の会社名および製品名は、それぞれの所有者の商標である場合があります。</block>
  <block id="f99aa604031e5049799e73b5c3748a98" category="inline-link-macro"><block ref="f99aa604031e5049799e73b5c3748a98" category="inline-link-rx"></block></block>
  <block id="5d545fe5152641e2ebe654e336e520e5" category="paragraph"><block ref="5d545fe5152641e2ebe654e336e520e5" category="inline-link-macro-rx"></block></block>
  <block id="be89498d2f8a22ce47c02ba9795fe2af" category="section-title">特許</block>
  <block id="d0b19d36be2c5f16e9aef46c8a452d3d" category="paragraph">ネットアップが所有する特許の最新リストは、次のサイトで入手できます。</block>
  <block id="88e5eabd3917048b6927c42496b98f86" category="inline-link-macro"><block ref="88e5eabd3917048b6927c42496b98f86" category="inline-link-rx"></block></block>
  <block id="dd38f906b37d412de7d1c1dcf4cbf31c" category="paragraph"><block ref="dd38f906b37d412de7d1c1dcf4cbf31c" category="inline-link-macro-rx"></block></block>
  <block id="56c34c6410dd45c5cec44149ad0ce037" category="section-title">プライバシーポリシー</block>
  <block id="8acb58cbd50ef1b468a020ee0bd351d3" category="inline-link-macro"><block ref="8acb58cbd50ef1b468a020ee0bd351d3" category="inline-link-rx"></block></block>
  <block id="2352c4e1f4d0024ade0869e00e6243f4" category="paragraph"><block ref="2352c4e1f4d0024ade0869e00e6243f4" category="inline-link-macro-rx"></block></block>
  <block id="c0227cef6f07a8cd2ac72f2945b031aa" category="section-title">オープンソース</block>
  <block id="9b73989307c1975dfa4d5e1581e4afe8" category="paragraph">通知ファイルには、ネットアップソフトウェアで使用されるサードパーティの著作権およびライセンスに関する情報が記載されています。</block>
  <block id="253b40ae359ba25b56231803430c4873" category="section-title">ONTAP</block>
  <block id="856c8958afd787f748a4a025f649154a" category="inline-link-macro">ONTAP 9.13.1に関する注意事項</block>
  <block id="b22b3b2970d843f99e7e6904bea05207" category="inline-link-macro">ONTAP 9.12.1に関する注意事項</block>
  <block id="0358f41254df2d512849db5a04b7e3d4" category="inline-link-macro">ONTAP 9.12.0の注意事項</block>
  <block id="28f1290102a277ef2fd452d558c74219" category="inline-link-macro">ONTAP 9.11.1の通知です</block>
  <block id="57b07f14c8eb4660f94a86d29d53362d" category="inline-link-macro">ONTAP 9.10.1 での通知</block>
  <block id="396712eb9c1644241047ac30619b2b3e" category="inline-link-macro">ONTAP 9.10.0に関する注意事項</block>
  <block id="1e6000d4849ef9f3e08d1d9908e9f163" category="inline-link-macro">ONTAP 9.9.1 に関する注意事項</block>
  <block id="6f408b9c999245c7aa32bc9cb1a020f6" category="inline-link-macro">ONTAP 9.8 に関する注意事項</block>
  <block id="04b0bd5b1b4d414fdde93f809162d36d" category="inline-link-macro">ONTAP 9.7 の場合の注意事項</block>
  <block id="0c1d7dffcba488555d5eb39b8991e822" category="inline-link-macro">ONTAP 9.6に関する注意事項</block>
  <block id="a11ac6880e72412c0f54ae19bea3d191" category="inline-link-macro">ONTAP 9.5 では次の点に注意</block>
  <block id="e49c3c01b15761b5f011d0bd2a0661a3" category="inline-link-macro">ONTAP 9.4 の注意事項</block>
  <block id="bf7dcf6467a8a03b05b2d37d31d6eccd" category="inline-link-macro">ONTAP 9.3 での注意</block>
  <block id="0328352fdfda84af6968462d1a67d3a6" category="inline-link-macro">ONTAP 9.2に関する注意事項</block>
  <block id="83904100c7d6fe0102e8b2b5bd8ec4bb" category="inline-link-macro">ONTAP 9.1に関する注意事項</block>
  <block id="5672f5979be77bb31dd559817c9e1e76" category="paragraph"><block ref="f7a2b1db149ed9886af0ce846dbc3e14" category="inline-link-macro-rx"></block>
<block ref="b349c509ad858348b30db7e73307e3aa" category="inline-link-macro-rx"></block>
<block ref="0dce234dfded58bd461541473b86e42a" category="inline-link-macro-rx"></block>
<block ref="9760ec4df13f0afbdfec88ae16c871ae" category="inline-link-macro-rx"></block>
<block ref="b6dab2933dfb92cf0c1355707a4aec7c" category="inline-link-macro-rx"></block>
<block ref="1b7c80b26162b03bd0addd587f70df55" category="inline-link-macro-rx"></block>
<block ref="14faf912aa42102a6628af4551e02583" category="inline-link-macro-rx"></block>
<block ref="a90f36d649d3be5d386cc3563ab044fb" category="inline-link-macro-rx"></block>
<block ref="2cd65b4a044075cfd9ad4a91f42fdff4" category="inline-link-macro-rx"></block>
<block ref="5e764cc3fdcc19ff667796e414159bdc" category="inline-link-macro-rx"></block>
<block ref="561451f09c7bca700ea0d7833cd9e92e" category="inline-link-macro-rx"></block>
<block ref="d23d341a344216fbf99a91152429d49c" category="inline-link-macro-rx"></block>
<block ref="b35e8fbd7b0369b23734510994911ec4" category="inline-link-macro-rx"></block>
<block ref="41d4305cf7a6acb595086f123121a781" category="inline-link-macro-rx"></block>
<block ref="ea685649fabe77da53e843fec56f72b8" category="inline-link-macro-rx"></block></block>
  <block id="07ee2fe6f236deffba69a7cf80a680fd" category="section-title">MCC IP向けONTAPメディエーター</block>
  <block id="f089ab2b9f25f609795bdd46ae636f18" category="inline-link-macro">9.9.1 ONTAP Mediator for MCC IPに関する通知</block>
  <block id="239794a299abe62705440f2dab3114cb" category="inline-link-macro">9.8 ONTAP Mediator for MCC IPに関する通知</block>
  <block id="51fcca20d278d2d03192c01120f17442" category="inline-link-macro">9.7 ONTAP Mediator for MCC IPに関する通知</block>
  <block id="3ba2aeb22339424d5f5b15dafd2c3eca" category="paragraph"><block ref="c8696a7854fcd089ea112145e4968b10" category="inline-link-macro-rx"></block>
<block ref="4d19e06382f392d0f1a50df789d77c13" category="inline-link-macro-rx"></block>
<block ref="fe4ac88b6b3f1cb9f1dc6d5d4b5086ee" category="inline-link-macro-rx"></block></block>
  <block id="9e476387322a5c250893cf9c5c4ce78c" category="doc">ポリシー</block>
  <block id="b9e18a3460bc17eb9ea65b03f0167453" category="paragraph">これはデータベースで一般的です。アクセス頻度の低いブロックが含まれていることがわかっているデータベースも、FabricPool階層化の候補になります。たとえば、サプライチェーン管理データベースには履歴情報が含まれている可能性があります。この情報は、必要に応じて利用できなければなりませんが、通常の運用中はアクセスできません。FabricPoolを使用すると、非アクティブなブロックを選択的に再配置できます。</block>
  <block id="95e955bbbe5dd9520a6bf45b0d8a9d4c" category="paragraph">たとえば、FabricPoolで実行されているデータファイルの場合、<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 90日の期間には、過去90日間にアクセスされたブロックがパフォーマンス階層に保持されます。ただし、90日間アクセスされなかったデータはすべて大容量階層に再配置されます。それ以外の場合は、通常のアプリケーションアクティビティで正しいブロックが正しい階層に保持されます。たとえば、データベースが通常、過去60日間のデータを定期的に処理するために使用されている場合、<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 期間を設定できるのは、アプリケーションの自然なアクティビティによって、ブロックが早期に再配置されないようにするためです。</block>
  <block id="c33af7c93d461803ceaf8531e861017d" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> データベースには注意してポリシーを使用する必要があります。多くのデータベースには、四半期末のプロセスやインデックスの再作成などの定期的なアクティビティがあります。これらの操作の期間が<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> パフォーマンスに問題が生じる可能性があります。たとえば、四半期末の処理で1TBのデータをまだ使用していない状態で処理する必要がある場合、そのデータは大容量階層に配置される可能性があります。大容量階層からの読み取りは非常に高速であることが多く、原因のパフォーマンスに問題はない可能性がありますが、正確な結果はオブジェクトストアの設定によって異なります。</block>
  <block id="03431a55183cb73a12c1bbc3e1927678" category="paragraph">。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> パフォーマンス階層で必要になる可能性のあるファイルを保持できるように、ポリシーを十分な高さに設定する必要があります。たとえば、最新の60日分のデータが必要でパフォーマンスが最適なデータベースでは、<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 60日までの期間。同様の結果は、ファイルのアクセスパターンに基づいても達成できます。たとえば、最新の90日間のデータが必要で、アプリケーションがその90日間のデータにアクセスしている場合、データは高パフォーマンス階層に残ります。を設定します<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> データの使用頻度が低下した場合は、2日間の期間でデータが階層化されます。</block>
  <block id="25d9496e96e698b08c4fc713bfc9a5ca" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> これらのブロックの階層化を推進するにはポリシーが必要です。これは、<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> ポリシーは、アクティブファイルシステム内のブロックに影響します。</block>
  <block id="55fad400d892fb6062e67904fa9be485" category="admonition">データにアクセスすると、ヒートマップデータがリセットされます。そのため、データベースのテーブル全体がスキャンされ、ソースファイルを読み取るバックアップアクティビティも行われるため、<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> しきい値に達していません。</block>
  <block id="117c4b6bad0236ab23e0fe29aead8aef" category="paragraph">LUNのサイズ変更は容量を拡張するためのオプションですが、一般にはOracle ASMなどのLVMを使用することを推奨します。LVMが存在する主な理由の1つは、LUNのサイズ変更を回避することです。LVMでは、複数のLUNが1つの仮想ストレージプールにボンディングされます。このプールから切り分けられた論理ボリュームはLVMで管理されるため、サイズを簡単に変更できます。もう1つの利点は、特定の論理ボリュームを使用可能なすべてのLUNに分散することで、特定のドライブ上のホットスポットを回避できることです。透過的な移行は、通常、ボリュームマネージャを使用して論理ボリュームの基盤となるエクステントを新しいLUNに再配置することで実行できます。</block>
  <block id="4d4855a15e1f9d6fd8f8bdf1668c537e" category="doc">手動強制NVFAIL</block>
  <block id="8772c1c8bed97f5c942657feeb8bfb6f" category="admonition">このセクションでは、基本的なONTAP NVFAILについて説明し、MetroCluster固有のトピックを扱います。</block>
  <block id="14d74316044293d1ebd8c5a01ff90055" category="paragraph">MetroClusterでは、少なくとも1台の他のコントローラのローカルNVRAMとNVRAMに書き込みが記録されるまで、書き込み確認は行われません。このアプローチにより、ハードウェア障害や停電が発生しても、転送中のI/Oが失われることはありません。ローカルのNVRAMに障害が発生したり、他のノードへの接続に障害が発生したりすると、データはミラーリングされなくなります。</block>
  <block id="d820d86d09ea05a0de19c3aacbfb72b2" category="paragraph">ローカルNVRAMからエラーが報告されると、ノードはシャットダウンします。このシャットダウンにより、HAペアが使用されている場合はパートナーコントローラにフェイルオーバーされます。MetroClusterでは、動作は選択した全体的な設定によって異なりますが、リモートノートに自動的にフェイルオーバーされる場合があります。いずれの場合も、障害が発生したコントローラが書き込み処理を認識していないため、データは失われません。</block>
  <block id="886174de078cee4595eb8a8d07f81703" category="paragraph">リモートノードへのNVRAMレプリケーションがブロックされるサイト間接続障害は、より複雑な状況です。書き込みがリモートノードにレプリケートされなくなるため、コントローラで重大なエラーが発生した場合にデータが失われる可能性があります。さらに重要なことは、このような状況で別のノードにフェイルオーバーしようとするとデータが失われることです。</block>
  <block id="790ec042c9b89dac2390ea81b9c29a51" category="paragraph">制御要素は、NVRAMが同期されているかどうかです。NVRAMが同期されていれば、ノード間のフェイルオーバーを安全に実行でき、データ損失のリスクはありません。MetroCluster構成では、NVRAMと基盤となるアグリゲートのプレックスが同期されていれば、データ損失のリスクなしにスイッチオーバーを安全に実行できます。</block>
  <block id="3d936bb059b98a2fc7c177d20eb755c9" category="paragraph">データが同期されていない場合、ONTAPは、フェイルオーバーまたはスイッチオーバーを強制的に実行しないかぎり、フェイルオーバーまたはスイッチオーバーを許可しません。この方法で条件を変更すると、元のコントローラにデータが残っている可能性があり、データ損失が許容されることが確認されます。</block>
  <block id="3d37a3a8ed77bebc986238aedccecbc9" category="paragraph">データベースは、ディスク上のデータのより大きな内部キャッシュを保持するため、フェイルオーバーやスイッチオーバーを強制的に実行した場合、データベースが破損する可能性が特に高くなります。強制的なフェイルオーバーまたはスイッチオーバーが発生した場合、以前に確認済みの変更は事実上破棄されます。ストレージアレイの内容は実質的に時間を逆方向に移動し、データベースキャッシュの状態はディスク上のデータの状態を反映しなくなります。</block>
  <block id="7ad23b7fa394c8666b132d78a58b1987" category="paragraph">この状況からアプリケーションを保護するために、ONTAPでは、NVRAMの障害に対する特別な保護をボリュームに設定できます。この保護メカニズムがトリガーされると、ボリュームがNVFAILという状態になります。この状態になると、古いデータを使用しないように原因アプリケーションをシャットダウンするI/Oエラーが発生します。確認済みの書き込みはストレージシステムに残っているため、データが失われることはありません。データベースの場合は、コミットされたトランザクションデータがログに含まれている必要があります。</block>
  <block id="99259586124503e22927506a7ed3738d" category="paragraph">次の手順では、管理者がホストを完全にシャットダウンしてから、LUNとボリュームを手動で再度オンラインに戻します。これらの手順にはいくつかの作業が含まれる可能性がありますが、このアプローチはデータの整合性を確保するための最も安全な方法です。すべてのデータがこの保護を必要とするわけではありません。そのため、NVFAILの動作はボリューム単位で設定できます。</block>
  <block id="13fbc5a220fe8007dcaea69217bba134" category="paragraph">サイト間に分散されているアプリケーションクラスタ（VMware、Oracle RACなど）でスイッチオーバーを強制的に実行する最も安全なオプションは、<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> コマンドラインで。このオプションは、キャッシュされたすべてのデータが確実にフラッシュされるようにするための緊急措置として使用できます。災害が発生したサイトにもともと配置されていたストレージリソースをホストが使用している場合、I/Oエラーまたは古いファイルハンドルのいずれかを受信します。 <block ref="a3c6541ac12f1f06a81cc9b03e6bd094" prefix="(" category="inline-code"></block>）エラー。Oracleデータベースがクラッシュし、ファイルシステムが完全にオフラインになるか、読み取り専用モードに切り替わります。</block>
  <block id="dc6683d37e50abd82911fa91c036fbb2" category="paragraph">スイッチオーバーの完了後、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> フラグをクリアし、LUNをオンラインにする必要があります。このアクティビティが完了したら、データベースを再起動できます。これらのタスクを自動化してRTOを短縮できます。</block>
  <block id="a2626552f293b2377efe829e69d14daa" category="section-title">dr-force-nvfail</block>
  <block id="f0cc4bbe3d196251009dbe9f0ac42ffc" category="paragraph">一般的な安全対策として、<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> 通常運用時にリモートサイトからアクセスされる可能性があるすべてのボリューム（フェイルオーバー前に使用されるアクティビティ）にフラグを付けます。この設定により、選択したリモートボリュームが<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> スイッチオーバー中。スイッチオーバーの完了後、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> フラグをクリアし、LUNをオンラインにする必要があります。これらのアクティビティが完了したら、アプリケーションを再起動できます。これらのタスクを自動化してRTOを短縮できます。</block>
  <block id="5f6aa76cc0fe886c07f242f921486ef7" category="paragraph">結果は、<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> 手動スイッチオーバーのフラグ。ただし、影響を受けるボリュームの数は、古いキャッシュを使用するアプリケーションまたはオペレーティングシステムから保護する必要があるボリュームだけに制限される場合があります。</block>
  <block id="4df566a29b44806612369c0c1f67521b" category="paragraph">を使用しない環境には、次の2つの重要な要件があります。<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> アプリケーションボリューム：</block>
  <block id="aaf1cc67bd88c39a71e691d413ded49f" category="list-text">強制スイッチオーバーは、プライマリサイトの障害から30秒以内に実行する必要があります。</block>
  <block id="7f9cc623e2a11875714cf4bc64f148fd" category="list-text">メンテナンスタスクの実行中や、SyncMirrorプレックスやNVRAMレプリケーションが同期されていないその他の状況では、スイッチオーバーを実行しないでください。最初の要件を満たすには、Tiebreakerソフトウェアを使用します。Tiebreakerソフトウェアは、サイト障害から30秒以内にスイッチオーバーを実行するように設定されています。これは、サイト障害が検出されてから30秒以内にスイッチオーバーを実行する必要があるという意味ではありません。これは、サイトが動作していることが確認されてから30秒が経過した場合に強制的にスイッチオーバーを実行しても安全ではないことを意味します。</block>
  <block id="0929cc8043c21dcf0163f06424677ede" category="paragraph">2つ目の要件は、MetroCluster構成が同期されていないことが判明した場合に、自動スイッチオーバー機能をすべて無効にすることで部分的に満たすことができます。NVRAMレプリケーションとSyncMirrorプレックスの健常性を監視できるTiebreaker解決策を使用することを推奨します。クラスタが完全に同期されていない場合、Tiebreakerはスイッチオーバーをトリガーしません。</block>
  <block id="a168430c68d0310385371eabe149a118" category="paragraph">NetApp MCTBソフトウェアは同期ステータスを監視できないため、何らかの理由でMetroClusterが同期されていない場合は無効にする必要があります。ClusterLionにはNVRAM監視機能とプレックス監視機能が搭載されており、MetroClusterシステムが完全に同期されていることが確認されないかぎり、スイッチオーバーをトリガーしないように設定できます。</block>
  <block id="baba038803e218b2ac3b2688bc2fd5db" category="doc">LUN数</block>
  <block id="b0e4db975ae00108abe9f47db9be5668" category="paragraph">LUNはONTAP上の仮想オブジェクトで、ホストしているアグリゲートのすべてのドライブにわたって配置されます。そのため、LUNはどのサイズを選択してもアグリゲートの潜在的なパフォーマンスを最大限に引き出すため、サイズによるLUNのパフォーマンスへの影響はありません。</block>
  <block id="7235d4b71fadc2fe03d09d863c7cdd66" category="paragraph">便宜上、特定のサイズのLUNを使用したい場合があります。たとえば、データベースを2つの1TB LUNで構成されるLVMまたはOracle ASMディスクグループ上に構築する場合、そのディスクグループは1TB単位で拡張する必要があります。8個の500GB LUNでディスクグループを構築し、ディスクグループの増分単位を小さくできるようにすることを推奨します。</block>
  <block id="4b1ffe65479a23391a2c7f9caf467a35" category="paragraph">汎用性に優れた標準LUNサイズを設定すると、管理が複雑になる可能性があるため、推奨されません。たとえば、標準サイズの100GBのLUNは、1TB~2TBのデータベースまたはデータストアの場合に適していますが、サイズが20TBのデータベースまたはデータストアには200個のLUNが必要です。つまり、サーバのリブート時間が長くなり、さまざまなUIで管理するオブジェクトが増え、SnapCenterなどの製品は多くのオブジェクトに対して検出を実行する必要があります。LUNのサイズを大きくすることで、このような問題を回避できます。</block>
  <block id="4afa3de974c36a09c2055d30989bb405" category="list-text">LUNの数は、サイズよりも重要です。</block>
  <block id="691c70133d96d57796a9299359666f80" category="list-text">LUNのサイズは、主に必要なLUN数によって決まります。</block>
  <block id="8af9e525c143179b948a11fc382a331e" category="list-text">必要以上の数のLUNを作成することは避けてください。</block>
  <block id="407b2218ad77513a7e3964f169d07e66" category="paragraph">LUNのサイズとは異なり、LUNの数はパフォーマンスに影響します。アプリケーションのパフォーマンスは、多くの場合、SCSIレイヤを介して並列I/Oを実行できるかどうかに左右されます。その結果、2つのLUNの方が単一のLUNよりもパフォーマンスが向上します。Veritas VxVM、Linux LVM2、Oracle ASMなどのLVMを使用すると、並列処理を強化する最も簡単な方法です。</block>
  <block id="39143fe6204f383e4ce3bb3b77926455" category="paragraph">NetAppのお客様は、LUNの数を16個以上に増やすことによるメリットはほとんどありませんが、ランダムI/Oが非常に大きい100% SSD環境のテストでは、最大64個のLUNがさらに向上していることが実証されています。</block>
  <block id="9875f7503e59521e91e519abd87f5c9e" category="paragraph">* NetAppの推奨事項*：</block>
  <block id="57153ab478a4958250d76ac6bf4e3ac0" category="paragraph">一般に、あらゆるデータベースワークロードのI/Oニーズに対応するには、4~16個のLUNで十分です。LUNを4つ未満にすると、ホストのSCSI実装の制限が原因でパフォーマンスが制限される可能性があります。</block>
  <block id="de932976b195d4755fcbea64295fc7cb" category="doc">ホストOSの設定</block>
  <block id="f62cb371f65c322cd9e17a5c2cecd1c8" category="paragraph">ほとんどのアプリケーションベンダーのドキュメントには、アプリケーションが最適に動作することを確認するためのTCPおよびイーサネットの設定が含まれています。これらの設定は通常、IPベースのストレージパフォーマンスを最適化するのに十分です。</block>
  <block id="ae7a0bb210cbd1edb935128116a21c55" category="section-title">イーサネットフロー制御</block>
  <block id="a3c15fb208efc85bdfe72c57d56c92b8" category="paragraph">このテクノロジを使用すると、クライアントは送信者にデータ転送を一時的に停止するように要求できます。これは通常、受信側が受信データを十分に迅速に処理できないために行われます。一時期、送信者に送信の中止を要求しても、バッファがいっぱいになったために受信者がパケットを破棄するよりも、中断が少なくて済みました。現在OSで使用されているTCPスタックでは、これは当てはまりません。実際、フロー制御は解決するよりも多くの問題を引き起こします。</block>
  <block id="950d31923e253d170d6c994801ce7cec" category="paragraph">近年、イーサネットフロー制御に起因するパフォーマンスの問題が増加しています。これは、イーサネットフロー制御が物理レイヤで動作するためです。ネットワーク構成で、任意のホストOSからストレージシステムへのイーサネットフロー制御要求の送信が許可されていると、接続されているすべてのクライアントのI/Oが一時停止します。1台のストレージコントローラで対応するクライアントの数が増えているため、1台以上のクライアントがフロー制御要求を送信する可能性が高くなります。この問題は、OSの仮想化が広範に行われているお客様のサイトで頻繁に発生しています。</block>
  <block id="6bfd8563627c68f73c30581843441a74" category="paragraph">NetAppシステム上のNICは、フロー制御要求を受信しないでください。この結果を得る方法は、ネットワークスイッチの製造元によって異なります。ほとんどの場合、イーサネットスイッチのフロー制御は次のように設定できます。<block ref="a67b5ddb674c9ca32d9c9e1ca81578ee" prefix=" " category="inline-code"></block> または<block ref="f4eb0bfa09695eb47ff4f3bd3ca4449d" prefix=" " category="inline-code"></block>これは、フロー制御要求がストレージコントローラに転送されないことを意味します。それ以外の場合は、ストレージコントローラのネットワーク接続でフロー制御の無効化が許可されないことがあります。このような場合は、ホストサーバ自体またはホストサーバが接続されているスイッチポートのNIC設定に変更して、フロー制御要求を送信しないようにクライアントを設定する必要があります。</block>
  <block id="7496f3ff64e30d4732c2c64880faf186" category="admonition">* NetAppでは* NetAppストレージコントローラがイーサネットフロー制御パケットを受信しないようにすることを推奨しています。これは通常、コントローラが接続されているスイッチポートを設定することで実行できますが、一部のスイッチハードウェアには制限があり、代わりにクライアント側の変更が必要になる場合があります。</block>
  <block id="ae6d0fc57efaf02ad7dfdacd3575e315" category="section-title">MTUサイス</block>
  <block id="ff13ea04765cd9c9aed7b839f15eb2b4" category="paragraph">ジャンボフレームを使用すると、CPUとネットワークのオーバーヘッドが軽減され、1Gbネットワークのパフォーマンスがある程度向上することが示されていますが、通常はそれほど大きなメリットはありません。</block>
  <block id="ee3f364287a30ef10dfdce2f37d94ed2" category="admonition">* NetAppでは、可能な限りジャンボフレームを実装することを推奨しています。これは、パフォーマンス上のメリットを実現し解決策、将来のニーズにも対応するためです。</block>
  <block id="2c6ba27b7ed602a9089da6ad9f762c9a" category="paragraph">10Gbネットワークではジャンボフレームの使用がほぼ必須です。これは、ほとんどの10Gb環境では、ジャンボフレームを使用しないと10Gbに達する前に1秒あたりのパケット数が制限されるためです。ジャンボフレームを使用すると、OS、サーバ、NIC、およびストレージシステムで処理できるパケットの数は少なくても大きいため、TCP / IP処理の効率が向上します。パフォーマンスの向上はNICによって異なりますが、大幅に向上します。</block>
  <block id="a44be1bbfde97e4a64b50282325165e7" category="paragraph">ジャンボフレームの実装では、接続されているすべてのデバイスでジャンボフレームがサポートされている必要があり、MTUサイズがエンドツーエンドで同じである必要があるという誤った考えがよくあります。代わりに、2つのネットワークエンドポイントは、接続を確立するときに、相互に許容可能な最大フレームサイズをネゴシエートします。一般的な環境では、ネットワークスイッチのMTUサイズは9216、NetAppコントローラは9000、クライアントは9000と1514が混在するように設定されています。MTU 9000をサポートできるクライアントはジャンボフレームを使用でき、1514しかサポートできないクライアントは低い値をネゴシエートできます。</block>
  <block id="a31484167f31e1c3f36f7cea821bc581" category="paragraph">完全にスイッチが接続された環境では、この構成に問題が生じることはほとんどありません。ただし、ルーティングされた環境では、中間ルータが強制的にジャンボフレームをフラグメント化しないように注意してください。</block>
  <block id="c805e9846e6fca449dbe3233cc5dbdf5" category="paragraph">* NetAppでは*次の設定を推奨しています。</block>
  <block id="b4446b5ca60d915111af271495bd4c17" category="list-text">ジャンボフレームの使用を推奨しますが、1Gbイーサネット（GbE）の場合は必須ではありません。</block>
  <block id="5b1ea13ac12a9c8be0d09303f637dba4" category="list-text">10GbE以上の速度で最大のパフォーマンスを実現するには、ジャンボフレームが必要です。</block>
  <block id="08a8dce78637f5dd14ed052163feb9da" category="section-title">TCPパラメータ</block>
  <block id="1a999618685598bee637262fe589de70" category="paragraph">TCPタイムスタンプ、選択的確認応答（SACK）、TCPウィンドウスケーリングの3つの設定が誤って設定されることがよくあります。インターネット上の古いドキュメントの多くは、パフォーマンスを向上させるために、これらのパラメータの1つまたは複数を無効にすることを推奨しています。CPU能力がはるかに低く、TCP処理のオーバーヘッドを可能な限り削減できるというメリットが何年も前にあったこの推奨事項には、いくつかのメリットがありました。</block>
  <block id="6a594ec6f0bb742c1d2b0f631cf65ba1" category="paragraph">ただし、最新のOSでは、これらのTCP機能のいずれかを無効にしても、通常は検出できるメリットはなく、パフォーマンスも低下する可能性があります。特に仮想ネットワーク環境では、パケット損失やネットワーク品質の変化を効率的に処理するためにこれらの機能が必要になるため、パフォーマンスが低下する可能性があります。</block>
  <block id="cdc44d05b1633e8a8c7835010c423dd6" category="admonition">* NetAppでは、ホストでTCPタイムスタンプ、SACK、TCPウィンドウスケーリングを有効にすることを推奨しています。現在のOSでは、これら3つのパラメータはすべてデフォルトでオンにする必要があります。</block>
  <block id="72a921ac9177188a9be32ec711fc15d8" category="doc">パスアクセス</block>
  <block id="544c599da087dba677a820c3df344503" category="paragraph">SnapMirrorビジネス継続性（SM-BC）は、SAN向けに強化されたSnapMirror機能です。これにより、ホストは、LUNをホストするシステムとレプリカをホストするシステムの両方からLUNにアクセスできます。</block>
  <block id="6139cdabb39d5ceac18a60642497c6a7" category="paragraph">SM-BCとSnapMirror Sync（SM-S）はレプリケーションエンジンを共有しますが、SM-BCには、エンタープライズアプリケーションの透過的なアプリケーションフェイルオーバーやフェイルバックなどの機能が追加されています。</block>
  <block id="a73743f15de974052b0640c60f489d90" category="paragraph">実際には、個 々 のワークロードに対して選択的かつきめ細かなRPO=0の同期レプリケーションを有効にすることで、MetroClusterのきめ細かなバージョンと同様に機能します。下位レベルのパスの動作はMetroClusterとは大きく異なりますが、ホスト側から見た結果はほぼ同じです。</block>
  <block id="b3bf85c7b0a17286752c110f404a7035" category="paragraph">SM-BCを使用すると、プライマリとリモートの両方のストレージアレイから、ホストオペレーティングシステムからストレージデバイスを認識できるようになります。パスは、ストレージシステムとホストの間の最適なパスを特定するための業界標準プロトコルであるAsymmetric Logical Unit Access（ALUA；非対称論理ユニットアクセス）を通じて管理されます。</block>
  <block id="cbf0bd4f4096570f567049c984f8c9d3" category="paragraph">I/Oへのアクセスに最も短いデバイスパスはアクティブ/最適パスとみなされ、残りのパスはアクティブ/非最適パスとみなされます。</block>
  <block id="350b9208772a185e0d0943b105765d89" category="paragraph">SM-BC関係は、異なるクラスタにあるSVMのペア間の関係です。どちらのSVMもデータを提供できますが、ALUAは、LUNが配置されているドライブの所有権を現在持っているSVMを優先的に使用します。リモートSVMへのIOは、SM-BCインターコネクト経由でプロキシされます。</block>
  <block id="341d84aa26cb4521474864e04ea2a63b" category="inline-image-macro">エラー：グラフィックイメージがありません</block>
  <block id="532db5273379dd6149d97b7ab6e420b6" category="paragraph"><block ref="532db5273379dd6149d97b7ab6e420b6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b56265ceb6311e42003e668438136a59" category="section-title">同期レプリケーション</block>
  <block id="8159c40a86db91b72e00c2eb5cf751fe" category="paragraph">通常の運用では、1つの例外を除き、リモートコピーは常にRPO=0の同期レプリカです。データをレプリケートできない場合、SM-BCはデータのレプリケート要件を解放し、IOの提供を再開します。このオプションは、レプリケーションリンクの損失がほぼ災害になると考えているお客様や、データをレプリケートできないときに業務の停止を望まないお客様に適しています。</block>
  <block id="0cf4a786acebd750bbfdfc4416c89406" category="section-title">ストレージハードウェア</block>
  <block id="f0fd4c8ee2422af8e335cc85c485ccbf" category="paragraph">他のストレージディザスタリカバリソリューションとは異なり、SM-BCは非対称プラットフォームの柔軟性を提供します。各サイトのハードウェアが同一である必要はありません。この機能により、SM-BCのサポートに使用するハードウェアのサイズを適正化できます。リモートストレージシステムは、本番環境のワークロードを完全にサポートする必要がある場合はプライマリサイトと同一にすることができますが、災害によってI/Oが減少した場合は、リモートサイトの小規模システムよりも対費用効果が高くなります。</block>
  <block id="ea9f3de5dd21190fbc6bca180b2040f1" category="section-title">ONTAPメディエーター</block>
  <block id="b378eb5f2b386494f24a3f09afd8ae1f" category="paragraph">ONTAPメディエーターは、NetAppサポートからダウンロードするソフトウェアアプリケーションです。Mediatorは、プライマリサイトとリモートサイトの両方のストレージクラスタのフェイルオーバー処理を自動化します。オンプレミスまたはクラウドでホストされた小規模な仮想マシン（VM）に導入できます。設定後は、両方のサイトのフェイルオーバーシナリオを監視するための第3のサイトとして機能します。</block>
  <block id="0f54fb931dbdeea735f18a8e73f9eab5" category="doc">SyncMirrorによるデータ保護</block>
  <block id="d7023f86951b6c3c009891a468c3effd" category="paragraph">最も簡単な意味では、同期レプリケーションとは、変更がミラーされたストレージの両側に対して確認応答される前に行われなければならないことを意味します。たとえば、データベースがログを書き込んでいる場合やVMwareゲストにパッチを適用している場合は、書き込みが失われることはありません。プロトコルレベルでは、両方のサイトの不揮発性メディアにコミットされるまで、ストレージシステムは書き込みを確認応答しないでください。その場合にのみ、データ損失のリスクなしに作業を安全に進めることができます。</block>
  <block id="eee4f7a4e0ed3a8646a97bcf3e118fb9" category="paragraph">同期レプリケーションテクノロジの使用は、同期レプリケーション解決策を設計および管理するための最初のステップです。最も重要な考慮事項は、計画的および計画外のさまざまな障害シナリオで何が発生するかを理解することです。すべての同期レプリケーションソリューションが同じ機能を提供するわけではありません。Recovery Point Objective（RPO；目標復旧時点）がゼロ（つまりデータ損失ゼロ）の解決策が必要な場合は、すべての障害シナリオを考慮する必要があります。特に、サイト間の接続が失われてレプリケーションが不可能になった場合、どのような結果が予想されますか。</block>
  <block id="71554672a088c43ab21c759ddd161928" category="section-title">SyncMirrorデータの可用性</block>
  <block id="bec293a9cf8e49ec40e6a4fdc02b9146" category="paragraph">MetroClusterレプリケーションは、同期モードに効率的に切り替えられるように設計されたNetApp SyncMirrorテクノロジに基づいています。この機能は、同期レプリケーションを必要とする一方で、データサービスに高可用性も必要とするお客様の要件を満たします。たとえば、リモートサイトへの接続が切断されている場合は、通常、ストレージシステムを非レプリケート状態で動作させておくことを推奨します。</block>
  <block id="9a9ce41f4b23474045b6c6e0ac7752af" category="paragraph">多くの同期レプリケーションソリューションは、同期モードでしか動作できません。このタイプのall-or-nothingレプリケーションは、Dominoモードと呼ばれることがあります。このようなストレージシステムは、データのローカルコピーとリモートコピーが非同期になるのではなく、データの提供を停止します。レプリケーションが強制的に解除された場合、再同期には非常に時間がかかり、ミラーリングの再確立中にデータが完全に失われる可能性があります。</block>
  <block id="8646bb558f8f18a200cce2f70602627a" category="paragraph">リモートサイトに到達できない場合にSyncMirrorを同期モードからシームレスに切り替えることができるだけでなく、接続がリストアされたときにRPO=0状態に迅速に再同期することもできます。再同期中にリモートサイトにある古いデータコピーを使用可能な状態で保持することもできるため、データのローカルコピーとリモートコピーを常に維持できます。</block>
  <block id="995f5151d2d1c0a4e8371b2b3c9b6e5b" category="paragraph">Dominoモードが必要な場合、NetAppはSnapMirror Synchronous（SM-S）を提供します。Oracle DataGuardや、ホスト側のディスクミラーリングのタイムアウト延長など、アプリケーションレベルのオプションもあります。追加情報とオプションについては、担当のNetAppまたはパートナーアカウントチームにお問い合わせください。</block>
  <block id="1d12d7a206d9b5337ae6fa442f23d377" category="doc">Snapshotのみ</block>
  <block id="64c29f2f2feedeb607ff588b13d9758b" category="paragraph">。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block><block ref="964193481f440d73ce3474a7a09bc3ac" prefix=" " category="inline-code"></block> アクティブファイルシステムと共有されていないブロックにのみ適用されます。基本的には、データベースバックアップの階層化につながります。Snapshotが作成されてそのブロックが上書きされると、ブロックが階層化の候補となり、その結果、Snapshot内にのみ存在するブロックが作成されます。Aの前の遅延<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> ブロックは冷却されていると見なされ、によって制御されます。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> ボリュームの設定。ONTAP 9.8で指定できる範囲は2～183日です。</block>
  <block id="ebd9889c847a7a3ddeccd2717ead46f2" category="paragraph">多くのデータセットは変更率が低いため、このポリシーによる削減効果は最小限に抑えられます。たとえば、ONTAPで観察される一般的なデータベースの変更率は、週あたり5%未満です。データベースのアーカイブログは大量のスペースを占有することがありますが、通常はアクティブファイルシステムに引き続き存在するため、このポリシーでは階層化の対象になりません。</block>
  <block id="06b9281e396db002010bde1de57262eb" category="section-title">自動</block>
  <block id="ecf602bd5abbd6a605debedbb6c3d4e0" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 階層化ポリシーは、階層化をSnapshot固有のブロックだけでなく、アクティブなファイルシステム内のブロックにも拡張します。ブロックが冷却されるまでの遅延は、<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> ボリュームの設定。ONTAP 9.8で指定できる範囲は2～183日です。</block>
  <block id="6256ce48698ff0bde6f818679cdfb382" category="paragraph">このアプローチでは、では使用できない階層化オプションが有効になります。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> ポリシー：たとえば、データ保護ポリシーで特定のログファイルを90日間保持する必要がある場合があります。クーリング期間を3日に設定すると、3日を超過した古いログファイルがパフォーマンスレイヤから階層化されます。この操作により、パフォーマンス階層のかなりのスペースが解放されると同時に、90日間分のすべてのデータを表示して管理することができます。</block>
  <block id="6adf97f83acf6453d4a6a4b1070f3754" category="section-title">なし</block>
  <block id="7026ff5c5d4ab3946ff2d86f0e2cca6f" category="paragraph">。<block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix=" " category="inline-code"></block> 階層化ポリシーを使用すると、追加のブロックがストレージレイヤから階層化されなくなりますが、大容量階層のデータは読み取りが行われるまで大容量階層に残ります。その後ブロックが読み取られると、元に戻されてパフォーマンス階層に配置されます。</block>
  <block id="d152c7b0939fb6d35fdb0433de0d6369" category="paragraph">を使用する主な理由は、<block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix=" " category="inline-code"></block> 階層化ポリシーはブロックが階層化されないようにするためのものですが、時間の経過とともにポリシーを変更すると便利です。たとえば、あるデータセットが大容量レイヤに階層化されているとしますが、完全なパフォーマンス機能が予期せず必要になったとします。このポリシーを変更すると、追加の階層化が不要になり、I/Oの増加に伴って読み取られたブロックがパフォーマンス階層に残るようにすることができます。</block>
  <block id="b1c94ca2fbc3e78fc30069c8d0f01680" category="section-title">すべて</block>
  <block id="84826d7e23dfac7549819d5115fdcedd" category="paragraph">。<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 階層化ポリシーで置き換えられる<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> ONTAP 9.6以降のポリシー。。<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> データ保護ボリューム（SnapMirrorまたはNetApp SnapVaultのデスティネーション）にのみ適用されるポリシー。。<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> ポリシーの機能は同じですが、データ保護ボリュームに限定されません。</block>
  <block id="10d8500e282e8bbacd668af6f773f412" category="paragraph">このポリシーでは、ブロックはすぐにクールとみなされ、すぐに容量レイヤに階層化できるようになります。</block>
  <block id="ec583de0216b95bc673c84e4ec9356e6" category="paragraph">このポリシーは、長期的なバックアップに特に適しています。Hierarchical Storage Management（HSM；階層型ストレージ管理）の一種としても使用できます。以前は、ファイルシステム上でファイル自体を認識したまま、ファイルのデータブロックをテープに階層化するためにHSMが一般的に使用されていました。FabricPoolボリューム<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> ポリシーを使用すると、表示および管理可能なにファイルを格納できますが、ローカルストレージ階層のスペースはほとんど消費しません。</block>
  <block id="79768a069a539d4f130e672a660bf45f" category="doc">ゾーニング</block>
  <block id="79da1502ddfac887bfdf0d92f2428fe6" category="paragraph">これには、ホストとストレージシステムの間のSANに十分な帯域幅があることを確認し、必要なすべてのデバイス間にすべてのSANパスが存在することを確認し、FCスイッチベンダーが必要とするFCポート設定を使用してISLの競合を回避するなど、一般的な計画方法が含まれます。 SANファブリックを適切に監視します。</block>
  <block id="a0bdb98e8b9da585816478d24278e42f" category="paragraph">FCゾーンに複数のイニシエータを含めることはできません。このような配置は最初は機能しているように見えるかもしれませんが、最終的にはイニシエータ間のクロストークがパフォーマンスと安定性の妨げになります。</block>
  <block id="8ef958d9e25538841b306960ab117626" category="paragraph">マルチターゲットゾーンは一般に安全とみなされますが、まれに、ベンダーが異なるFCターゲットポートの動作が問題を引き起こすことがあります。たとえば、NetAppとネットアップ以外のストレージアレイのターゲットポートを同じゾーンに配置することは避けてください。また、NetAppストレージシステムとテープデバイスを同じゾーンに配置すると、原因の問題が発生する可能性がさらに高くなります。</block>
  <block id="642223473862db290604321fe2ebe763" category="doc">SVM</block>
  <block id="47ea917cf14ad91c68c407f90a7a189d" category="paragraph">SVMは、ONTAP CLIではSVMと呼ばれ、ストレージの基本的な機能ユニットであり、VMware ESXサーバ上のゲストと比較すると便利です。</block>
  <block id="9efbaa34de852e33319ca8ceb1861832" category="paragraph">ESXを最初にインストールした時点では、ゲストOSのホストやエンドユーザアプリケーションのサポートなど、事前に設定された機能はありません。仮想マシン（VM）が定義されるまでは空のコンテナです。ONTAPも同様です。ONTAPを最初にインストールした時点では、SVMが作成されるまでデータを提供する機能はありません。データサービスはSVMの特性によって定義されます。</block>
  <block id="13ce2622b2cc2118c44d3aae7df8167d" category="paragraph">ストレージアーキテクチャの他の要素と同様に、SVMと論理インターフェイス（LIF）の設計に最適なオプションは、拡張要件とビジネスニーズによって大きく異なります。</block>
  <block id="8fb41a27984f0beba2e12fb920a486aa" category="paragraph">ONTAP用にSVMをプロビジョニングする公式のベストプラクティスはありません。適切なアプローチは、管理要件とセキュリティ要件によって異なります。</block>
  <block id="f4d8541bb6d07f7533a6b5aa6cfb2455" category="paragraph">ほとんどのお客様は、プライマリSVMを1つ運用して日常的な要件のほとんどに対応しつつ、特殊なニーズに対応するSVMを少数作成しています。たとえば、次のようなものを作成できます。</block>
  <block id="259908e9e431c0fbb9d425249ceb7930" category="list-text">スペシャリストチームが管理する重要なビジネスデータベース用のSVM</block>
  <block id="0e10f2715884f3538282397d69b2cd00" category="list-text">開発グループ用のSVM。独自のストレージを個別に管理できるように、完全な管理権限が与えられています。</block>
  <block id="7624156e307247e4ea1ec8bf574136a1" category="list-text">人事や財務報告のデータなど、機密性の高いビジネスデータを格納するSVM。管理チームを限定する必要がある</block>
  <block id="e5e09031843479ef9ef8cbbd4c2f404c" category="inline-link-macro">NetApp Hardware Universe の略</block>
  <block id="bd32656670155eb09690047819fc0971" category="paragraph">マルチテナント環境では、各テナントのデータに専用のSVMを割り当てることができます。クラスタ、HAペア、およびノードあたりのSVMとLIFの数の上限は、使用するプロトコル、ノードモデル、およびONTAPのバージョンによって異なります。  を参照してください <block ref="41f66f34b3a905f864500c9319fdff8f" category="inline-link-macro-rx"></block> これらの限界のために。</block>
  <block id="fb012f1e7970d8285bd5d6c5a7f7d523" category="doc">SSDアグリゲート（AFFシステムを含む）</block>
  <block id="cb8e4651c457f71d5788f38eac01471f" category="paragraph">空きスペースとは実際のデータに使用されていないスペースのことで、アグリゲート自体の未割り当てスペースやコンスティチュエントボリューム内の未使用スペースを含みます。シンプロビジョニングも考慮する必要があります。たとえば、あるボリュームに含まれている1TBのLUNのうち、実際のデータに使用されているのは50%だけであるとします。シンプロビジョニング環境では、500GBのスペースが消費されているように見えます。ただし、フルプロビジョニング環境では、1TBの全容量が使用中と表示されます。500GBの未割り当てスペースは非表示になります。このスペースは実際のデータには使用されていないため、空きスペースの合計の計算に含める必要があります。</block>
  <block id="d3487661d9a0702bd5915d49070f62dc" category="paragraph">エンタープライズアプリケーションに使用するストレージシステムに関するNetAppの推奨事項は次のとおりです。</block>
  <block id="678e476783bceae80094bcb4c1f32969" category="admonition">* NetAppでは*最低10%の空き容量を推奨しています。これには、アグリゲートまたはボリューム内の空きスペース、フルプロビジョニングのために割り当てられているが実際のデータには使用されていない空きスペースなど、すべての未使用スペースが含まれます。論理スペースは重要ではありません。問題は、データストレージに実際に使用できる物理的な空きスペースの量です。</block>
  <block id="2171d172d184f1202a686849c85dce91" category="paragraph">推奨される10%の空きスペースは非常に控えめな値です。SSDアグリゲートでは、パフォーマンスに影響を与えることなく、さらに高い利用率でワークロードをサポートできます。ただし、アグリゲートの使用率が高くなると、使用率を注意深く監視しないと、スペースが不足するリスクも高まります。さらに、容量99%でシステムを実行している場合はパフォーマンスが低下することはありませんが、ハードウェアの追加発注時にシステムが完全にいっぱいにならないように管理作業が必要になる可能性があり、追加のドライブの調達と取り付けに時間がかかることがあります。</block>
  <block id="789243e17acb0b134f435d6c4c1350f2" category="section-title">HDDアグリゲート（Flash Poolアグリゲートを含む）</block>
  <block id="7302e9f16fb8c5bc30f6035fe4098b52" category="admonition">* NetAppでは*回転式ドライブを使用する場合は、最低15%の空き容量を確保することを推奨しています。これには、アグリゲートまたはボリューム内の空きスペース、フルプロビジョニングのために割り当てられているが実際のデータには使用されていない空きスペースなど、すべての未使用スペースが含まれます。言論の自由が10%に近づくと、パフォーマンスに影響が出ます。</block>
  <block id="0b0a68e2dedde9c0b9a3ea4276f4b85c" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> ポリシーは、バックアップデータに最も適したポリシーです。これにより、ファイルが削除されたか、プライマリファイルシステムに引き続き存在しているかに関係なく、クーリングしきい値に達したときに迅速に階層化されます。必要となる可能性があるすべてのファイルをアクティブファイルシステムの1つの場所に格納することも、管理を簡易化します。リストアが必要なファイルを特定するためにSnapshotを検索する必要はありません。</block>
  <block id="11a75a1257cc68a4a46bc553dabe0c0d" category="paragraph">。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> ポリシーは機能するように設定できますが、アクティブファイルシステムに存在しなくなった環境ブロックのみが対象となります。そのため、データを階層化するには、まずNFS共有またはSMB共有上のファイルを削除する必要があります。</block>
  <block id="b4af96e8cea99b56592db816cab30fce" category="paragraph">LUNからファイルを削除するとファイル参照がファイルシステムのメタデータから削除されるだけなので、このポリシーはLUN設定の場合はさらに効率的ではありません。LUN上の実際のブロックは、上書きされるまでそのまま維持されます。このような状況では、ファイルが削除されてブロックが上書きされて階層化の候補になるまでに長時間の遅延が発生する可能性があります。の移動にはいくつかの利点があります。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> ブロックは大容量階層に移動しますが、全体的にはバックアップデータのFabricPool管理が最適なのは、<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> ポリシー：</block>
  <block id="1c237d1ebcdeff13ae0145c741d9401d" category="admonition">このアプローチは、バックアップに必要なスペースをより効率的に管理するのに役立ちますが、FabricPool自体はバックアップテクノロジではありません。バックアップファイルをオブジェクトストアに階層化すると、ファイルは元のストレージシステムに引き続き表示されるため、管理が簡易化されますが、オブジェクトストアデスティネーションのデータブロックは元のストレージシステムに依存します。ソースボリュームが失われると、オブジェクトストアのデータを使用できなくなります。</block>
  <block id="a19665c8f7c0210f96ad2934ad0ee361" category="paragraph">ONTAPシステムでは、ストレージは4KB単位で編成されます。データベースまたはファイルシステムの8KBブロックは、4KBブロック2個に正確にマッピングする必要があります。LUNの構成エラーによってアライメントがいずれかの方向に1KBずれた場合、8KBの各ブロックは、4KBのストレージブロックが2つではなく3つに配置されます。このようにすると、原因によってレイテンシが増加し、ストレージシステム内で実行される原因の追加I/Oが発生します。</block>
  <block id="211a9fe299057fe8665b591dddbac56d" category="paragraph">アライメントはLVMアーキテクチャにも影響します。論理ボリュームグループ内の物理ボリュームがドライブデバイス全体に定義されている場合（パーティションは作成されません）、LUN上の最初の4KBブロックがストレージシステム上の最初の4KBブロックとアライメントされます。これは正しいアライメントです。パーティションで問題が発生するのは、OSがLUNを使用する開始場所が変わるためです。オフセットが4KB単位でずれているかぎり、LUNはアライメントされます。</block>
  <block id="7c8a0aad1f59988f8160921a07203bb4" category="paragraph">Linux環境では、ドライブデバイス全体に論理ボリュームグループを構築します。パーティションが必要な場合は、次のコマンドを実行してアライメントを確認します。<block ref="16ae8c2dc7757a3180ce37bad780251a" prefix=" " category="inline-code"></block> 各パーティションの開始が8の倍数であることを確認します。つまり、パーティションは8の倍数の512バイトセクター（4KB）から開始されます。</block>
  <block id="e98a692d783d8d778aab49ed4c55e214" category="doc">サイト障害からの保護：NVRAMとMetroCluster</block>
  <block id="186577daf29184ed8a55cf899ba2979c" category="paragraph">MetroClusterは、次の方法でNVRAMデータ保護を拡張します。</block>
  <block id="679f5a5873d7d3378cf4b3035fd5cb13" category="list-text">2ノード構成では、NVRAMデータがスイッチ間リンク（ISL）を使用してリモートパートナーにレプリケートされます。</block>
  <block id="00bec98f52b9151dd2e0c760becd4ca8" category="list-text">HAペア構成では、NVRAMデータがローカルパートナーとリモートパートナーの両方にレプリケートされます。</block>
  <block id="94deccfbf8f798c1661000b27a568b18" category="list-text">書き込みは、すべてのパートナーにレプリケートされるまで確認応答されません。このアーキテクチャは、NVRAMデータをリモートパートナーにレプリケートすることで、転送中のI/Oをサイト障害から保護します。このプロセスは、ドライブレベルのデータレプリケーションには関係ありません。アグリゲートを所有するコントローラは、アグリゲート内の両方のプレックスに書き込むことでデータレプリケーションを実行しますが、サイトが失われた場合でも転送中のI/Oの損失からデータを保護する必要があります。レプリケートされたNVRAMデータは、障害が発生したコントローラをパートナーコントローラがテイクオーバーする必要がある場合にのみ使用されます。</block>
  <block id="996aa1ed8a906e55c7f157a1643021b7" category="section-title">サイトおよびシェルフ障害からの保護：SyncMirrorとプレックス</block>
  <block id="1c114a932963683e04dc7dece97c15c9" category="paragraph">SyncMirrorは、RAID DPやRAID-TECを強化するミラーリングテクノロジですが、これに代わるものではありません。2つの独立したRAIDグループの内容をミラーリングします。論理構成は次のとおりです。</block>
  <block id="b4b4f1d65cb5f1370402220b00584e79" category="list-text">ドライブは、場所に基づいて2つのプールに構成されます。1つのプールはサイトAのすべてのドライブで構成され、2つ目のプールはサイトBのすべてのドライブで構成されます。</block>
  <block id="418f0763b76bff8e324f1afdd5456b49" category="list-text">次に、アグリゲートと呼ばれる共通のストレージプールが、RAIDグループのミラーセットに基づいて作成されます。各サイトから同じ数のドライブが引き出されます。たとえば、20ドライブのSyncMirrorアグリゲートは、サイトAの10本のドライブとサイトBの10本のドライブで構成されます。</block>
  <block id="51bf74357f742acfa0a7cd11ce52ed7f" category="list-text">サイト上の各ドライブセットは、ミラーリングを使用せずに、完全に冗長化された1つ以上のRAID DPグループまたはRAID-TECグループとして自動的に構成されます。ミラーリングの下でRAIDを使用することで、サイトが失われた場合でもデータを保護できます。</block>
  <block id="8a35ad1e53533c7a3a8ff427bda0deb2" category="paragraph"><block ref="8a35ad1e53533c7a3a8ff427bda0deb2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="abf64dbc3ac20af1b4a30150a016ca58" category="paragraph">上の図は、SyncMirror構成の例を示しています。24ドライブのアグリゲートをコントローラに作成しました。このアグリゲートは、サイトAで割り当てられたシェルフの12本のドライブと、サイトBで割り当てられたシェルフの12本のドライブで構成されています。ドライブは2つのミラーRAIDグループにグループ化されました。RAIDグループ0には、サイトAの6ドライブのプレックスが含まれており、サイトBの6ドライブのプレックスにミラーリングされています。同様に、RAIDグループ1にはサイトAの6ドライブのプレックスが含まれており、サイトBの6ドライブのプレックスにミラーリングされています。</block>
  <block id="d9945e1dbadc87ba8e52a5e69376005c" category="paragraph">SyncMirrorは通常、MetroClusterシステムにリモートミラーリングを提供するために使用され、各サイトにデータのコピーが1つずつ配置されます。場合によっては、1つのシステムで追加レベルの冗長性を提供するために使用されます。特に、シェルフレベルの冗長性を提供します。ドライブシェルフにはすでにデュアル電源装置とコントローラが搭載されており、全体的には板金をほとんど使用していませんが、場合によっては追加の保護が保証されることがあります。たとえば、あるNetAppのお客様は、自動車テストで使用するモバイルリアルタイム分析プラットフォームにSyncMirrorを導入しています。システムは、独立した電源供給と独立したUPSシステムを備えた2つの物理ラックに分かれていました。</block>
  <block id="f3495a1e6cf563a617c71164f3b11ca3" category="section-title">冗長性エラー：NVFAIL</block>
  <block id="c7474a3ed1a224804e4741a256bdd953" category="paragraph">前述したように、書き込みの確認応答は、少なくとも1台の他のコントローラでローカルのNVRAMとNVRAMに記録されるまで返されません。このアプローチにより、ハードウェア障害や停電が発生しても、転送中のI/Oが失われることはありません。ローカルのNVRAMに障害が発生したり、他のノードへの接続に障害が発生したりすると、データはミラーリングされなくなります。</block>
  <block id="4774101e81ea03c43fe20e0d7f2d21d1" category="paragraph">制御要素は、NVRAMが同期されているかどうかです。NVRAMが同期されていれば、ノード間のフェイルオーバーを安全に実行でき、データ損失のリスクはありません。MetroCluster構成では、NVRAMと基盤となるアグリゲートのプレックスが同期されていれば、データ損失のリスクなしにスイッチオーバーを実行できます。</block>
  <block id="03e97c023521445cd70307afabdcf0d5" category="paragraph">データベースやその他のアプリケーションは、ディスク上のデータのより大きな内部キャッシュを保持するため、フェイルオーバーやスイッチオーバーを強制的に実行した場合に特に破損の影響を受けやすくなります。強制的なフェイルオーバーまたはスイッチオーバーが発生した場合、以前に確認済みの変更は事実上破棄されます。ストレージアレイの内容は実質的に時間を逆方向にジャンプし、キャッシュの状態はディスク上のデータの状態を反映しなくなります。</block>
  <block id="ff7a32ed70b7df57dd29a3ed75e8c787" category="paragraph">この状況を回避するために、ONTAPでは、NVRAMの障害に対する特別な保護をボリュームに設定できます。この保護メカニズムがトリガーされると、ボリュームがNVFAILという状態になります。この状態になると、原因アプリケーションがクラッシュするI/Oエラーが発生します。このクラッシュにより、古いデータを使用しないようにアプリケーションがシャットダウンされます。コミットされたトランザクションデータがログに含まれている必要があるため、データが失われないようにしてください。次の手順では、管理者がホストを完全にシャットダウンしてから、LUNとボリュームを手動で再度オンラインに戻します。これらの手順にはいくつかの作業が含まれる可能性がありますが、このアプローチはデータの整合性を確保するための最も安全な方法です。すべてのデータがこの保護を必要とするわけではありません。そのため、NVFAILの動作はボリューム単位で設定できます。</block>
  <block id="637d4b37868fb7825461df6edd674158" category="section-title">HAペアとMetroCluster</block>
  <block id="9d8738f531e6c6a809ba66315beaa2f4" category="paragraph">MetroClusterには、2ノードとHAペアの2つの構成があります。2ノード構成の動作は、NVRAMに関してはHAペアと同じです。突然の障害が発生した場合、パートナーノードはNVRAMデータを再生してドライブの整合性を確保し、確認済みの書き込みが失われていないことを確認できます。</block>
  <block id="936f4311b16ee4dc74a5564892f8976d" category="paragraph">HAペア構成では、ローカルパートナーノードにもNVRAMがレプリケートされます。MetroClusterを使用しないスタンドアロンHAペアの場合と同様に、単純なコントローラ障害ではパートナーノードでNVRAMが再生されます。サイト全体が突然失われた場合、リモートサイトには、ドライブの整合性を確保してデータの提供を開始するために必要なNVRAMも用意されています。</block>
  <block id="83b6c3c3018b913ecf1aca67e0daa35e" category="paragraph">MetroClusterの重要な側面の1つは、通常の運用状態ではリモートノードがパートナーデータにアクセスできないことです。各サイトは本質的に、反対のサイトのパーソナリティを想定できる独立したシステムとして機能します。このプロセスはスイッチオーバーと呼ばれ、計画的スイッチオーバーでは、サイトの処理が無停止で反対側のサイトに移行されます。また、サイトが失われ、ディザスタリカバリの一環として手動または自動のスイッチオーバーが必要になる計画外の状況も含まれます。</block>
  <block id="58504b36cfdfd10d5f2802d7b943a379" category="section-title">スイッチオーバーとスイッチバック</block>
  <block id="d505751d1708fb5d57b0e23d089507a9" category="paragraph">スイッチオーバーとスイッチバックという用語は、MetroCluster構成のリモートコントローラ間でボリュームを移行するプロセスを指します。このプロセスでは、リモートノードのみが環境されます。4ボリューム構成でMetroClusterを使用する場合のローカルノードのフェイルオーバーは、前述したテイクオーバーとギブバックのプロセスと同じです。</block>
  <block id="1127608e73df5ede22b149c8f19fc860" category="section-title">計画的スイッチオーバーとスイッチバック</block>
  <block id="a6733335678588619c977608e891e54e" category="paragraph">計画的スイッチオーバーまたはスイッチバックは、ノード間のテイクオーバーやギブバックと似ています。このプロセスには複数の手順があり、数分かかるように見える場合もありますが、実際には、ストレージリソースとネットワークリソースを複数のフェーズで正常に移行します。完全なコマンドの実行に必要な時間よりもはるかに短時間で制御転送が行われる瞬間。</block>
  <block id="4bb5647dcff332f0b53819ecd631303c" category="paragraph">テイクオーバー/ギブバックとスイッチオーバー/スイッチバックの主な違いは、FC SAN接続への影響です。ローカルのテイクオーバー/ギブバックでは、ローカルノードへのFCパスがすべて失われ、ホストのネイティブMPIOを使用して使用可能な代替パスに切り替えます。ポートは再配置されません。スイッチオーバーとスイッチバックでは、コントローラの仮想FCターゲットポートがもう一方のサイトに移行します。一時的にSAN上に存在しなくなり、代わりのコントローラに再表示されます。</block>
  <block id="0ba902ec3f6ce91c2e801715bb8b96fa" category="section-title">SyncMirrorタイムアウト</block>
  <block id="9c8a1814b60b84d1aa68fa7bba69138b" category="paragraph">SyncMirrorは、シェルフ障害から保護するONTAPのミラーリングテクノロジです。シェルフが離れた場所に配置されている場合は、リモートデータ保護が実現します。</block>
  <block id="68cf36f65a7e56ff3b6c0894be3ed9e8" category="paragraph">SyncMirrorは汎用同期ミラーリングを提供しません。その結果、可用性が向上します。一部のストレージシステムでは、一定のオールオアナッシングミラーリング（Dominoモードと呼ばれることもあります）を使用します。リモートサイトへの接続が失われるとすべての書き込みアクティビティが停止する必要があるため、この形式のミラーリングはアプリケーションで制限されます。そうしないと、書き込みは一方のサイトに存在し、もう一方のサイトには存在しません。通常、このような環境では、サイト間の接続が短時間（30秒など）以上切断された場合にLUNがオフラインになるように構成されます。</block>
  <block id="84ad4c21def9c355e80ef250d910bfa2" category="paragraph">この動作は、一部の環境に適しています。ただし、ほとんどのアプリケーションには、通常の動作条件下で保証された同期レプリケーションを提供しながら、レプリケーションを一時停止できる解決策が必要です。サイト間の接続が完全に失われると、多くの場合、災害が近い状況とみなされます。通常、このような環境は、接続が修復されるか、データを保護するために環境をシャットダウンする正式な決定が下されるまで、オンラインのままでデータを提供します。リモートレプリケーションの障害のみが原因でアプリケーションを自動的にシャットダウンする必要があるのは珍しいことです。</block>
  <block id="e3bd381a7bbaee6c741aee230972acf4" category="paragraph">SyncMirrorは、タイムアウトの柔軟性を備えた同期ミラーリングの要件に対応しています。リモートコントローラやプレックスへの接続が失われると、30秒のタイマーがカウントダウンを開始します。カウンタが0に達すると、ローカルデータを使用して書き込みI/O処理が再開されます。データのリモートコピーは使用可能ですが、接続が回復するまで時間内に凍結されます。再同期では、アグリゲートレベルのSnapshotを使用してシステムをできるだけ迅速に同期モードに戻します。</block>
  <block id="0c919cd6511df6d83b811234b0448374" category="paragraph">特に、多くの場合、この種の汎用的なオールオアナッシングDominoモードレプリケーションは、アプリケーションレイヤでより適切に実装されています。たとえば、Oracle DataGuardには最大保護モードが用意されており、どのような状況でも長時間のインスタンスレプリケーションが保証されます。設定可能なタイムアウトを超えてレプリケーションリンクに障害が発生すると、データベースはシャットダウンします。</block>
  <block id="ba92cbe464cfee8aa12c41e6aecd1071" category="section-title">ファブリック接続MetroClusterによる自動無人スイッチオーバー</block>
  <block id="515094655d10031595da776c94b3d710" category="paragraph">Automatic Unattended Switchover（AUSO；自動無人スイッチオーバー）は、クロスサイトHAの形式を提供するファブリック接続MetroClusterの機能です。前述したように、MetroClusterには2つのタイプ（各サイトに1台のコントローラを配置する場合と、各サイトに1台のHAペアを配置する場合）があります。HAオプションの主な利点は、コントローラの計画的シャットダウンと計画外シャットダウンのどちらでもすべてのI/Oをローカルで処理できることです。シングルノードオプションのメリットは、コスト、複雑さ、インフラの削減です。</block>
  <block id="29d4da26af76b66db3a172a39edf8367" category="paragraph">AUSOの主な価値は、ファブリック接続MetroClusterシステムのHA機能を向上させることです。各サイトが反対側のサイトの健常性を監視し、データを提供するノードがなくなると、AUSOによって迅速なスイッチオーバーが実行されます。このアプローチは、可用性の点でHAペアに近い構成になるため、サイトごとにノードが1つだけのMetroCluster構成で特に役立ちます。</block>
  <block id="6b3a5f7923b2d803fd3b28c255fef420" category="paragraph">AUSOでは、HAペアレベルで包括的な監視を行うことはできません。HAペアには、ノード間の直接通信用の2本の冗長な物理ケーブルが含まれているため、きわめて高い可用性を実現できます。さらに、HAペアの両方のノードが冗長ループ上の同じディスクセットにアクセスできるため、1つのノードが別のノードの健常性を監視するための別のルートが提供されます。</block>
  <block id="da87dad268507a3523bc38275b1d3fbc" category="paragraph">MetroClusterクラスタは複数のサイトにまたがって存在し、ノード間の通信とディスクアクセスの両方がサイト間ネットワーク接続に依存します。クラスタの残りの部分のハートビートを監視する機能には制限があります。AUSOは、ネットワークの問題が原因で、もう一方のサイトが使用できない状況ではなく、実際にダウンしている状況を区別する必要があります。</block>
  <block id="e8e4f55c4203e7fb24d4543a7a0f65da" category="paragraph">その結果、HAペアのコントローラで、システムパニックなどの特定の理由で発生したコントローラ障害が検出された場合、テイクオーバーが要求されることがあります。また、接続が完全に失われた場合（ハートビートの損失とも呼ばれます）、テイクオーバーを促すこともあります。</block>
  <block id="91aa4ce36cb243281f3777d66c8f89e0" category="paragraph">MetroClusterシステムで自動スイッチオーバーを安全に実行できるのは、元のサイトで特定の障害が検出された場合のみです。また、ストレージシステムの所有権を取得するコントローラは、ディスクとNVRAMのデータが同期されていることを保証できる必要があります。コントローラは、ソースサイトとの通信が失われて稼働している可能性があるため、スイッチオーバーの安全性を保証できません。スイッチオーバーを自動化するためのその他のオプションについては、次のセクションのMetroCluster Tiebreaker（MCTB）解決策に関する情報を参照してください。</block>
  <block id="8e7705fe4aea384d7f6a99ab6dc0f408" category="section-title">ファブリック接続MetroClusterを使用したMetroCluster Tiebreaker</block>
  <block id="897b7698cb343dbc3452e845705ab0f3" category="inline-link">NetApp MetroCluster Tiebreaker</block>
  <block id="9c093f14319e8253b8c9b37290597239" category="inline-link">NetApp Support Site</block>
  <block id="a1d9fc4fb49119a9fe9b39abec0a769b" category="paragraph">。<block ref="9332969062716487f0feefe076babf99" category="inline-link-rx"></block> ソフトウェアを第3のサイトで実行して、MetroCluster環境の健全性を監視し、通知を送信し、必要に応じて災害時にスイッチオーバーを強制的に実行できます。Tiebreakerの完全な概要は、<block ref="c21658567f794984b03c21186a56713d" category="inline-link-rx"></block>ただし、MetroCluster Tiebreakerの主な目的はサイトの損失を検出することです。また、サイトの損失と接続の損失を区別する必要があります。たとえば、Tiebreakerがプライマリサイトに到達できなかったためにスイッチオーバーが発生しないようにします。そのため、Tiebreakerはリモートサイトがプライマリサイトに接続する能力も監視します。</block>
  <block id="6f29b1849750ceee5eb7f6f02d100e6b" category="paragraph">AUSOによる自動スイッチオーバーもMCTBと互換性があります。AUSOは、特定の障害イベントを検出し、NVRAMとSyncMirrorのプレックスが同期されている場合にのみスイッチオーバーを実行するように設計されているため、非常に迅速に対応します。</block>
  <block id="6f5c7ae76595eca2ca83c5dd30cd8e9f" category="paragraph">一方、Tiebreakerはリモートに配置されているため、サイトの停止を宣言する前にタイマーが経過するのを待つ必要があります。Tiebreakerは最終的にAUSOの対象となるコントローラ障害を検出しますが、一般的にはAUSOがスイッチオーバーを開始しており、Tiebreakerが機能する前にスイッチオーバーを完了している可能性があります。Tiebreakerから送信される2つ目のswitchoverコマンドは拒否されます。</block>
  <block id="842547e1622bb12d9201167b0c39cf6d" category="paragraph">*注意：* MCTBソフトウェアは、強制的なスイッチオーバー時にNVRAMが同期されていること、またはプレックスが同期されていることを確認しません。メンテナンス作業中に自動スイッチオーバーが設定されている場合は無効にして、NVRAMまたはSyncMirrorプレックスの同期が失われるようにしてください。</block>
  <block id="7110edd59c3d0f25a584723f6fea26a0" category="paragraph">また、MCTBは、次の一連のイベントにつながるローリングディザスタに対応できない場合があります。</block>
  <block id="93d732b784eaf1a323f191e75c10f233" category="list-text">サイト間の接続が30秒以上中断されます。</block>
  <block id="81d4275cc3534a9fa8cfdcdb5172eb94" category="list-text">SyncMirrorレプリケーションがタイムアウトし、プライマリサイトで処理が続行されるため、リモートレプリカは古くなります。</block>
  <block id="44441f68631008a941ce92e985131ff9" category="list-text">プライマリサイトが失われます。その結果、プライマリサイトにレプリケートされていない変更が存在します。その場合、次のようないくつかの理由でスイッチオーバーが望ましくない可能性があります。</block>
  <block id="499527dd40fad77b119b8b33c99cd614" category="list-text">重要なデータはプライマリサイトに存在し、最終的にリカバリ可能になる可能性があります。スイッチオーバーによってアプリケーションの動作が継続されると、重要なデータは実質的に破棄されます。</block>
  <block id="86de4e3737e3d871dacf8ffef353fc31" category="list-text">サバイバーサイトのアプリケーションで、サイト障害時にプライマリサイトのストレージリソースを使用していた場合、データがキャッシュされている可能性があります。スイッチオーバーでは、キャッシュと一致しない古いバージョンのデータが生成されます。</block>
  <block id="dbb2a01afe28c8310daf781bb80b795f" category="list-text">サバイバーサイトのオペレーティングシステムで、サイト障害時にプライマリサイトのストレージリソースを使用していた場合、キャッシュデータがある可能性があります。スイッチオーバーでは、キャッシュと一致しない古いバージョンのデータが生成されます。最も安全な方法は、Tiebreakerがサイト障害を検出した場合にアラートを送信するように設定し、スイッチオーバーを強制的に実行するかどうかを決定することです。キャッシュされたデータを消去するには、アプリケーションやオペレーティングシステムのシャットダウンが必要になる場合があります。さらに、NVFAIL設定を使用して保護を強化し、フェイルオーバープロセスを合理化することもできます。</block>
  <block id="ec6b0ea9c511479c118aa0f028f6519d" category="section-title">MetroCluster IPを使用したONTAPメディエーター</block>
  <block id="8ada6a626a475d631df231bbb3a88ac9" category="paragraph">ONTAPメディエーターは、MetroCluster IPおよびその他の特定のONTAPソリューションで使用されます。これは、前述のMetroCluster Tiebreakerソフトウェアと同様に従来のTiebreakerサービスとして機能しますが、自動無人スイッチオーバーの実行という重要な機能も備えています。</block>
  <block id="991d7d7d7388ccdd87c65ca09aa804f2" category="paragraph">ファブリック接続MetroClusterは、反対側のサイトのストレージデバイスに直接アクセスできます。これにより、一方のMetroClusterコントローラがドライブからハートビートデータを読み取ることで、他のコントローラの健常性を監視できます。これにより、一方のコントローラがもう一方のコントローラの障害を認識し、スイッチオーバーを実行できるようになります。</block>
  <block id="db2e932a11478bcf14c75d38e8b9a170" category="paragraph">一方、MetroCluster IPアーキテクチャでは、すべてのI/Oがコントローラとコントローラの接続を介して排他的にルーティングされるため、リモートサイトのストレージデバイスに直接アクセスすることはありません。これにより、コントローラで障害を検出してスイッチオーバーを実行する機能が制限されます。そのため、サイトの損失を検出して自動的にスイッチオーバーを実行するためには、ONTAPメディエーターがTiebreakerデバイスとして必要になります。</block>
  <block id="fed81cab21bffffef4cc425583569036" category="section-title">Mediator Automatic Unattended Switch Over（MAUSO；メディエーター自動無人スイッチオーバー）</block>
  <block id="8004e6d63f487a456290225b74768a6c" category="section-title">ClusterLionを使用した3番目の仮想サイト</block>
  <block id="f1d5a7305654a402a719675fbec810e7" category="paragraph">ClusterLionは、仮想の第3サイトとして機能する高度なMetroCluster監視アプライアンスです。このアプローチにより、完全に自動化されたスイッチオーバー機能により、MetroClusterを2サイト構成で安全に導入できます。さらに、ClusterLionでは、追加のネットワークレベル監視を実行し、スイッチオーバー後の処理を実行できます。完全なドキュメントはProLionから入手できます。</block>
  <block id="a60b8f728a13371898fea9947ef1e0dc" category="paragraph"><block ref="a60b8f728a13371898fea9947ef1e0dc" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f8aae92ec17ec82868ef9ffc767dbd03" category="list-text">ClusterLionアプライアンスは、直接接続されたイーサネットケーブルとシリアルケーブルでコントローラの健常性を監視します。</block>
  <block id="c5f8963a91e3d8e7ac0abda2eab9f17d" category="list-text">2つのアプライアンスは、冗長3Gワイヤレス接続で相互に接続されています。</block>
  <block id="24de16a13a1b584832d19117982cbfa6" category="list-text">ONTAPコントローラへの電源は、内部リレーを介して配線されます。サイト障害が発生すると、内部UPSシステムを搭載したClusterLionによって電源接続が切断されてからスイッチオーバーが実行されます。このプロセスにより、スプリットブレイン状態が発生しないようにします。</block>
  <block id="b2bcd3c3c555e2e4f27d453de4e0f06d" category="list-text">ClusterLionは、30秒のSyncMirrorタイムアウト内にスイッチオーバーを実行するか、まったく実行しません。</block>
  <block id="390fb5f827a3fbcdc7d05e6e7db03223" category="list-text">ClusterLionでは、NVRAMプレックスとSyncMirrorプレックスの状態が同期されていないかぎり、スイッチオーバーは実行されません。</block>
  <block id="f322f850d55e87946f9660e4ccb1bbb6" category="list-text">ClusterLionでは、MetroClusterが完全に同期されている場合にのみスイッチオーバーが実行されるため、NVFAILは必要ありません。この構成では、計画外スイッチオーバーが発生しても、拡張Oracle RACなどのサイトスパニング環境をオンラインのまま維持できます。</block>
  <block id="5c132e05fb0e306f56955603619de359" category="list-text">ファブリック接続MetroClusterとMetroCluster IPの両方をサポート</block>
  <block id="86bcf99dbc3944da56f06b48074d09f6" category="doc">通常運用時</block>
  <block id="16dd4928055f2caf6f6fb8119ef69bcc" category="paragraph">SM-BCでは、計画的フェイルオーバーと計画外フェイルオーバーの2種類のストレージフェイルオーバー処理がサポートされます。どちらの処理も多少異なります。計画的フェイルオーバーは、リモートサイトへの迅速なスイッチオーバーのために管理者が手動で開始し、計画外フェイルオーバーは3番目のサイトのメディエーターによって自動的に開始されます。計画的フェイルオーバーの主な目的は、パッチ適用とアップグレードの段階的な実行、ディザスタリカバリテストの実行、または完全なビジネス継続性機能を実証するための年間を通してサイト間の運用を切り替える正式なポリシーの採用です。</block>
  <block id="63d4f976530f4faffa1ecd40fe8843f4" category="paragraph">次の図は、通常、フェイルオーバー、フェイルバックの各処理中に何が発生するかを示しています。わかりやすいように、レプリケートされたLUNを表しています。実際のSM-BC構成では、レプリケーションはボリュームに基づいています。各ボリュームには1つ以上のLUNが含まれていますが、わかりやすくするためにボリュームレイヤは削除されています。</block>
  <block id="e48472f7daf781b63506f9e296443027" category="paragraph">通常の操作では、ローカルレプリカまたはリモートレプリカからLUNにアクセスできます。赤い線はALUAによってアドバタイズされる最適パスを示し、そのパスにIOが優先的に送信されることになります。</block>
  <block id="ef1d805ecb3b65664c42a1d32d8120d5" category="paragraph">緑の線はアクティブなパスですが、そのパスのIOをSM-BCパスを経由する必要があるため、レイテンシが高くなります。追加のレイテンシは、SM-BCに使用されるサイト間のインターコネクトの速度によって異なります。</block>
  <block id="e139a585510a502bbf1841cf589f5086" category="section-title">失敗</block>
  <block id="7ed516552b652790c92df0bf237264b2" category="paragraph">計画的フェイルオーバーまたは計画外フェイルオーバーのためにアクティブなミラーコピーを使用できなくなった場合は、明らかに使用できなくなります。ただし、リモートシステムには同期レプリカがあり、リモートサイトへのSANパスはすでに存在します。リモートシステムは、そのLUNのIOを処理できます。</block>
  <block id="89a4933a199f7b0e286c8bcb1606905a" category="paragraph">リモートコピーをすぐに使用するかどうかは、SM-BCがSyncモードとStrictSyncモードのどちらで動作しているかによって異なります。</block>
  <block id="af43c542f512c4f7dc1b137d5de49d40" category="paragraph"><block ref="af43c542f512c4f7dc1b137d5de49d40" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7388404ef116c3ff812bfd290b094d9e" category="section-title">フェイルオーバー</block>
  <block id="997dfe060d2107e84407cfb41e692c54" category="paragraph">フェイルオーバーを実行すると、リモートコピーがアクティブコピーになります。パスが[Active]から[Active]/[Optimized]に変更され、IOは引き続きデータ損失なしで処理されます。</block>
  <block id="52da4ea35ba60090f331eefab5d6c612" category="paragraph"><block ref="52da4ea35ba60090f331eefab5d6c612" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0493d27e20d11e356e53e0a730b0ad08" category="section-title">修復する</block>
  <block id="4f125c91283d9dc1751ad99a7a171420" category="paragraph">ソースシステムが稼働状態に戻ると、SM-BCはレプリケーションを再同期できますが、逆方向を実行できます。現在の構成は、アクティブミラーサイトが反転されている点を除き、基本的には開始点と同じです。</block>
  <block id="5c647f57a104a05d7d8b55d089efefbe" category="paragraph"><block ref="5c647f57a104a05d7d8b55d089efefbe" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6d80a3efb80520f47b63dc279e1bea3d" category="section-title">フェイルバック</block>
  <block id="d47f47372b9b94d274cceb3638b28845" category="paragraph">必要に応じて、管理者はフェイルバックを実行し、LUNのアクティブコピーを元のコントローラに戻すことができます。</block>
  <block id="0c99cedb6f39d8ac16d5b4c01c162c23" category="paragraph">データベースのRedo /トランザクションログでは通常、アライメントされていないI/Oが生成されるため、ONTAPでLUNがミスアライメントされているという警告が原因で誤って表示される可能性があります。</block>
  <block id="b2f7bb8e75b21ee3e883141c6ac1defe" category="paragraph">ロギングは、さまざまなサイズの書き込みでログファイルのシーケンシャルライトを実行します。4KBの境界にアライメントされないログ書き込み処理では、次のログ書き込み処理でブロックが完了するため、通常は原因のパフォーマンスの問題は発生しません。その結果、一部の4KBブロックが2つの別 々 の処理で書き込まれていても、ONTAPはほぼすべての書き込みを完全な4KBブロックとして処理できます。</block>
  <block id="0e635e1f8ffad809203304cf41ed45c4" category="inline-link-macro">WAFLアライメントの検証</block>
  <block id="bf837d24f10c904e697e3c0092da43b9" category="paragraph">次のようなユーティリティを使用してアライメントを確認します。<block ref="40883add63f1fbabc7fe6158f93c1246" prefix=" " category="inline-code"></block> または<block ref="1aabac6d068eef6a7bad3fdf50a05cc8" prefix=" " category="inline-code"></block> 定義されたブロックサイズでI/Oを生成できます。ストレージシステムのI/Oアライメント統計は、<block ref="446501053769c06c565094b26d26e8ef" prefix=" " category="inline-code"></block> コマンドを実行しますを参照してください <block ref="ebccec7997af507c87f985ec4ccec634" category="inline-link-macro-rx"></block> を参照してください。</block>
  <block id="b5ffbfb0c082804ad41d0f61c87525ed" category="paragraph">多くのアプリケーションデータセットは日付別に整理されており、そのようなデータが古くなるにつれてアクセスされる可能性はますます低くなっています。たとえば、銀行が5年間の顧客明細書を含むPDFファイルのリポジトリを持っていても、最近の数か月のみがアクティブになっているとします。FabricPoolを使用して、古いデータファイルを大容量階層に再配置できます。クーリング期間を14日間にすると、直近の14日間のPDFファイルがパフォーマンス階層に残ります。さらに、少なくとも14日ごとに読み取られたファイルはホットのままであるため、パフォーマンス階層に残ります。</block>
  <block id="ed7e2cc7ff107d4b2032fe65cf4e756a" category="paragraph">ファイルベースの階層化アプローチを実装するには、ファイルが書き込まれ、その後変更されないようにする必要があります。。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 必要なファイルが高パフォーマンス階層に残るように、ポリシーを十分に高く設定する必要があります。たとえば、最新の60日分のデータが必要なデータセットで、最適なパフォーマンス保証が設定されているとします。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 60までの期間。ファイルアクセスパターンに基づいても同様の結果が得られます。たとえば、最新の90日間のデータが必要で、アプリケーションがその90日間のデータにアクセスしている場合、データは高パフォーマンス階層に残ります。を設定する<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 2までの期間では、データの使用頻度が低下した後、迅速な階層化が行われます。</block>
  <block id="8a467b35326e4738b1bd39865c3b21a0" category="admonition">データにアクセスすると、ヒートマップデータがリセットされます。ウィルススキャン、インデックス作成、さらにはソースファイルを読み取るバックアップ処理も行われるため、<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> しきい値に達していません。</block>
  <block id="7a1920d61156abc05a60135aefe8bc67" category="doc">デフォルト</block>
  <block id="5ba46d288640832c345e169b04a7458a" category="paragraph">すべてのFabricPoolボリュームの初期設定は<block ref="c21f969b5f03d33d43e04f8f136e7682" prefix=" " category="inline-code"></block>これは、動作が「cloud-retrieval-policy」によって制御されることを意味します。'正確な動作は、使用する階層化ポリシーによって異なります。</block>
  <block id="5ec354970d7934d92ba67ccaa0de0121" category="list-text"><block ref="9df22f196a33acd0b372fe502de51211" prefix="" category="inline-code"></block>–ランダムリードデータのみを取得</block>
  <block id="74092cfa5efab8e6ddc5c2991ee2cfc9" category="list-text"><block ref="8805d416ce540c5f2df34af5b18d742b" prefix="" category="inline-code"></block>–すべてのシーケンシャルまたはランダムリード・データを取得</block>
  <block id="2de036541477f953c6fd33d14a8db0e8" category="list-text"><block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix="" category="inline-code"></block>–すべてのシーケンシャルまたはランダムリード・データを取得</block>
  <block id="b6ffdb7ccf86e99ecf73899ec23bdd46" category="list-text"><block ref="a181a603769c1f98ad927e7367c7aa51" prefix="" category="inline-code"></block>–大容量階層からデータを取得しない</block>
  <block id="d556a0d2cad80695d1d803ebb49de9cd" category="section-title">オンリード</block>
  <block id="7c39eb141ca855e5a211b468bd67636c" category="paragraph">設定<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> をオンリードに設定するとデフォルトの動作が無効になるため、階層化されたデータが読み取られた場合、そのデータはパフォーマンス階層に返されます。</block>
  <block id="e07df43ea07fecb178484ef278644eb2" category="paragraph">たとえば、ボリュームは、<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 階層化ポリシーとほとんどのブロックが階層化されます。</block>
  <block id="98c8614a9e0467f220df33a02cf7550a" category="paragraph">ビジネスニーズの予期しない変化によって、特定のレポートを作成するために一部のデータを繰り返しスキャンする必要がある場合は、<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> 終了：<block ref="0ba0dc933ac714a0bef4467360437336" prefix=" " category="inline-code"></block> シーケンシャルデータとランダムリードデータの両方を含む、読み取りされるすべてのデータがパフォーマンス階層に返されます。これにより、ボリュームに対するシーケンシャルI/Oのパフォーマンスが向上します。</block>
  <block id="3ea4ba4aadef21fbda74c9b242c99efa" category="section-title">プロモート</block>
  <block id="cb674c0cbcbaa23bdd3c8e4f6182f865" category="paragraph">昇格ポリシーの動作は階層化ポリシーによって異なります。階層化ポリシーがの場合<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block>をクリックし、<block ref="723c2b1883eb9949dd821267c2d1b5c7" prefix=" " category="inline-code"></block> 次回の階層化スキャンで大容量階層のすべてのブロックを戻します。</block>
  <block id="452d85cc34fd3a4cf55ac61e732239f4" category="paragraph">階層化ポリシーがの場合<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block>を指定すると、アクティブファイルシステムに関連付けられているブロックのみが返されます。通常、これは効果がありません。これは、<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> ポリシーは、Snapshotにのみ関連付けられたブロックになります。アクティブファイルシステムに階層化されたブロックはありません。</block>
  <block id="d6269fb1a970b6c261fedbc79464b3dc" category="paragraph">ただし、ボリュームSnapRestoreまたはSnapshotからのファイルクローン操作によってボリューム上のデータがリストアされた場合、Snapshotにのみ関連付けられていたために階層化されたブロックの一部がアクティブファイルシステムで必要になることがあります。一時的に<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> ポリシーの宛先<block ref="eeefc0add5ccd6e20ac4214923d27fbc" prefix=" " category="inline-code"></block> ローカルで必要なすべてのブロックを迅速に取得できます。</block>
  <block id="6e7b34fa59e1bd229b207892956dc41c" category="section-title">なし</block>
  <block id="c45e30a0f86af155e2feb17dd7ba6e44" category="paragraph">大容量階層からブロックを取得しないでください。</block>
  <block id="2d242bb36ec91b32005f9296ff03a912" category="doc">アーキテクチャ</block>
  <block id="ac30d4a74ecef302adab70e9669a4bf2" category="paragraph">FabricPoolは、ブロックをホットまたはクールに分類し、最も適切なストレージ階層に配置する階層化テクノロジです。ほとんどの場合、パフォーマンス階層はSSDストレージに配置され、ホットデータブロックをホストします。大容量階層はオブジェクトストアに配置され、クールデータブロックをホストします。サポートされるオブジェクトストレージには、NetApp StorageGRID、ONTAP S3、Microsoft Azure Blobストレージ、Alibaba Cloud Object Storageサービス、IBM Cloud Object Storage、Google Cloudストレージ、Amazon AWS S3などがあります。</block>
  <block id="f9f5fe2f7456d37c955f3291744c93b6" category="paragraph">ブロックをホットまたはクールに分類する方法を制御する複数の階層化ポリシーを使用できます。ポリシーはボリューム単位で設定し、必要に応じて変更できます。パフォーマンス階層と大容量階層の間で移動されるのはデータブロックのみです。LUNとファイルシステムの構造を定義するメタデータは、常にパフォーマンス階層に残ります。そのため、管理はONTAPに一元化されます。ファイルとLUNは、他のONTAP構成に格納されているデータと変わりません。NetApp AFFコントローラまたはFASコントローラが定義されたポリシーを適用して、データを適切な階層に移動します。</block>
  <block id="156a1cf692c4ba9a4f9574fb16428b01" category="paragraph"><block ref="156a1cf692c4ba9a4f9574fb16428b01" category="inline-image-macro-rx" type="image"></block></block>
  <block id="616ce0475334fe37834d13972a168ca5" category="section-title">オブジェクトストレージプロバイダ</block>
  <block id="71e79501cc067e6b35ac3d3e97c940a4" category="paragraph">オブジェクトストレージプロトコルでは、単純なHTTP要求またはHTTPS要求を使用して大量のデータオブジェクトを格納します。ONTAPからのデータアクセスは要求の迅速な処理に依存するため、オブジェクトストレージへのアクセスは信頼できるものでなければなりません。オプションには、Amazon S3の[Standard and InFrequent Access]オプション、Microsoft Azure Hot and Cool Blob Storage、IBM Cloud、Google Cloudなどがあります。Amazon GlacierやAmazon Archiveなどのアーカイブオプションはサポートされていません。データの読み出しに要する時間がホストのオペレーティングシステムやアプリケーションの許容範囲を超える可能性があるためです。</block>
  <block id="e114e830308285cd9085063fad91662c" category="paragraph">NetApp StorageGRIDもサポートされており、最適なエンタープライズクラスの解決策です。ハイパフォーマンス、拡張性、セキュリティに優れたオブジェクトストレージシステムであり、FabricPoolデータだけでなく、エンタープライズアプリケーション環境に組み込まれる可能性が高まるその他のオブジェクトストレージアプリケーションにも、地理的な冗長性を提供します。</block>
  <block id="fb318c5cd9ed18c79e1f7a298dd96665" category="paragraph">また、StorageGRIDは、多くのパブリッククラウドプロバイダがサービスからデータを読み返す際に出力料金を課す必要がないため、コストを削減できます。</block>
  <block id="119d8a1213b5b7cae4bb567153b028cf" category="section-title">データとメタデータ</block>
  <block id="b59d6123a3191bd85fe14e57b7a01e11" category="paragraph">ここで「data」という用語は、メタデータではなく実際のデータブロックを環境することに注意してください。データブロックのみが階層化され、メタデータはパフォーマンス階層に残ります。また、あるブロックのステータス（hotまたはcool）が影響を受けるのは、実際のデータブロックを読み取った場合のみです。ファイルの名前、タイムスタンプ、所有権のメタデータを読み取っても、基盤となるデータブロックの場所には影響しません。</block>
  <block id="1414cdc093d39dd56d0b0d20049e17fc" category="section-title">バックアップ</block>
  <block id="e0b766a7a0a7633679ecddd0f78a7390" category="paragraph">FabricPoolはストレージの設置面積を大幅に削減できますが、それだけではバックアップ解決策ではありません。NetApp WAFLメタデータは常に高パフォーマンス階層に残ります。大容量階層にはWAFLメタデータが含まれていないため、大容量階層のデータを使用して新しい環境を作成することはできません。</block>
  <block id="7a25ce12890e524732cb71784b5915ab" category="paragraph">ただし、FabricPoolはバックアップ戦略の一部になる可能性があります。たとえば、FabricPoolにはNetApp SnapMirrorレプリケーションテクノロジを設定できます。ミラーの各半分は、オブジェクトストレージターゲットに独自に接続できます。その結果、データの2つの独立したコピーが作成されます。プライマリコピーは、パフォーマンス階層のブロックと大容量階層内の関連するブロックで構成され、レプリカはパフォーマンスブロックと容量ブロックの2つ目のセットです。</block>
  <block id="82af841589057aa8922b1ac3bb4a28a4" category="doc">圧縮</block>
  <block id="e242ff0701d9ed7d8317b32fd762a100" category="paragraph">圧縮、コンパクション、重複排除などのスペース効率化機能は、特定の量の物理ストレージに収まる論理データの量を増やすように設計されています。その結果、コストと管理オーバーヘッドが削減されます。</block>
  <block id="13b992c3d358d786db03341886472c4f" category="paragraph">圧縮とは、大まかに言って、データのパターンを検出してスペースを削減する方法でエンコードする数学的プロセスです。一方、重複排除機能は、実際に繰り返されるデータブロックを検出し、不要なコピーを削除します。コンパクションを使用すると、複数の論理ブロックのデータをメディア上の同じ物理ブロックで共有できます。</block>
  <block id="786d7cc1b18aa3d9c3e8d3e30865240e" category="paragraph">オールフラッシュストレージシステムが登場する以前は、アレイベースの圧縮の価値は限られていました。I/O負荷の高いワークロードのほとんどでは、許容可能なパフォーマンスを提供するために非常に多数のスピンドルが必要だったためです。ストレージシステムには、ドライブ数が多いことの副作用として、必要以上の容量が常に搭載されていました。この状況は、ソリッドステートストレージの登場によって変化しました。優れたパフォーマンスを得るためだけにドライブを過剰にオーバープロビジョニングする必要はもうありません。ストレージシステムのドライブスペースは、実際の容量ニーズに合わせて調整できます。</block>
  <block id="b207c460d31fea9e1cfab71057e8152c" category="paragraph">ソリッドステートドライブ（SSD）ではIOPSが向上するため、ほとんどの場合、回転式ドライブに比べてコストを削減できますが、圧縮を使用すると、ソリッドステートメディアの実効容量を増やすことで、さらに削減効果を高めることができます。</block>
  <block id="bd6c983943da8bf0ead08c643f0e75f3" category="paragraph">データを圧縮する方法はいくつかあります。多くのデータベースには独自の圧縮機能が搭載されていますが、お客様の環境ではこのような圧縮機能はほとんど見られません。その理由は、通常、圧縮データを*変更*するとパフォーマンスが低下することに加えて、多くの場合、ライセンスコストが高くなることにあります。最後に、データベース処理のパフォーマンスが全体的に低下します。実際のデータベース作業ではなく、データの圧縮と解凍を実行するCPUに、高いCPU単位のライセンスコストを支払うことはほとんど意味がありません。より適切な方法は、圧縮処理をストレージシステムにオフロードすることです。</block>
  <block id="6296c8b7406b90d37edf269f1ea6f6ee" category="section-title">適応圧縮</block>
  <block id="1245fef302b5da2c27766d9a98ad358c" category="paragraph">アダプティブ圧縮は、レイテンシがマイクロ秒単位で測定されるオールフラッシュ環境であっても、パフォーマンスに影響を及ぼさないエンタープライズワークロードで徹底的にテストされています。一部のお客様から、圧縮機能によってデータがキャッシュ内で圧縮されたままになるため、パフォーマンスが向上したとの報告もあります。これは、コントローラで使用可能なキャッシュ容量が実質的に増加するためです。</block>
  <block id="93e0a644c8f1b7f7f378bc071d15d1e9" category="paragraph">ONTAPは物理ブロックを4KB単位で管理します。アダプティブ圧縮では、デフォルトの圧縮ブロックサイズである8KBが使用されます。つまり、データは8KB単位で圧縮されます。これは、リレーショナルデータベースで最もよく使用される8KBのブロックサイズに一致します。圧縮アルゴリズムは、より多くのデータが1つの単位として圧縮されるので、より効率的になります。圧縮ブロックサイズが32KBの場合、8KBの圧縮ブロックユニットよりもスペース効率に優れています。つまり、デフォルトの8KBのブロックサイズを使用するアダプティブ圧縮の場合、削減率はわずかに低くなりますが、圧縮ブロックサイズを小さくすることには大きなメリットがあります。データベースワークロードには、大量の上書きアクティビティが含まれています。32KBの圧縮されたデータブロックの8KBを上書きするには、32KBの論理データ全体を読み取って解凍し、必要な8KB領域を更新してから再度圧縮し、32KB全体をドライブに書き込む必要があります。この処理はストレージシステムでは非常にコストがかかります。このため、圧縮ブロックサイズの大きい競合ストレージアレイでも、データベースワークロードのパフォーマンスが大幅に低下します。</block>
  <block id="096cc7f8e7e1861c3ee0269a90fc27e3" category="admonition">適応圧縮で使用されるブロックサイズは、最大32KBまで拡張できます。これによりストレージ効率が向上する可能性があります。アーカイブログやバックアップファイルなどの静止ファイルでは、大量のデータがアレイに格納されている場合に検討する必要があります。状況によっては、適応圧縮のブロックサイズをそれに合わせて増やすことで、16KBまたは32KBのブロックサイズを使用するアクティブデータベースでもメリットが得られる場合があります。この方法がお客様のワークロードに適しているかどうかについては、NetAppまたはパートナーの担当者にお問い合わせください。</block>
  <block id="f291779c724993ded5e79421d88f3e55" category="admonition">ストリーミングバックアップデスティネーションでは、重複排除と一緒に8KBを超える圧縮ブロックサイズを使用しないでください。これは、バックアップデータへのわずかな変更が32KBの圧縮ウィンドウに影響するためです。ウィンドウが移動すると、圧縮されたデータはファイル全体で異なります。重複排除は圧縮後に実行されます。つまり、重複排除エンジンは、圧縮された各バックアップを別 々 に認識します。ストリーミングバックアップ（Oracle RMANなど）の重複排除が必要な場合は、8KBのブロックアダプティブ圧縮のみを使用します。アダプティブ圧縮を使用することを推奨します。アダプティブ圧縮はブロックサイズが小さく、重複排除による効率化の妨げにならないためです。同様の理由から、ホスト側の圧縮も重複排除による効率化の妨げになります。</block>
  <block id="1f9367b7afff301ee24188d35050ae0a" category="section-title">温度に基づくストレージ効率</block>
  <block id="78aa8c12abb3bf9f61a08df0f9b403de" category="paragraph">ONTAP 9.8以降で利用できるTemperature Sensitive Storage Efficiency（TSSE）は、ブロックアクセスのヒートマップを利用してアクセス頻度の低いブロックを特定し、圧縮して効率を高めます。</block>
  <block id="02e44d620def629a6c145ccd0d9a0fd3" category="section-title">圧縮のアライメント</block>
  <block id="3b6e6c232a02ab9c64199eb9efae012c" category="paragraph">データベース環境でアダプティブ圧縮を使用する場合は、圧縮ブロックのアライメントについて考慮する必要があります。これは、非常に特定のブロックでランダムオーバーライトが発生するデータについてのみ考慮する必要があります。このアプローチは、ファイルシステム全体のアライメントと概念的に似ています。ファイルシステムの開始は4Kデバイスの境界に合わせて調整する必要があり、ファイルシステムのブロックサイズは4Kの倍数でなければなりません。</block>
  <block id="327a36f7ca539411197c2f867b501719" category="paragraph">たとえば、ファイルへの8KBの書き込みは、ファイルシステム自体の8KBの境界にアライメントされている場合にのみ圧縮されます。これは、ファイルの最初の8KB、ファイルの2番目の8KBなどに配置する必要があることを意味します。RMANバックアップやアーカイブログなどのデータは、複数のブロックにまたがるシーケンシャルライト処理であり、すべて圧縮されます。したがって、アライメントを考慮する必要はありません。問題となるI/Oパターンは、ファイルのランダムオーバーライトだけです。</block>
  <block id="1d1a594959ec615f56516f5d0f5e8ddb" category="section-title">NFS</block>
  <block id="8dae8f7054353dae17cd9da8deb0e091" category="paragraph">NFSを使用すると、ファイルI/Oがアライメントされます。ファイルの各ブロックは、ファイルの先頭を基準に整列されます。</block>
  <block id="62a0282d39568be094470486eaf70c4f" category="section-title">SAN</block>
  <block id="b0762e9957c8485f911e57bfd027eddb" category="paragraph">SAN環境では、圧縮を最適化するために、データを8KBの境界にアライメントする必要があります。SANのアライメントには、LUNとファイルシステムの2つの側面があります。LUNは、ドライブ全体として（パーティションなし）、または8KBの境界にアライメントされたパーティションで構成する必要があります。</block>
  <block id="ad16b6d5634739ef4ceb795c5beea659" category="admonition">圧縮機能とフラクショナルリザベーションの相互作用については、シンプロビジョニングに関するセクションを参照してください。</block>
  <block id="14c3c56ff2a98d1a9c47b63a917f67a3" category="section-title">データコンパクション</block>
  <block id="546168bb7b68da66be7b6c0e60a23460" category="paragraph">データコンパクションは、ONTAPに導入された圧縮効率を向上させるテクノロジです。前述したように、アダプティブ圧縮では4KBのWAFLブロックに8KBのI/Oが格納されるため、削減率は最大でも2：1です。ブロックサイズが大きい圧縮方式では、効率性が向上します。ただし、小さなブロックの上書きが発生するデータには適していません。32KBのデータユニットを解凍して8KB部分を更新し、再度圧縮してからドライブにライトバックすると、オーバーヘッドが発生します。</block>
  <block id="0b01f66d49b9df153ee76048de44f6eb" category="paragraph">データコンパクションでは、複数の論理ブロックを物理ブロック内に格納できます。たとえば、テキストブロックや部分的にフルブロックなど、圧縮率の高いデータを含むデータベースは、8KBから1KBに圧縮できます。コンパクションを使用しない場合、この1KBのデータが4KBブロック全体を占有します。インラインデータコンパクションでは、圧縮された1KBのデータを、他の圧縮データと一緒にわずか1KBの物理スペースに格納できます。これは圧縮テクノロジではありません。ドライブのスペースをより効率的に割り当てる方法なので、検出できるほどのパフォーマンスへの影響はありません。</block>
  <block id="07b153ed9b6a6f9f334f2ad1fe94651e" category="paragraph">得られる削減効果の程度はさまざまです。すでに圧縮または暗号化されているデータは、通常それ以上圧縮することはできないため、コンパクションによるメリットはありません。ブロックメタデータとゼロブロックしか含まれない、初期化されたばかりのOracleデータファイルは、最大80：1まで圧縮されます。これにより、非常に幅広い可能性が生まれます。</block>
  <block id="83f45cad5e6f535ff10e564a526baad0" category="section-title">重複排除</block>
  <block id="f591ef30da06841378ee7f595e63a93c" category="paragraph">重複排除とは、データセットから重複するブロックサイズを削除することです。たとえば、同じ4KBブロックが10個のファイルに存在する場合、重複排除機能は、10個のファイルすべてのうち、その4KBブロックを同じ4KBの物理ブロックにリダイレクトします。その結果、そのデータの効率が10分の1に向上します。</block>
  <block id="699c85c5df1985b2af588f9e6c1ad353" category="paragraph">VMwareゲストブートLUNなどのデータは、同じオペレーティングシステムファイルの複数のコピーで構成されるため、通常は重複排除が非常に効果的です。100:1以上の効率が観測されている。</block>
  <block id="c3ed34b88ac0b8efff210a99f19a4b9b" category="paragraph">一部のデータに重複データが含まれていません。たとえば、Oracleブロックには、データベースに対してグローバルに一意のヘッダーと、ほぼ一意のトレーラが含まれています。そのため、Oracleデータベースの重複排除によって1%以上の削減効果が得られることはほとんどありません。</block>
  <block id="9653a3d4907877aae00bb7d39eeec66d" category="paragraph">16KBでブロックサイズが大きいデータベースでは、最大15%のスペース削減効果が確認されたケースがいくつかあります。各ブロックの最初の4KBにはグローバルに一意なヘッダーが含まれ、最後の4KBブロックにはほぼ一意のトレーラが含まれます。内部ブロックは重複排除の対象となりますが、実際には、初期化されたデータの重複排除にほぼ完全に起因しています。</block>
  <block id="89d6ec0df0a54d3cdcc8f0573a6b37c5" category="paragraph">競合するアレイの多くは、Oracleデータベースが複数回コピーされていると仮定すると、重複排除機能があると主張しています。この点では、NetAppの重複排除も使用できますが、ONTAPにはNetApp FlexCloneテクノロジというより優れたオプションがあります。最終的な結果は同じで、基盤となる物理ブロックの大部分を共有するOracleデータベースのコピーが複数作成されます。FlexCloneを使用すると、時間をかけてデータファイルをコピーし、その後重複を排除するよりも、はるかに効率的です。重複は最初から作成されないため、実際には重複排除ではなく重複排除です。</block>
  <block id="32aeb47267cb2045610b468115f3ae0e" category="section-title">効率性とシンプロビジョニング</block>
  <block id="3381946611f34fb44ad8a38a0c44e0a8" category="paragraph">効率化機能はシンプロビジョニングの一形態です。たとえば、100GBのボリュームを使用している100GBのLUNを50GBに圧縮するとします。ボリュームが100GBのままなので、実際の削減はまだ実現されていません。削減されたスペースをシステムの他の場所で使用できるように、まずボリュームのサイズを縮小する必要があります。100GBのLUNにあとから変更した結果、データの圧縮率が低下すると、LUNのサイズが大きくなり、ボリュームがいっぱいになる可能性があります。</block>
  <block id="20132d08f816a6401f40a29feb68df8d" category="paragraph">シンプロビジョニングは、管理を簡易化しながら、使用可能な容量を大幅に改善し、コストを削減できるため、強く推奨されます。これは単純な理由です。Oracle環境では、多くの場合、空のスペース、大量のボリュームとLUN、圧縮可能なデータが含まれているからです。シックプロビジョニングでは、ボリュームとLUNのストレージにスペースがリザーブされます。これは、100%フルになり、100%圧縮不可能なデータが含まれる場合に限られます。これは起こりそうもないことですシンプロビジョニングを使用すると、スペースを他の場所で再生して使用できます。また、容量の管理は、多数の小さいボリュームやLUNではなく、ストレージシステム自体に基づいて行うことができます。</block>
  <block id="38ef8b6f2fc332958c293d93c61d7756" category="paragraph">一部のお客様は、特定のワークロードにシックプロビジョニングを使用するか、一般的には確立された運用と調達の手法に基づいてシックプロビジョニングを使用します。</block>
  <block id="f8ea8eaa5ca0e58c6a43ec0117b7bd8d" category="paragraph">*注意：*ボリュームがシックプロビジョニングされている場合は、ボリュームの圧縮解除や重複排除の削除など、そのボリュームのすべての効率化機能を完全に無効にするように注意する必要があります。<block ref="3cfeff511a11b8c5f54ce9749a719a58" prefix=" " category="inline-code"></block> コマンドを実行しますボリュームが<block ref="df899f2d908ec33afe1d01ee26b3dd47" prefix=" " category="inline-code"></block> 出力。有効になっている場合、ボリュームはまだ部分的に効率化機能用に設定されています。その結果、オーバーライトギャランティの動作が異なります。そのため、設定で原因が見落とされてボリュームのスペースが予期せず不足し、データベースI/Oエラーが発生する可能性が高くなります。</block>
  <block id="0e7c78164adb6d4650ea685a79d8e99e" category="section-title">効率化のベストプラクティス</block>
  <block id="d67dd6ae62908b7781805cf297fa8d87" category="paragraph">NetAppでは、ONTAP 9以降について次の推奨事項を提供しています。ONTAP 9より前のバージョンのONTAPについては、NetApp担当者にお問い合わせください。</block>
  <block id="ec499ad25fa5a765ba43ec2c87819623" category="section-title">AFFのデフォルト</block>
  <block id="38b7d52fb2d518d07c1c857b20ebbbd2" category="paragraph">オールフラッシュAFFシステムで実行されているONTAPで作成されたボリュームは、すべてのインライン効率化機能が有効になった状態でシンプロビジョニングされます。Oracleデータベースには一般に重複排除機能はなく、圧縮不可能なデータも含まれている可能性がありますが、デフォルト設定はほぼすべてのワークロードに適しています。ONTAPは、あらゆる種類のデータとI/Oパターンを効率的に処理するように設計されており、削減効果があるかどうかは関係ありません。デフォルトは、理由が完全に理解されていて、逸脱するメリットがある場合にのみ変更する必要があります。</block>
  <block id="9f7127e69d50bf7b844ff3723b86fbd1" category="section-title">一般的な推奨事項</block>
  <block id="2c24e4751310e03f119a4df187a3bc08" category="list-text">ボリュームやLUNがシンプロビジョニングされていない場合は、すべての効率化設定を無効にする必要があります。これらの機能を使用しても削減は得られず、シックプロビジョニングとスペース効率化が有効になっていると、スペース不足エラーなどの予期しない動作が原因に発生する可能性があるためです。</block>
  <block id="4922fe547c351d6a121465da036d478e" category="list-text">バックアップやデータベーストランザクションログなどでデータが上書きされない場合は、クーリング期間を短くしてTSSEを有効にすることで、効率を高めることができます。</block>
  <block id="e75fd383e4106eb78482b18896975daf" category="list-text">アプリケーションレベルで圧縮がすでに有効になっているファイルが暗号化されている場合など、一部のファイルには圧縮不可能なデータが大量に含まれていることがあります。上記のいずれかに該当する場合は、圧縮可能なデータを含む他のボリュームでより効率的に処理できるように、圧縮を無効にすることを検討してください。</block>
  <block id="11845fef1d21077d7b23ce880868b556" category="list-text">データベースバックアップでは、32KBの圧縮機能と重複排除機能の両方を使用しないでください。セクションを参照してください。<block ref="57ee2712afc5e59236f86db0537b05dc" category="inline-xref-macro-rx"></block>詳細については、を参照してください。</block>
  <block id="64d5def835c194cac8afe4fafded756e" category="doc">ポリシー-ローカルSnapshot</block>
  <block id="baa596d0db91317fa83739a95649752e" category="paragraph">FabricPoolの初期リリースでは、バックアップのユースケースを対象としていました。階層化できるブロックのタイプは、アクティブファイルシステム内のデータに関連付けられなくなったブロックだけです。そのため、大容量階層に移動できるのはSnapshotデータブロックだけです。これは、パフォーマンスに影響を与えないようにする必要がある場合に、最も安全な階層化オプションの1つです。</block>
  <block id="b21eb7f0b67c3e27e915183638bf92cf" category="paragraph">アクセス頻度の低いSnapshotブロックを大容量階層に階層化する方法は2つあります。まず、<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> ポリシーはSnapshotブロックのみを対象としています。ただし、<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> ポリシーには、<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> ブロックの場合は、アクティブファイルシステムのブロックも階層化されます。これは望ましくない可能性があります。</block>
  <block id="eeba990304f236b36a9fec2434c77470" category="paragraph">。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> この値は、リストア時に必要となる可能性のあるデータを高パフォーマンス階層で使用できるようにする期間に設定する必要があります。たとえば、重要な本番環境データベースのリストアシナリオのほとんどには、過去数日間のある時点のリストアポイントが含まれます。セッテイ<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 値を3に設定すると、ファイルをリストアしたときにパフォーマンスがすぐに最大になるようにファイルが作成されます。アクティブファイル内のすべてのブロックは、大容量階層からリカバリすることなく高速ストレージに残ります。</block>
  <block id="baf531ed01ad56f5614e1a68e8a2e7aa" category="section-title">ポリシー-レプリケートされたSnapshot</block>
  <block id="27e5121a4c75181022e7be2b738339d0" category="paragraph">リカバリのみに使用されるSnapMirrorまたはSnapVaultでレプリケートされるSnapshotには、一般にFabricPoolを使用する必要があります。<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> ポリシー：このポリシーでは、メタデータはレプリケートされますが、すべてのデータブロックがただちに大容量階層に送信されるため、パフォーマンスが最大限に向上します。ほとんどのリカバリプロセスではシーケンシャルI/Oが発生しますが、これは本質的に効率的です。オブジェクトストアのデスティネーションからのリカバリ時間を評価する必要がありますが、適切に設計されたアーキテクチャでは、このリカバリプロセスにローカルデータからのリカバリよりも大幅に時間がかかる必要はありません。</block>
  <block id="639e481de0ffe002bd83251b26a2540a" category="paragraph">レプリケートされたデータをクローニングにも使用する場合は、<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> ポリシーはより適切であり、<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> クローニング環境で定期的に使用されることが期待されるデータを含む価値。たとえば、データベースのアクティブなワーキングセットには、過去3日間に読み書きされたデータが含まれている場合がありますが、さらに6カ月分の履歴データが含まれている場合もあります。その場合は、<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> SnapMirrorデスティネーションでポリシーを設定すると、作業セットを高パフォーマンス階層で使用できるようになります。</block>
  <block id="ace0bd0c1be3a9e17d9736d93e7a1da2" category="doc">IOPS QoS</block>
  <block id="786ee59e0cdaa09335e12fea3a168653" category="paragraph">特に、オールフラッシュストレージの採用が増えたことで、ワークロードの統合が実現しました。回転式メディアに依存するストレージアレイでは、古い回転式ドライブテクノロジではIOPS機能が制限されているため、I/O負荷の高いワークロードの数が限られていました。1つまたは2つの高アクティブデータベースでは、ストレージコントローラが制限に達するずっと前に基盤となるドライブがいっぱいになります。これは変更されました。SSDドライブの数が比較的少ないパフォーマンス機能は、最も強力なストレージコントローラでさえ飽和状態になる可能性があります。つまり、回転式メディアのレイテンシが急激に低下することなく、コントローラのすべての機能を活用できます。</block>
  <block id="270d79669200ef485add1ecc1833cc94" category="paragraph">参考例として、シンプルな2ノードHA AFF A800システムでは、レイテンシが1ミリ秒を超える前に最大100万IOPSのランダムIOPSを処理できます。このレベルに達すると予想される単一のワークロードはほとんどありません。このAFF A800システムアレイをフルに活用するには、複数のワークロードをホストする必要がありますが、予測可能性を確保しながら安全にこれを行うには、QoS制御が必要です。</block>
  <block id="4dca0c3547523a2e5bd1b8d0e2ff8de5" category="paragraph">ONTAPには、IOPSと帯域幅の2種類のサービス品質（QoS）があります。QoS制御は、SVM、ボリューム、LUN、およびファイルに適用できます。</block>
  <block id="3ea539ed2021ba46a3658039e8af419f" category="paragraph">IOPS QoS制御は、特定のリソースの合計IOPSに基づいていることは明らかですが、IOPS QoSには直感的でない側面がいくつかあります。当初、一部のお客様は、IOPSのしきい値に達したときにレイテンシが明らかに上昇したことに困惑していました。レイテンシの増加は、IOPSが制限されることによる当然の結果です。論理的には、トークンシステムと同様に機能します。たとえば、データファイルが格納されている特定のボリュームに10、000 IOPSの制限がある場合、受信した各I/Oは、処理を続行するために最初にトークンを受信する必要があります。1秒間に10Kを超えるトークンが消費されない限り、遅延は発生しません。IO処理がトークンの受信を待機する必要がある場合、この待機は追加のレイテンシとして表示されます。ワークロードがQoS制限に押し上げられにくくなると、各IOが処理されるまでキューで待機する時間が長くなり、レイテンシが高くなります。</block>
  <block id="34a96885dd7f4501920b13026e7f2cab" category="admonition">データベースのトランザクション/ REDOログデータにQoS制御を適用する場合は注意が必要です。通常、Redoログに必要なパフォーマンスはデータファイルよりもはるかに低くなりますが、Redoログのアクティビティはバースト性が高くなります。IOは短時間のパルスで発生し、平均REDO IOレベルに適したQoS制限が実際の要件に対して低すぎる可能性があります。その結果、RedoログのバーストごとにQoSが適用されるため、パフォーマンスが大幅に制限される可能性があります。一般に、REDOログとアーカイブログはQoSによって制限されるべきではありません。</block>
  <block id="c79dc76371299e08f4b4ebd609314ca4" category="section-title">帯域幅QoS</block>
  <block id="b9d5c520039715de9b997c5a69f4aeaa" category="paragraph">すべてのI/Oサイズが同じではありません。たとえば、あるデータベースが大量の小さなブロック読み取りを実行していて、IOPSのしきい値に達しているとします。 一方、データベースがテーブルのフルスキャン処理を実行している場合もあります。この処理では、大量のブロック読み取りが非常に少なく、大量の帯域幅を消費しますが、IOPSは比較的低くなります。</block>
  <block id="4930ae83bb8dd5e539dc9f7e73c6d74c" category="paragraph">同様に、VMware環境ではブート時に非常に多くのランダムIOPSが発生する可能性がありますが、外部バックアップ時に実行されるI/Oは少なくても大きくなります。</block>
  <block id="eabb5a523a77d4521c12622ee9388aa6" category="paragraph">パフォーマンスを効果的に管理するために、IOPSまたは帯域幅のQoS制限、あるいはその両方が必要になる場合があります。</block>
  <block id="13dac55a5f26cefab26368ea5a67e29f" category="section-title">最小/保証されたQoS</block>
  <block id="68559688130772c84bb39b2a9ca2c2af" category="paragraph">多くのお客様が、QoS保証付きの解決策を求めていますが、これは見た目よりも達成が難しく、無駄になる可能性があります。たとえば、10個のデータベースを10K IOPS保証で配置する場合、10個のデータベースすべてが同時に10K IOPSで実行され、合計で100Kになるようにシステムをサイジングする必要があります。</block>
  <block id="c0938f706c890ea85c86388391ffad22" category="paragraph">QoS管理を最小限に抑えるには、重要なワークロードを保護するのが最適です。たとえば、最大IOPSが500Kで、本番ワークロードと開発ワークロードが混在しているONTAPコントローラについて考えてみましょう。特定のデータベースがコントローラを独占しないように、開発ワークロードに最大QoSポリシーを適用する必要があります。次に、最小限のQoSポリシーを本番環境のワークロードに適用して、必要なIOPSを必要なときに常に利用できるようにします。</block>
  <block id="acdda1c20fb3985ce840929f7525c803" category="section-title">アダプティブ QoS</block>
  <block id="dd5bc58ed6ab031b170a409470d9a763" category="paragraph">アダプティブQoSとは、ONTAPの機能のことで、ストレージオブジェクトの容量に基づいてQoS制限が設定されます。通常、データベースのサイズとそのパフォーマンス要件との間にリンクがないため、データベースで使用されることはほとんどありません。大規模なデータベースはほとんど不活性になる可能性がありますが、小規模なデータベースはIOPS負荷が最も高くなる可能性があります。</block>
  <block id="eb595833577352045f92d14ac4315ad2" category="paragraph">アダプティブQoSは、仮想化データストアで非常に役立ちます。このようなデータセットのIOPS要件は、データベースの合計サイズに相関する傾向があるためです。1TBのVMDKファイルを格納した新しいデータストアでは、2TBデータストアの約半分のパフォーマンスが必要になる可能性があります。アダプティブQoSを使用すると、データストアにデータが入力されたときに、QoS制限を自動的に増やすことができます。</block>
  <block id="23f3d415bb4fe6f99165df604b24da0e" category="paragraph">FabricPoolでデータセットを階層化すると、プライマリストレージアレイとオブジェクトストア階層の間に依存関係が生じます。オブジェクトストレージには、さまざまなレベルの可用性を提供するオプションが多数あります。プライマリストレージアレイとオブジェクトストレージ階層の間の接続が失われた場合の影響を理解することが重要です。</block>
  <block id="7e856c11a853d276fd5d6274bf60fafd" category="paragraph">ONTAPに対して実行するI/Oで大容量階層のデータが必要になり、ONTAPが大容量階層に到達してブロックを読み出すことができない場合、最終的にI/Oはタイムアウトします。このタイムアウトの影響は、使用するプロトコルによって異なります。NFS環境では、ONTAPはプロトコルに応じてEJUKEBOXまたはEDELAYのいずれかの応答で応答します。一部の古いオペレーティングシステムではエラーと解釈される場合がありますが、現在のオペレーティングシステムとOracle Direct NFSクライアントの現在のパッチレベルでは、これを再試行可能なエラーとして扱い、I/Oの完了を待ち続けます。</block>
  <block id="207d9fe0f57910936bfa043248f3afca" category="paragraph">環境SAN環境のタイムアウトを短縮します。オブジェクトストア環境のブロックが必要で、2分間アクセスできない場合は、読み取りエラーがホストに返されます。ONTAPボリュームとLUNはオンラインのままですが、ホストOSからファイルシステムにエラー状態のフラグが設定されることがあります。</block>
  <block id="c9251835da8df507ca4f6ce02d4216be" category="paragraph">オブジェクトストレージの接続の問題<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> バックアップデータのみが階層化されるため、ポリシーはそれほど重要ではありません。通信に問題があると、データのリカバリに時間がかかりますが、それ以外の場合はアクティブに使用されているデータに影響。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> および<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> ポリシーを使用すると、アクティブなLUNからコールドデータを階層化できます。つまり、オブジェクトストアデータの読み出し中にエラーが発生すると、データベースの可用性に影響する可能性があります。これらのポリシーを使用したSAN環境は、高可用性を実現するように設計されたエンタープライズクラスのオブジェクトストレージとネットワーク接続でのみ使用してください。NetApp StorageGRIDは優れたオプションです。</block>
  <block id="0f8062f9220efe4f38e7236fe8885379" category="paragraph">ほとんどのリレーショナルデータベースは、ポイントインタイムリカバリを実現するためにトランザクションログアーカイブモードで動作します。データベースへの変更は、トランザクションログに変更を記録することによってコミットされ、トランザクションログは上書きされずに保持されます。そのため、大量のアーカイブトランザクションログを保持しなければならない場合があります。同様の例は、保持する必要があるデータを生成する他の多くのアプリケーションワークフローにも存在しますが、アクセスされることはほとんどありません。</block>
  <block id="229384bbfb1db19c4897d87ba4b9bc2d" category="paragraph">FabricPoolは、階層化が統合された単一の解決策を提供することで、これらの問題を解決します。ファイルは通常の場所に保存されてアクセス可能な状態に維持されますが'プライマリ・アレイのスペースはほとんど消費されません</block>
  <block id="f60aec7aaed8420e09f17a8cfd1d7d37" category="paragraph">を使用します<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 数日間のポリシーを設定すると、最近作成されたファイル（短期的に必要になる可能性が高いファイル）のブロックが高パフォーマンス階層に保持されます。その後、古いファイルのデータブロックが大容量階層に移動されます。</block>
  <block id="485e24df9e0ebeecf416daa6e5441bba" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> ログが削除されたか、プライマリファイルシステムに引き続き存在しているかに関係なく、クーリングしきい値に達したときに、プロンプト階層化を適用します。必要となる可能性があるすべてのログをアクティブファイルシステムの1つの場所に格納することも、管理を簡易化します。リストアが必要なファイルを特定するためにSnapshotを検索する必要はありません。</block>
  <block id="bbe0132696bc482e0ba7a1f293d80083" category="paragraph">Microsoft SQL Serverなどの一部のアプリケーションでは、バックアップ処理中にトランザクションログファイルが切り捨てられ、ログがアクティブファイルシステムに記録されなくなります。容量は、<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 階層化ポリシー<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> アクティブファイルシステムにはログデータが冷却されることはほとんどないため、ログデータにはポリシーは役立ちません。</block>
  <block id="0694b4972669f201ca85f9427a230208" category="doc">MetroClusterは3種類の構成で使用できます。</block>
  <block id="948676ffa8073153cbe404795950ad85" category="list-text">IPセツソクノHAヘア</block>
  <block id="ef012b81fd45a95681a584a59f8df77e" category="list-text">FCセツソクノHAヘア</block>
  <block id="6ffec869ba36dff4e093b5ed8bac798a" category="list-text">シングルコントローラ、FC接続</block>
  <block id="6fa7041982bed9488213a7bd2ecccfdf" category="paragraph">[注]「接続」という用語は、サイト間レプリケーションに使用されるクラスタ接続を指します。ホストプロトコルを指しているわけではありません。MetroCluster構成では、クラスタ間通信に使用される接続の種類に関係なく、すべてのホスト側プロトコルが通常どおりサポートされます。</block>
  <block id="4767099b22895a8101a1cba45d8cf6e9" category="section-title">MetroCluster IP の略</block>
  <block id="adc397d87c1a7827f2df9fdd362d5ff7" category="paragraph">HAペアMetroCluster IP構成では、サイトごとに2ノードまたは4ノードを使用します。この設定オプションを使用すると、2ノードオプションに比べて複雑さとコストが増加しますが、サイト内の冗長性という重要なメリットがあります。単純なコントローラ障害では、WAN経由のデータアクセスは必要ありません。データアクセスは、代替ローカルコントローラを介してローカルのままです。</block>
  <block id="c15560f2ae5432223c591c5f5d9db5c1" category="paragraph">ほとんどのお客様は、インフラストラクチャの要件がシンプルであるため、IP接続を選択しています。これまでは、ダークファイバやFCスイッチを使用した場合、サイト間での高速接続のプロビジョニングは一般的に容易でしたが、今日では、高速で低レイテンシのIP回線がより容易に利用可能になっています。</block>
  <block id="b28c5a429800ea9669a191a402a72b49" category="paragraph">サイト間接続はコントローラのみであるため、アーキテクチャもシンプルです。FC SAN接続MetroClusterでは、コントローラが反対側サイトのドライブに直接書き込むため、追加のSAN接続、スイッチ、およびブリッジが必要になります。一方、IP構成のコントローラは、コントローラを介して反対側のドライブに書き込みます。</block>
  <block id="457b0075e8f0333975a8e2aaeaceb149" category="inline-link">MetroCluster IP 解決策のアーキテクチャと設計</block>
  <block id="82aa44c8aa5ebe78f1496c8fc80cb954" category="paragraph">追加情報については、ONTAPの公式ドキュメントを参照してください。<block ref="03a3c76178d2d43147a2756857a0985e" category="inline-link-rx"></block>。</block>
  <block id="68cf128ce140240c63e9a47e2a82a333" category="paragraph"><block ref="68cf128ce140240c63e9a47e2a82a333" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0d2d438a72f6c558744351265fa49a62" category="section-title">HAペアFC SAN接続MetroCluster</block>
  <block id="3e9133ff590581b29a911d9631ab1737" category="paragraph">HAペアMetroCluster FC構成では、サイトごとに2ノードまたは4ノードを使用します。この設定オプションを使用すると、2ノードオプションに比べて複雑さとコストが増加しますが、サイト内の冗長性という重要なメリットがあります。単純なコントローラ障害では、WAN経由のデータアクセスは必要ありません。データアクセスは、代替ローカルコントローラを介してローカルのままです。</block>
  <block id="7ea740801794ba8a2ce3f87db010c319" category="paragraph"><block ref="7ea740801794ba8a2ce3f87db010c319" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4bc2926f030255369db3e4435de5c774" category="paragraph">一部のマルチサイトインフラは、アクティブ/アクティブ運用向けに設計されたものではなく、プライマリサイトやディザスタリカバリサイトとして使用されます。この場合、一般にHAペアMetroClusterオプションが推奨される理由は次のとおりです。</block>
  <block id="5f49f48dd22b405a813e2ef7cc02e9f8" category="list-text">2ノードMetroClusterクラスタはHAシステムですが、コントローラに予期しない障害が発生した場合や計画的メンテナンスを行う場合は、反対側のサイトでデータサービスをオンラインにする必要があります。サイト間のネットワーク接続が必要な帯域幅をサポートできない場合は、パフォーマンスが低下します。唯一の選択肢は、さまざまなホストOSと関連サービスを代替サイトにフェイルオーバーすることです。HAペアMetroClusterクラスタでは、コントローラが停止すると同じサイト内で単純なフェイルオーバーが発生するため、この問題は解消されます。</block>
  <block id="0ce798a4f2e77d6aa1a6e0d718fa8e98" category="list-text">一部のネットワークトポロジは、サイト間アクセス用に設計されていませんが、異なるサブネットまたは分離されたFC SANを使用します。この場合、代替コントローラが反対側のサイトのサーバにデータを提供できないため、2ノードMetroClusterクラスタはHAシステムとして機能しなくなります。完全な冗長性を実現するには、HAペアMetroClusterオプションが必要です。</block>
  <block id="098fa44ef37572e0f8ea717199ac72e6" category="list-text">2サイトインフラを単一の高可用性インフラとみなす場合は、2ノードMetroCluster構成が適しています。ただし、サイト障害後もシステムが長時間機能しなければならない場合は、HAペアが推奨されます。HAペアは、単一サイト内でHAを提供し続けるためです。</block>
  <block id="ea8bb3e5a357ca97851352f6944342c9" category="section-title">2ノードFC SAN接続MetroCluster</block>
  <block id="b759079fef92c80eca80e7349bf84363" category="paragraph">2ノードMetroCluster構成では、サイトごとに1つのノードのみが使用されます。設定とメンテナンスが必要なコンポーネントが少ないため、HAペアオプションよりもシンプルな設計になっています。また、ケーブル配線やFCスイッチの点でインフラストラクチャの必要性も軽減されています。最後に、コストを削減します。</block>
  <block id="5bfcbf762ac959212294cdf71bbec2b5" category="paragraph"><block ref="5bfcbf762ac959212294cdf71bbec2b5" category="inline-image-macro-rx" type="image"></block></block>
  <block id="bcf549481eb36a62594e938bca6a10bb" category="paragraph">この設計の明らかな影響は、1つのサイトでコントローラに障害が発生した場合、反対側のサイトからデータを利用できることです。この制限は必ずしも問題ではありません。多くの企業は、本質的に単一のインフラとして機能する、拡張された高速で低レイテンシのネットワークを使用したマルチサイトデータセンター運用を行っています。このような場合は、2ノードバージョンのMetroClusterが推奨されます。2ノードシステムは現在、複数のサービスプロバイダでペタバイト規模で使用されています。</block>
  <block id="78558542e724655ba80fc4879399f103" category="section-title">MetroClusterの耐障害性機能</block>
  <block id="5427d2eb91f25a425f13544e56fb12c4" category="paragraph">MetroCluster 解決策 には単一点障害（Single Point of Failure）はありません。</block>
  <block id="6a988bf07e73bcbf69f62ce9724dd0f3" category="list-text">各コントローラに、ローカルサイトのドライブシェルフへの独立したパスが2つあります。</block>
  <block id="2c98a75e02c6e103b43724f02e99e393" category="list-text">各コントローラに、リモートサイトのドライブシェルフへの独立したパスが2つあります。</block>
  <block id="e18f703538cd1f5af3b9185eed57b49b" category="list-text">各コントローラには、反対側のサイトのコントローラへの独立したパスが2つあります。</block>
  <block id="800ec0ea85a62c2fb192ac2f79ee1d02" category="list-text">HAペア構成では、各コントローラからローカルパートナーへのパスが2つあります。</block>
  <block id="a3d7a569ad6ea771a0ad9b995619251b" category="paragraph">つまり、構成内のコンポーネントを1つでも削除しても、MetroClusterのデータ提供機能を損なうことはありません。2つのオプションの耐障害性の違いは、サイト障害後もHAペアバージョンが全体的なHAストレージシステムになる点だけです。</block>
  <block id="9b4c3976d453e66a3dd22e2793fc3a8e" category="doc">スペース管理</block>
  <block id="e89d3732a2fbc592923c30e54522dcdb" category="paragraph">シンプロビジョニングにはさまざまな形式があり、ONTAPがエンタープライズアプリケーション環境に提供する多くの機能に欠かせない機能です。シンプロビジョニングも効率化テクノロジと密接に関連しています。効率化機能を使用すると、ストレージシステムに実際に存在するよりも多くの論理データを格納できます。</block>
  <block id="537642ed3bfef7f2bb3e580b3b266bd3" category="paragraph">Snapshotを使用する場合、シンプロビジョニングが必要になります。たとえば、NetAppストレージ上の一般的な10TBのデータベースには、約30日間のSnapshotが含まれています。この構成では、アクティブファイルシステムに表示されるデータは約10TB、Snapshot専用のデータは300TBになります。合計310TBのストレージは、通常、約12~15TBのスペースに配置されます。アクティブデータベースは10TBを消費しますが、残りの300TBのデータは元のデータに加えられた変更のみが格納されるため、2TB~5TBのスペースしか必要としません。</block>
  <block id="a19609016ad1cb6b7bae7cac796a26a4" category="paragraph">クローニングもシンプロビジョニングの一例です。NetAppの主要なお客様が、80TBのデータベースのクローンを40個作成し、開発用に使用しました。これらのクローンを使用している40人の開発者全員がすべてのデータファイルのすべてのブロックを上書きした場合、3.2PBを超えるストレージが必要になります。実際には書き替え率は低く、変更のみがドライブに格納されるため、必要なスペースは合計で40TBに近くなります。</block>
  <block id="2433af6347e4871be5af0f2af0f6bd6e" category="paragraph">データの変更率が予期せず増加する可能性があるため、アプリケーション環境のシンプロビジョニングには注意が必要です。たとえば、データベーステーブルのインデックスを再作成したり、VMwareゲストに大規模なパッチを適用したりすると、Snapshotによるスペース消費が急増します。バックアップの配置が間違っていると、非常に短時間で大量のデータが書き込まれる可能性があります。最後に、ファイルシステムの空きスペースが予期せず不足した場合、一部のアプリケーションのリカバリが困難になることがあります。</block>
  <block id="5cf4dc4d1ce52ff655ea7f1157a72e2e" category="paragraph">幸いなことに、これらのリスクは慎重に構成することで対処できます。<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> および<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block> ポリシー：名前からわかるように、これらのオプションを使用すると、Snapshotによって消費されるスペースを自動的にクリアしたり、追加データに対応するためにボリュームを拡張したりするポリシーを作成できます。多くのオプションが用意されており、ニーズはお客様によって異なります。</block>
  <block id="6a28738961e6f6e4b57e4dd70c446600" category="inline-link-macro">論理ストレージ管理に関する文書</block>
  <block id="01570cb5a3aec2324ab56e318e1de04d" category="paragraph">を参照してください <block ref="e69bd75bdb49183ee90588843edb33f4" category="inline-link-macro-rx"></block> を参照してください。</block>
  <block id="8cf44a7a390ab582c5010ba430143d4b" category="section-title">LUNシンプロビジョニング</block>
  <block id="ba0bdf51bc57bacdd6f3f0bd26b7674c" category="paragraph">ファイルシステム環境でアクティブなLUNをシンプロビジョニングした場合、データが削除されるにつれて効率が低下する可能性があります。削除されたデータがゼロで上書きされるか、TRIM/UNMAPスペース再生でスペースが解放されない限り、「消去された」データはファイルシステム内の割り当てられていないスペースをますます占有します。さらに、データファイルは作成時にフルサイズに初期化されるため、アクティブなLUNのシンプロビジョニングは多くのデータベース環境ではあまり使用されません。</block>
  <block id="e10d46632bc86306cf4c22633ee930ab" category="paragraph">LVMの構成を慎重に計画すると、効率が向上し、ストレージのプロビジョニングやLUNのサイズ変更の必要性を最小限に抑えることができます。Veritas VxVMやOracle ASMなどのLVMを使用すると、基盤となるLUNが複数のエクステントに分割され、必要な場合にのみ使用されます。たとえば、最初は2TBのサイズだったデータセットが、やがて10TBに拡張される可能性がある場合、このデータセットを、シンプロビジョニングされた10TBのLUNがLVMディスクグループにまとめられて配置できます。作成時に消費されるスペースは2TBにすぎず、データ量の増大に対応するためにエクステントが割り当てられた場合にのみ追加のスペースが必要になります。このプロセスは、スペースが監視されているかぎり安全です。</block>
  <block id="66a41fd6fc38c454973e91d92cf0e291" category="section-title">フラクショナルリザベーション</block>
  <block id="e8a206fe65814e0ea465e32487544751" category="paragraph">フラクショナルリザーブは、ボリューム内でのスペース効率に関するLUNの動作です。オプション<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> が100%に設定されている場合、ボリュームのスペースを使い切ることなく、任意のデータパターンでボリューム内のすべてのデータを100%書き替えることができます。</block>
  <block id="a3cd28aef7d0becd57b60187fdc4a24e" category="paragraph">たとえば、1TBのボリュームに配置された単一の250GB LUNにデータベースが格納されているとします。Snapshotを作成すると、ただちにボリュームに250GBのスペースが追加でリザーブされ、何らかの理由でボリュームのスペースが不足することはありません。データベースボリュームのすべてのバイトの上書きが必要になることはほとんどないため、フラクショナルリザーブの使用は一般に無駄です。決して発生しないイベントのためにスペースを予約する理由はありません。ただし、ストレージシステムのスペース消費を監視できず、スペースが不足しないように保証する必要がある場合は、Snapshotの使用に100%のフラクショナルリザベーションが必要になります。</block>
  <block id="e30fbe8981929fb070a820a213381bab" category="section-title">圧縮と重複排除</block>
  <block id="1b6e4e9a2be031edc6f3da1f559ef884" category="paragraph">圧縮と重複排除はどちらもシンプロビジョニングの形式です。たとえば、50TBのデータ容量を30TBに圧縮すると、20TBが削減されます。圧縮によってメリットが得られるようにするには、20TBの一部を他のデータに使用するか、50TB未満のストレージシステムを購入する必要があります。その結果、ストレージシステムで実際に使用可能な量よりも多くのデータが格納されます。データの観点から見ると、ドライブでは30TBしか占有していないにもかかわらず、50TBのデータがあります。</block>
  <block id="dbca4bb791f36eac2c11c32f73f2b4ec" category="paragraph">データセットの圧縮率は常に変化し、実際のスペースの消費量が増加する可能性があります。このように消費量が増加するため、他の形式のシンプロビジョニングと同様に、監視と使用の観点から圧縮を管理する必要があります。<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> および<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block>。</block>
  <block id="ad241666a88b5414e8c2fe6d1cc1edb0" category="paragraph">圧縮機能と重複排除機能の詳細については、efficiency.htmlのリンクを参照してください。</block>
  <block id="8ecfcadfebb472a089481e8554ebed87" category="section-title">圧縮とフラクショナルリザベーション</block>
  <block id="4f8fcc146d2e8e712dcd8c56b1684fcc" category="paragraph">圧縮はシンプロビジョニングの一形態です。フラクショナルリザベーションは圧縮の使用に影響します。スペースはSnapshotの作成前にリザーブされる点に注意してください。通常、フラクショナルリザーブが重要になるのはSnapshotが存在する場合のみです。Snapshotがない場合、フラクショナルリザーブは重要ではありません。これは、圧縮の場合には当てはまりません。圧縮が有効なボリュームでLUNを作成すると、ONTAPではSnapshotに対応するためのスペースが確保されます。この動作は設定時に混乱を招く可能性がありますが、これは想定される動作です。</block>
  <block id="e26f8048b4bf60dad827c5a425271361" category="paragraph">たとえば、10GBのボリュームに5GBのLUNが格納され、2.5GBに圧縮されてSnapshotが作成されていないとします。次の2つのシナリオを検討します。</block>
  <block id="ade18971a2dab7e37335e95d81da0ef1" category="list-text">フラクショナルリザーブ= 100では7.5GBが使用されます。</block>
  <block id="1d07b8e7c92488a55301ea201328cf35" category="list-text">フラクショナルリザーブ= 0の場合、2.5GBの使用率が得られます。</block>
  <block id="aa410d0e46ec94b6efcf344f0d870c1a" category="paragraph">最初のシナリオでは、現在のデータ用に2.5GBのスペースが使用され、スナップショットの使用を想定してソースの100%の切り替えに使用される5GBのスペースが使用されます。2番目のシナリオでは、追加のスペースは確保されません。</block>
  <block id="e79414ad391b126cc9bd53af1624c8de" category="paragraph">この状況は混乱しているように見えるかもしれませんが、実際に遭遇することはほとんどありません。圧縮はシンプロビジョニングを意味し、LUN環境でのシンプロビジョニングにはフラクショナルリザベーションが必要です。圧縮されたデータは圧縮不可能なデータで上書きされる可能性があります。つまり、圧縮によって削減効果が得られるように、ボリュームをシンプロビジョニングする必要があります。</block>
  <block id="499a10b92cb9ca6b3412d4bf5a91a2b0" category="paragraph">* NetAppでは*次の予約構成を推奨しています。</block>
  <block id="7f26e875cee50c1b3baf71a014043794" category="list-text">設定<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 基本的な容量監視と<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> および<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block>。</block>
  <block id="675996bd34ec0d8c134215f5be73fb3a" category="list-text">設定<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 監視機能がない場合、または何らかの状況でスペースを使い切ることができない場合は、100にします。</block>
  <block id="8ee38535add58992c14b23a6f7cf8d27" category="doc">LIFタイフ</block>
  <block id="50d034374ef68094a0f6c8e8d06a77af" category="inline-link-macro">ONTAPネットワーク管理に関するドキュメント</block>
  <block id="fc25025f3f0a2afd42465a55f35c02d0" category="paragraph">このセクションでは、LIFの主な設計原則の概要を説明します。より包括的なドキュメントについては、 <block ref="a3e6361e1a52d384f542a2f2d8bc9bb1" category="inline-link-macro-rx"></block>。データベースアーキテクチャの他の要素と同様に、Storage Virtual Machine（SVM、CLIではVserver）と論理インターフェイス（LIF）の設計に最適なオプションは、拡張要件とビジネスニーズに大きく依存します。</block>
  <block id="be0801f7fb241be642bec73b799d45cb" category="paragraph">LIFの戦略を立てる際は、主に次の点を考慮してください。</block>
  <block id="362c2978dddcf6988ce266d3d60f5beb" category="list-text">*パフォーマンス。*ネットワーク帯域幅は十分か。</block>
  <block id="cfc88efb72b2c7ea83a4a3d68b760d55" category="list-text">*耐障害性。*設計に単一点障害はありますか？</block>
  <block id="af02972fd4dc1e949d800731d9518812" category="list-text">*管理性。*ネットワークを無停止で拡張できますか？</block>
  <block id="fdcbadc80d2dd31527cc91cf81fb725d" category="paragraph">これらのトピックは、ホストからスイッチ、ストレージシステムまで、エンドツーエンドの解決策に適用されます。</block>
  <block id="f45fe079103703d0b315ff2e339728fd" category="inline-link-macro">LIFタイプに関するONTAPのドキュメント</block>
  <block id="cc4583278db25277db9ddcd781cbf992" category="paragraph">LIFには複数のタイプがあります。 <block ref="9d27879d9d2bd4f0f081ffed63159522" category="inline-link-macro-rx"></block> このトピックのより包括的な情報を提供しますが、機能的にはLIFを次のグループに分類できます。</block>
  <block id="f34a52d788c5a4cf56d7ae8ccb85f8c2" category="list-text">*クラスタおよびノードの管理LIF。*ストレージクラスタの管理に使用するLIF。</block>
  <block id="73ac4e00a9ff3caf31e6df13a6df2f78" category="list-text">* SVM管理LIF。* REST APIまたはONTAPI（ZAPIとも呼ばれます）を使用してSVMへのアクセスを許可するインターフェイス。Snapshotの作成やボリュームのサイズ変更などの機能に使用できます。SnapManager for Oracle（SMO）などの製品では、SVM管理LIFにアクセスする必要があります。</block>
  <block id="b7010e46f4769f638197aa230f448ba0" category="list-text">*データLIF。* FC、iSCSI、NVMe/FC、NVMe/TCP、NFS、 またはSMB / CIFSデータ。</block>
  <block id="1eb4f53fa8ee8f0954514a1b9858bf6b" category="admonition">ファイアウォールポリシーを<block ref="8d777f385d3dfec8815d20f7496026dc" prefix=" " category="inline-code"></block> 終了：<block ref="d724f231a9a7b89757c4394d6622bc47" prefix=" " category="inline-code"></block> または、HTTP、HTTPS、SSHを許可する別のポリシー。この変更により、NFSデータLIFと別の管理LIFの両方にアクセスするように各ホストを設定する必要がなくなるため、ネットワーク設定が簡易化されます。iSCSIトラフィックと管理トラフィックの両方にIPプロトコルを使用しているにもかかわらず、インターフェイスを設定することはできません。iSCSI環境では、個別の管理LIFが必要です。</block>
  <block id="85d465743ad38be108b50648ab283d78" category="section-title">SAN LIFの設計</block>
  <block id="8800a54085e1b2987d83537423221cf9" category="paragraph">SAN環境でのLIFの設計は、マルチパスという1つの理由で比較的簡単です。最新のSAN実装では、クライアントは複数の独立したネットワークパス経由でデータにアクセスし、アクセスに最適なパス（複数可）を選択できます。その結果、SANクライアントは使用可能な最適なパス間でI/Oの負荷を自動的に分散するため、パフォーマンスに関してはLIFの設計は容易に対処できます。</block>
  <block id="e33c923a4d6280bf6f2b2a982ff74ee3" category="paragraph">あるパスが使用できなくなった場合、クライアントは自動的に別のパスを選択します。その結果、設計がシンプルになるため、一般にSAN LIFの管理性が向上します。だからといって、SAN環境の方が常に簡単に管理できるわけではありません。SANストレージには、NFSよりもはるかに複雑な要素が多数あるからです。単純に、SAN LIFの設計が容易であることを意味します。</block>
  <block id="9446a98ad14416153cc4d45ab8b531bf" category="section-title">パフォーマンス</block>
  <block id="141614e246b14131ec01a449d61ed657" category="paragraph">SAN環境でLIFのパフォーマンスを考慮する際に最も重要な考慮事項は、帯域幅です。たとえば、2ノードONTAP AFFクラスタの各ノードに16Gb FCポートを2つ搭載すると、各ノードとの間で最大32Gbの帯域幅を確保できます。</block>
  <block id="02bc0523497de72834c4c7990e32d155" category="section-title">耐障害性</block>
  <block id="01b1d8276ca14813ff4804089a9ac082" category="paragraph">AFFストレージシステムでは、SAN LIFはフェイルオーバーしません。コントローラのフェイルオーバーが原因でSAN LIFに障害が発生すると、クライアントのマルチパスソフトウェアがパスの損失を検出し、I/Oを別のLIFにリダイレクトします。ASAストレージシステムでは、LIFは短時間でフェイルオーバーされますが、もう一方のコントローラにすでにアクティブなパスがあるためIOが中断されることはありません。フェイルオーバープロセスは、定義されたすべてのポートでホストアクセスをリストアするために実行されます。</block>
  <block id="b7c94ef25c0629a65f8a1f6ce7014d95" category="section-title">管理性</block>
  <block id="1325935a6fa0e88cfec45038005f18e3" category="paragraph">NFS環境では、クラスタ内でのボリュームの再配置にLIFの移行が伴うことが多いため、LIFの移行ははるかに一般的なタスクです。SAN環境でHAペア内でボリュームを再配置しても、LIFを移行する必要はありません。ボリュームの移動が完了すると、ONTAPはパスの変更をSANに通知し、SANクライアントは自動的に再最適化します。SANを使用したLIFの移行は、主に物理ハードウェアの大幅な変更に関連しています。たとえば、コントローラの無停止アップグレードが必要な場合は、SAN LIFを新しいハードウェアに移行します。FCポートで障害が検出された場合は、LIFを未使用のポートに移行できます。</block>
  <block id="dbb887b1373e51dab774976c5a556964" category="section-title">設計上の推奨事項</block>
  <block id="076872b2444637e6142c3c6f0f157423" category="paragraph">NetAppの推奨事項は次のとおりです。</block>
  <block id="d8d6bca7c981c13479781da85883cfef" category="list-text">必要以上の数のパスを作成しないでください。パスの数が多すぎると管理全体が複雑になり、一部のホストでのパスのフェイルオーバーで原因の問題が発生する可能性があります。さらに、一部のホストでは、SANブートなどの構成でパスが予期せず制限されます。</block>
  <block id="bd662d86fcca370cddf188ff5378fb1b" category="list-text">ごく少数の構成では、LUNへのパスが4つ以上必要です。LUNにパスをアドバタイズするノードが3つ以上あると、LUNを所有するノードとそのHAパートナーに障害が発生した場合、LUNをホストしているアグリゲートにアクセスできなくなるため、その価値には制限があります。このような状況では、プライマリHAペア以外のノードにパスを作成しても役に立ちません。</block>
  <block id="8873f044ab7c082f16372e4b8bdc6e03" category="list-text">参照可能なLUNパスの数はFCゾーンに含めるポートを選択することで管理できますが、一般には、ターゲットとなるポイントをすべてFCゾーンに含め、LUNの可視性をONTAPレベルで制御する方が簡単です。</block>
  <block id="0ebc6267761306c4daefb9871a470e4b" category="list-text">ONTAP 8.3以降では、選択的LUNマッピング（SLM）機能がデフォルトです。SLMを使用すると、新しいLUNはすべて、基盤となるアグリゲートを所有するノードとノードのHAパートナーから自動的に通知されます。これにより、ポートのアクセス性を制限するためにポートセットを作成したりゾーニングを設定したりする必要がなくなります。各LUNは、最適なパフォーマンスと耐障害性の両方を実現するために必要な最小限のノードで利用できます。
* LUNを2台のコントローラの外部に移行する必要がある場合は、<block ref="02d0bbdc14988c85bbd7994723f4dd7f" prefix=" " category="inline-code"></block> コマンドを実行して、新しいノードでLUNがアドバタイズされるようにします。これにより、LUNの移行用にLUNへの追加のSANパスが作成されます。ただし、新しいパスを使用するには、ホストで検出処理を実行する必要があります。</block>
  <block id="cc4b24f288afae5889c6061466dda472" category="list-text">間接トラフィックを過度に気にしないでください。I/Oが大量に発生する環境ではレイテンシがマイクロ秒単位で重要になるため、間接トラフィックは避けることを推奨しますが、一般的なワークロードではパフォーマンスに目に見える影響はごくわずかです。</block>
  <block id="f54fccb82abaa995eb9f86264f431505" category="section-title">NFS LIFの設計</block>
  <block id="e68dee93f11ae71aebd7a1e4c2abfc5a" category="paragraph">NFSでは、SANプロトコルとは異なり、データへの複数のパスを定義する機能に制限があります。NFSv4に対するParallel NFS（pNFS）拡張ではこの制限に対応していますが、イーサネットの速度が100GB以上に達しているため、パスを追加する価値があることはほとんどありません。</block>
  <block id="391dc675ec3d853200129b799ed5923e" category="section-title">パフォーマンスと耐障害性</block>
  <block id="a0bd34f908e3947aa4aba15382354836" category="paragraph">SAN LIFのパフォーマンスを測定することは、主にすべてのプライマリパスの合計帯域幅を計算することですが、NFS LIFのパフォーマンスを判断するには、正確なネットワーク構成を詳しく調べる必要があります。たとえば、2つの10Gbポートを物理ポートとして構成することも、Link Aggregation Control Protocol（LACP）インターフェイスグループとして構成することもできます。インターフェイスグループとして設定されている場合は、複数のロードバランシングポリシーを使用できます。ロードバランシングポリシーの動作は、トラフィックがスイッチングされるかルーティングされるかによって異なります。最後に、Oracle Direct NFS（dNFS）は、現時点ではどのOS NFSクライアントにも存在しないロードバランシング設定を提供します。</block>
  <block id="e500ca27c6b92454c989d80e0445c359" category="paragraph">SANプロトコルとは異なり、NFSファイルシステムにはプロトコルレイヤでの耐障害性が必要です。たとえば、LUNは常にマルチパスを有効にして設定されるため、ストレージシステムではFCプロトコルを使用する複数の冗長チャネルを使用できます。一方NFSファイルシステムは、物理レイヤでのみ保護できる単一のTCP/IPチャネルの可用性に依存します。このような理由から、ポートフェイルオーバーやLACPポートアグリゲーションなどのオプションが用意されています。</block>
  <block id="35926e2ada969ad80fd3b16c0cd7d35a" category="paragraph">NFS環境では、パフォーマンスと耐障害性の両方がネットワークプロトコルレイヤで提供されます。その結果、両方のトピックが絡み合っており、一緒に議論する必要があります。</block>
  <block id="84f4a5dfaa9613a469cd783c353a186c" category="section-title">ポートグループへのLIFのバインド</block>
  <block id="44bfb87c11d83c1b91c3589f2081e7ca" category="paragraph">LIFをポートグループにバインドするには、LIFのIPアドレスを物理ポートのグループに関連付けます。物理ポートを1つに集約する主な方法はLACPです。LACPのフォールトトレランス機能は非常に簡単です。LACPグループ内の各ポートは監視され、障害が発生した場合はポートグループから削除されます。ただし、パフォーマンスに関してLACPがどのように機能するかについては、多くの誤解があります。</block>
  <block id="19a43026949fb6ef1017a54cf7c94f9b" category="list-text">LACPでは、エンドポイントと一致するようにスイッチで設定する必要はありません。たとえば、ONTAPにIPベースのロードバランシングを設定し、スイッチにMACベースのロードバランシングを使用することができます。</block>
  <block id="86501252b34395de5303a65f5e9943e3" category="list-text">LACP接続を使用する各エンドポイントは、パケット送信ポートを個別に選択できますが、受信に使用するポートは選択できません。これは、ONTAPから特定の宛先へのトラフィックが特定のポートに結び付けられ、リターントラフィックが別のインターフェイスに到達する可能性があることを意味します。ただし、これは原因の問題ではありません。</block>
  <block id="298ca40b99dd3540dcd82ba5537f3f8d" category="list-text">LACPでは、常にトラフィックが均等に分散されるわけではありません。多数のNFSクライアントを含む大規模な環境では、通常はLACPアグリゲーションのすべてのポートが均等に使用されます。ただし、環境内の1つのNFSファイルシステムの帯域幅は、アグリゲーション全体ではなく、1つのポートの帯域幅に制限されます。</block>
  <block id="d071b5ccd1569aace97a0b4d6c0a71ac" category="list-text">ONTAPではロビンベースのLACPポリシーを使用できますが、スイッチからホストへの接続には対応していません。たとえば、ホストで4ポートのLACPトランクを、ONTAPで4ポートのLACPトランクを使用する構成でも、ファイルシステムの読み取りには1つのポートしか使用できません。ONTAPは4つのポートすべてを介してデータを送信できますが、4つのポートすべてを介してスイッチからホストに送信するスイッチテクノロジは現在使用できません。使用されるのは1つだけです。</block>
  <block id="6e9e98dfaea1ca7860606f1fc05e414a" category="paragraph">多数のデータベースホストで構成される大規模な環境で最も一般的なアプローチは、IPロードバランシングを使用して、適切な数の10Gb（またはそれよりも高速）インターフェイスでLACPアグリゲートを構築する方法です。このアプローチにより、ONTAPはクライアントが十分に存在する限り、すべてのポートを均等に使用できます。LACPトランキングでは負荷が動的に再分散されないため、構成内のクライアント数が少なくなるとロードバランシングが機能しません。</block>
  <block id="7815da600ab459d2b05c5792f2271c1a" category="paragraph">接続が確立されると、特定の方向のトラフィックは1つのポートにのみ配置されます。たとえば、あるデータベースがNFSファイルシステムに対してテーブルのフルスキャンを実行し、接続に4ポートのLACPトランクを使用している場合、データの読み取りには1枚のネットワークインターフェイスカード（NIC）のみが使用されます。このような環境にデータベースサーバが3台しかない場合は、3台すべてが同じポートから読み取りを行い、他の3つのポートはアイドル状態になる可能性があります。</block>
  <block id="153f704ea16440133d51b1877af2a657" category="section-title">物理ポートへのLIFのバインド</block>
  <block id="70e655aa3c03f840747c5272142b3527" category="paragraph">物理ポートにLIFをバインドすると、ネットワーク構成をきめ細かく制御できるようになります。これは、ONTAPシステム上の特定のIPアドレスは、一度に1つのネットワークポートにのみ関連付けられるためです。フェイルオーバーグループとフェイルオーバーポリシーを設定することで耐障害性が実現します。</block>
  <block id="218f00463f5281b8ead536582c69ac3a" category="section-title">フェイルオーバーポリシーとフェイルオーバーグループ</block>
  <block id="0a53c26a1bc4036c84fc3b4b63542744" category="inline-link-macro">フェイルオーバーグループとポリシーに関するONTAPのネットワーク管理に関するドキュメント</block>
  <block id="f29ae31443947c9782482ee9683dbc0e" category="paragraph">ネットワーク停止時のLIFの動作は、フェイルオーバーポリシーとフェイルオーバーグループによって制御されます。設定オプションは、ONTAPのバージョンによって変更されました。を参照してください <block ref="96c8cd47b667604fb9991ace7d2eff29" category="inline-link-macro-rx"></block> を参照して、導入するONTAPのバージョンの詳細を確認してください。</block>
  <block id="0f2f345dd1247ae428cee703c1bf1c84" category="paragraph">ONTAP 8.3以降では、ブロードキャストドメインに基づいてLIFのフェイルオーバーを管理できます。そのため、特定のサブネットにアクセスできるすべてのポートを管理者が定義し、ONTAPが適切なフェイルオーバーLIFを選択できるようにすることができます。このアプローチは一部のお客様にも使用できますが、予測性がないため、高速ストレージネットワーク環境では制限があります。たとえば、ファイルシステムへの日常的なアクセスに使用する1Gbポートと、データファイルI/Oに使用する10Gbポートの両方を環境に含めることができます。両方のタイプのポートが同じブロードキャストドメインにあると、LIFのフェイルオーバーによって、データファイルI/Oが10Gbポートから1Gbポートに移動される可能性があります。</block>
  <block id="ced0729d57c08312b2b12382f2147d26" category="paragraph">要約すると、次の方法を検討してください。</block>
  <block id="57cb6a7ba8acb7faa31cc5219bae83b3" category="list-text">ユーザ定義のフェイルオーバーグループを設定します。</block>
  <block id="b444855eccae552d7fb79bf3d31a4f7b" category="list-text">フェイルオーバーグループにストレージフェイルオーバー（SFO）パートナーコントローラのポートを含め、ストレージフェイルオーバー時にLIFがアグリゲートに従って移動するようにします。これにより、間接トラフィックの作成が回避されます。</block>
  <block id="86c48b21d166ed8e440a07e1d4a0b15d" category="list-text">パフォーマンス特性が元のLIFと一致するフェイルオーバーポートを使用します。たとえば、1つの物理10Gbポート上のLIFには、1つの10Gbポートを含むフェイルオーバーグループを含める必要があります。4ポートLACP LIFは、別の4ポートLACP LIFにフェイルオーバーする必要があります。これらのポートは、ブロードキャストドメインに定義されているポートのサブセットになります。</block>
  <block id="3e839a73f7dc1262508f23a89628ca2d" category="list-text">SFOパートナーのみにフェイルオーバーポリシーを設定します。これにより、フェイルオーバー時にLIFがアグリゲートに従うようになります。</block>
  <block id="85e82ce4c9842f978fa774c4fe96b14c" category="section-title">自動リバート</block>
  <block id="3dc8610f78478640e47688101cecbfad" category="paragraph">を設定します<block ref="9f1b7141f09f19c4e33409646aef43cf" prefix=" " category="inline-code"></block> 必要に応じてパラメータを指定する。ほとんどのお客様は、このパラメータを<block ref="b326b5062b2f0e69046810717534cb09" prefix=" " category="inline-code"></block> LIFをホームポートにリバートします。ただし、場合によっては、想定外のフェイルオーバーを調査してからLIFをホームポートに戻すように、このパラメータを「false」に設定することもできます。</block>
  <block id="edf6d4c299bc2890ba63c7eb3ef8b4d2" category="section-title">LIFとボリュームの比率</block>
  <block id="9c75becef8c432a0152a40c7c037a04c" category="paragraph">よくある誤解の1つは、ボリュームとNFS LIFの間には1：1の関係が必要であるということです。この構成は、ボリュームをクラスタ内の任意の場所に移動する際に必要ですが、インターコネクトトラフィックが増えることはありません。ただし、この構成は必須要件ではありません。クラスタ間トラフィックは考慮する必要がありますが、クラスタ間トラフィックが存在するだけでは問題は発生しません。ONTAP用に作成された公開済みのベンチマークの多くには、主に間接I/Oが含まれています。</block>
  <block id="2b4ebcd522b07b80d3fd76b301c506e8" category="paragraph">たとえば、パフォーマンスが重視されるデータベースの数が比較的少なく、合計で40個のボリュームしか必要としないデータベースプロジェクトの場合、ボリューム対LIFの戦略は1：1で、必要なIPアドレスは40個です。これにより、すべてのボリュームを関連付けられたLIFと一緒にクラスタ内の任意の場所に移動でき、トラフィックは常に直接送信されるため、レイテンシのすべてのソースをマイクロ秒レベルでも最小限に抑えることができます。</block>
  <block id="38bad4911bcdf1117d37eb1195566f8c" category="paragraph">反対の例として、大規模なホスト環境では、お客様とLIFが1：1の関係にある場合、より簡単に管理できます。時間が経つにつれて、ボリュームを別のノードに移行しなければならない場合があり、間接トラフィックが原因になることがあります。ただし、インターコネクトスイッチのネットワークポートが飽和状態になっていないかぎり、パフォーマンスへの影響は検出されません。懸念がある場合は、ノードを追加して新しいLIFを設定し、次回のメンテナンス時間にホストを更新して、構成から間接トラフィックを取り除くことができます。</block>
  <block id="d75b0d8f723c3e97eaa4ca39630c7420" category="doc">MetroClusterと複数のアグリゲート</block>
  <block id="df5855269b493a27a5565dfd9f2584f0" category="list-text">通常の状態では、特定のコントローラへの書き込みは、パートナーに同期ミラーリングされます。NetApp MetroCluster環境では、書き込みはリモートコントローラにもミラーリングされます。書き込みがすべての場所の不揮発性メディアに格納されるまで、ホストアプリケーションに確認応答は返されません。</block>
  <block id="05b60db315aa45e1524b7a6ffa242fa8" category="list-text">書き込みデータを格納するメディアは、不揮発性メモリ（NVMEM）と呼ばれます。不揮発性ランダムアクセスメモリ（NVRAM）と呼ばれることもあります。機能はジャーナルですが、書き込みキャッシュとみなすことができます。通常の処理でNVMEMのデータが読み取られることはなく、ソフトウェアまたはハードウェアに障害が発生した場合のデータ保護にのみ使用されます。ドライブにデータが書き込まれると、NVMEMではなくシステムのRAMからデータが転送されます。</block>
  <block id="e6dd8b559da6e046f2043043a55faafc" category="list-text">テイクオーバー処理では、ハイアベイラビリティ（HA）ペアの一方のノードがパートナーの処理をテイクオーバーします。スイッチオーバーは基本的に同じですが、IT環境 MetroCluster構成ではリモートノードがローカルノードの機能を引き継ぎます。</block>
  <block id="33c0c466972aae7427262e3075a2ed07" category="paragraph">定期的なメンテナンス作業中は、ネットワークパスの変更によって一時的に運用が停止する可能性がある場合を除き、ストレージのテイクオーバーやスイッチオーバーは透過的に行われる必要があります。ただし、ネットワークの設定は複雑なため、エラーが発生しやすいため、NetAppでは、ストレージシステムを本番環境に移行する前に、テイクオーバーとスイッチオーバーの処理を徹底的にテストすることを強く推奨します。これは、すべてのネットワークパスが正しく設定されていることを確認する唯一の方法です。SAN環境では、コマンドの出力を慎重に確認します。<block ref="41dc2c94e82e1c56ba876085acf5a974" prefix=" " category="inline-code"></block> 想定されるすべてのプライマリパスとセカンダリパスが使用可能であることを確認します。</block>
  <block id="d33ea1ad1493de23aafd480e95fea159" category="paragraph">テイクオーバーやスイッチオーバーを強制的に実行する場合は注意が必要です。これらのオプションを使用してストレージ構成を強制的に変更すると、ドライブを所有するコントローラの状態が無視され、代わりのノードが強制的にドライブの制御を引き継ぐことになります。テイクオーバーの強制が正しく行われないと、データの損失や破損が発生する可能性があります。これは、強制的なテイクオーバーやスイッチオーバーによってNVMEMの内容が破棄される可能性があるためです。テイクオーバーまたはスイッチオーバーの完了後にそのデータが失われると、データベースから見ると、ドライブに格納されているデータが少し古い状態に戻る可能性があります。</block>
  <block id="c226371d96b605ccff84ad23db0069b8" category="paragraph">通常のHAペアを使用した強制テイクオーバーが必要になることはほとんどありません。ほぼすべての障害シナリオでは、ノードがシャットダウンし、パートナーに通知して自動フェイルオーバーが実行されます。一部のエッジケース（ローリング障害など）では、ノード間のインターコネクトが失われたあとに一方のコントローラが失われた場合など、強制テイクオーバーが必要になります。この場合、コントローラで障害が発生する前にノード間のミラーリングが失われるため、稼働しているコントローラには実行中の書き込みのコピーが存在しなくなります。その後、テイクオーバーを強制的に実行する必要があります。つまり、データが失われる可能性があります。</block>
  <block id="418f81f529a577cb711b44adece1376f" category="paragraph">同じ論理環境A MetroClusterスイッチオーバー。通常の状態では、スイッチオーバーはほぼ透過的に実行されます。ただし、災害が発生すると、サバイバーサイトとディザスタサイトの間の接続が失われる可能性があります。サバイバーサイトから見ると、問題はサイト間の接続の中断にすぎず、元のサイトが引き続きデータを処理している可能性があります。ノードがプライマリコントローラの状態を検証できない場合は、強制スイッチオーバーのみが実行できます。</block>
  <block id="ae0c16d397348d8f8fd4e56b08b06c7c" category="paragraph">* NetAppでは、次の注意事項を遵守することを推奨しています。</block>
  <block id="79fd18cb18befbe5c2113757478be193" category="list-text">テイクオーバーやスイッチオーバーを誤って強制的に実行しないように十分注意してください。通常は強制は必要ありません。強制的に変更すると、原因のデータが失われる可能性があります。</block>
  <block id="26cece11254903c5ba8bfdd8d54ae779" category="list-text">テイクオーバーやスイッチオーバーの強制実行が必要な場合は、アプリケーションがシャットダウンされ、すべてのファイルシステムがディスマウントされ、論理ボリュームマネージャ（LVM）ボリュームグループが分離されていることを確認してください。ASMディスクグループをアンマウントする必要があります。</block>
  <block id="0b6986eb1285d28a9987ea13adbca358" category="list-text">MetroClusterの強制スイッチオーバーが発生した場合は、障害が発生したノードを残りのすべてのストレージリソースからフェンシングします。詳細については、該当するバージョンのONTAPの『MetroCluster管理およびディザスタリカバリガイド』を参照してください。</block>
  <block id="71303adf87737046acd4381c72151278" category="paragraph">MetroClusterは同期レプリケーションテクノロジで、接続が中断されると非同期モードに切り替わります。これはお客様からの最も一般的な要求です。同期レプリケーションが保証されていると、サイト接続が中断されるとデータベースI/Oが完全に停止し、データベースのサービスが停止します。</block>
  <block id="cb791a44ee361703eb7594a7932f57de" category="paragraph">MetroClusterを使用すると、接続がリストアされたあとにアグリゲートが迅速に再同期されます。他のストレージテクノロジとは異なり、MetroClusterでは、サイト障害後に完全な再ミラーリングを行う必要はありません。変更された差分のみを出荷する必要があります。</block>
  <block id="c1536091d7c1ca33c9dc4dfa8c0852a2" category="paragraph">複数のアグリゲートにまたがるデータセットでは、ローリングディザスタシナリオでデータリカバリ手順を追加する必要があるというわずかなリスクがあります。具体的には、（a）サイト間の接続が中断された場合、（b）接続がリストアされた場合、（c）アグリゲートが同期されている状態と同期されていない状態になった場合、 そして（d）プライマリサイトが失われると、サバイバーサイトが作成され、アグリゲートが相互に同期されなくなります。この場合、データセットの一部が相互に同期され、アプリケーション、データベース、またはデータストアをリカバリなしで起動することはできません。データセットが複数のアグリゲートにまたがっている場合、NetAppでは、Snapshotベースのバックアップと多数のツールのいずれかを活用して、このような異常な状況で迅速にリカバリできるかどうかを検証することを強く推奨しています。</block>
  <block id="a42c87064c284490a38efac4bf0b7f7f" category="paragraph">RAID 4、RAID 5、RAID 6、RAID DP、およびRAID-TECはいずれもパリティを使用して、ドライブ障害によってデータが失われないようにします。これらのRAIDオプションはミラーリングよりもストレージ利用率がはるかに優れていますが、ほとんどのRAID実装には書き込み処理に影響する欠点があります。他のRAID実装で書き込み操作が完了すると、パリティデータを再生成するために複数のドライブ読み取りが必要になる場合があります。これは、一般にRAIDペナルティと呼ばれるプロセスです。</block>
  <block id="3cfcf9a3299db75df9aa0e024ebef965" category="paragraph">ただし、ONTAPではこのようなRAIDペナルティは発生しません。これは、NetApp WAFL（Write Anywhere File Layout）とRAIDレイヤが統合されているためです。書き込み処理はRAMで結合され、パリティ生成を含む完全なRAIDストライプとして準備されます。ONTAPは書き込みを完了するために読み取りを実行する必要がないため、ONTAPとWAFLはRAIDペナルティを回避できます。レイテンシが重要な処理（Redoロギングなど）のパフォーマンスが妨げられることはありません。また、データファイルのランダム書き込みでは、パリティの再生成が必要になるためにRAIDのペナルティが発生することもありません。</block>
  <block id="5ff9a871332f0f82f38d880b68a9874b" category="paragraph">統計的信頼性に関しては、RAID DPでさえRAIDミラーリングよりも優れた保護を提供します。主な問題は、RAIDのリビルド中にドライブに要求が発生することです。ミラーリングされたRAIDセットでは、RAIDセット内のパートナーへのリビルド中にドライブ障害によるデータ損失のリスクが、RAID DPセット内の三重ドライブ障害のリスクよりもはるかに高くなります。</block>
  <block id="12c3fe87fd5a746ce8a7cbe25dc1c25b" category="paragraph">フラッシュドライブが登場する以前は、回転式ドライブのパフォーマンス上の制限を克服するためにストライピングが使用されていました。たとえば、OSが1MBの読み取り操作を実行する必要がある場合、1つのドライブからその1MBのデータを読み取るには、1MBがゆっくり転送されるため、多くのドライブヘッドのシークと読み取りが必要になります。この1MBのデータが8つのLUNにストライピングされている場合、OSは8つの128K読み取り処理を並行して問題できるため、1MB転送の完了に必要な時間が短縮されます。</block>
  <block id="e337352c3d57672fd08af8ba709b544f" category="paragraph">回転式ドライブを使用したストライピングは、I/Oパターンを事前に把握しておく必要があったため、より困難でした。ストライピングが実際のI/Oパターンに合わせて正しく調整されていない場合、ストライピングされた構成ではパフォーマンスが低下する可能性があります。Oracleデータベース、特にオールフラッシュ構成では、ストライピングは設定がはるかに簡単で、パフォーマンスが劇的に向上することが実証されています。</block>
  <block id="7025652291dc6872022b0f79a2b2be21" category="paragraph">デフォルトではOracle ASMなどの論理ボリュームマネージャがストライプされますが、ネイティブOS LVMはストライプされません。その中には、複数のLUNを連結されたデバイスとして結合するものもあります。そのため、データファイルは1つのLUNデバイスにしか存在しません。これにより、ホットスポットが発生します。他のLVM実装では、デフォルトで分散エクステントが使用されます。これはストライピングに似ていますが、粗いです。ボリュームグループ内のLUNはエクステントと呼ばれる大きな部分にスライスされ、通常は数メガバイト単位で測定され、論理ボリュームがそれらのエクステントに分散されます。その結果、ファイルに対するランダムI/OはLUN間で適切に分散されますが、シーケンシャルI/O処理はそれほど効率的ではありません。</block>
  <block id="0c2f3b2ec9d90baa0a0a0b6fb673a113" category="paragraph">高いパフォーマンスを必要とするアプリケーションI/Oは、ほとんどの場合（a）基本ブロックサイズの単位または（b）1メガバイトのいずれかです。</block>
  <block id="804d5b1f06570b4d242be0c2f0c3392c" category="paragraph">ストライピング構成の主な目的は、シングルファイルI/Oを1つのユニットとして実行し、マルチブロックI/O（サイズは1MB）をストライピングされたボリューム内のすべてのLUNで均等に並列化できるようにすることです。つまり、ストライプ・サイズはデータベース・ブロック・サイズより小さくすることはできず、ストライプ・サイズにLUN数を掛けたサイズは1MBにする必要があります。</block>
  <block id="0598f393baefd05d48b48076cc7df606" category="paragraph">次の図に、ストライプサイズと幅の調整に使用できる3つのオプションを示します。LUNの数は、前述のパフォーマンス要件を満たすように選択されますが、いずれの場合も、1つのストライプ内の総データ量は1MBです。</block>
  <block id="9ca503fae9ccd4d6d8e67806b23adfa0" category="paragraph"><block ref="9ca503fae9ccd4d6d8e67806b23adfa0" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0353522b39b87d54d40d3f09ec668851" category="doc">ONTAP構成</block>
  <block id="8e52de0d4b03d5fe87dc88da09616c7f" category="inline-link-macro">こちらをご覧ください。</block>
  <block id="9fe343788d08130f46e418bb81928479" category="summary">FabricPool の概要</block>
  <block id="337c62c6b6eb7319bae58701105e889c" category="doc">階層化</block>
  <block id="cec4b296aaf93974a98a5d3b3f27ff9e" category="paragraph">FabricPoolの階層化がアプリケーションとデータベースに与える影響を理解するには、低レベルのFabricPoolアーキテクチャについて理解しておく必要があります。</block>
  <block id="3493794b3ccb587f71a663f51f4484ef" category="summary">ONTAP上のPostgreSQLデータベース</block>
  <block id="2d3298c651b356a82db5d664ce68e65e" category="doc">標準搭載のデータ保護</block>
  <block id="31c6611c8e0bd237a3ee51db1728a440" category="paragraph">ストレージ設計の主な側面の1つは、PostgreSQLボリュームの保護を有効にすることです。お客様は、ダンプアプローチを使用するか、ファイルシステムバックアップを使用して、PostgreSQLデータベースを保護できます。このセクションでは、個 々 のデータベースまたはクラスタ全体をバックアップするさまざまな方法について説明します。</block>
  <block id="9f3265914462c64fd02bc50ab4c9ebe9" category="paragraph">PostgreSQLデータをバックアップするには、次の3つの方法があります。</block>
  <block id="6b592c7950245a5a9f54d9424e851e97" category="list-text">SQL Serverダンプ</block>
  <block id="c8b1fc69d12d1da6589e384671c8e82c" category="list-text">ファイルシステムレベルのバックアップ</block>
  <block id="3c25062a0babfa1495dd604698707610" category="list-text">継続的アーカイブ</block>
  <block id="58c132e2be12705408a7456c6183b617" category="paragraph">SQL Serverダンプ方式の背後にある考え方は、SQL Serverコマンドを使用してファイルを生成することです。このコマンドをサーバに返すと、ダンプ時と同じようにデータベースを再作成できます。PostgreSQLはユーティリティプログラムを提供します。<block ref="5a5149b2817f30cbb3805307f9cadae4" prefix=" " category="inline-code"></block> および<block ref="0ead269b3d000482b5a44a1ef4e8cd54" prefix=" " category="inline-code"></block> 個 々 のバックアップとクラスタレベルのバックアップの作成に使用します。これらのダンプは論理的であり、WAL再生で使用するのに十分な情報が含まれていません。</block>
  <block id="1d05b80fc6f199681263e063190e8325" category="paragraph">別のバックアップ戦略として、PostgreSQLがデータベースにデータを保存するために使用するファイルを管理者が直接コピーするファイルシステムレベルのバックアップを使用する方法があります。この方法はオフラインモードで実行されます。データベースまたはクラスタをシャットダウンする必要があります。もう1つの選択肢は、<block ref="35679fc424d9eec0c30f38459fd9b322" prefix=" " category="inline-code"></block> PostgreSQLデータベースのホットストリーミングバックアップを実行します。</block>
  <block id="10907e7ac5ab6e5235a23898a2331b31" category="doc">ONTAP上のPostgreSQLデータベース</block>
  <block id="b5f477e959f26421a80e1eebdadbdd71" category="paragraph">PostgreSQLには、PostgreSQL、PostgreSQL Plus、EDB Postgres Advanced Server（EPAS）などのバリアントが付属しています。PostgreSQLは通常、多層アプリケーションのバックエンドデータベースとして導入されます。一般的なミドルウェアパッケージ(PHP、Java、Python、Tcl/Tk、ODBCなど)でサポートされています。 とJDBC）は、オープンソースのデータベース管理システムでは、歴史的に人気のある選択肢でした。NetApp ONTAPは、信頼性、パフォーマンス、効率に優れたデータ管理機能を備えたPostgreSQLデータベースを実行するための優れた選択肢です。</block>
  <block id="841a21e58e7c22a71c07b89a4362d2b6" category="admonition">ONTAPおよびPostgreSQLデータベースに関するこのドキュメントは、以前に公開されていた_TR-4770：『PostgreSQL database on ONTAP best practices』に代わるものです。_</block>
  <block id="23dc28a190980aa339329235e8b66434" category="paragraph">データが指数関数的に増加するにつれて、企業にとってデータ管理はより複雑になります。この複雑さにより、ライセンス、運用、サポート、メンテナンスのコストが増大します。全体的なTCOを削減するには、信頼性とパフォーマンスに優れたバックエンドストレージを使用して、商用データベースからオープンソースデータベースに切り替えることを検討してください。PostgreSQLは、学術、商業、大企業で広く使用されている高度なオープンソースデータベースです。他のリレーショナルデータベース管理システム(RDBMS)のギャップに対処する新しい機能セットが付属しています。</block>
  <block id="595e7195ec732ff0042e8b03492176cc" category="admonition">物理環境または仮想環境でPostgreSQLデータベースを使用しているNetAppのお客様は、ONTAPにPostgreSQLデータベースを適切に導入して管理するためのベストプラクティスを理解することができます。推奨事項は一般的なものであるため、どの構成にも固有のものではありません。ビジネスニーズによっては、一部の提案で変更が必要になる場合があります。使用する環境は、PostgreSQL、ハイパーバイザー、OS、ONTAPストレージに関する公式ドキュメントに照らして評価する必要があります。</block>
  <block id="6c1ea8a6f96c812bdbee4a788f8282dc" category="doc">付録A：ホストの設定</block>
  <block id="c3ef6436e8acdba8ced1def7d29a99b8" category="paragraph">付録の内容：</block>
  <block id="873bf9c2fc74dd3fc39aa67a16b51d6a" category="list-text">ESXホストのFC Host Bus Adapter（HBA；ホストバスアダプタ）が実行されており、ドライバ、ファームウェア、および正しいBIOSバージョンが更新されていることを確認します。</block>
  <block id="b6d348f60c7c0e3bb221591b67518d1c" category="list-text">ホストにNetApp Host Utilitiesをインストールして、特定のLUNの直接パスと間接パスを表示します。キットには、LUN SVM情報に関する詳細情報も含まれています。</block>
  <block id="4a1afd4a3d39c7e385017e01816d721f" category="list-text">ホストでは必ず再スキャンSCSIバススクリプトを使用して、次の処理を実行します。</block>
  <block id="6d1436a6f6bda3b3ce87df91aaf6fb56" category="list-text">新しいLUNの検索</block>
  <block id="897dc659ee2dd9f0dd17af82c47259bd" category="list-text">古いLUNを破棄する</block>
  <block id="ecef9cf88b8cf100d1a489f3acdd4732" category="list-text">LUNへの新しいパスの更新</block>
  <block id="c7b133bd977e02fc973a2df60786e7a8" category="list-text">パス障害が発生した場合にストレージへの複数のルートを確立するには、ホストオペレーティングシステムにマルチパスソフトウェアをインストールして設定します。</block>
  <block id="3617da17b3368e5730bf10cdacf54a18" category="list-text">マルチパスソフトウェアを使用しない場合は、各LUNのパスを1つに制限する必要があります。</block>
  <block id="6dff2f8361cdca0bbb6cfa1d162de499" category="list-text">Linuxカーネルでは、ブロックデバイスへのI/Oのスケジュールを低レベルで制御できます。デフォルトの設定はLinuxのバージョンによって大きく異なる場合があります。一般に、NetAppをご利用のお客様や社内テストでは、データベース向けのNoOpsスケジューラを使用した方が効果的です。ベンチマークを実行して、ユースケースに最適なI/Oスケジューラを特定する必要があります。</block>
  <block id="9147e5e61a7b9260dec09f3a6eb3e5be" category="doc">Snapshot</block>
  <block id="0b9d99167191c5d9ad23ca07bc6a9b38" category="paragraph">PostgreSQLを使用したスナップショットベースのバックアップでは、フルリカバリまたはポイントインタイムリカバリを提供するために、データファイル、WALファイル、およびアーカイブされたWALファイルのスナップショットを構成する必要があります。</block>
  <block id="8c6a53edc4449a4cc3983d47ecffa851" category="paragraph">PostgreSQLデータベースの場合、Snapshotを使用した平均バックアップ時間は数秒~数分です。このバックアップ速度は、<block ref="35679fc424d9eec0c30f38459fd9b322" prefix=" " category="inline-code"></block> その他のファイル・システム・ベースのバックアップ・アプローチ</block>
  <block id="c798632224ae09152f66f60e0edc757e" category="paragraph">NetAppストレージ上のSnapshotは、crash-consistentとアプリケーション整合性の両方が可能です。crash-consistent Snapshotはデータベースを休止せずにストレージ上に作成されますが、アプリケーション整合性Snapshotはデータベースがバックアップモードの間に作成されます。NetAppでは、後続のスナップショットが永久増分バックアップとなるため、ストレージの節約とネットワークの効率化が促進されます。</block>
  <block id="d0e369216eeac8de66e915909364970a" category="paragraph">スナップショットは高速で、システムのパフォーマンスに影響を与えないため、他のストリーミングバックアップテクノロジのように1日1回のバックアップを作成するのではなく、1日に複数のスナップショットをスケジュールできます。リストアとリカバリの処理が必要な場合は、次の2つの主な機能によってシステムのダウンタイムが短縮されます。</block>
  <block id="316eb8adba4d16a34c92eaf9db381b9e" category="list-text">NetApp SnapRestoreのデータリカバリテクノロジにより、リストア処理が数秒で実行されます。</block>
  <block id="c128c475c12703e37685edd6db8144bc" category="list-text">Recovery Point Objective（RPO；目標復旧時点）が頻繁に発生するため、適用するデータベースログの数が減り、フォワードリカバリも高速化されます。</block>
  <block id="9b9f26085ff7149d4dbb916b1db0f121" category="paragraph">PostgreSQLをバックアップするには、データボリュームが（コンシステンシグループ）WALとアーカイブログと同時に保護されていることを確認する必要があります。Snapshotテクノロジを使用してWALファイルをコピーする場合は、次のコマンドを実行してください：<block ref="a3b8c8ee15ba60bfb2b999195d2b4e7d" prefix=" " category="inline-code"></block> アーカイブする必要があるすべてのWALエントリをフラッシュします。リストア中にWALエントリをフラッシュする場合は、データベースを停止するか、既存のデータディレクトリをアンマウントまたは削除し、ストレージでSnapRestore操作を実行するだけで済みます。リストアが完了したら、システムをマウントして現在の状態に戻すことができます。ポイントインタイムリカバリの場合は、WALとアーカイブログをリストアすることもできます。次に、PostgreSQLは最も整合性のあるポイントを決定し、自動的にリカバリします。</block>
  <block id="8e8d6187572eace409fee5bf2dbb7cf9" category="paragraph">整合グループはONTAPの機能であり、1つのインスタンスまたは複数の表領域を含むデータベースに複数のボリュームがマウントされている場合に推奨されます。整合性グループSnapshotを使用すると、すべてのボリュームがグループ化されて保護されます。整合グループはONTAP System Managerから効率的に管理できます。また、整合グループをクローニングして、テストや開発用にデータベースのインスタンスコピーを作成することもできます。</block>
  <block id="55ca4b30c6f7c3ef975a6d1e1fb222a2" category="inline-link-macro">NetApp整合性グループの概要</block>
  <block id="69dd5879aee425e37fdd5796a8e06a56" category="paragraph">コンシステンシグループの詳細については、を参照してください。 <block ref="112c5744a39904facdbc5fab385d9fe1" category="inline-link-macro-rx"></block>。</block>
  <block id="7e7397a7b79323762c61941fc0e6b5f9" category="doc">データ保護</block>
  <block id="04e7487d479314b6bdfdca58a245d899" category="paragraph">インデックス保護</block>
  <block id="90b0d8da95f7f5935481bc7e648c111e" category="summary">PostgreSQLテーブルスペース</block>
  <block id="16a49d0bc0249ef3dd42949589a0ed4e" category="doc">表領域</block>
  <block id="d6d544de56c329d9f68bb176c6245e7c" category="paragraph">データベース・クラスタが初期化されると、2つの表領域が自動的に作成されます。</block>
  <block id="6df924905e21856e4e8b8f936767cdd6" category="paragraph">。<block ref="bd676cbef0d168a62a062c8709af1824" prefix=" " category="inline-code"></block> 表領域は共有システムカタログに使用されます。。<block ref="3224684b8e7208962a73daeb0bb24110" prefix=" " category="inline-code"></block> tablespaceは、template1およびtemplate0データベースのデフォルトのテーブルスペースです。クラスタが初期化されたパーティションまたはボリュームの容量が不足し、拡張できない場合は、別のパーティションに表領域を作成して、システムを再構成できるようになるまで使用できます。</block>
  <block id="364c9d7b9593277eee9477befaf9f66b" category="paragraph">頻繁に使用されるインデックスは、ソリッドステートデバイスのような高速で可用性の高いディスクに配置できます。また、ほとんど使用されない、またはパフォーマンスが重要でないアーカイブデータを格納するテーブルは、SASドライブやSATAドライブなどの低コストで低速なディスクシステムに格納できます。</block>
  <block id="9bfe8d8e1117bd1d4b8597220e3f166e" category="paragraph">表領域はデータベースクラスタの一部であり、データファイルの自律的なコレクションとして扱うことはできません。これらは、メインデータディレクトリに含まれるメタデータに依存するため、別のデータベースクラスタに接続したり、個別にバックアップしたりすることはできません。同様に、（ファイル削除やディスク障害などによって）テーブルスペースが失われると、データベースクラスタが読み取り不能になったり、起動できなくなったりすることがあります。RAMディスクのような一時ファイルシステムに表領域を配置すると、クラスタ全体の信頼性が低下します。</block>
  <block id="7d9573b1ed3543ec6ea42c81830dc27c" category="paragraph">作成後、要求元ユーザに十分な権限があれば、任意のデータベースから表領域を使用できます。PostgreSQLは、テーブルスペースの実装を簡素化するためにシンボリックリンクを使用します。PostgreSQLは、<block ref="4a926dc6e7549c49a13755513af41e67" prefix=" " category="inline-code"></block> Table（クラスタ全体のテーブル）を作成し、その行に新しいオブジェクト識別子（OID）を割り当てます。最後に、サーバはOIDを使用して、クラスタと指定されたディレクトリの間にシンボリックリンクを作成します。ディレクトリ<block ref="8e3da386e945c59fb1e1cd1d7a47697c" prefix=" " category="inline-code"></block> クラスタで定義されている組み込み以外の各表領域を参照するシンボリックリンクが含まれます。</block>
  <block id="249fd7d68098688fab42436eed51be7d" category="doc">データベース設定</block>
  <block id="8daf26b2c72dd18a89fa89a6b1aa988d" category="paragraph">パフォーマンスを向上させるPostgreSQLのチューニング設定がいくつかあります。</block>
  <block id="abb3dae412afe5c801e9ab90de71675b" category="paragraph">最も一般的に使用されるパラメータは次のとおりです。</block>
  <block id="bfdf741f4acb3dfee6e87075b535610e" category="list-text"><block ref="39d79378db03fed7c5ba62efba38e327" prefix="" category="inline-code"></block>:一度に持つデータベース接続の最大数。このパラメータを使用して、ディスクへのスワップを制限し、パフォーマンスを強制終了します。アプリケーションの要件に応じて、このパラメータを接続プールの設定に合わせて調整することもできます。</block>
  <block id="9625e1a6f5d1f695fd1c72401afaa07e" category="list-text"><block ref="904d399f43708a8a5b6d10c1ee3f8356" prefix="" category="inline-code"></block>：データベース・サーバのパフォーマンスを向上させる最も簡単な方法最新のほとんどのハードウェアでは、デフォルトはlowです。導入時に、システム上の使用可能なRAMの約25%に設定されます。このパラメータ設定は、特定のデータベースインスタンスでの動作によって異なります。試行錯誤して値を増減しなければならない場合があります。ただし、この値をHighに設定すると、パフォーマンスが低下する可能性があります。</block>
  <block id="d1960c56572383fc401fec3f0b767cf9" category="list-text"><block ref="5edeed59821790d8bec6d32da26bca4c" prefix="" category="inline-code"></block>:この値は、PostgreSQLのオプティマイザに、PostgreSQLがデータをキャッシュするために使用できるメモリ量を伝え、インデックスを使用するかどうかを判断するのに役立ちます。値を大きくすると、インデックスを使用する可能性が高くなります。このパラメータは、に割り当てられているメモリの量に設定する必要があります。<block ref="e15ed0f69e5c2475450b97691d6a2cee" prefix=" " category="inline-code"></block> さらに、使用可能なOSキャッシュの容量も表示されます。多くの場合、この値はシステムメモリ全体の50%を超えています。</block>
  <block id="508df54f84fc7abb00f3a92937ca3506" category="list-text"><block ref="1edef4d43b06d4deb28010505df5724d" prefix="" category="inline-code"></block>:このパラメータは、ソート操作およびハッシュテーブルで使用するメモリの量を制御します。アプリケーションで大量のソートを行う場合は、メモリの量を増やす必要があるかもしれませんが、注意が必要です。これはシステム全体のパラメータではなく、操作ごとのパラメータです。複雑なクエリに複数のソート操作が含まれている場合、複数のwork_mem単位のメモリを使用し、複数のバックエンドが同時にこれを実行する可能性があります。このクエリを実行すると'値が大きすぎると'データベース・サーバがスワップされることがよくありますこのオプションは、以前のバージョンのPostgreSQLではsort_memと呼ばれていました。</block>
  <block id="59d9770060aecba84c7e8ed849b5653d" category="list-text"><block ref="65768448b4f275b95af20a317c7355a9" prefix="" category="inline-code"></block>:このパラメータは、トランザクションがコミットされる前にfsync()を使用して、すべてのWALページをディスクに同期するかどうかを決定します。電源をオフにすると、書き込みパフォーマンスが向上し、オンにすると、システムクラッシュ時の破損のリスクからの保護が強化されます。</block>
  <block id="625a65dd6cef83bac66319bde3894899" category="list-text"><block ref="ff5a06a39dd6824f30a778a51cf7ea69" prefix="" category="inline-code"></block>:チェックポイント・プロセスは'コミットされたデータをディスクにフラッシュしますこれには、ディスク上で多くの読み取り/書き込み処理が含まれます。値は秒単位で設定され、値を小さくするとクラッシュリカバリ時間が短縮されます。値を大きくすると、チェックポイントコールが削減されるため、システムリソースの負荷が軽減されます。アプリケーションの重要度、使用状況、データベースの可用性に応じて、checkpoint_timeoutの値を設定します。</block>
  <block id="309b1036c45e7ad490448925dc4f9597" category="list-text"><block ref="6a5c0586429891e84e05d6ab15088405" prefix="" category="inline-code"></block> および<block ref="9080796d32078fea7d191100eab64f92" prefix=" " category="inline-code"></block>:これらのオプションを組み合わせて使用すると、一度にコミットする複数のトランザクションを書き出すことで、パフォーマンスを向上させることができます。トランザクションがコミットされた瞬間に複数のcommit_siblingsオブジェクトがアクティブになっている場合、サーバはcommit_delayマイクロ秒を待って、一度に複数のトランザクションをコミットしようとします。</block>
  <block id="8d5137ce002c6328c2b5f4f328662e1d" category="list-text"><block ref="fa4ca2cd95c20a44171f964fb8f5fdb9" prefix="" category="inline-code"></block>:プロセスに最適なワーカー数を設定します。max_parallel_workersは、使用可能なCPUの数に対応します。アプリケーションの設計によっては、クエリで並列処理に必要なワーカーの数が少なくて済みます。両方のパラメータの値は同じにし、テスト後に値を調整することをお勧めします。</block>
  <block id="c8736e7ca19e9096796c624f3030dae5" category="list-text"><block ref="8dda85a5feb6de66d8f5f9a4cbdb0754" prefix="" category="inline-code"></block>:この値は、PostgreSQLが非シーケンシャルディスク読み取りを表示する方法を制御します。値を大きくすると、PostgreSQLはインデックススキャンではなくシーケンシャルスキャンを使用する可能性が高くなります。これは、サーバーに高速ディスクがあることを示します。計画ベースの最適化、真空化、クエリやスキーマの変更に対するインデックス付けなど、他のオプションを評価した後で、この設定を変更してください。</block>
  <block id="17edf3863f12b7d9480b3336a9fca773" category="list-text"><block ref="709989c844c22473cb8406550423d39a" prefix="" category="inline-code"></block>:このパラメータは、PostgreSQLが同時に実行を試みる同時ディスクI/O処理の数を設定します。この値を大きくすると、個 々 のPostgreSQLセッションが並行して開始しようとするI/O処理の数が増加します。指定できる範囲は1～1、000です。非同期I/O要求の発行を無効にする場合は0にします。現在、この設定はビットマップヒープスキャンにのみ影響します。ソリッドステートドライブ（SSD）やその他のメモリベースストレージ（NVMe）は、多数の同時要求を処理できることが多いため、数百の数を推奨します。</block>
  <block id="82b38edb10ad73f9645c5d65e73a659b" category="paragraph">PostgreSQL設定パラメータの完全なリストについては、PostgreSQLのドキュメントを参照してください。</block>
  <block id="402fbc243dbef50cd5c8e57ccbdd92f5" category="section-title">トースト</block>
  <block id="0d2b62abb26bd0b4109f5bc967250933" category="paragraph">TOASTは、特大属性ストレージテクニックを表しています。PostgreSQLは固定のページサイズ（通常は8KB）を使用しており、タプルを複数のページにまたがることはできません。したがって、大きなフィールド値を直接保存することはできません。このサイズを超える行を格納しようとすると、トーストは大きな列のデータを小さな「ピース」に分割してトーストテーブルに格納します。</block>
  <block id="3f11f21bdc22c3c955c3f0fca39e9bc0" category="paragraph">トーストされた属性の大きな値は'結果セットがクライアントに送信されるときにのみ(選択されている場合)プルアウトされますテーブル自体は非常に小さく、アウトオブラインストレージ（TOAST）を使用しない場合よりも多くの行を共有バッファキャッシュに格納できます。</block>
  <block id="9a311ef6dad816cb7a15c0ab41920ad8" category="section-title">バキューム</block>
  <block id="385e23b8ebe64dfd0005f6846cc8e85e" category="paragraph">通常のPostgreSQL操作では、更新によって削除または廃止されたタプルはテーブルから物理的に削除されず、VACUUMが実行されるまで存在したままになります。したがって、特に頻繁に更新されるテーブルでは、VACUMを定期的に実行する必要があります。ディスクスペースが使用されているスペースは、ディスクスペースが停止しないように、新しい行で再利用できるように再利用する必要があります。ただし、スペースはオペレーティングシステムに返されません。</block>
  <block id="db81319c35b48ed94867775a9a1ce1d7" category="paragraph">ページ内の空き領域は断片化されません。VACUUMはブロック全体を書き換え、残りの行を効率的にパッキングし、1つの連続した空き領域ブロックをページに残します。</block>
  <block id="8a5c17164c9920590fc057ee01f2fcb3" category="paragraph">一方、VACUUM FULLは、デッドスペースのないまったく新しいバージョンのテーブルファイルを作成することで、テーブルを積極的に圧縮します。この操作により、テーブルのサイズは最小限に抑えられますが、時間がかかることがあります。また、処理が完了するまで、テーブルの新しいコピー用に追加のディスクスペースが必要になります。ルーチンバキュームの目的は、バキュームフルアクティビティを回避することです。このプロセスでは、テーブルが最小サイズに維持されるだけでなく、ディスクスペースの安定した使用量も維持されます。</block>
  <block id="d3213224909897cac25fe1359e587293" category="summary">PostgreSQLの初期化</block>
  <block id="61bcd96a2c1f8026527cbf2019d6e9a4" category="doc">初期化</block>
  <block id="f4f9dac58f7c47e819293af5f2dd1177" category="paragraph">新しいデータベースクラスタを作成するには、<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> プログラム。A<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> スクリプトは、クラスタを定義するデータファイル、システムテーブル、およびテンプレートデータベース（template0およびtemplate1）を作成します。</block>
  <block id="b668460552732302350bbb840d57931c" category="paragraph">テンプレートデータベースはストックデータベースを表します。システムテーブル、標準ビュー、関数、およびデータ型の定義が含まれています。<block ref="3865cf98fe802a965570b4a10a1d894b" prefix=" " category="inline-code"></block> の引数として機能します。<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> データベースクラスタの場所を指定するスクリプト。</block>
  <block id="8fcd14822a5b94d212898fe3e006526e" category="paragraph">PostgreSQLのすべてのデータベースオブジェクトは、それぞれのOIDによって内部的に管理されます。テーブルとインデックスは、個 々 のOIDによっても管理されます。データベースオブジェクトとそれぞれのOIDとの関係は、オブジェクトのタイプに応じて適切なシステムカタログテーブルに格納されます。たとえば、データベースとヒープテーブルのOIDは、<block ref="d0fcebb608269edbd5d67486884ebed7" prefix=" " category="inline-code"></block> それぞれ`pg_classと`pg_classです。OIDを確認するには、PostgreSQLクライアントでクエリを発行します。</block>
  <block id="d0e97e34fe92edd2facd0f7377b6340b" category="paragraph">各データベースには、1GBに制限された個別のテーブルとインデックスファイルがあります。各テーブルには、それぞれサフィックス付きの2つのファイルが関連付けられています。<block ref="7b9b00c45b01f7b7c6d3a3c8ba2e9275" prefix=" " category="inline-code"></block> および<block ref="a1d869a79e2f43693a6a416fcbdc2724" prefix=" " category="inline-code"></block>。これらは、フリースペースマップおよび可視性マップと呼ばれます。これらのファイルには空きスペース容量に関する情報が格納され、テーブルファイルの各ページに表示されます。インデックスには個 々 の空き領域マップのみがあり、可視性マップはありません。</block>
  <block id="048a7ed79caf84bb5c725efc5f474911" category="paragraph">。<block ref="c28f4f32219f5ff99fb4b116980b8549" prefix=" " category="inline-code"></block> ディレクトリには、先行書き込みログが格納されます。先行書き込みログは、データベースの信頼性とパフォーマンスを向上させるために使用されます。テーブル内の行を更新するたびに、PostgreSQLは先読みログに変更内容を書き込み、その後実際のデータページに変更内容をディスクに書き込みます。。<block ref="f7223cfaa9416056a91e259e326ac5cf" prefix=" " category="inline-code"></block> ディレクトリには通常複数のファイルが含まれていますが、initdbは最初のファイルだけを作成します。必要に応じて追加のファイルが追加されます。各xlogファイルの長さは16MBです。</block>
  <block id="2bd2440a8b5fed6660918b5f10f685bb" category="doc">ファイルシステム</block>
  <block id="81d00501c34ba5f161f685a99dce0d13" category="paragraph">PostgreSQLは、NFSまたはSANのファイルシステムでホストできます。</block>
  <block id="789a6c7dd865d16eb1df122bcc5c9a3a" category="admonition">* NetAppでは* NFSv4の機能が必要な場合はNFSv4.1を使用することを推奨します。NFSv4.1では、一部のエッジにおける耐障害性を向上させるために、NFSv4プロトコルの機能がいくつか強化されています。</block>
  <block id="36772d6dfc6e102eff552ffad6b98690" category="paragraph">NFSファイルシステムのマウントには、次のマウントオプションを使用します。</block>
  <block id="8e86e0aee135afb67c6a1d3d6e0f3306" category="inline-link-macro">NFSテンソウサイス</block>
  <block id="d84b41126744795c4ee82f7b256e7234" category="inline-link-macro">FC SAN</block>
  <block id="2c8c2171fc87c96e58fb40d8714f85cf" category="doc">PostgreSQLアーキテクチャ</block>
  <block id="ee62b4420d426c21a46d892ac084872a" category="paragraph">PostgreSQLは、クライアントとサーバのアーキテクチャに基づいたRDBMSです。PostgreSQLインスタンスはデータベースクラスタと呼ばれ、サーバの集合ではなくデータベースの集合です。</block>
  <block id="89c30c326e106773af32af40255b92a8" category="inline-image-macro">エラー：グラフィックが見つかりません</block>
  <block id="54c2dd41fd1ad3efa25e80bee0bae549" category="paragraph">PostgreSQLデータベースには、postmaster、フロントエンド(クライアント)、バックエンドの3つの要素があります。クライアントは、IPプロトコルや接続先データベースなどの情報を含む要求をポストマスターに送信します。postmasterは接続を認証し、さらに通信するためにバックエンドプロセスに渡します。バックエンドプロセスはクエリを実行し、結果を直接フロントエンド（クライアント）に送信します。</block>
  <block id="9f96e07bbaf7c0237047d6d0f95301a8" category="paragraph">PostgreSQLインスタンスは、マルチスレッドモデルではなく、マルチプロセスモデルに基づいています。ジョブごとに複数のプロセスが生成され、各プロセスには独自の機能があります。主なプロセスには、クライアントプロセス、WALライタプロセス、バックグラウンドライタプロセス、およびcheckpointerプロセスが含まれます。</block>
  <block id="6aebf901bd4be26a765c56e4133b3798" category="list-text">クライアント（フォアグラウンド）プロセスがPostgreSQLインスタンスに読み取りまたは書き込み要求を送信しても、データを直接ディスクに読み書きすることはありません。最初に、共有バッファとWAL(Write-Ahead Logging)バッファにデータをバッファします。</block>
  <block id="458239ee6c634dc5fef96f9dfab275f0" category="list-text">WALライタプロセスは、共有バッファとWALバッファの内容を操作してWALログに書き込みます。WALログは通常PostgreSQLのトランザクションログであり、シーケンシャルに書き込まれます。したがって、データベースからの応答時間を短縮するために、PostgreSQLはまずトランザクションログに書き込み、クライアントに確認応答します。</block>
  <block id="9ec2999256fe568cd596b42e7da2cc39" category="list-text">データベースを整合性のある状態にするために、バックグラウンドライタープロセスは共有バッファにダーティページがないか定期的にチェックします。次に、NetAppボリュームまたはLUNに格納されているデータファイルにデータをフラッシュします。</block>
  <block id="5c852dd8ba7215c01dfde8e98f6c46c6" category="list-text">checkpointerプロセスも定期的に（バックグラウンドプロセスよりも少ない頻度で）実行され、バッファへの変更を防ぎます。WALライタプロセスに、NetAppディスクに保存されているWALログの末尾にチェックポイントレコードを書き込み、フラッシュするように指示します。また、すべてのダーティページをディスクに書き込み、フラッシュするようにバックグラウンドライタープロセスに通知します。</block>
  <block id="0a7b1215fd0b9621d4d7300f88b2906c" category="doc">データ保護ソフトウェア</block>
  <block id="e265011e47d11db43ee112fd2fdc9d5b" category="paragraph">PostgreSQLデータベース用のNetApp SnapCenterプラグインをSnapshotおよびNetApp FlexCloneテクノロジと組み合わせると、次のようなメリットがあります。</block>
  <block id="4dcdaba06a92b8fecfdc823643a71723" category="list-text">高速なバックアップとリストア：</block>
  <block id="aee746a577a1baebdc33197fb5f3a279" category="list-text">スペース効率に優れたクローン：</block>
  <block id="b96bb0cd2ebc0389b6670602ac80d983" category="list-text">迅速で効果的なディザスタリカバリシステムを構築する能力。</block>
  <block id="9e060ad00fced94f2616dd71fbc49f76" category="paragraph">次のような状況では、Veeam SoftwareやCommvaultなど、ネットアップのプレミアムバックアップパートナーを選択することもできます。</block>
  <block id="0ee17b3b55ea2b0af3d90985bc347775" category="list-text">異機種混在環境全体でのワークロードの管理</block>
  <block id="88fbde7bbe0274fbe9e7ce01c563d03c" category="list-text">バックアップをクラウドまたはテープに保存して長期保持</block>
  <block id="445e3e0cce7f959696dde65b3be27843" category="list-text">さまざまなバージョンと種類のOSをサポート</block>
  <block id="21c5d67cc22beaf7d7c9c84c8deaabbe" category="paragraph">PostgreSQL用のSnapCenterプラグインはコミュニティでサポートされているプラグインであり、セットアップとドキュメントはNetAppオートメーションストアで入手できます。SnapCenterを使用すると、データベースのバックアップ、データのクローニング、リストアをリモートで実行できます。</block>
  <block id="7d334ca369e4a752ec91b1503183f0ed" category="summary">SAP HANAおよびAnyDB向けソリューション</block>
  <block id="1ac73696f4529e3901b0d4e5430365cb" category="doc">SAP HANAとSAP with ANYDB</block>
  <block id="2c1b27a986b5e37a810d61f72b23ee4b" category="paragraph">SAPソリューションの構成、管理、自動化に関するベストプラクティスについては、NetAppのSAPソリューションページを参照してください。</block>
  <block id="6c92285fa6d3e827b198d120ea3ac674" category="inline-link-macro">こちらをご覧ください</block>
  <block id="ee1e67308b27672a8f54eace4c615a98" category="paragraph">クリックしてください <block ref="c95e4a3e1de9e00fefc4bf8a7ce42893" category="inline-link-macro-rx"></block> もっと。</block>
  <block id="beb3ca55ed0a53a38a2b97540b05d6e4" category="summary">ONTAP上のMicrosoft SQL Server</block>
  <block id="7636ae91f443b605f05bed59d7d57a02" category="doc">Microsoft SQL Serverのディザスタリカバリ</block>
  <block id="810304d54e0a61663cfc457b0894037b" category="paragraph">NetAppは、ハードウェア、ソフトウェア、またはサイトに障害が発生した場合にデータの可用性を高めるためのさまざまなアプローチを提供します。</block>
  <block id="9c1e9d82d3220658621f72dca978adb0" category="section-title">NetApp SnapMirror</block>
  <block id="46983273062fdc8ce8561a9ce89cdc5b" category="paragraph">NetApp SnapMirrorテクノロジは、LANおよびWAN経由でデータをミラーリングまたはレプリケートするための、高速で柔軟なエンタープライズ解決策を提供します。SnapMirrorテクノロジでは、初回のベース転送後に変更された4KBのデータブロックのみがデスティネーションに転送されるため、必要なネットワーク帯域幅が大幅に削減されます。SnapMirrorは、設定されたレプリケーション更新間隔に基づいて、ボリュームレベルの非同期レプリケーションを提供します。
SnapMirror for SQL Serverの推奨事項は次のとおりです。</block>
  <block id="5f3bfe8f92842bdc2f9455d4102f2531" category="list-text">CIFSを使用する場合は、デスティネーションSVMがソースSVMと同じActive Directoryドメインのメンバーである必要があります。これにより、NASファイルに格納されているアクセス制御リスト（ACL）が災害からのリカバリ時に破損しないようになります。</block>
  <block id="e0fd410ebdc68e7ca628bbca66b63ff4" category="list-text">ソースボリューム名と同じデスティネーションボリューム名を使用する必要はありませんが、デスティネーションボリュームをデスティネーションにマウントするプロセスを管理しやすくすることができます。CIFSを使用する場合は、デスティネーションNASネームスペースをソースネームスペースとパスおよびディレクトリ構造で同一にする必要があります。</block>
  <block id="14b01fb6bdbebef1f8a00c7f84926307" category="list-text">整合性を確保するために、コントローラからのSnapMirror更新のスケジュールを設定しないでください。ただし、フルバックアップまたはログバックアップの完了後にSnapCenterからのSnapMirror更新を有効にしてSnapMirrorを更新してください。</block>
  <block id="18c6a681ea46e1ed394e092461bb53ef" category="list-text">SQL Serverデータを含むボリュームをクラスタ内の複数のノードに分散して、すべてのクラスタノードでSnapMirrorレプリケーションアクティビティを共有できるようにします。この分散により、ノードリソースの使用が最適化されます。</block>
  <block id="0a01e6837f5c691536f0b6cbdd0232ec" category="inline-link-macro">TR-4015：『SnapMirrorの設定およびベストプラクティスガイド- ONTAP 9』</block>
  <block id="1cca1a3fad8c6dd7e2dadbd2aa08bf07" category="paragraph">SnapMirrorの詳細については、を参照してください。 <block ref="64b916f792bad525a069a243c092b62e" category="inline-link-macro-rx"></block>。</block>
  <block id="3d4b417d78ff0ef4c84f0c043de24b10" category="doc">データベースノセキュリティ</block>
  <block id="555119357ec4acedae2d155a0c65df5a" category="paragraph">データベースのセキュリティ保護は常に優先され、DBAと組織はセキュリティ強化チェックポイントを実施して、ユーザにサーバとデータベースへのアクセスを許可するだけです。サーバへの定期的なパッチ適用、ファイアウォールの設定、一般的なゲストまたはパブリックアクセスの削除、アプリケーションの実行やアドホックレポートクエリーの実行を制限されたユーザに最小限の権限を付与することは、ビジネスエコシステムのセキュリティ保護の一部です。</block>
  <block id="3f0ff45bcce968caef3a216a79681533" category="paragraph">ランサムウェアや内部の脅威が増加するにつれて、ビジネスデータとバックアップを保護し、悪意のある攻撃から一貫した順序で迅速にリカバリできるようにする必要があります。攻撃者はまだデータをハイジャックする方法を見つける可能性があります。
ONTAPは、NASおよびSAN上のデータを保護するためのさまざまな機能を提供します。</block>
  <block id="8b64c006213e96766bdb598b57396083" category="paragraph">ONTAPを使用すると、ソースとしてのFlexVolとデスティネーションとしてのSnapLockとの間にSnapMirror関係を作成することで、フレキシブルボリュームをSnapLock EnterpriseまたはSnapLock Complianceボリュームにバックアップできます。セカンダリストレージにバックアップされたSnapshotコピーは、SnapLockテクノロジを使用して保持期限まで変更や削除から保護されます。 関係に関連付けられているSnapMirrorポリシーで、デスティネーションSnapLockボリュームで保持される特定のSnapMirrorラベルに対してSnapshotコピーの数が定義されています。LUNデータを含むSnapshotをリストアするには、SnapMirrorリストア処理を使用してSnapLock以外のボリュームに対して実行できます。ONTAP 9.13.1では、SnapLockタイプをnon-snaplockに指定することでFlexCloneコピーを作成できます。SnapLock の詳細については、を参照してください <block ref="ef172f6fa5e7e0d1ce81bd97ee5f82e3" category="inline-link-macro-rx"></block>。</block>
  <block id="0b6dbdd1b25ffa8aa9efcccb98bb3fbe" category="paragraph">改ざん防止SnapshotコピーまたはSnapshotコピーロック：Snapshotコピーを使用すると、データベースをすばやく保護およびリストアできます。攻撃者は、データが破損した場合にデータベースをリストアする最後のオプションであった可能性のあるSnapshotコピーを削除する可能性があります。改ざん防止Snapshotコピーを有効にすると、プライマリまたはセカンダリのONTAPシステムでSnapshotコピーがロックされ、不正な管理者や信頼されていない管理者が指定した期間Snapshotを削除できなくなります。改ざん防止Snapshotコピー機能はONTAP 9.12.1から使用できます。SnapLockライセンスとコンプライアンスクロックの初期化が必要です。</block>
  <block id="310ba850db6109a11c606bdc5224be97" category="paragraph">ONTAPにはMulti-Admin Verification（MAV；マルチ管理者検証）機能があります。つまり、Snapshotコピーの削除やボリュームの変更を実行できる完全な権限を持つ管理者は1人もいません。これにより、信頼されていない管理者がボリュームやSnapshotコピーを再度改ざんしないように、セキュリティを強化できます。</block>
  <block id="77641f4a3e4406855e878235cbd89b87" category="doc">CPU構成</block>
  <block id="a51adad5719779145ac252822e328611" category="section-title">ハイパースレッディング</block>
  <block id="fe520b79816bad6a21fbebcb205c7ca9" category="paragraph">ハイパースレッディングはインテル独自の同時マルチスレッド(SMT)実装であり、x86マイクロプロセッサ上で実行される計算（マルチタスク）の並列化を改善します。</block>
  <block id="005f484c2235e04f39d2e69256147281" category="paragraph">ハイパースレッディングを使用するハードウェアでは、論理ハイパースレッディングCPUを物理CPUとしてオペレーティングシステムに認識させることができます。SQL Serverは、オペレーティングシステムが提供する物理CPUを認識し、ハイパースレッドプロセッサを使用できるようにします。</block>
  <block id="673c216e20d1cf8827f347c01dace664" category="paragraph">ここで注意すべき点は、SQL Serverの各バージョンには、使用できるコンピューティング能力に独自の制限があることです。詳細については、「SQL Serverのエディション別のコンピューティング容量制限」を参照してください。</block>
  <block id="932a9271c08db114962ce3791480f371" category="paragraph">SQL Serverのライセンスを取得する際には、主に2つの考え方があります。1つ目はサーバ+クライアントアクセスライセンス（CAL）モデルと呼ばれ、2つ目はプロセッサごとのコアモデルです。SQL Serverで利用可能なすべての製品機能には、サーバ+ CAL戦略でアクセスできますが、ソケットあたりのCPUコア数はハードウェアで20に制限されています。ソケットあたり20個以上のCPUコアを搭載したサーバ用のSQL Server Enterprise Edition+CALがある場合でも、アプリケーションはそのインスタンスですべてのコアを一度に使用することはできません。この図は、起動後のSQL Serverログメッセージを示しており、コア制限の適用を示しています。</block>
  <block id="d06fce44fdcf20791141e7585205a477" category="section-title">ログエントリは、SQL Serverの起動後に使用されているコアの数を示します。</block>
  <block id="cf0e2551e639758cc3c4d82df655eccd" category="inline-link-macro">SQL Server 2022：最新データプラットフォームを実現</block>
  <block id="809c9e1f6ce0bc82bf42fae361c6f43e" category="paragraph">したがって、すべてのCPUを使用するには、プロセッサ単位のコアライセンスを使用する必要があります。SQL Serverのライセンスの詳細については、を参照してください。 <block ref="457abfaf1083b1cbfc49f2783069c6cd" category="inline-link-macro-rx"></block>。</block>
  <block id="cb8d56a3511d402b7355db8502a54c5a" category="section-title">CPUアフィニティ</block>
  <block id="884be48d06a17be095fb51de089dfc89" category="paragraph">パフォーマンスの問題が発生しない限り、プロセッサアフィニティのデフォルトを変更する必要はありませんが、その内容と動作を理解する価値はあります。</block>
  <block id="74f896768ee487acfd4c42370c202bed" category="paragraph">SQL Serverは、次の2つのオプションでプロセッサアフィニティをサポートします。</block>
  <block id="cb315fb2b62c836ba51357d46f2e8c3f" category="list-text">CPUアフィニティマスク</block>
  <block id="cb00a2408ea648cf85edfd7dbb23fbe0" category="list-text">アフィニティI/Oマスク</block>
  <block id="14ad08466dec6635067b988a82e91a8e" category="paragraph">SQL Serverは、オペレーティングシステムで使用可能なすべてのCPUを使用します（プロセッサ単位のコアライセンスが選択されている場合）。すべてのCPUにスケジューラを作成し、特定のワークロードでリソースを最大限に活用します。マルチタスクを実行する場合、オペレーティングシステムやサーバー上のその他のアプリケーションは、プロセススレッドをプロセッサ間で切り替えることができます。SQL Serverはリソースを大量に消費するアプリケーションであるため、この状況が発生するとパフォーマンスに影響する可能性があります。この影響を最小限に抑えるには、SQL Serverのすべての負荷が事前に選択されたプロセッサグループに送られるようにプロセッサを設定します。これは、CPUアフィニティマスクを使用することによって実現されます。</block>
  <block id="28a51b601de21080b76fe2d8b2ec8101" category="paragraph">アフィニティI/Oマスクオプションは、SQL ServerディスクI/OをCPUのサブセットにバインドします。SQL Server OLTP環境では、この拡張により、I/O処理を実行するSQL Serverスレッドのパフォーマンスが向上します。</block>
  <block id="49e103832576f4486179df8868372d17" category="section-title">並列処理の最大次数(MAXDOP)</block>
  <block id="f7e9f8e341a301aec4560db108b93020" category="paragraph">デフォルトでは、SQL Serverはクエリの実行中に使用可能なすべてのCPUを使用します（プロセッサ単位のコアライセンスが選択されている場合）。</block>
  <block id="9bdcdbe52ea41cf96b314b7b7671bd2a" category="paragraph">これは大規模なクエリには適していますが、原因のパフォーマンスが低下し、同時実行数が制限される可能性があります。1つのCPUソケット内の物理コアの数に並列処理を制限する方法が適しています。たとえば、ソケットあたり12コアの2つの物理CPUソケットを持つサーバでは、ハイパースレッディングに関係なく、MAXDOPを12に設定する必要があります。MAXDOPでは、使用するCPUを制限したり、指定したりすることはできません。代わりに、単一のバッチクエリで使用できるCPUの数を制限します。</block>
  <block id="1a6b79859b80796a108bd348f98856f6" category="admonition">* NetAppでは、データウェアハウスなどのDSSの場合、この設定を50程度にしてから、必要に応じて調整することをお勧めします。アプリケーション内の重要なクエリを測定し、必要に応じて調整してください。</block>
  <block id="a99f7ebb3b0f5b0ecea93ed586b2a17d" category="section-title">ワーカースレッドの最大数</block>
  <block id="aff27140f50a549b1331add8d5025f7e" category="paragraph">最大ワーカースレッド数オプションは、多数のクライアントがSQL Serverに接続されている場合にパフォーマンスを最適化するのに役立ちます。</block>
  <block id="aefc7f2ee96effbbbe49e6ece6d2f72a" category="paragraph">通常、クエリ要求ごとに個別のオペレーティングシステムスレッドが作成されます。SQL Serverへの同時接続が数百もの場合、クエリ要求ごとに1つのスレッドが大量のシステムリソースを消費します。最大ワーカースレッド数オプションを使用すると、SQL Serverでワーカースレッドのプールを作成して多数のクエリ要求を処理できるようになるため、パフォーマンスが向上します。</block>
  <block id="decd79137325e1efbc7b994f946ea24f" category="paragraph">デフォルト値は0で、SQL Serverは起動時にワーカースレッド数を自動的に設定できます。これはほとんどのシステムで機能します。ワーカースレッドの最大数は高度なオプションであり、経験豊富なデータベース管理者（DBA）の支援なしに変更しないでください。</block>
  <block id="030a270970f70c1bd91d3689b6f95f3f" category="inline-link-macro">max worker threadsサーバ設定オプションの設定</block>
  <block id="2a0c648df721b9bc2643d59c4a3a310a" category="paragraph">より多くのワーカースレッドを使用するようにSQL Serverを設定する必要があるのはいつですか？各スケジューラの平均ワークキューの長さが1を超える場合は、負荷がCPUに制限されていないか、その他の重い待機時間が発生している場合にのみ、システムにスレッドを追加することでメリットが得られます。これらのいずれかが発生している場合、スレッドを追加しても、他のシステムボトルネックを待つことになるため、効果はありません。最大ワーカースレッド数の詳細については、を参照してください。 <block ref="77c391df5f9f06cdf367c2a7314ce351" category="inline-link-macro-rx"></block>。</block>
  <block id="29d04e616d2293c4c7538dd6226feac5" category="section-title">SQL Server Management Studioを使用した最大ワーカースレッド数の設定。</block>
  <block id="5962130d833e0408cf58a87e342bc1f9" category="doc">Microsoft SQL Server tempdbフアイル</block>
  <block id="625156cc6cef9a3c56b1b535579bd2c9" category="paragraph">NetAppでは、ディスクの断片化を避けるために、tempdbファイルを事前にフルサイズに拡張することを推奨しています。</block>
  <block id="ca75041d415f4dafabb49b7f06b634ed" category="paragraph">ページ競合は、SQL Serverが新しいオブジェクトを割り当てるために特別なシステムページに書き込む必要がある場合に、グローバル割り当てマップ（GAM）、共有グローバル割り当てマップ（SGAM）、またはページ空きスペース（PFS）ページで発生する可能性があります。ラッチは、メモリ内のこれらのページを保護（ロック）します。ビジー状態のSQL Serverインスタンスでは、tempdbのシステムページでラッチを取得するのに時間がかかることがあります。その結果、クエリの実行時間が長くなり、ラッチ競合と呼ばれます。tempdbデータファイルを作成する場合は、次のベストプラクティスを参照してください。</block>
  <block id="44dbc82801d84781083ed9e23b63be00" category="list-text">8コア以下の場合：tempdbデータファイル=コア数</block>
  <block id="6203fcdbdad10bb603fd00edd2f0fcf5" category="list-text">8コアを超える場合：8個のtempdbデータファイル</block>
  <block id="b9f341e4fb0e6b384aa7ec0b5c33f964" category="paragraph">次のスクリプト例は、8つのtempdbファイルを作成し、tempdbをマウントポイントに移動することで、tempdbを変更します。<block ref="ae6fbe62f3ddc46fa9a9885244d23675" prefix=" " category="inline-code"></block> （SQL Server 2012以降）。</block>
  <block id="0424163d6b24f29436021dfd7072863b" category="paragraph">SQL Server 2016以降では、インストール時にオペレーティングシステムが認識できるCPUコアの数が自動的に検出され、その数に基づいて、最適なパフォーマンスを実現するために必要なtempdbファイルの数が計算および設定されます。</block>
  <block id="1c5b37437282a3648dde78afd914e452" category="doc">Microsoft SQL Serverの概要</block>
  <block id="9aa5016539f88d8f1972a16ce9babd34" category="paragraph">SQL ServerはMicrosoftのデータプラットフォームの基盤であり、オンプレミスでもクラウドでも、インメモリテクノロジを使用してミッションクリティカルなパフォーマンスを実現し、あらゆるデータの分析を高速化します。</block>
  <block id="93561e0df88dabbfc4999f97e0030525" category="admonition">このドキュメントは、以前に公開されたテクニカルレポート（TR-4590：『Best Practice Guide for Microsoft SQL Server with ONTAP』）に代わるものです。</block>
  <block id="8133a02d7327679696821fb31b105177" category="paragraph">Microsoft SQL Serverは、ミッションクリティカルなアプリケーションに画期的なパフォーマンス、可用性、管理性を提供することで、以前のリリースで提供されていたミッションクリティカルな機能を基盤としています。ストレージシステムは、SQL Serverデータベースの全体的なパフォーマンスを左右する重要な要素です。NetAppには、SQL Serverデータベースでエンタープライズクラスのパフォーマンスを実現しながら、環境を管理するためのワールドクラスのツールを提供する複数の製品が用意されています。</block>
  <block id="0bdfc026961d516d3d473152b4b6a87e" category="section-title">モクテキトモクテキ</block>
  <block id="d0554e23b25bb82082a0cd9eaf810d0f" category="paragraph">このセクションでは、効果的かつ効率的なストレージ導入とエンドツーエンドのデータ保護および保持計画を実現するために、NetApp ONTAPソフトウェアを実行するNetAppストレージシステムにSQL Serverを導入する際のベストプラクティスと設計上の考慮事項について説明します。このガイドの範囲は、SQL Serverの導入時にNetAppがストレージインフラに推奨する設計原則と推奨標準に基づく技術設計ガイドラインに限定されます。エンドツーエンドの実装は、このレポートの範囲外です。</block>
  <block id="cf4cab9c6fd24025b34dfcae06e9b6fc" category="paragraph">このガイドで説明するベストプラクティスと推奨事項により、SQL ServerアーキテクトやNetAppストレージ管理者は、可用性と管理が容易なSQL Server環境を計画し、厳しいSLAを満たすことができます。NetAppは、読者が以下について実用的な知識を持っていることを前提としています。</block>
  <block id="9801f873fe2232da0de3cbab00483bfb" category="list-text">NetApp ONTAPソフトウェア</block>
  <block id="3b5b2ca12603a36517ce602ffe47361c" category="list-text">バックアップソフトウェアとしてのNetApp SnapCenterには、次のものが含まれます。</block>
  <block id="36a92a010308100e1efc10d9eb98c369" category="list-text">SnapCenter Plug-in for Microsoft Windows の略</block>
  <block id="ec51578d7d8f930329548bf3d00d7038" category="list-text">SQL Server向けSnapCenterプラグイン</block>
  <block id="a6d698a68f555339f6e91957f636ad69" category="list-text">Microsoft SQL Serverのアーキテクチャと管理</block>
  <block id="697ea025ecb303d4f40d1bf3a8b4bde0" category="inline-link-macro">ネットアップの Interoperability Matrix Tool （ IMT ）</block>
  <block id="c02eaaaf0eed9e51c3a9e1e9ae8b9147" category="paragraph">NetAppスタック全体での設定の互換性については、を参照してください。 <block ref="ea0e6fe442c1f7a042a8853ffcc2b382" category="inline-link-macro-rx"></block>。</block>
  <block id="fbd4c4f9516af91c6c3cb5fa35fb5720" category="doc">Microsoft SQL Serverストレージに関する考慮事項</block>
  <block id="8c2a9e7195a263b5d79d397f5c6a9f68" category="paragraph">NetAppストレージソリューションとMicrosoft SQL Serverを組み合わせることで、今日の最も要求の厳しいアプリケーション要件を満たすエンタープライズレベルのデータベースストレージ設計を作成できます。</block>
  <block id="8136e237a15b0f72e5d7a60392225d17" category="paragraph">両方のテクノロジを最適化するには、SQL ServerのI/Oパターンと特性を理解することが重要です。SQL Serverデータベース用の適切に設計されたストレージレイアウトは、SQL ServerのパフォーマンスとSQL Serverインフラの管理をサポートします。また、ストレージレイアウトを適切に配置すれば、初期導入を成功させ、ビジネスの成長に合わせて環境をスムーズに拡張できます。</block>
  <block id="3da07c62fca4dd242f7ffcfcf72998be" category="section-title">データストレージ設計</block>
  <block id="9e45010900186b3cbbe04f954a6f3562" category="paragraph">SnapCenter を使用してバックアップを実行しないSQL Serverデータベースについては、データファイルとログファイルを別 々 のドライブに配置することを推奨します。データを同時に更新して要求するアプリケーションでは、ログファイルに書き込み負荷がかかり、（アプリケーションによっては）データファイルの読み取り/書き込み負荷が高くなります。データを取得する場合、ログファイルは必要ありません。そのため、データの要求は、そのドライブに配置されたデータファイルから満たすことができます。</block>
  <block id="df018ea4abdb71f91802ea1d4fb0fb37" category="inline-link-macro">データファイルとログファイルを別 々 のドライブに配置</block>
  <block id="f2f25c68d67c561be1926b4b06e676b0" category="paragraph">新しいデータベースを作成するときは、データとログ用に別 々 のドライブを指定することを推奨します。データベース作成後にファイルを移動するには、データベースをオフラインにする必要があります。Microsoftのその他の推奨事項については、 <block ref="04fab8828edf0d2e95eff3c4f124b372" category="inline-link-macro-rx"></block>。</block>
  <block id="d5350d8759b1ec84607e47908809058e" category="section-title">アグリゲート</block>
  <block id="b8212b86fca1dcaeb0438529a03212c3" category="paragraph">アグリゲートはNetAppストレージ構成のプライマリストレージコンテナであり、データディスクとパリティディスクの両方で構成される1つ以上のRAIDグループを含みます。NetAppは、データファイルとトランザクションログファイルを分離した共有アグリゲートと専用アグリゲートを使用して、さまざまなI/Oワークロードの特性評価テストを実施してきました。このテストでは、1つの大規模アグリゲートに複数のRAIDグループとスピンドルを配置することで、ストレージのパフォーマンスが最適化されて向上し、管理者が管理しやすくなることがわかりました。その理由は次の2つです。</block>
  <block id="5f9196be7c85ebe3a38375ace1f3a345" category="list-text">1つの大きなアグリゲートで、すべてのスピンドルのI/O機能をすべてのファイルで使用できます。</block>
  <block id="77f1d6b9cbcaf3663f6bdd19a821e773" category="list-text">1 つの大きなアグリゲートで、最も効率的なディスクスペースを使用できます。</block>
  <block id="63d9962fabe500361986d05317bd65a5" category="paragraph">高可用性（HA）を実現するには、SQL Server Always On可用性グループのセカンダリ同期レプリカを、アグリゲート内の別のStorage Virtual Machine（SVM）に配置します。ディザスタリカバリを目的とした場合は、DRサイト内の別のストレージクラスタの一部であるアグリゲートに非同期レプリカを配置し、NetApp SnapMirrorテクノロジを使用してコンテンツをレプリケートします。NetAppでは、ストレージのパフォーマンスを最適化するために、アグリゲートに利用可能な空きスペースを少なくとも10%確保することを推奨しています。</block>
  <block id="c6f01c78bfe0a0a495cb5d3ed77824a9" category="section-title">個のボリューム</block>
  <block id="5ec65e803efce0f0779c59e4df9b2a71" category="paragraph">NetApp FlexVolボリュームはアグリゲート内に作成され、格納されます。1つのアグリゲートに多数のボリュームを作成し、各ボリュームを拡張、縮小、アグリゲート間で移動できます。ユーザのダウンタイムは発生しません。</block>
  <block id="17fce39141e6fa457c789ce2c3239b0c" category="section-title">ボリュームの設計に関する考慮事項</block>
  <block id="d1c9fdbcdbb8521971decf35c6d1c0c8" category="paragraph">データベースボリュームの設計を作成する前に、SQL ServerのI/Oパターンと特性がワークロードやバックアップとリカバリの要件に応じてどのように変わるかを理解しておくことが重要です。フレキシブルボリュームについては、NetAppに関する次の推奨事項を参照してください。</block>
  <block id="570f1006846b0d45ff44b4332b9b4d14" category="list-text">フレキシブルボリュームを使用してSQL Serverデータベースファイルを格納し、ホスト間でボリュームを共有しないようにします。</block>
  <block id="674343739e297abb52c536a453ebaad0" category="list-text">ドライブレターではなくNTFSマウントポイントを使用して、Windowsのドライブレターの制限（26文字）を超えます。ボリュームマウントポイントを使用する場合は、ボリュームラベルにマウントポイントと同じ名前を付けることを一般的に推奨します。</block>
  <block id="d5fe4f7f1c47df1ec78c926d21498f73" category="list-text">必要に応じて、スペース不足が発生しないようにボリュームのオートサイズポリシーを設定します。17 ONTAPを使用したMicrosoft SQL Serverのベストプラクティスガイド©2022 NetApp、Inc. 無断転載を禁じます。</block>
  <block id="fdb3a973962ea77cf56d76e12cff8c7d" category="list-text">SQL ServerデータベースのI/Oプロファイルが、意思決定支援システムのワークロードなど、大部分がラージシーケンシャルリードで構成されている場合は、ボリュームの読み取り再割り当てを有効にします。読み取り再割り当ては、パフォーマンスを向上させるためにブロックを最適化します。</block>
  <block id="3a9320cf27fb328f77ec6153273784d5" category="list-text">SQL ServerをSMB共有にインストールする場合は、フォルダを作成するためにSMB/CIFSボリュームでUnicodeが有効になっていることを確認してください。</block>
  <block id="08a6901e4e7b04d6170563bc57864093" category="list-text">運用面からの監視を容易にするために、ボリュームのNetApp Snapshotコピーリザーブの値を0に設定します。</block>
  <block id="156ce9adf6c474183396aa3cfb8f92f1" category="list-text">ストレージSnapshot™コピースケジュールと保持ポリシーを無効にします。代わりに、SnapCenterを使用してSQL ServerデータボリュームのSnapshotコピーを調整します。</block>
  <block id="f2e00c12259a4bb11608f2a12fc8014a" category="list-text">SQL Serverシステムデータベースを専用のボリュームまたはVMDKに配置します。</block>
  <block id="4176288dbc134524f79476ba4e57e3aa" category="list-text">tempdbは、特にI/O負荷の高いDBCC CHECKDB処理のために、SQL Serverが一時的なワークスペースとして使用するシステムデータベースです。したがって、このデータベースは、独立したスピンドルセットを持つ専用ボリュームに配置します。ボリューム数が課題となる大規模な環境では、慎重に計画を立てたあと、tempdbを少数のボリュームに統合し、他のシステムデータベースと同じボリュームに格納できます。tempdbのデータ保護は、SQL Serverを再起動するたびにこのデータベースが再作成されるため、優先度の高いものではありません。</block>
  <block id="57eda1aa66778bf3c77caa0294652ba8" category="list-text">ランダムな読み取り/書き込みワークロードであるため、ユーザデータファイル（.mdf）を別 々 のボリュームに配置します。トランザクションログバックアップは、データベースバックアップよりも頻繁に作成するのが一般的です。そのため、トランザクションログファイル（.ldf）をデータファイルとは別のボリュームまたはVMDKに配置して、それぞれに個別のバックアップスケジュールを作成できるようにします。この分離により、ログファイルのシーケンシャルライトI/Oがデータファイルのランダムリード/ライトI/Oから分離され、SQL Serverのパフォーマンスが大幅に向上します。</block>
  <block id="b26e74ed6e2892c7e2bb95e414d460c6" category="section-title">LUN</block>
  <block id="b703a2ceaabee81dd9dfcfb3a4b738ee" category="list-text">ユーザデータベースファイルとログバックアップを格納するログディレクトリが別 々 のボリュームにあることを確認して、SnapVaultテクノロジでSnapshotが使用されている場合に保持ポリシーによって上書きされないようにしてください。</block>
  <block id="152bb9192ea87919eda3b4f97fd4e1bf" category="list-text">SQL Serverデータベースが、フルテキスト検索関連ファイルなど、データベース以外のファイルを持つLUNとは別のLUN上に存在することを確認します。</block>
  <block id="e2faf723544ceb1ea01ba41cef2d633a" category="list-text">データベースのセカンダリファイルを（ファイルグループの一部として）別 々 のボリュームに配置すると、SQL Serverデータベースのパフォーマンスが向上します。この分離は、データベースの.mdfファイルがLUNを他の.mdfファイルと共有していない場合にのみ有効です。</block>
  <block id="ae72f885471636cbfd0dbe902ddf24e1" category="list-text">DiskManagerなどのツールを使用してLUNを作成する場合は、LUNをフォーマットするときに、パーティションの割り当て単位サイズが64Kに設定されていることを確認してください。</block>
  <block id="ac4782a9243acaaff52164f9e47417d5" category="inline-link-macro">最新SANに対するONTAPのベストプラクティスに基づくMicrosoft WindowsとネイティブMPIO</block>
  <block id="934e206705ddafc720e4a8f25a4acded" category="list-text">を参照してください <block ref="95506eaa4fca841adc20747ae4650d10" category="inline-link-macro-rx"></block> WindowsのマルチパスサポートをMPIOプロパティのiSCSIデバイスに適用するには、次の手順を実行します。</block>
  <block id="31a8d85b6a44cffc2c7dfc6387696f31" category="section-title">ログディレクトリ</block>
  <block id="973781a026becacffaae9fd5fd5c2b7b" category="paragraph">ログディレクトリは、トランザクションログバックアップデータをホストレベルで格納するためにSQL Serverで指定します。SnapCenterを使用してログファイルをバックアップする場合は、SnapCenterで使用される各SQL Serverホストに、ログバックアップを実行するようにホストログディレクトリを設定する必要があります。SnapCenter にはデータベースリポジトリがあるため、バックアップ、リストア、クローニングの処理に関連するメタデータは中央のデータベースリポジトリに格納されます。</block>
  <block id="29766ed5967263787fface0a4ad3396f" category="paragraph">ホストログディレクトリのサイズは、次のように計算されます。
ホストログディレクトリのサイズ=（（最大DB LDFサイズx日次ログ変更率%）x（Snapshot保持率）÷（1 LUNオーバーヘッドスペース%）
ホストログディレクトリのサイジング式では、LUNオーバーヘッドスペースが10%であることを前提としています。</block>
  <block id="31333b887781902e13c263570523ddc1" category="paragraph">ログディレクトリは専用のボリュームまたはLUNに配置します。ホストログディレクトリのデータ量は、バックアップのサイズとバックアップを保持する日数によって異なります。SnapCenterでは、SQL Serverホストごとに1つのホストログディレクトリのみが許可されます。ホストログディレクトリは、SnapCenter --&gt;ホスト--&gt;プラグインの設定で設定できます。</block>
  <block id="e815059019027c04aa969a50787d5b34" category="paragraph">* NetAppでは、ホストログディレクトリに次のことを推奨しています*。</block>
  <block id="07ae4edb1ccfbfe1f5da6006c95ee4a9" category="list-text">ホストログディレクトリが、バックアップSnapshotデータを破損する可能性のある他のタイプのデータと共有されていないことを確認してください。</block>
  <block id="991bd1f492a593453f65c2a23c1f1612" category="list-text">マウントポイントをホストするLUNにユーザデータベースまたはシステムデータベースを配置しないでください。</block>
  <block id="bdfdf6f1492d7a7beac0bce2c4109f95" category="list-text">SnapCenterによるトランザクション・ログのコピー先となる専用のFlexVolボリューム上に、ホスト・ログ・ディレクトリを作成します。</block>
  <block id="7b01578e73f5081fecdcc6dedf28aa3c" category="list-text">SnapCenterウィザードを使用してデータベースをNetAppストレージに移行し、データベースを有効な場所に格納できるようにすることで、SnapCenterのバックアップおよびリストア処理を正常に実行できます。移行プロセスはシステムの停止を伴うため、移行の実行中にデータベースを原因でオフラインにする可能性があることに注意してください。</block>
  <block id="b2d0e2f60ee139155b728ef6933efe7c" category="list-text">SQL Serverのフェイルオーバークラスタインスタンス（FCI）では、次の条件が満たされている必要があります。</block>
  <block id="863fda0972208e1e15d0c4a16d6915af" category="list-text">フェイルオーバークラスタインスタンスを使用している場合は、ホストログディレクトリLUNがSnapCenter、バックアップ対象のSQL Serverインスタンスと同じクラスタグループ内のクラスタディスクリソースである必要があります。</block>
  <block id="ddb1104e1e71caabad3e7639c7675af8" category="list-text">フェイルオーバークラスタインスタンスを使用している場合は、SQL Serverインスタンスに関連付けられたクラスタグループに割り当てられた物理ディスククラスタリソースである共有LUNにユーザデータベースを配置する必要があります。</block>
  <block id="bca5f9a18696e080113088282fe481de" category="doc">Microsoft SQL Serverのメモリ構成</block>
  <block id="02578ec0e8ce2fbef37ca792fd20c289" category="section-title">最大サーバメモリ</block>
  <block id="81dbc262a15fc545920141998ddd1c17" category="paragraph">max server memoryオプションは、SQL Serverインスタンスで使用できるメモリの最大容量を設定します。</block>
  <block id="c9fa383209ffc05f20049101298fec96" category="paragraph">通常、SQL Serverが実行されている同じサーバで複数のアプリケーションが実行されていて、これらのアプリケーションが正常に機能するのに十分なメモリを確保したい場合に使用されます。</block>
  <block id="1ceeb5f5f18aefbc39e34d0d3c7b7e1c" category="paragraph">アプリケーションによっては、起動時に使用可能なメモリのみを使用し、必要に応じて要求しないものもあります。ここで、最大サーバメモリ設定が有効になります。</block>
  <block id="6e345f11e9b2856a7ac40d6cf283606b" category="paragraph">複数のSQL Serverインスタンスを持つSQL Serverクラスタでは、各インスタンスがリソースを競合する可能性があります。SQL Serverインスタンスごとにメモリ制限を設定すると、各インスタンスのパフォーマンスを最大限に高めることができます。</block>
  <block id="318b34a3511a1be6d179a73303da2077" category="admonition">* NetAppでは、パフォーマンスの問題を回避するために、オペレーティングシステム用に少なくとも4GBから6GBのRAMを残しておくことを推奨しています。</block>
  <block id="cd151dbdf946ad6bd27e1d55ea1cd029" category="section-title">SQL Server Management Studioを使用したサーバの最小メモリと最大メモリの調整</block>
  <block id="2e0d4de7d927936246f5537ba48015d2" category="paragraph">SQL Server Management Studioを使用してサーバの最小メモリまたは最大メモリを調整するには、SQL Serverサービスを再起動する必要があります。次のコードを使用して、Transact SQL（T-SQL）を使用してサーバメモリを調整できます。</block>
  <block id="998c5e632fa0f987c20c182fc9322f67" category="section-title">不均一なメモリアクセス</block>
  <block id="d92030bf70ac1cf1da30ce4c9ab2bbf6" category="paragraph">NUMA（Nonuniform Memory Access）は、プロセッサバスの負荷を増やすことなくプロセッサ速度を向上させるメモリアクセス最適化方法です。</block>
  <block id="6ef102e61df24a50b0119558432f5623" category="paragraph">SQL ServerがインストールされているサーバでNUMAが構成されている場合、SQL ServerはNUMAを認識し、NUMAハードウェアで優れたパフォーマンスを発揮するため、追加の構成は必要ありません。</block>
  <block id="b3b5cd113ed637ebe6cb28eab322307a" category="section-title">インデックス作成メモリ</block>
  <block id="8e7c0153e4b7aa851a5a62683c378d1c" category="paragraph">index create memoryオプションは、通常は変更しないもう1つの高度なオプションです。</block>
  <block id="631c6718cc62ad33b6e3b3b48d754569" category="paragraph">インデックスを作成するために最初に割り当てられるRAMの最大容量を制御します。このオプションのデフォルト値は0です。これは、SQL Serverによって自動的に管理されることを意味します。ただし、インデックスの作成に問題がある場合は、このオプションの値を増やすことを検討してください。</block>
  <block id="8c91aa3f5264c57bd2d2e66bd70f2ad1" category="section-title">クエリあたりの最小メモリ</block>
  <block id="027d5a3eabe88aa0ab705b9c4a2fe096" category="paragraph">クエリを実行すると、SQL Serverは効率的に実行するために最適なメモリ容量を割り当てようとします。</block>
  <block id="4c7836a7e63c3ecb3f6860ec19643561" category="paragraph">デフォルトでは、クエリごとの最小メモリ設定では、実行するクエリごとに&gt;または=が1024KBに割り当てられます。SQL Serverがインデックス作成処理に割り当てられるメモリ容量を動的に管理できるようにするには、この設定をデフォルト値の0のままにしておくことを推奨します。ただし、SQL ServerのRAM容量が効率的に実行するために必要な容量を超えている場合は、この設定を大きくすると、一部のクエリのパフォーマンスが向上することがあります。したがって、SQL Server、その他のアプリケーション、またはオペレーティングシステムで使用されていないサーバ上のメモリが使用可能であれば、この設定を大きくすることでSQL Serverの全体的なパフォーマンスを向上させることができます。空きメモリがない場合、この設定を増やすと、全体的なパフォーマンスが低下する可能性があります。</block>
  <block id="d2a88da9a0fcc96168f8f051909d5599" category="section-title">バッファプール拡張</block>
  <block id="11a3fdcfeb0715eaf26e855034f6ab9a" category="paragraph">バッファプール拡張機能を使用すると、NVRAM拡張機能とデータベースエンジンのバッファプールをシームレスに統合して、I/Oスループットを大幅に向上させることができます。</block>
  <block id="c722da593d2f37b2c1ffc91a10c03dad" category="paragraph">バッファプール拡張機能は、すべてのSQL Serverエディションで使用できるわけではありません。64ビットのSQL Server Standard、Business Intelligence、およびEnterpriseエディションでのみ使用できます。</block>
  <block id="df07548a7c164cbe93b68c4cbebbdcf8" category="paragraph">バッファプール拡張機能は、不揮発性ストレージ（通常はSSD）を使用してバッファプールキャッシュを拡張します。この拡張機能により、バッファプールはより大規模なデータベースワーキングセットに対応できるようになり、RAMとSSD間のI/Oのページングが強制され、小さなランダムI/OがメカニカルディスクからSSDに効果的にオフロードされます。SSDのレイテンシが低く、ランダムI/Oのパフォーマンスが向上するため、バッファプールを拡張することでI/Oスループットが大幅に向上します。</block>
  <block id="54af95ef673718e2f8bf1cc873d8b3ce" category="paragraph">バッファプール拡張機能には、次の利点があります。</block>
  <block id="2c250b49dc6705e6d219cf2bf8d50bc5" category="list-text">ランダムI/Oスループットの向上</block>
  <block id="93dce890e8c62b3a651edb9098201e58" category="list-text">I/Oレイテンシの低減</block>
  <block id="d7e49f79c1b78c9ead1e9541d2160307" category="list-text">トランザクションスループットの向上</block>
  <block id="6643befb3c9dc2fbb68fe1107fe24842" category="list-text">ハイブリッドバッファプールの拡張による読み取りパフォーマンスの向上</block>
  <block id="6609220b8670ffd627a3663b3beef46b" category="list-text">既存および将来の低コストメモリを活用できるキャッシュアーキテクチャ</block>
  <block id="471bda18bb94c589b421edccb0e402fe" category="paragraph">* NetAppでは、バッファプール拡張を次のように設定することを推奨しています。</block>
  <block id="12810c53d2afa05bd2a75aa3c0c55592" category="list-text">バッファプール拡張ターゲットディスクとして使用できるように、SSDベースのLUN（NetApp AFFなど）がSQL Serverホストに提供されていることを確認します。</block>
  <block id="824cfa1576a82f89ee0af13fb9f086dc" category="list-text">拡張ファイルのサイズは、バッファプールと同じかそれよりも大きくする必要があります。</block>
  <block id="c7e0d87e723625072015431887edf349" category="paragraph">次に、バッファプール拡張を32GBに設定するT-SQLコマンドの例を示します。</block>
  <block id="7ef20d2374bc8b734222e4ec2f0f3643" category="doc">ONTAPによるMicrosoft SQL ServerのStorage Efficiency</block>
  <block id="e5bc122522e9ae1409590d9944ec4421" category="paragraph">Storage Efficiencyとは、消費するストレージスペースを最小限に抑えながら、システム全体のパフォーマンスにほとんど影響を与えずに、SQL Serverデータを格納、管理できる機能です。</block>
  <block id="2d3c9d6f03cd640c224f5daf9c2352b0" category="paragraph">SQL Serverには、データを圧縮して効率的に管理する機能もあります。SQL Serverでは現在、行圧縮とページ圧縮の2種類のデータ圧縮がサポートされています。</block>
  <block id="181341700086c5e2f2259774b2aaa59c" category="inline-link-macro">ページ圧縮の実装</block>
  <block id="46c6aaf21d639d23d4f297a1f6922d9a" category="paragraph">行圧縮を使用すると、データストレージ形式が変更されます。たとえば、整数と小数を、ネイティブの固定長形式ではなく可変長形式に変更します。また、空白スペースを排除することで、固定長の文字列を可変長形式に変更します。ページ圧縮では、行圧縮と他の2つの圧縮方式（プレフィックス圧縮とディクショナリ圧縮）が実装されます。ページ圧縮の詳細については、 <block ref="88eab602b149fe360da37498ad5cdeae" category="inline-link-macro-rx"></block>。</block>
  <block id="0d629ff07f9214182fa91977089ff029" category="paragraph">データ圧縮は現在、SQL Server 2008以降のEnterprise、Developer、およびEvaluationエディションでサポートされています。圧縮はデータベース自体で実行できますが、SQL Server環境ではほとんど実行されません。</block>
  <block id="c6757fbc56df4ba20f0ef165aeb214d0" category="paragraph">SQL Serverデータファイルのスペース管理の推奨事項は次のとおりです。</block>
  <block id="46344e63db1ea2128cc47543b10a0f96" category="list-text">SQL Server環境でシンプロビジョニングを使用すると、スペース利用率を向上し、スペースギャランティ機能を使用する場合に必要なストレージ全体を削減できます。</block>
  <block id="924e1b131d6b3a2846efd1a81de8eac1" category="list-text">ストレージ管理者が監視する必要があるのはアグリゲート内のスペース使用量だけであるため、一般的な構成では自動拡張を使用します。</block>
  <block id="13a233d96ce19e7530391105360d749b" category="list-text">バックアップから単一ボリュームへのデータベースのリストアなど、同じデータのコピーがボリュームに複数含まれていることがわかっている場合を除き、SQL Serverデータファイルを含むボリュームで重複排除を有効にしないことを推奨します。</block>
  <block id="752d71c042ef775879f6db705ccf6b31" category="section-title">スペース再生</block>
  <block id="89f8656e4e33094d6011ef9aaa8fa8de" category="paragraph">スペース再生は、LUN内の未使用スペースをリカバリするために定期的に開始できます。SnapCenterでは、次のPowerShellコマンドを使用してスペース再生を開始できます。</block>
  <block id="aa864feb1e600aa376e91ac119da387b" category="paragraph">スペース再生を実行する必要がある場合は、最初にホストのサイクルを消費するため、アクティビティが少ない時間帯にこのプロセスを実行する必要があります。</block>
  <block id="a356c94dff23a233551ff221e74a144d" category="summary">ONTAPを使用したMicrosoft SQL Serverのデータ保護</block>
  <block id="731c00fe6475fb22aece82ffa9d74ef3" category="paragraph">データベースの保護は、どのような組織にとっても重要です。データのサイズとデータベースの数が増えるにつれて、目標復旧時間（RTO）と目標復旧時点（RPO）を維持することが非常に重要になります。</block>
  <block id="5c014f8939a89da0166a347a0237cf4f" category="section-title">SnapCenter</block>
  <block id="2ddb1872f6c378e74cb7269e9de4c4e5" category="paragraph">SnapCenterは、エンタープライズアプリケーション向けのNetAppデータ保護ソフトウェアです。NetApp SnapCenterソフトウェアとPlug-in for SQL ServerおよびPlug-in for Microsoft Windowsを併用することで、SQL Serverデータベースを迅速かつ簡単に保護できます。</block>
  <block id="bdc6c0cf646d837838203c2980eba84a" category="paragraph">この製品を使用すると、アプリケーションと整合性のあるバックアップ、自動クローニング、SQL Serverデータベース、インスタンス、可用性グループのリストアとリカバリを実行できます。</block>
  <block id="2450e19674db2a865555d3c04563e647" category="admonition">* NetAppでは* SnapCenterを使用してSnapshotコピーを作成することを推奨しています。</block>
  <block id="1567bc0803275089d7cbc1ffc468158c" category="inline-link-macro">TR-4714：『Best Practice Guide for SQL Server using NetApp SnapCenter』</block>
  <block id="17f58c1b5cb5feb5dcaf49ca87298c00" category="paragraph">SQL Server Plug-in for SnapCenterの詳細については、を参照してください。 <block ref="c94de7812b9bc9ed76b3c4005974958d" category="inline-link-macro-rx"></block>。</block>
  <block id="91a7baba41dc4b5f958101b261cf179b" category="section-title">T-SQLスナップショットを使用したデータベースの保護</block>
  <block id="e158e137ead13fd14e064b875e45df20" category="paragraph">SQL Server 2022では、MicrosoftがT-SQLスナップショットを導入しました。これは、データベース管理者が簡単に使用できなかった従来の方法よりも利点が組み込まれています。ONTAP REST APIを利用すると、Snapshotボリュームに対するコマンドを呼び出すことができます。</block>
  <block id="02e19b2989ebddca9ad3778807bdc426" category="paragraph">次に、バックアップワークフローの例を示します。</block>
  <block id="17884d5a1cfc06145e718a49c8d6ac66" category="list-text">ALTERコマンドを使用してデータベースをフリーズします。基盤となるストレージで整合性のあるスナップショットを実行できます。その後、backupコマンドを使用してデータベースを解凍し、Snapshotを記録できます。</block>
  <block id="bd03301405e4dd8f2460ff1788765ac4" category="list-text">新しいbackup groupコマンドとbackup serverコマンドを使用して、ストレージボリューム上の複数のデータベースのスナップショットを同時に実行します。</block>
  <block id="a3b19be7df3ddff7295558d9934cd9b6" category="list-text">フルバックアップまたはCOPY_ONLYフルバックアップを実行します。これらのバックアップもmsdbに記録されます。</block>
  <block id="e2d06152222f63515f4b83229cb5444c" category="list-text">スナップショットフルバックアップ後に通常のストリーミング方式で作成されたログバックアップを使用して、ポイントインタイムリカバリを実行します。必要に応じて、ストリーミング差分バックアップもサポートされます。</block>
  <block id="a7a2496066febda8d325e0964e434481" category="inline-link-macro">T-SQLスナップショットについて知るためのMicrosoftのドキュメント</block>
  <block id="bf06f3f95c5b653499bb4ac53ba44c95" category="paragraph">詳細については、を参照してください <block ref="2ba8392a398067f6d2e5f6e4167e9d00" category="inline-link-macro-rx"></block>。</block>
  <block id="450eb6d84ec721a20f17b7778b24b457" category="doc">Microsoft SQL Serverのワークロード</block>
  <block id="764e07fc8f1f5e2d1b9fc63f83b88cbd" category="paragraph">SQL Serverデータベースプラットフォームは、多くのアプリケーションをサポートできます。</block>
  <block id="25343e3363b414e89943f5a4e46f51ad" category="paragraph">SQL Serverを導入する前に、SQL Serverインスタンスがサポートするアプリケーションのデータベースワークロード要件を理解しておく必要があります。容量、パフォーマンス、可用性に関する要件はアプリケーションごとに異なるため、各データベースはこれらの要件を最適にサポートするように設計する必要があります。多くの組織では、アプリケーション要件を使用してSLAを定義し、データベースを複数の管理階層に分類しています。SQL Serverのワークロードは次のように記述できます。</block>
  <block id="c6a1c5843ff7b078079edf24beeea746" category="list-text">OLTPデータベースは、多くの場合、組織で最も重要なデータベースでもあります。これらのデータベースは通常、顧客向けのアプリケーションをバックアップし、企業の中核業務に不可欠であると考えられています。ミッションクリティカルなOLTPデータベースとサポート対象のアプリケーションには、高レベルのパフォーマンスが必要で、パフォーマンスの低下や可用性の影響を受けやすいSLAが設定されていることがよくあります。また、Always-OnフェイルオーバークラスタやAlways-On可用性グループの候補になることもあります。これらのタイプのデータベースのI/O構成は、通常、ランダムリードが75~90%、書き込みが25~10%という特徴があります。</block>
  <block id="96d864d235bcd68e1ef22c2c49aef352" category="list-text">意思決定支援システム(DSS)データベースは、データウェアハウスとも呼ばれます。これらのデータベースは、ビジネスの分析に依存している多くの組織でミッションクリティカルです。これらのデータベースは、クエリの実行時にCPU利用率やディスクからの読み取り処理の影響を受けます。多くの組織では、DSSデータベースは月、四半期、年末に最も重要なデータベースです。このワークロードは、一般に100%の読み取りI/O構成です。</block>
  <block id="da02a82356735ded82f6661108abe7ef" category="section-title">ベンチマーク</block>
  <block id="b9a9b34816c2e5ebaecb45f376b52bc3" category="paragraph">Transaction Process Council（TPC）は、トランザクション処理とデータベースのベンチマークを定義し、客観的で検証可能なTPCパフォーマンスデータを業界に広めるために設立された非営利団体です。TPCテストは、ユーザがデータベースに対してトランザクションを実行する完全なコンピューティング環境をシミュレートします。</block>
  <block id="427af860f9733f0c5427a1408195bb2b" category="cell">ワークロードの種類</block>
  <block id="54861efdd06fc309e1c9a420feff98eb" category="cell">シナリオ（ Scenario ）</block>
  <block id="b130fcf8f0704ab887b72883b1eda2fa" category="cell">読み取り/書き込み比率（割合）</block>
  <block id="3edb9cc3b98f151feb21dbde6323e82a" category="cell">OLTP</block>
  <block id="69e16af975a283d07a422bdbcc70aa33" category="cell">TPC-C</block>
  <block id="b1e04731135df8a16c5318612ec8654e" category="cell">～75/25</block>
  <block id="106ff1baff5c32dc414f262e0a710c54" category="cell">TPC-E</block>
  <block id="48e219d97cf4619f212471bafd4215ec" category="cell">～90/10</block>
  <block id="e71f0182ed04206cb78bd7ceb2d9f4f3" category="cell">DSS</block>
  <block id="5788057170990ecf5e4d921f2853c2ae" category="cell">TPC-H</block>
  <block id="492d66c3da61bdb9c69261aa1aa6f5f9" category="cell">~100/0</block>
  <block id="0737ef89fbed16c79fadf3568aad6ba0" category="inline-link-macro">HammerDB.com</block>
  <block id="45e5ae4569fb8a91cd5513654f31b764" category="paragraph">さまざまなワークロード生成オプションを利用できますが、一般的には、トランザクションワークロードを処理する際のSQL Serverデータベースのパフォーマンス測定に重点を置いており、MicrosoftのTPC-EツールやHammerDB（<block ref="af66be8e0834614cdd62ca4f34bc61ec" category="inline-link-macro-rx"></block>^）。これらの特定のベンチマークの使用方法の詳細な手順は、このドキュメントでは説明していません。</block>
  <block id="1b1b4c822e9c1b28b845dcc038fec08e" category="doc">Microsoft SQL Serverデータベースファイルおよびファイルグループ</block>
  <block id="381c0738613a6b6a27d1c14f223e99ba" category="paragraph">SQL Serverデータベースは、データの格納と操作を可能にするオブジェクトの集まりです。</block>
  <block id="5306de2e4bff067a10c1c9b5aafe5920" category="paragraph">理論的には、SQL Server（64ビット）ではインスタンスあたり32、767個のデータベースと524、272TBのデータベースサイズがサポートされますが、通常のインストールでは複数のデータベースが使用されます。ただし、SQL Serverで処理できるデータベースの数は、負荷とハードウェアによって異なります。SQL Serverインスタンスでは、数十、数百、場合によっては数千の小規模データベースをホストしていることも珍しくありません。</block>
  <block id="9a3f42cec243006996ab4580d3ce5d56" category="paragraph">各データベースは、1つ以上のデータファイルと1つ以上のトランザクションログファイルで構成されます。トランザクションログには、データベーストランザクションに関する情報と、各セッションで行われたすべてのデータ変更が格納されます。データが変更されるたびに、SQL Serverはトランザクションログに十分な情報を格納して、アクションを元に戻す（ロールバックする）か、やり直す（再生する）かを指定します。SQL Serverトランザクションログは、データの整合性と堅牢性に関するSQL Serverの評価に不可欠な要素です。トランザクションログは、SQL Serverの不可分性、整合性、分離、耐久性（ACID）機能に不可欠です。SQL Serverは、データページが変更されるとすぐにトランザクションログに書き込みます。すべてのData Manipulation Language（DML）ステートメント（SELECT、INSERT、UPDATE、DELETEなど）は完全なトランザクションであり、トランザクションログによってセットベースの操作全体が確実に実行され、トランザクションの不可分性が保証されます。</block>
  <block id="cbe6958e46fbab53cdbdb9deb2d75938" category="paragraph">各データベースには1つのプライマリデータファイルがあり、デフォルトでは.mdf拡張子が付いています。また、各データベースにセカンダリデータベースファイルを含めることもできます。これらのファイルには、デフォルトで.ndf拡張子が付いています。</block>
  <block id="811b578b6dfbb4a4ca16ba0c0911e3df" category="paragraph">すべてのデータベースファイルはファイルグループにグループ化されます。ファイルグループは論理ユニットであり、データベース管理を簡素化します。論理オブジェクトの配置と物理データベースファイルを分離できます。データベースオブジェクトテーブルを作成するときは、基になるデータファイルの設定を気にすることなく、配置するファイルグループを指定します。</block>
  <block id="3717596742d438a1c8e77b0aeb58fcec" category="paragraph">ファイルグループ内に複数のデータファイルを配置できるため、複数のストレージデバイスに負荷を分散して、システムのI/Oパフォーマンスを向上させることができます。一方、SQL Serverはトランザクションログにシーケンシャルに書き込むため、トランザクションログには複数のファイルを使用するメリットはありません。</block>
  <block id="c136ffb510a6a465d338ab0affc16641" category="paragraph">ファイルグループ内の論理オブジェクトの配置と物理データベースファイルの配置を分離することで、データベースファイルのレイアウトを微調整し、ストレージサブシステムを最大限に活用できます。たとえば、異なる顧客に自社製品を導入している独立系ソフトウェアベンダー（ISV）は、基盤となるI/O構成と導入段階で予想されるデータ量に基づいてデータベースファイルの数を調整できます。これらの変更は、データベースファイルではなくファイルグループにデータベースオブジェクトを配置するアプリケーション開発者には透過的です。</block>
  <block id="3ac46c2f04dec9d215efbe44d307a020" category="admonition">* NetAppでは、システムオブジェクト以外にプライマリファイルグループを使用しないことを推奨しています。ユーザオブジェクト用に別のファイルグループまたはファイルグループのセットを作成すると、特に大規模なデータベースの場合、データベースの管理とディザスタリカバリが容易になります。</block>
  <block id="e3fc56c012a5d0c9f92dff9b49bcc80d" category="paragraph">データベースを作成するとき、または既存のデータベースに新しいファイルを追加するときに、初期ファイルサイズと自動拡張パラメータを指定できます。SQL Serverでは、Proportional Fill Algorithmを使用して、データを書き込むデータファイルを選択します。ファイルで使用可能な空きスペースに比例してデータ量が書き込まれます。ファイル内の空きスペースが多いほど、処理する書き込み数も多くなります。</block>
  <block id="91d249de86b62102d6324849de2360fe" category="admonition">* NetAppでは、1つのファイルグループ内のすべてのファイルに同じ初期サイズと自動拡張パラメータを設定し、拡張サイズをパーセンテージではなくメガバイト単位で定義することを推奨しています*。これにより、Proportional Fill Algorithmは、データファイル間で書き込みアクティビティのバランスを均等に調整できます。</block>
  <block id="a39d73055b8dbbe112e749e7c3ededb8" category="paragraph">SQL Serverはファイルを拡張するたびに、ファイル内で新しく割り当てられたスペースをゼロでいっぱいにします。このプロセスは、対応するファイルへの書き込みが必要なすべてのセッションをブロックします。トランザクションログが増加した場合は、トランザクションログレコードを生成します。</block>
  <block id="54db492ee9e4d356cc8722d1f4126f77" category="paragraph">SQL Serverは常にトランザクションログをゼロにし、その動作を変更することはできません。ただし、インスタントファイルの初期化を有効または無効にすることで、データファイルを初期化するかどうかを制御できます。インスタントファイルの初期化を有効にすると、データファイルの増加を高速化し、データベースの作成やリストアに必要な時間を短縮できます。</block>
  <block id="92208bd4d9c6fec3f7c1dedeca62e135" category="paragraph">インスタントファイルの初期化には、わずかなセキュリティリスクが伴います。このオプションを有効にすると、データファイルの未割り当て部分に、以前に削除されたOSファイルの情報を含めることができます。データベース管理者はこのようなデータを調べることができます。</block>
  <block id="2b222ad4000e6e966783fd7bc480180e" category="paragraph">インスタントファイルの初期化を有効にするには、「ボリュームメンテナンスタスクの実行」とも呼ばれるSA_MANAGE_VOLUME_name権限をSQL Serverスタートアップアカウントに追加します。これは、次の図に示すように、ローカルセキュリティポリシー管理アプリケーション（secpol.msc）で実行できます。「Perform volume maintenance task」権限のプロパティを開き、SQL Serverスタートアップアカウントをユーザのリストに追加します。</block>
  <block id="c622e0142ed854a10f98fcaa8b3487f8" category="paragraph">権限が有効になっているかどうかを確認するには、次の例のコードを使用します。このコードは、SQL Serverがエラーログに追加情報を書き込み、小さなデータベースを作成し、ログの内容を読み取るように強制する2つのトレースフラグを設定します。</block>
  <block id="eba8c32bde087b29aaa1fe0d3bb32ef3" category="paragraph">インスタントファイルの初期化が有効になっていない場合、次の例に示すように、SQL Serverのエラーログには、LDFログファイルの初期化に加えてMDFデータファイルが初期化されていることが示されます。インスタントファイルの初期化を有効にすると、ログファイルの初期化のみが表示されます。</block>
  <block id="cf346325be0652c6b6e9a04b9352bda3" category="paragraph">ボリュームメンテナンスタスクはSQL Server 2016では簡単に実行でき、インストールプロセス中にオプションとして提供されます。この図は、SQL Serverデータベースエンジンサービスにボリュームメンテナンスタスクを実行する権限を付与するオプションを示しています。</block>
  <block id="638b283700120d26a838f9cb56fca59d" category="paragraph">データベースファイルのサイズを制御するもう1つの重要なデータベースオプションは、自動縮小です。このオプションを有効にすると、SQL Serverはデータベースファイルを定期的に縮小してサイズを縮小し、オペレーティングシステムにスペースを解放します。この処理はリソースを大量に消費するため、新しいデータがシステムに入ってくるとデータベースファイルが再び拡張されるため、あまり有用ではありません。データベースで自動縮小を有効にしないでください。</block>
  <block id="3b6c913908f5844ccb31a4d3775cb34e" category="doc">Microsoft SQL Server共有インスタンスと専用インスタンス</block>
  <block id="8b58192b54b5dc25444ace0536a34893" category="paragraph">アプリケーションに多数のスキーマとストアドプロシージャがある場合、SQL Serverインスタンスを共有する他のアプリケーションに影響を与える可能性があります。</block>
  <block id="0f85d9701e2ca305652e98c4181097e4" category="paragraph">インスタンスリソースが分割またはロックされる可能性があり、その結果、共有SQL Serverインスタンスでデータベースがホストされている他のアプリケーションでパフォーマンスの問題が発生する可能性があります。</block>
  <block id="37fbf1be337695452699ab9df948aa25" category="paragraph">どのインスタンスがルート原因であるかを把握する必要があるため、パフォーマンスの問題のトラブルシューティングは複雑になります。この質問は、オペレーティングシステムライセンスとSQL Serverライセンスのコストと比較して検討されます。アプリケーションのパフォーマンスを最優先する場合は、専用インスタンスを使用することを推奨します。</block>
  <block id="c840abede1d1bcf78e7b3e30048c08b1" category="paragraph">Microsoftでは、SQL Serverのライセンスは、インスタンス単位ではなく、コア単位でサーバレベルで付与されます。このため、データベース管理者は、ライセンスコストを削減するために、サーバで処理できる数のSQL Serverインスタンスをインストールしようとします。これは、後で大きなパフォーマンスの問題につながる可能性があります。</block>
  <block id="8a77155b45f0f2313c8ebf3d755463e5" category="admonition">* NetAppでは、最適なパフォーマンスを得るために、可能な限り専用のSQL Serverインスタンスを選択することを推奨しています。</block>
  <block id="df7423789cebcf51de121abdae4181c3" category="summary">ONTAPとエンタープライズアプリケーション</block>
  <block id="6e1c62c6c9ec560b6b6cf47a8a8c83f8" category="summary">Solarisを使用したONTAP上のOracle</block>
  <block id="eaf36c98b91893b7f79bd5184a23d377" category="doc">Solaris の場合</block>
  <block id="fb04d97697a77a89d0c3f5c09cd9ba47" category="paragraph">Solaris OSに固有の構成に関するトピック</block>
  <block id="eefc332f1bd0a0aa81d0ce222989294f" category="section-title">Solaris NFSのマウントオプション</block>
  <block id="3e484486d582145f6d93ca5f8c71e228" category="paragraph">次の表に、単一インスタンスのSolaris NFSのマウントオプションを示します。</block>
  <block id="6622c14ce91b6b9683505626a5eebdd2" category="cell">ファイルタイプ</block>
  <block id="f18f8a29d3e2281d374f43c78cf8f0f1" category="cell">マウントオプション</block>
  <block id="a45543a64530673135f37ff8f9e95e69" category="cell">ADRホーム</block>
  <block id="93a02670f814a2df6c830194a7244ea9" category="cell"><block ref="623bbf58c0b2f552d891a1c276bcc3bc" prefix="" category="inline-code"></block></block>
  <block id="80d52d74fd5c383b43f91575d569b42c" category="cell">制御ファイル
データファイル
REDO ログ</block>
  <block id="73cf9d3814b8678439c37316096219b1" category="cell"><block ref="4c899c62e1ffeb12078476828bb54351" prefix="" category="inline-code"></block></block>
  <block id="72d33cb5c8b7ff5f7fd6a894094b0697" category="cell"><block ref="e1f651debac4f720c13ae930ff3ca14a" prefix="" category="inline-code"></block></block>
  <block id="3f490427e0bf55dc5c837e7b0d4c651c" category="cell"><block ref="b9ce73264210e6d0faa4115ce7525610" prefix="" category="inline-code"></block></block>
  <block id="b00b0ab6e8494db1a230bf3da7f42fd6" category="paragraph">の使用<block ref="545e1db0caafaa47ef37ce893c8fb92c" prefix=" " category="inline-code"></block> ストレージシステムでロックを取得および解放する際のレイテンシを排除することで、お客様の環境のパフォーマンスが劇的に向上することが実証されています。多数のサーバが同じファイルシステムをマウントするように構成され、Oracleがこれらのデータベースをマウントするよう構成されている環境では、このオプションの使用に注意してください。これは非常に珍しい構成ですが、少数のお客様によって使用されています。インスタンスが誤って2回目に開始された場合、Oracleは外部サーバ上のロックファイルを検出できないため、データが破損する可能性があります。NFSロックは、NFSバージョン3のように保護を提供するものではなく、推奨されるだけです。</block>
  <block id="f480015b57b289b7dad1473ee5c55216" category="paragraph">なぜなら、<block ref="545e1db0caafaa47ef37ce893c8fb92c" prefix=" " category="inline-code"></block> および<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> パラメータは相互に排他的です。次のことが重要です。<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> は、<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> ファイルを作成して<block ref="6887bae4cda2d09a283a165c5be3f2b8" prefix=" " category="inline-code"></block> を使用します。このパラメータを指定しないと、ホストOSのバッファキャッシュが使用され、パフォーマンスが低下する可能性があります。</block>
  <block id="5171d5dfdc21b0941b921796638c10a9" category="paragraph">次の表に、Solaris NFSのマウントオプションを示します。</block>
  <block id="38e4e10abf410c92cd13e9cb4d54ae35" category="cell"><block ref="41a82b9bd64cb001f8913a34614b00d1" prefix="" category="inline-code"></block></block>
  <block id="e72cc50c204d77a1e47f0dcc8ad28a56" category="cell">制御ファイル
データ・ファイル
REDO ログ</block>
  <block id="98ee9e91a49f27abbd9dc831afa9fae5" category="cell"><block ref="f3a0fd4a197a2eae60d2ef904e5366f1" prefix="" category="inline-code"></block></block>
  <block id="f93eecf9c582d76d4e14292dc34c79f8" category="cell">CRS /投票</block>
  <block id="42c82995de255264e2a8690c3149c16a" category="cell">専用<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block></block>
  <block id="b71e04a676ec52e65edb52c138f2ad98" category="cell"><block ref="ac15a7c050732bc5169b6c17ce30f859" prefix="" category="inline-code"></block></block>
  <block id="273f714e976e2a709a6abe18d34e4b61" category="cell">共有<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block></block>
  <block id="2052aa052eee25e077178cd737b68f47" category="cell"><block ref="18f533bce293643d1004086db883dd03" prefix="" category="inline-code"></block></block>
  <block id="e9d3beba8b6a40da6f8074236ca3ddbc" category="paragraph">シングルインスタンスとRACマウントオプションの主な違いは、<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> および<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> をマウントオプションに移動します。このオプションを使用するとホストOSのキャッシングが無効になるため、データの状態について、RACクラスタ内のすべてのインスタンスが一貫した情報を認識できるようになります。ただし、<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> パラメータ<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> ホストのキャッシングを無効にした場合と同じ効果がありますが、引き続きを使用する必要があります。<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> および<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block>。</block>
  <block id="983c4ff0cb78851d95be06277152653f" category="paragraph">理由<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 共有の場合は必須です<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> を導入すると、Oracleパスワードファイルやspfileなどのファイルの整合性が維持されます。RACクラスタ内の各インスタンスに専用の<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>、このパラメータは必須ではありません。</block>
  <block id="5a11994cffaa4d0a9c8594d2223e3e96" category="section-title">Solaris UFSのマウントオプション</block>
  <block id="130c5ffb786e38c2e6648fd53593681a" category="paragraph">NetAppでは、ロギングマウントオプションを使用して、SolarisホストがクラッシュしたりFC接続が中断したりした場合にデータの整合性が維持されるようにすることを強く推奨しています。ロギングマウントオプションを使用すると、Snapshotバックアップのユーザビリティも維持されます。</block>
  <block id="516f7006de2e9b1f7f871d961db4a1ca" category="section-title">Solaris ZFS</block>
  <block id="a92c2c52c7360246c6da2b1169e0fa50" category="paragraph">最適なパフォーマンスを実現するには、Solaris ZFSをインストールして慎重に設定する必要があります。</block>
  <block id="c9208a3ad95d5ce3d9e2ba1839426251" category="section-title">mvector</block>
  <block id="c54b9977f43cf2f9a1aa7cb0de8fec22" category="paragraph">Solaris 11では、大規模なI/O処理の処理方法が変更され、SANストレージアレイのパフォーマンスに重大な問題が発生する可能性がありました。この問題の詳細については、NetAppバグレポート630173「Solaris 11 ZFSパフォーマンスの回帰」を参照してください。"The解決策is to change a OS parameter called<block ref="954f82599f7db0212a28fd448e03bdf3" prefix=" " category="inline-code"></block>。</block>
  <block id="17e692fa261653b11634297d15070637" category="paragraph">rootとして次のコマンドを実行します。</block>
  <block id="bc7e9b3c34345bf9ebe88467d6714f1b" category="paragraph">この変更によって予期しない問題が発生した場合は、次のコマンドをrootとして実行することで簡単に元に戻すことができます。</block>
  <block id="6ff9f4444ac481652f4412b5e1623846" category="section-title">カーネル</block>
  <block id="78d06f587305b9e5481c8cf660693a61" category="paragraph">信頼性の高いZFSパフォーマンスを実現するには、LUNのアライメントの問題に対してSolarisカーネルにパッチを適用する必要があります。この修正は、Solaris 10のパッチ147440-19とSolaris 11のSRU 10.5で導入されました。ZFSではSolaris 10以降のみを使用してください。</block>
  <block id="db8880d80ab20f2f01a010e5c454f7fb" category="section-title">LUN構成</block>
  <block id="3b296d65c0c37979abe39ac7f6d8e1d8" category="paragraph">LUNを設定するには、次の手順を実行します。</block>
  <block id="3bdc2a5622b76404f8b0ce2fc774e69a" category="list-text">タイプがのLUNを作成します。<block ref="7bee0477f82303aa43de5d78f7b9cb05" prefix=" " category="inline-code"></block>。</block>
  <block id="c06f6c6685c06bb821295b3a6d5e580c" category="list-text">で指定された適切なHost Utility Kit（HUK）をインストールします。 <block ref="b5b16f3cdb0eb25a282348ba54f8c677" category="inline-link-macro-rx"></block>。</block>
  <block id="33db73c9b3936cb8eaae825d3101f60c" category="inline-link-macro">最新のドキュメント</block>
  <block id="c8646086dca29c1d978ab285faa93709" category="list-text">HUKに記載されている手順に正確に従ってください。基本的な手順は以下のとおりですが、 <block ref="33574dfffc2cb6d01be0edb6738c51bb" category="inline-link-macro-rx"></block> を参照してください手順。</block>
  <block id="6c06455cad171d61eac3593147bd71d6" category="list-text">を実行します<block ref="3062dc928daa4d85f6e34b6dea110a00" prefix=" " category="inline-code"></block> を更新するユーティリティ<block ref="d5416d340f5bec1fcb3addb6ae7d059e" prefix=" " category="inline-code"></block> ファイル。これにより、SCSIドライブがONTAP LUNを正しく検出できるようになります。</block>
  <block id="7ec6668202fa9a677238143b0445102f" category="list-text">の指示に従ってください。<block ref="3062dc928daa4d85f6e34b6dea110a00" prefix=" " category="inline-code"></block> Multipath Input/Output（MPIO；マルチパス入出力）を有効にするユーティリティ。</block>
  <block id="b53abe6c0013125abea171427b351ccc" category="list-text">リブートします。この手順は、システム全体で変更が認識されるようにするために必要です。</block>
  <block id="b88caedbe9708683eed783eb534ae5f6" category="list-text">LUNをパーティショニングし、適切にアライメントされていることを確認します。アライメントを直接テストして確認する方法については、「付録B：WAFLアライメントの検証」を参照してください。</block>
  <block id="a0c1c26e783204cf713b2e1f0823aab3" category="section-title">zpools</block>
  <block id="c81b8fe4a368c32102406e65fc41a227" category="inline-link-macro">LUNの設定</block>
  <block id="c49c7ca1707a6d27b04d804b2b5dfeb3" category="paragraph">zpoolは、の手順を実行したあとに作成する必要があります。 <block ref="255d6439b7182d422c7625a86084578a" category="inline-link-macro-rx"></block> が実行されます。手順を正しく実行しないと、I/Oのアライメントが原因でパフォーマンスが大幅に低下する可能性があります。ONTAPのパフォーマンスを最適化するには、I/Oがドライブの4Kの境界にアライメントされている必要があります。zpoolに作成されるファイルシステムは、というパラメータで制御される実効ブロックサイズを使用します。<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block>（コマンドを実行すると表示できます）<block ref="1615297782a0dff59b20451e2ca97ea7" prefix=" " category="inline-code"></block>。</block>
  <block id="869dc3a8daf591c7f33e5bb32a4a63c9" category="paragraph">の値<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> デフォルトは9です。これは2^9、つまり512バイトを意味します。最適なパフォーマンスを実現するには、<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 値は12（2^12=4K）である必要があります。この値はzpoolの作成時に設定され、変更することはできません。つまり、<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 12以外の場合は、新しく作成したzpoolにデータをコピーして移行する必要があります。</block>
  <block id="6a00a2262e030c2656588743cb031710" category="paragraph">zpoolを作成したら、の値を確認します。<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 次に進む前に、値が12以外の場合は、LUNが正しく検出されていません。zpoolを削除し、関連するHost Utilitiesのドキュメントに記載された手順をすべて正しく実行したことを確認してから、zpoolを再作成します。</block>
  <block id="15ec722ce3f6694d12f89aeb5b621941" category="section-title">zpoolとSolaris LDOM</block>
  <block id="8826ef54a7d108df25ed6921b5129cb6" category="paragraph">Solaris LDOMには、I/Oアライメントが正しいことを確認するための追加の要件があります。LUNは4Kデバイスとして適切に検出されますが、LDOM上の仮想vdskデバイスはI/Oドメインの設定を継承しません。このLUNに基づくvdskは、デフォルトで512バイトブロックに戻ります。</block>
  <block id="9a984f24f825e4f0bca1f36e11acbca9" category="paragraph">追加の構成ファイルが必要です。まず、追加の設定オプションを有効にするために、個 々 のLDOMにOracleのバグ15824910のパッチを適用する必要があります。このパッチは、現在使用されているすべてのバージョンのSolarisに移植されています。LDOMにパッチを適用すると、適切にアライメントされた新しいLUNを設定できるようになります。手順は次のとおりです。</block>
  <block id="e0f306ab540315b015db849b1ae9099e" category="list-text">新しいzpoolで使用するLUNを特定します。この例では、c2d1デバイスです。</block>
  <block id="f469046d419183a7be08ed5a13d2c65e" category="list-text">ZFSプールに使用するデバイスのVDCインスタンスを取得します。</block>
  <block id="bcaa63dcd5db76bffd8b867e8720a272" category="list-text">編集<block ref="ebceeaa7b6ce5abf6c8de7177255fef5" prefix=" " category="inline-code"></block>：</block>
  <block id="ec960a08b4666fe258b6e005064378ab" category="paragraph">つまり、デバイスインスタンス1には4096のブロックサイズが割り当てられます。</block>
  <block id="3df4cdc476a0c3a5a930597e9d8da84c" category="paragraph">追加の例として、vdskインスタンス1~6を4Kブロックサイズに設定する必要があり、<block ref="74a491ed941b00d0c9909d488eee67bf" prefix=" " category="inline-code"></block> 読み取り値は次のとおりです。</block>
  <block id="dfed6d8974f03c5b31f20c9c5c2bbe66" category="list-text">決勝戦<block ref="3328fba80b08b36663ffae0684f6c578" prefix=" " category="inline-code"></block> ファイルには以下が含まれている必要があります</block>
  <block id="764a2caff05993fc0d3eff5de7b225e9" category="cell">注意</block>
  <block id="5c442834a7707cc96719e468c87b2ff6" category="cell">vdc.confを設定してvdskを作成したら、LDOMをリブートする必要があります。この手順は避けられません。ブロックサイズの変更はリブート後にのみ有効になります。zpoolの設定に進み、前述のようにashiftが12に正しく設定されていることを確認します。</block>
  <block id="2138e0b461ac7e557539bb0b33bde81a" category="section-title">ZFSインテントログ（ZIL）</block>
  <block id="5477cebfd480a13008afdd16bea2b3f9" category="paragraph">通常'ZFSインテントログ(ZIL)を別のデバイスに配置する理由はありませんログはメインプールとスペースを共有できます。ZILを別 々 に使用する主な用途は、最新のストレージアレイには書き込みキャッシュ機能がない物理ドライブを使用する場合です。</block>
  <block id="26a004aeb043de19f767bd7daa39cf2f" category="section-title">ロバイアス</block>
  <block id="07fff183bc4c01bf9bbb21a48b389845" category="paragraph">を設定します<block ref="26a004aeb043de19f767bd7daa39cf2f" prefix=" " category="inline-code"></block> OracleデータをホストするZFSファイルシステムのパラメータ。</block>
  <block id="ac01fbc5e98d6450f3b565d0617f4a55" category="paragraph">このパラメータを使用すると、全体的な書き込みレベルが低下します。デフォルトでは、書き込まれたデータはまずZILにコミットされ、次にメインのストレージプールにコミットされます。このアプローチは、SSDベースのZILデバイスとメインストレージプール用の回転式メディアを含む、プレーンドライブ構成を使用する構成に適しています。これは、利用可能な最も低レイテンシのメディア上の単一のI/Oトランザクションでコミットを実行できるためです。</block>
  <block id="c6cc0f147c42f124079d7fc1a0761886" category="paragraph">独自のキャッシュ機能を備えた最新のストレージアレイを使用する場合は、通常、このアプローチは必要ありません。まれに、レイテンシの影響を受けやすい大量のランダム書き込みで構成されるワークロードのように、単一のトランザクションで書き込みをログにコミットした方が望ましい場合があります。ログに記録されたデータは最終的にメインのストレージプールに書き込まれ、書き込みアクティビティが2倍になるため、ライトアンプリフィケーションという結果になります。</block>
  <block id="92b9531657a4ce6a31c623d889a2c55d" category="section-title">ダイレクトI/O</block>
  <block id="387f4a4c250ed7a5003f3f6a19abfd1f" category="paragraph">Oracle製品を含む多くのアプリケーションでは、ダイレクトI/Oを有効にすることでホストのバッファキャッシュをバイパスできます。ZFSファイルシステムでは、この方法は想定どおりに機能しません。ホストのバッファキャッシュはバイパスされますが、ZFS自体はデータのキャッシュを継続します。I/Oがストレージシステムに到達しているかどうか、またはI/OがOS内にローカルにキャッシュされているかどうかを予測することが困難であるため、FIOやSIOなどのツールを使用してパフォーマンステストを実行すると、誤った結果になる可能性があります。また、このような総合的なテストを使用してZFSと他のファイルシステムのパフォーマンスを比較することも非常に困難になります。実際のユーザワークロードでは、ファイルシステムのパフォーマンスにほとんど違いはありません。</block>
  <block id="ec79b30d56e7bae54aa7efedccc47e93" category="section-title">複数のzpool</block>
  <block id="f5aa5b31f0536ddcdb748ae360d91358" category="paragraph">ZFSベースのデータのSnapshotベースのバックアップ、リストア、クローニング、アーカイブは、zpoolレベルで実行する必要があり、通常は複数のzpoolが必要です。zpoolはLVMディスクグループに似ており、同じルールを使用して設定する必要があります。たとえば、データベースのレイアウトには、データファイルが配置されているのが最適です。<block ref="f1fb162e58045170396a0ac29d648fa5" prefix=" " category="inline-code"></block> およびにあるアーカイブログ、制御ファイル、REDOログ<block ref="92073f03d18c8eaec3eb5e0908210e1a" prefix=" " category="inline-code"></block>。このアプローチでは、データベースがホットバックアップモードに設定された標準のホットバックアップに続いて、<block ref="f1fb162e58045170396a0ac29d648fa5" prefix=" " category="inline-code"></block>。次に、データベースがホットバックアップモードから削除され、ログアーカイブが強制的に実行され、<block ref="92073f03d18c8eaec3eb5e0908210e1a" prefix=" " category="inline-code"></block> が作成されます。リストア処理では、zfsファイルシステムをアンマウントし、zpoolを完全にオフラインにしてから、SnapRestoreのリストア処理を実行する必要があります。その後、zpoolをオンラインに戻してデータベースをリカバリできます。</block>
  <block id="f1110589be196c2310808482067fce1b" category="section-title">ファイルシステムオプション</block>
  <block id="c271ff9f255f2d215054d508448781a3" category="paragraph">Oracleパラメータ<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> ZFSでは動作が異なります。状況<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block> または<block ref="6887bae4cda2d09a283a165c5be3f2b8" prefix=" " category="inline-code"></block> を使用します。書き込み処理は同期でOSのバッファキャッシュをバイパスしますが、読み取りはZFSによってバッファされます。この場合、I/OがZFSキャッシュによって代行受信されて処理されることがあるため、ストレージのレイテンシと総I/Oが想定よりも低くなるため、パフォーマンス分析が困難になります。</block>
  <block id="22a7d37643562540ddbda52f511fb1fe" category="summary">HP-UXを使用したONTAP上のOracle</block>
  <block id="b1fd823d262032e04291313f72be9452" category="doc">HP-UX</block>
  <block id="5be7e182308e16aee80978c6a5ebe02b" category="paragraph">HP-UXオペレーティングシステムに固有の構成トピック。</block>
  <block id="8ec258cd0b6ab050fc478a415a20f2e9" category="section-title">HP-UX NFSのマウントオプション</block>
  <block id="7c5876d5737071c64af78562fe375386" category="paragraph">次の表に、単一インスタンスのHP-UX NFSマウントオプションを示します。</block>
  <block id="9c9fb3cc18a83e4e46165b5c3d4ce8ef" category="cell">制御ファイル
データファイル
REDO ログ</block>
  <block id="55b835c747261995c0e1022d234e286d" category="cell"><block ref="fa8766c679857b7d589983df0ab5bcf4" prefix="" category="inline-code"></block></block>
  <block id="189dbd39cabd57c5d2e51714d9a5b85b" category="paragraph">次の表に、RACのHP-UX NFSマウントオプションを示します。</block>
  <block id="fa9da3a6a7ef8986a94c7395577c322f" category="cell"><block ref="8b080dc74532d24847a6163dcc34d93f" prefix="" category="inline-code"></block></block>
  <block id="add42ff64fa5b57e5abeab49d154a9d9" category="cell"><block ref="acdef4af05a9f0c43f72b7c600f04d62" prefix="" category="inline-code"></block></block>
  <block id="c88a7b7f83f761f7fc2979815d210140" category="cell"><block ref="d29d7b7ed8c19a99fe17fd7f3d07ea7b" prefix="" category="inline-code"></block></block>
  <block id="af8831a1b8129b099114c3237a61db88" category="paragraph">シングルインスタンスとRACマウントオプションの主な違いは、<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> および<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> をマウントオプションに移動します。このオプションを使用するとホストOSのキャッシングが無効になるため、データの状態について、RACクラスタ内のすべてのインスタンスが一貫した情報を認識できるようになります。ただし、<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> パラメータ<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> ホストのキャッシングを無効にした場合と同じ効果がありますが、引き続きを使用する必要があります。<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> および<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block>。</block>
  <block id="b865c6aba24c3f61595471aab993d27c" category="paragraph">理由<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 共有の場合は必須です<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> を導入すると、Oracleパスワードファイルやspfileなどのファイルの整合性が維持されます。RACクラスタ内の各インスタンスに専用の<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>、このパラメータは必須ではありません。</block>
  <block id="898311d838a2fa2fa41b4b52a63a7f1d" category="section-title">HP-UX VxFSマウントオプション</block>
  <block id="85b4a3d44370909d395ab8af28ff4927" category="paragraph">Oracleバイナリをホストするファイルシステムには、次のマウントオプションを使用します。</block>
  <block id="6630bbc9a901be0d038b2c39e2faf65d" category="paragraph">データファイル、Redoログ、アーカイブログ、制御ファイルが格納されているファイルシステムで、HP-UXのバージョンが同時I/Oをサポートしていない場合は、次のマウントオプションを使用します。</block>
  <block id="ed37730e0f28a631768a396e7898e197" category="paragraph">同時I/Oがサポートされている場合（VxFS 5.0.1以降、またはServiceGuard Storage Management Suiteを使用している場合）は、データファイル、Redoログ、アーカイブログ、および制御ファイルを格納しているファイルシステムで次のマウントオプションを使用します。</block>
  <block id="f51ddb98d92e83609db075add5fba4d8" category="admonition">パラメータ<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> VxFS環境では特に重要です。Oracleでは、特に指示がないかぎり、Oracle 10g R1以降ではこのパラメータを未設定のままにすることを推奨しています。Oracleの8KBブロックサイズの場合、デフォルトは128です。このパラメータの値が強制的に16以下になる場合は、<block ref="a6b02283cba560dcfdea44af66ec792c" prefix=" " category="inline-code"></block> シーケンシャルI/Oのパフォーマンスが低下する可能性があるため、マウントオプションを使用します。この手順は、パフォーマンスの他の側面に損傷を与えるため、<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> デフォルト値から変更する必要があります。</block>
  <block id="ca3fa25943498edb0ee62d0ea286bb7a" category="summary">LinuxおよびASMlib/ASMフィルタドライバを使用したONTAP上のOracle</block>
  <block id="d7e9c72be485a5a848f1f7cd15a9a5ba" category="doc">ASMlibおよびASMフィルタドライバ</block>
  <block id="5802d9527a43305e9e1c903bc6b5a721" category="paragraph">AFDとASMlibを使用するLinux OSに固有の設定トピック</block>
  <block id="2681013be5b0a9063a7ef0a8fe4d31da" category="section-title">ASMlibブロックサイズ</block>
  <block id="1943673cc25055e93f0129f2baa8f499" category="paragraph">ASMlibは、オプションのASM管理ライブラリおよび関連ユーティリティです。その主な価値は、LUNまたはNFSベースのファイルにASMリソースとして人間が判読可能なラベルを付けることです。</block>
  <block id="51713fdb873939c9c333273947776b8e" category="paragraph">ASMlibの最近のバージョンでは、Logical Blocks Per Physical Block Exponent（LBPPBE）というLUNパラメータが検出されています。最近まで、この値はONTAP SCSIターゲットによって報告されていませんでした。4KBのブロックサイズが推奨されることを示す値が返されるようになりました。これはブロックサイズの定義ではありませんが、LBPPBEを使用するアプリケーションにとって、特定のサイズのI/Oがより効率的に処理される可能性があることを示唆しています。ただし、ASMlibはLBPPBEをブロックサイズとして解釈し、ASMデバイスの作成時にASMヘッダーを永続的にスタンプします。</block>
  <block id="65242d5b49071240043eeef598415104" category="paragraph">このプロセスは、さまざまな方法でアップグレードや移行で原因の問題を引き起こす可能性があります。すべては、同じASMディスクグループにブロックサイズの異なるASMlibデバイスを混在させることができないことが原因です。</block>
  <block id="ea884eec0628302adc731211dc4e2cc7" category="paragraph">たとえば、古いアレイでは通常、LBPPBE値が0と報告されているか、この値がまったく報告されていませんでした。ASMlibはこれを512バイトのブロックサイズと解釈します。新しいアレイは、4KBのブロックサイズと解釈されます。512バイトと4KBのデバイスを同じASMディスクグループに混在させることはできません。これにより、2つのアレイのLUNを使用してASMディスクグループのサイズを拡張したり、ASMを移行ツールとして活用したりすることができなくなります。それ以外の場合、RMANでは、512バイトのブロックサイズのASMディスクグループと4KBのブロックサイズのASMディスクグループの間でファイルを複製できないことがあります。</block>
  <block id="f17ff15b23b87f35906ece98842a080f" category="paragraph">推奨される解決策は、ASMlibにパッチを適用することです。OracleのバグIDは13999609で、パッチはoracleasm-support-2.1.8-1以降に存在します。このパッチを適用すると、ユーザーはパラメータを設定できます。<block ref="442e2026c8afecc4611b52331b5d0d56" prefix=" " category="inline-code"></block> 終了：<block ref="b326b5062b2f0e69046810717534cb09" prefix=" " category="inline-code"></block> を参照してください<block ref="92a59ba9a0643a344be2d72cfd504181" prefix=" " category="inline-code"></block> 構成ファイルこれにより、ASMlibはLBPPBEパラメータを使用できなくなります。つまり、新しいアレイ上のLUNが512バイトのブロックデバイスとして認識されるようになります。</block>
  <block id="f140ff6b2b71e70e551e39dacb9561ef" category="admonition">このオプションを使用しても、以前にASMlibによってスタンプされたLUNのブロックサイズは変更されません。たとえば、ブロック数が512バイトのASMディスクグループを、ブロック数が4KBと報告される新しいストレージシステムに移行する必要がある場合は、オプション<block ref="442e2026c8afecc4611b52331b5d0d56" prefix=" " category="inline-code"></block> 新しいLUNがASMlibでスタンプされる前に設定する必要があります。  デバイスがoracleasmによってすでにスタンプされている場合は、新しいブロックサイズで再スタンプする前に再フォーマットする必要があります。まず、デバイスの設定を解除します。<block ref="41bd8c47b8e640da7bdb5c7dc995d435" prefix=" " category="inline-code"></block>をクリックし、デバイスの最初の1GBを消去します。<block ref="85c2e94baaf4d9c084e19d290907596e" prefix=" " category="inline-code"></block>。最後に、デバイスが以前にパーティション分割されていた場合は、<block ref="9a287d63dabd6fbcbbe1b12344bfe922" prefix=" " category="inline-code"></block> 古いパーティションを削除するか、単にOSを再起動するためのコマンド。</block>
  <block id="75ad83418241561186f96dfed5229aaa" category="paragraph">ASMlibにパッチを適用できない場合は、ASMlibを構成から削除できます。この変更はシステムの停止を伴うため、ASMディスクのスタンプを解除し、<block ref="0802edf7303a95bdecde832bbbe3a89c" prefix=" " category="inline-code"></block> パラメータが正しく設定されている。ただし、この変更ではデータの移行は必要ありません。</block>
  <block id="ad9ac4c6d7ed2e11bdcf8c693658a482" category="section-title">ASMフィルタドライブ（AFD）のブロックサイズ</block>
  <block id="de59cd97a61c9f9964a35d2cd8b05c88" category="paragraph">AFDは、ASMlibに代わるオプションのASM管理ライブラリです。ストレージの観点から見ると、ASMlibはASMlibに非常に似ていますが、Oracle以外のI/Oをブロックして、データが破損する可能性のあるユーザーまたはアプリケーションのエラーの可能性を減らすなどの追加機能が含まれています。</block>
  <block id="36dc27685773851e52f035f82e3deba2" category="section-title">デバイスのブロックサイズ</block>
  <block id="1ef92cf7e561e179d6079cc937b2778a" category="paragraph">ASMlibと同様に、AFDもLUNパラメータLogical Blocks Per Physical Block Exponent（LBPPBE）を読み取り、デフォルトでは論理ブロックサイズではなく物理ブロックサイズを使用します。</block>
  <block id="b95ce6c503801cb15f2f9c0773c58f00" category="paragraph">ASMデバイスがすでに512バイトのブロックデバイスとしてフォーマットされている既存の構成にAFDを追加すると、問題が発生する可能性があります。AFDドライバはLUNを4Kデバイスとして認識し、ASMラベルと物理デバイスの不一致が原因でアクセスできなくなります。同様に、512バイトと4KBのデバイスを同じASMディスクグループに混在させることはできないため、移行も影響を受けます。これにより、2つのアレイのLUNを使用してASMディスクグループのサイズを拡張したり、ASMを移行ツールとして活用したりすることができなくなります。それ以外の場合、RMANでは、512バイトのブロックサイズのASMディスクグループと4KBのブロックサイズのASMディスクグループの間でファイルを複製できないことがあります。</block>
  <block id="7ef45d3a7c5fff234bf42bdf549b8339" category="paragraph">解決策はシンプルです- AFDには、論理ブロックサイズと物理ブロックサイズのどちらを使用するかを制御するパラメータが含まれています。これは、システム上のすべてのデバイスに影響を与えるグローバルパラメータです。AFDで強制的に論理ブロックサイズを使用するには、<block ref="722fc896569f3d455bb5ef8f5b8c3703" prefix=" " category="inline-code"></block> を参照してください<block ref="dcd5fd81543c5e08e927c54e89acdd40" prefix=" " category="inline-code"></block> ファイル。</block>
  <block id="47b0d7fc4c27720c4fc326722edad27c" category="section-title">マルチハステンソウサイス</block>
  <block id="7c329811bcc7bb2f50005da5a3aff250" category="paragraph">最近のLinuxカーネルの変更では、マルチパスデバイスに送信されるI/Oサイズ制限が適用されますが、AFDではこれらの制限が適用されません。その後I/Oが拒否され、LUNパスがオフラインになります。その結果、Oracle Gridのインストール、ASMの設定、データベースの作成ができなくなります。</block>
  <block id="926e4b7a2822a39a07f61474b92e9d8c" category="paragraph">解決策では、ONTAP LUNのmultipath.confファイルに最大転送長を手動で指定します。</block>
  <block id="3d0c741146f1e8e31bc7d07128ca6e0a" category="admonition">現在問題が存在しない場合でも、AFDを使用して将来のLinuxアップグレードで予期せず原因の問題が発生しないようにする場合は、このパラメータを設定する必要があります。</block>
  <block id="72247c591c444399f3d42dffa31b644e" category="summary">AIXを使用したONTAP上のOracle</block>
  <block id="23802d94b756cf69028557bea156ab1a" category="doc">IBM AIX</block>
  <block id="5b8d4d99cdcb494ca636eb065004b165" category="paragraph">IBM AIXオペレーティングシステム固有の構成に関するトピック。</block>
  <block id="d99ae60d37a12f766bc2a1f1c228fb4f" category="section-title">同時I/O</block>
  <block id="0f3eb508f611e203aeffa91d5753648a" category="paragraph">IBM AIXで最適なパフォーマンスを実現するには、同時I/Oを使用する必要があります。AIXはシリアル化されたアトミックなI/Oを実行するため、大量のオーバーヘッドが発生するため、同時I/Oがないとパフォーマンスが制限される可能性があります。</block>
  <block id="ecdc41fc6a2adf7e41e7277e12eeb805" category="paragraph">従来のNetAppでは、<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> マウントオプション：ファイルシステムで強制的に同時I/Oを使用しますが、このプロセスには欠点があるため不要になりました。AIX 5.2とOracle 10gR1が導入されて以降、AIX上のOracleでは、ファイルシステム全体で同時I/Oを強制的に実行するのではなく、個 々 のファイルを開いて同時IOを実行できるようになりました。</block>
  <block id="445b433b62b675f0ca0bda7acb56d41b" category="paragraph">同時I/Oを有効にする最適な方法は、<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> パラメータ<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 終了：<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block>。これにより、Oracleが特定のファイルを開いて同時I/Oで使用できるようになります。</block>
  <block id="6206c23a0282b18352573158f9a8f9b3" category="paragraph">を使用します<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> マウントオプションを指定すると、同時I/Oが強制的に使用されるため、悪影響が生じる可能性があります。たとえば、同時I/Oを強制するとファイルシステムの先読みが無効になり、Oracleデータベースソフトウェアの外部で発生するI/O（ファイルのコピーやテープバックアップの実行など）のパフォーマンスが低下する可能性があります。さらに、Oracle GoldenGateやSAP BR * Toolsなどの製品は、<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 特定のバージョンのOracleでのマウントオプション。</block>
  <block id="770cb9a1e9321ca3012ecbb9ec65c422" category="list-text">を使用しないでください<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> ファイルシステムレベルのマウントオプション。代わりに、を使用して同時I/Oを有効にします。<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block>。</block>
  <block id="872080b7d5ec5585776f1426fb157842" category="list-text">使用するのは、<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> マウントオプションは次のように設定できない場合に実行します：<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block>。</block>
  <block id="0c5d86482201f32acb30cd2f7de3048f" category="section-title">AIX NFSのマウントオプション</block>
  <block id="1ce07cafb2507c98c8b96ad5f35fb66a" category="paragraph">次の表に、OracleシングルインスタンスデータベースのAIX NFSマウントオプションを示します。</block>
  <block id="9a8f040dae3f0f15b337fe69a85239c0" category="cell"><block ref="86d38d6e2b36f6557e583e005e23d258" prefix="" category="inline-code"></block></block>
  <block id="d45a1a2afa30c30042b28f028fe75953" category="cell"><block ref="915be14765d6133923d803e1221f1513" prefix="" category="inline-code"></block></block>
  <block id="b74f5956b4bcda2de3c82ee97e192ab6" category="paragraph">次の表に、RACのAIX NFSマウントオプションを示します。</block>
  <block id="b547b55ba7f2a20602494777c5426eba" category="cell"><block ref="7e879bda961bd5b7d64d2ef4f5fb7869" prefix="" category="inline-code"></block></block>
  <block id="875abb256654bd3f6da7abcb1bd92f27" category="cell"><block ref="f93eecf9c582d76d4e14292dc34c79f8" prefix="" category="inline-code"></block></block>
  <block id="3ed8fb68917b28af138fb74ccde62e80" category="cell"><block ref="415e8eb8b9fc05cb48e633d31fd04944" prefix="" category="inline-code"></block></block>
  <block id="8102775fe4080f632332ab8d3312311a" category="paragraph">シングルインスタンスとRACマウントオプションの主な違いは、<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> をマウントオプションに移動します。このオプションを使用するとホストOSのキャッシングが無効になるため、データの状態について、RACクラスタ内のすべてのインスタンスが一貫した情報を認識できるようになります。</block>
  <block id="1e3f10dfa324520cb7261c0da5bf6ec7" category="paragraph">ただし、<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> マウントオプションと<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> パラメータ<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> ホストのキャッシングを無効にした場合と同じ効果がありますが、引き続きを使用する必要があります。<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block>。<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 共有の場合は必須です<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> OracleパスワードファイルやOracleパスワードファイルなどのファイルの整合性を維持するための導入<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> パラメータファイル。RACクラスタ内の各インスタンスに専用の<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>の場合、このパラメータは必要ありません。</block>
  <block id="5365dd1a92461c9e6cf65017c4a11647" category="section-title">AIX JFS / JFS2のマウントオプション</block>
  <block id="d7a578263480a2003f05c459a8961298" category="paragraph">次の表に、AIX JFS / JFS2のマウントオプションを示します。</block>
  <block id="0aabf727ab0a83c5f5d078e8b18445e0" category="cell">デフォルト値です</block>
  <block id="e1f651debac4f720c13ae930ff3ca14a" category="cell">ORACLE_HOME を参照してください</block>
  <block id="27a7ffa293f5a4d2a5bb54354486dece" category="paragraph">AIXを使用する前に<block ref="b7cc91287fc99a8937a55e79376c6f54" prefix=" " category="inline-code"></block> データベースを含むあらゆる環境のデバイスで、パラメータをチェックします。<block ref="9d51746070ef554ad4e93a16de4aed0f" prefix=" " category="inline-code"></block>。このパラメータはHBAのキュー深度ではなく、個 々 ののSCSIキュー深度に関連します。<block ref="66ad66c6ace8456eae4ca6807552e54b" prefix=" " category="inline-code"></block> パフォーマンスを向上させるには低すぎる可能性があります。テストでは、最適値は64であることが示されています。</block>
  <block id="6e1dee25b21d0005970053df9e9384ba" category="summary">Microsoft Windowsを使用したONTAP上のOracle</block>
  <block id="bb79f96acbff544ded541446c9c7c894" category="doc">Microsoft Windows の場合</block>
  <block id="44959b8c12de9e1107621ee8c0337463" category="paragraph">Microsoft Windows OSに固有の構成に関するトピック。</block>
  <block id="14ce2582c2080a7f08fe9249f6565f40" category="paragraph">Oracleでは、Direct NFSクライアントでのMicrosoft Windowsの使用がサポートされています。この機能は、複数の環境にわたるファイルの表示、ボリュームの動的なサイズ変更、安価なIPプロトコルの活用など、NFSの管理上のメリットをもたらします。DNFSを使用してMicrosoft Windowsにデータベースをインストールおよび設定する方法については、Oracleの公式ドキュメントを参照してください。特別なベストプラクティスはありません。</block>
  <block id="f854b764258138b512f30be71e1c7908" category="paragraph">圧縮効率を最適化するには、NTFSファイルシステムで8K以上の割り当て単位を使用するようにしてください。一般にデフォルトである4Kの割り当て単位を使用すると、圧縮効率が低下します。</block>
  <block id="140def8362bd2cf6a999328e25572cfd" category="summary">Linuxを使用したONTAP上のOracle</block>
  <block id="edc9f0a5a5d57797bf68e37364743831" category="doc">Linux の場合</block>
  <block id="dfc95ed5e895617bbd0d4b1a8bfba8ca" category="paragraph">Linux OSに固有の設定に関するトピック。</block>
  <block id="5ecd4a6f4aedfdd45cce80a18b1a7942" category="section-title">スロットテーブル</block>
  <block id="2518e65e64213437c921c39a097db167" category="section-title">Linux NFSのマウントオプション</block>
  <block id="29cd2e6d4fc96e749c4a0e622cad7f50" category="paragraph">次の表に、単一インスタンスのLinux NFSのマウントオプションを示します。</block>
  <block id="9fafd031075cede0e8a5a796ec45fbff" category="paragraph">次の表に、RACのLinux NFSマウントオプションを示します。</block>
  <block id="f16135915fe2ca5c3b0d660acc0325d3" category="cell"><block ref="4c927b3193f1cd00c7cfd3ac2e7ba8ea" prefix="" category="inline-code"></block></block>
  <block id="fc1ea13514277ff14dc705f62c31c0fc" category="cell"><block ref="4d0511346ac74044d79c9bc297d59b09" prefix="" category="inline-code"></block></block>
  <block id="13c64659680c0bc3603209997cc22225" category="cell">CRS /投票</block>
  <block id="672c5eef2603018159295408f761324b" category="cell"><block ref="26b20bdf0b0e7d3ddef3749a70c17932" prefix="" category="inline-code"></block></block>
  <block id="f7085c7dc406f5b44813ac43c18b80c0" category="paragraph">シングルインスタンスとRACマウントオプションの主な違いは、<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> をマウントオプションに移動します。このオプションを使用するとホストOSのキャッシングが無効になるため、データの状態について、RACクラスタ内のすべてのインスタンスが一貫した情報を認識できるようになります。ただし、<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> パラメータ<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> ホストのキャッシングを無効にした場合と同じ効果がありますが、引き続きを使用する必要があります。<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block>。</block>
  <block id="d2537738f34705bc9d100925252c0102" category="paragraph">理由<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 共有の場合は必須です<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> を導入すると、Oracleパスワードファイルやspfileなどのファイルの整合性が維持されます。RACクラスタ内の各インスタンスに専用の<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>の場合、このパラメータは必要ありません。</block>
  <block id="5084019c1051a9937b5ff77568ce579b" category="paragraph">一般に、データベース以外のファイルは、シングルインスタンスのデータファイルと同じオプションを使用してマウントします。ただしアプリケーションによっては要件が異なる場合があります。マウントオプションを使用しない<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> および<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> これらのオプションは、ファイルシステムレベルの先読みとバッファリングを無効にするため、可能であれば可能です。これにより、原因抽出、変換、ロードなどのプロセスで重大なパフォーマンスの問題が発生する可能性があります。</block>
  <block id="243de27c01fea05cc58186d2e5ad1ce5" category="section-title">ACCESSとGETATTR</block>
  <block id="59dcf78e97c197a0f240067da57a248f" category="paragraph">一部のお客様は、ACCESSやGETATTRなどのIOPSがワークロードを占有する可能性が非常に高いことを指摘しています。極端なケースでは、読み取りや書き込みなどの処理が全体の10%にまで低下することがあります。これは、を含むデータベースでは正常に動作します。<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> および / または<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> Linuxの場合：これらのオプションは、Linux OSを原因して、ストレージシステムからファイルメタデータを定期的にリロードします。ACCESSやGETATTRなどの処理は影響力の低い処理で、データベース環境ではONTAPキャッシュから処理されます。読み取りや書き込みなど、ストレージシステムに真の需要を生み出す純粋なIOPSとみなすべきではありません。ただし、特にRAC環境では、これらのIOPSにはある程度の負荷がかかります。この状況に対処するには、DNFSを有効にして、OSのバッファキャッシュをバイパスし、不要なメタデータ処理を回避します。</block>
  <block id="041f371e212c70407e145ae9f752a8b4" category="section-title">Linux Direct NFS</block>
  <block id="dd2f3f344f14ae5daf12cb0a817a72e0" category="paragraph">もう1つのマウントオプション（<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block>は、（a）DNFSが有効で、（b）1つのソースボリュームが1つのサーバ（c）に複数回マウントされ、NFSマウントがネストされている場合に必要です。この構成は、主にSAPアプリケーションをサポートしている環境で見られます。たとえば、NetAppシステム上の1つのボリュームに、次の場所にディレクトリを配置できます。<block ref="9f9f4ccb1fc3afcbfe0cc3f5eac4332c" prefix=" " category="inline-code"></block> 1秒前に<block ref="ac2f9bbcd397d8f6b39e6713658051ea" prefix=" " category="inline-code"></block>。状況<block ref="9f9f4ccb1fc3afcbfe0cc3f5eac4332c" prefix=" " category="inline-code"></block> はにマウントされます。<block ref="9ad16912cc0ba54a259b1a15d233c264" prefix=" " category="inline-code"></block> および<block ref="ac2f9bbcd397d8f6b39e6713658051ea" prefix=" " category="inline-code"></block> はにマウントされます。<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>を指定すると、同じソースからのNFSマウントがネストされます。</block>
  <block id="b06ff38483faff2d17d8de1fc966848e" category="paragraph">OSは、次の事実を検出できます。<block ref="9ad16912cc0ba54a259b1a15d233c264" prefix=" " category="inline-code"></block> および<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block> 同じボリューム（同じソースファイルシステム）に配置します。その後、OSは同じデバイスハンドルを使用してデータにアクセスします。これにより、OSキャッシングなどの特定の処理の使用が改善されますが、DNFSの妨げになります。DNFSが次のようなファイルにアクセスする必要がある場合<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block>、オン<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>は、誤ってデータへの間違ったパスを使用しようとする可能性があります。その結果、I/O処理が失敗します。これらの構成では、<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block> マウントオプションは、ソースFlexVolボリュームをそのホスト上の別のNFSファイルシステムと共有する任意のNFSファイルシステムに適用されます。これにより、Linux OSはそのファイルシステムに独立したデバイスハンドルを割り当てるようになります。</block>
  <block id="14dd7af30f62ec838445a1e167d2aff6" category="section-title">Linux Direct NFSとOracle RAC</block>
  <block id="c6a209e4ad702c6424efb7d63d76feca" category="paragraph">Linux OS上のOracle RACでは、ノード間の一貫性を維持するためにRACで必要となるダイレクトI/Oを強制的に実行する方法がLinuxにないため、DNFSを使用するとパフォーマンスが特別に向上します。Linuxを回避策として使用するには、<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> マウントオプション。OSキャッシュからファイルデータがただちに期限切れになります。このオプションを使用すると、Linux NFSクライアントは属性データを定期的に再読み取りするため、レイテンシが低下し、ストレージコントローラの負荷が増加します。</block>
  <block id="3070cb366c38db327b0cf057d63792c1" category="paragraph">DNFSを有効にすると、ホストNFSクライアントがバイパスされ、この被害を回避できます。DNFSを有効にしたところ、RACクラスタのパフォーマンスが大幅に向上し、（特に他のIOPSに関して）ONTAPの負荷が大幅に減少したという報告が複数のお客様から寄せられています。</block>
  <block id="e97ab7f94d503bbec4b013b5b77118c6" category="section-title">Linux Direct NFSとoranfstabファイル</block>
  <block id="f63255b70940d25581e0cf5f81dd6cd6" category="paragraph">マルチパスオプションを指定してLinuxでDNFSを使用する場合は、複数のサブネットを使用する必要があります。他のOSでは、を使用して複数のDNFSチャネルを確立できます。<block ref="54b4c4075463b2e02cd69f5cd139b5b2" prefix=" " category="inline-code"></block> および<block ref="bbf52a1a57a4eaa83512cab68fd52b70" prefix=" " category="inline-code"></block> 単一のサブネット上に複数のDNFSチャネルを設定するためのオプション。ただし、これはLinuxでは正しく機能せず、予期しないパフォーマンスの問題が発生する可能性があります。Linuxでは、DNFSトラフィックに使用するNICをそれぞれ別 々 のサブネットに配置する必要があります。</block>
  <block id="6c5cf31ca1af553b1f4a9b99e3cb054c" category="section-title">I/Oスケジューラ</block>
  <block id="49bb1f5f4810e5f3d32dac84bd96005d" category="paragraph">Linuxカーネルでは、ブロックデバイスへのI/Oのスケジュール方法を低レベルで制御できます。デフォルト値はLinuxのディストリビューションによって大きく異なります。テストでは、通常はDeadlineが最良の結果を提供することが示されていますが、場合によってはNOOPがわずかに改善されています。パフォーマンスの違いはごくわずかですが、データベース構成から最大限のパフォーマンスを引き出す必要がある場合は、両方のオプションをテストしてください。CFQは多くの構成でデフォルトであり、データベースワークロードのパフォーマンスに重大な問題があることが実証されています。</block>
  <block id="38f25b8840d56fc601af1024115764b2" category="paragraph">I/Oスケジューラの設定手順については、該当するLinuxベンダーのドキュメントを参照してください。</block>
  <block id="4150162ad42bffea7bb903b4c7a4ffd9" category="section-title">マルチパス</block>
  <block id="305482bf1c318f0a9a04f94987db06b2" category="paragraph">一部のお客様では、マルチパスデーモンがシステムで実行されていなかったために、ネットワーク停止中にクラッシュが発生しました。最近のバージョンのLinuxでは、OSとマルチパスデーモンのインストールプロセスによって、これらのOSがこの問題に対して脆弱なままになる可能性があります。パッケージは正しくインストールされていますが、再起動後の自動起動が設定されていません。</block>
  <block id="6fb0bf499bef576f56e0fd6360eba0a6" category="paragraph">たとえば、RHEL5.5のマルチパスデーモンのデフォルトは次のようになります。</block>
  <block id="31026ba0b77cbe4c9d44ed6afc859ed6" category="paragraph">これを修正するには、次のコマンドを使用します。</block>
  <block id="c759a9b7e4db09da8a25fb73d256f6b7" category="section-title">ASMミラーリング</block>
  <block id="f2f41836b42c08199948378b4a4a6e26" category="paragraph">ASM ミラーリングでは、 ASM が問題を認識して代替の障害グループに切り替えるために、 Linux マルチパス設定の変更が必要になる場合があります。ONTAP 上のほとんどの ASM 構成では、外部冗長性が使用されます。つまり、データ保護は外部アレイによって提供され、 ASM はデータをミラーリングしません。一部のサイトでは、通常の冗長性を備えた ASM を使用して、通常は異なるサイト間で双方向ミラーリングを提供しています。</block>
  <block id="25f47751ccd5df99e3c25a8eb2a21fc5" category="inline-link-macro">NetApp Host Utilitiesのマニュアル</block>
  <block id="066a79b72a430b074cdc0476b67bbde3" category="paragraph">に表示されるLinux設定 <block ref="210658f6fe0d0061c73c19a9a6b263d1" category="inline-link-macro-rx"></block> I/Oが無期限にキューイングされるマルチパスパラメータを指定します。つまり、アクティブなパスがないLUNデバイス上のI/Oは、I/Oが完了するまで待機します。これは、SANパスの変更が完了するまで、FCスイッチがリブートするまで、またはストレージシステムがフェイルオーバーを完了するまで、Linuxホストが必要な時間だけ待機するために、通常は推奨されます。</block>
  <block id="184ea23c04f24d03fc0123bc6eb30de2" category="paragraph">この無制限のキューイング動作により、ASMミラーリングで問題が発生します。ASMは、代替LUNでI/Oを再試行するためにI/O障害を受信する必要があるためです。</block>
  <block id="5616945ee545765b51d3fe1871cff4ec" category="paragraph">Linuxで次のパラメータを設定します。<block ref="9ac80d53ede05256c28cf9e043eb423c" prefix=" " category="inline-code"></block> ASMミラーリングで使用されるASM LUNのファイル：</block>
  <block id="49af3bbe0c557480960d217b217502ff" category="paragraph">これらの設定により、ASMデバイスに120秒のタイムアウトが作成されます。タイムアウトは、<block ref="e2f0125c5971e1ce714f86f145386ee3" prefix=" " category="inline-code"></block> *<block ref="9434de34302b4f40887a7277cf35a8fc" prefix=" " category="inline-code"></block> 秒として。状況によっては正確な値の調整が必要になる場合がありますが、ほとんどの場合は120秒のタイムアウトで十分です。具体的には、コントローラのテイクオーバーまたはギブバックが120秒以内に実行され、I/Oエラーが発生しないようにしてください。この場合、障害グループはオフラインになります。</block>
  <block id="dbff1dc161f3f1d61258259b3a0b549c" category="paragraph">A下限<block ref="9434de34302b4f40887a7277cf35a8fc" prefix=" " category="inline-code"></block> この値を指定すると、ASMが代替障害グループに切り替えるのに必要な時間を短縮できますが、これにより、コントローラのテイクオーバーなどのメンテナンス作業中に不要なフェイルオーバーが発生するリスクも高まります。ASMミラーリングの状態を注意深く監視することで、このリスクを軽減できます。不要なフェイルオーバーが発生した場合、再同期が比較的短時間で実行されると、ミラーを迅速に再同期できます。追加情報については、使用しているOracleソフトウェアのバージョンに対応するASM高速ミラー再同期に関するOracleのマニュアルを参照してください。</block>
  <block id="ec0b68df6b5a0fdd6d73ac710b9684da" category="section-title">Linuxのxfs、ext3、ext4のマウントオプション</block>
  <block id="278230e4238d02fcb49850454e7d79e0" category="admonition">* NetAppでは*デフォルトのマウントオプションを使用することを推奨しています。</block>
  <block id="17361a1d111a3ff3a45b20c3a1efa11b" category="summary">OracleおよびTCP/IPおよびイーサネット構成。</block>
  <block id="fe586387f0871fa578f77ac2e26e624a" category="doc">Oracleデータベース用のTCP/IPおよびイーサネット構成</block>
  <block id="02a5a4d50c5112bb31ff9c94f5b47ce9" category="paragraph">Oracle on ONTAPをご利用のお客様の多くは、NFS、iSCSI、NVMe/TCPのネットワークプロトコルであるイーサネットを使用しており、特にクラウドを使用しています。</block>
  <block id="8a1870adbe8a237106c32d72660a9c42" category="summary">Oracleデータベース向けの論理インターフェイス設計</block>
  <block id="f46a94d438563c03413adfec27c6bfda" category="paragraph">Oracleデータベースにはストレージへのアクセスが必要です。Logical Interface（LIF；論理インターフェイス）は、Storage Virtual Machine（SVM）をネットワークに接続し、さらにデータベースに接続するネットワーク配管です。各データベースワークロードに十分な帯域幅を確保し、フェイルオーバーによってストレージサービスが失われないようにするには、LIFを適切に設計する必要があります。</block>
  <block id="f445528d334d486a14570735705e2223" category="summary">Oracleデータベース用のFCネットワーク構成</block>
  <block id="ee955933387c00b282dcfda69005517f" category="doc">Oracle向けのFCの設定</block>
  <block id="92cdde4ecc529b9f9379ed2bdb6aae34" category="paragraph">Oracleデータベース用にFC SANを構成する主な目的は、日常的なSANのベストプラクティスに従うことです。</block>
  <block id="953369199e3a71ad1ad58bc7d5ad2d9f" category="summary">NetApp ONTAPは、瞬時のバックアップ、リストア、クローニングなどの機能、インライン圧縮、ハードウェアの無停止アップグレードなどの効率化機能、外部ストレージアレイからのLUNインポート機能など、あらゆる機能を標準搭載した強力なデータ管理プラットフォームです。</block>
  <block id="9eaca569c6f5ca3388f5613da3aa008c" category="doc">ONTAP上のOracleデータベース</block>
  <block id="528b35962f1679204260ddef6800eece" category="paragraph">ONTAPはOracleデータベース向けに設計されています。ONTAPは数十年にわたり、リレーショナルデータベースI/O固有の要求に合わせて最適化されてきました。また、Oracleデータベースのニーズに対応するために、さらにはOracle Inc自体の要求にも対応するために、複数のONTAP機能が開発されました。</block>
  <block id="c9f8ef2db64ce19b15d2cc98fbd3d24c" category="admonition">本ドキュメントは、これまでに公開されていたテクニカルレポート_TR-3633：『Oracle databases on ONTAP』、TR-4591：『Oracle data protection：Backup、recovery、replication』、TR-4592：『Oracle on MetroCluster』、TR-4534：『Migration of Oracle Databases to NetApp Storage Systems_</block>
  <block id="b42ad0517ef7394f97178fb9e1de8d78" category="paragraph">ONTAPがデータベース環境にもたらすさまざまな価値に加えて、データベースのサイズ、パフォーマンス要件、データ保護のニーズなど、ユーザのさまざまな要件もあります。NetAppストレージの既知の導入には、VMware ESXで実行される約6、000個のデータベースの仮想環境から、現在996TBのシングルインスタンスデータウェアハウスまで、あらゆるものが含まれます。そのため、NetAppストレージ上にOracleデータベースを設定する際の明確なベストプラクティスはほとんどありません。</block>
  <block id="7bf0493f27e81fe4c3740e773e137a48" category="paragraph">NetAppストレージでOracleデータベースを運用するための要件には、2つの方法があります。まず、明確なベストプラクティスが存在する場合は、具体的に説明します。大まかに、Oracleストレージソリューションの設計者が、それぞれのビジネス要件に基づいて対処しなければならない、設計上のさまざまな考慮事項について説明します。</block>
  <block id="633d94718c25247da5772ed6f2b244c9" category="summary">Oracleストレージ移行の概要</block>
  <block id="6ca08c212e9ec987ce485fd9c7705eff" category="doc">NetAppストレージシステムへのOracleデータベースの移行</block>
  <block id="9e099143017b5d9ff9c117de4ac659d7" category="paragraph">新しいストレージプラットフォームの機能を活用するには、必ず新しいストレージシステムにデータを配置する必要があるという、避けられない要件が1つあります。</block>
  <block id="08beeb11d62fd51ef2742eae3ee3719f" category="admonition">以前に公開されていたテクニカルレポート_TR-4534：『Migration of Oracle Databases to NetApp Storage Systems_</block>
  <block id="5f2a4190824fd64be3c8cabeb7dc62ff" category="paragraph">新しいデータベースプロジェクトの場合、データベースとアプリケーション環境が適切に構築されているため、これは問題になりません。ただし、移行には、ビジネスの中断、移行の完了に必要な時間、必要なスキルセット、リスクの最小化という特別な課題が伴います。</block>
  <block id="a83f1ca5ad00b39773d9e6a26b0e70b2" category="section-title">スクリプト</block>
  <block id="08293bec81c296b61f4a751175d9caa7" category="paragraph">このドキュメントには、サンプルスクリプトが記載されています。これらのスクリプトは、ユーザによるミスの可能性を減らすために、移行のさまざまな側面を自動化するサンプル方法を提供します。スクリプトを使用すると、移行を担当するITスタッフの全体的な要求を軽減し、プロセス全体をスピードアップできます。これらのスクリプトはすべて、NetAppプロフェッショナルサービスとNetAppパートナーが実施した実際の移行プロジェクトを基に作成されています。このドキュメント全体で使用例が示されています。</block>
  <block id="b3978e376e381abd116a2ae7938d8a9c" category="summary">FLIカットオーバー- Oracle</block>
  <block id="c28b52826242c7cdffe5f3ae1e917f61" category="paragraph">FCネットワーク設定を変更する必要があるため、Foreign LUN Importの実行中にシステムが一部停止することは避けられません。ただし、システム停止は、データベース環境を再起動してFCゾーニングを更新し、ホストのFC接続を外部LUNからONTAPに切り替えるために必要な時間よりもはるかに長く続く必要はありません。</block>
  <block id="a2248459756ffc1877beb9b39c77668b" category="paragraph">このプロセスは次のように要約できます。</block>
  <block id="c9f77905e39abbada6c73a7a3d5f51f8" category="list-text">外部LUN上のすべてのLUNアクティビティを休止します。</block>
  <block id="cff6e7c6c4f8dd7e57a0286f28712c58" category="list-text">ホストのFC接続を新しいONTAPシステムにリダイレクトします。</block>
  <block id="9fea842823b73e1eb32307ab325f170e" category="list-text">インポートプロセスをトリガーします。</block>
  <block id="df814ea2bf92d4f18e72a648e93103a2" category="list-text">LUNを再検出します。</block>
  <block id="030a5009bbe6fb141ca5863ab6c59464" category="list-text">データベースを再起動します。</block>
  <block id="f3bb22d18791c042e889671ad1963239" category="paragraph">移行プロセスが完了するまで待つ必要はありません。特定のLUNの移行を開始すると、そのLUNをONTAPで使用できるようになり、データコピープロセスを続行しながらデータを提供できます。すべての読み取りが外部LUNに渡され、すべての書き込みが両方のアレイに同期的に書き込まれます。コピー処理は非常に高速で、FCトラフィックのリダイレクトによるオーバーヘッドも最小限であるため、パフォーマンスへの影響は一時的で最小限に抑えてください。懸念事項がある場合は、移行プロセスが完了してインポート関係が削除されるまで、環境の再起動を遅らせることができます。</block>
  <block id="b19e17ab765f91aa0bc0e7152f13779f" category="section-title">データベースをシャットダウン</block>
  <block id="2869cd69e0fec20ba28a42e74afef158" category="paragraph">この例の環境を休止する最初の手順は、データベースをシャットダウンすることです。</block>
  <block id="e20dab0880a91f5da2ea05170177576d" category="section-title">グリッドサービスをシャットダウン</block>
  <block id="89c458e5176d6caf0690f1e61ecb0620" category="paragraph">移行するSANベースのファイルシステムの1つには、Oracle ASMサービスも含まれています。基盤となるLUNを休止するには、ファイルシステムをディスマウントする必要があります。つまり、このファイルシステム上で開いているファイルを含むプロセスをすべて停止する必要があります。</block>
  <block id="49f05bf7da4eacfa4c80bb987443eb5a" category="section-title">ファイルシステムのディスマウント</block>
  <block id="c5a09ac3ff0bb25c97951c7b7f815cd0" category="paragraph">すべてのプロセスがシャットダウンされると、アンマウント処理は成功します。権限が拒否された場合は、ファイルシステムがロックされているプロセスが存在する必要があります。。<block ref="ace112f9725b6fa0b702e6b3970b2102" prefix=" " category="inline-code"></block> コマンドは、これらのプロセスを識別するのに役立ちます。</block>
  <block id="765e13ffc3361a9fd6c6088b2603ffbf" category="section-title">ボリュームグループの非アクティブ化</block>
  <block id="907e5f35f70dc2f5e4b67da56381bdf4" category="paragraph">特定のボリュームグループ内のすべてのファイルシステムがディスマウントされたら、そのボリュームグループを非アクティブ化できます。</block>
  <block id="ad80f935ccd133a802189e3c2f4421d7" category="section-title">FCネットワークの変更</block>
  <block id="a497da6790d9ab4bb5cce3d04b0efd2e" category="paragraph">FCゾーンを更新して、ホストから外部アレイへのすべてのアクセスを削除し、ONTAPへのアクセスを確立できるようになりました。</block>
  <block id="3ef31115a10790468ad841ec2cdf566f" category="section-title">インポートプロセスの開始</block>
  <block id="5bc309ef1913ddc70534a0a7135ba938" category="paragraph">LUNインポートプロセスを開始するには、<block ref="76ffc50817aa4cd6214aa0061339fdf6" prefix=" " category="inline-code"></block> コマンドを実行します</block>
  <block id="0a10f1ad4a0b45d384c5771ec0906c4c" category="section-title">インポートの進捗状況の監視</block>
  <block id="9a3a7545f4a7407ec022c4b2271e0c34" category="paragraph">インポート操作を監視するには、<block ref="1ab15ef2c245a4434fcea3cc3149f4f4" prefix=" " category="inline-code"></block> コマンドを実行します次の図に示すように、20個すべてのLUNのインポートを実行中です。つまり、データコピー処理がまだ進行中であっても、ONTAPからデータにアクセスできるようになります。</block>
  <block id="d36f98c8a305e33483232e7b5cd90c49" category="inline-link-macro">Foreign LUN Import—完了</block>
  <block id="24a74765303a8fc0e4b1e7afbb8e2205" category="paragraph">オフラインプロセスが必要な場合は、サービスの再検出または再開を<block ref="1ab15ef2c245a4434fcea3cc3149f4f4" prefix=" " category="inline-code"></block> コマンドは、すべての移行が正常に完了したことを示します。その後、移行プロセスを完了できます（を参照）。 <block ref="5b0017122426f8734e0358273adc6802" category="inline-link-macro-rx"></block>。</block>
  <block id="a9c97f84ee4958d39ed989b3da7ed0ba" category="paragraph">オンライン移行が必要な場合は、新しいホーム内のLUNの再検出に進み、サービスを起動します。</block>
  <block id="d0369936c6fe8c292874e3bc647893b8" category="section-title">SCSIデバイスの変更をスキャン</block>
  <block id="6d338faddede649cab4c5b498e8e4379" category="paragraph">ほとんどの場合、新しいLUNを再検出する最も簡単なオプションは、ホストを再起動することです。これにより、古いデバイスが自動的に削除され、新しいLUNがすべて適切に検出され、マルチパスデバイスなどの関連デバイスが構築されます。この例では、デモ用の完全オンラインプロセスを示しています。</block>
  <block id="3b493a859f19779c1f7db7d1951785ee" category="paragraph">注意：ホストを再起動する前に、<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 移行されたSANリソースについては、コメントアウトされています。これを行わず、LUNアクセスに問題があると、OSがブートしない可能性があります。この状況ではデータが破損することはありません。ただし、レスキューモードまたは同様のモードで起動し、<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> これにより、OSを起動してトラブルシューティングを有効にすることができます。</block>
  <block id="9d7b16568eb7edb80492b49cb02d7663" category="paragraph">この例で使用しているLinuxバージョンのLUNは、<block ref="b6f75508bf2af141e9de6f862662661e" prefix=" " category="inline-code"></block> コマンドを実行しますコマンドが成功すると、各LUNパスが出力に表示されます。出力は解釈が難しい場合がありますが、ゾーニングとigroupの設定が正しい場合は、<block ref="971c047750d8e3b03c71d24020b3816f" prefix=" " category="inline-code"></block> ベンダー文字列。</block>
  <block id="3384aa7c090758ad18028832967b143f" category="section-title">マルチハステハイスノカクニン</block>
  <block id="07a39d42e6d8cc61e0a880e43b83e2a3" category="paragraph">LUN検出プロセスではマルチパスデバイスの再作成もトリガーされますが、Linuxのマルチパスドライバでは時折問題が発生することがわかっています。の出力<block ref="eeb30d005cab1d8c69785a3cd5818f55" prefix=" " category="inline-code"></block> 出力が想定どおりに表示されることを確認する必要があります。たとえば、次の出力は、に関連付けられているマルチパスデバイスを示しています。<block ref="971c047750d8e3b03c71d24020b3816f" prefix=" " category="inline-code"></block> ベンダー文字列。各デバイスには4つのパスがあり、2つはプライオリティ50、2つはプライオリティ10です。正確な出力はLinuxのバージョンによって異なりますが、この出力は想定どおりです。</block>
  <block id="efd921479c3d57448954050760c568ca" category="admonition">使用するLinuxのバージョンに対応するHost Utilitiesのマニュアルを参照して、<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 設定が正しい。</block>
  <block id="28751dc1e914a778d11ca0e69613690b" category="section-title">LVMボリュームグループの再アクティブ化</block>
  <block id="a66a38e4056f28a310ef6d1fa8bbcc77" category="paragraph">LVM LUNが正しく検出されていれば、<block ref="5239f542d8edbc4b528b1f362153c0c7" prefix=" " category="inline-code"></block> コマンドは成功するはずです。これは、論理ボリュームマネージャの価値を示す良い例です。ボリュームグループのメタデータはLUN自体に書き込まれるため、LUNのWWNやシリアル番号の変更は重要ではありません。</block>
  <block id="1d374f8de5ba1b82ab4407b8c6efbd0d" category="paragraph">OSがLUNをスキャンし、LUNに書き込まれている少量のデータが検出され、LUNがLUNに属する物理ボリュームであることがわかりました。<block ref="83b7788c8e4de444d6cd4c69978eaf32" prefix=" " category="inline-code"></block>。その後、必要なすべてのデバイスを構築しました。必要なのは、ボリュームグループを再アクティブ化することだけです。</block>
  <block id="1f0285a57b2357507c3b77ce5130b548" category="section-title">ファイルシステムの再マウント</block>
  <block id="a9047d68dc7e99f553b71590cff301d6" category="paragraph">ボリューム・グループを再アクティブ化すると'元のデータをすべてそのまま使用してファイル・システムをマウントできます前述したように、バックグループでデータレプリケーションがまだアクティブであっても、ファイルシステムは完全に動作します。</block>
  <block id="a787d65e2525ac6bc3a6328efe383b5c" category="section-title">ASMテハイスノサイスキヤン</block>
  <block id="a25bb20f07ed95a633f623678855e8dc" category="paragraph">ASMlibデバイスは、SCSIデバイスが再スキャンされたときに再検出されているはずです。再検出をオンラインで確認するには、ASMlibを再起動してからディスクをスキャンします。</block>
  <block id="37fb12a52b4a5371c12209e89e09b04f" category="admonition">この手順は、ASMlibを使用するASM構成にのみ関連します。</block>
  <block id="6de48f39063d81d53fd0ff3e9938af13" category="paragraph">注意：ASMlibを使用しない場合は、<block ref="9c9f766701f811ef6f170c7a3453c53f" prefix=" " category="inline-code"></block> デバイスは自動的に再作成されているはずです。ただし、権限が正しくない可能性があります。ASMlibがない場合は、ASMの基盤となるデバイスに特別な権限を設定する必要があります。これは通常、次のいずれかの特別なエントリによって達成されます。<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> または<block ref="ab775c875d5f89d991a670444dd32ad2" prefix=" " category="inline-code"></block> ルール、または両方のルールセットに含まれている可能性があります。ASMデバイスに正しいアクセス許可が設定されていることを確認するには、WWNまたはシリアル番号に関する環境の変更を反映するために、これらのファイルの更新が必要になる場合があります。</block>
  <block id="08b33d6af4ec78f99dbbc3533589aafc" category="paragraph">この例では、ASMlibを再起動してディスクをスキャンすると、元の環境と同じ10個のASM LUNが表示されます。</block>
  <block id="17c4ae76000d9a79a56195071665af32" category="section-title">グリッドサービスの再起動</block>
  <block id="e8c3dc00e15826e3b77a2d41d7fde92a" category="paragraph">LVMデバイスとASMデバイスがオンラインで使用可能になったので、グリッドサービスを再起動できます。</block>
  <block id="934317e45581988a01f54761705ca58a" category="section-title">データベースの再起動</block>
  <block id="41475a737e947d73c674b90e78e246a0" category="paragraph">グリッドサービスが再起動されたら、データベースを起動できます。ASMサービスが完全に使用可能になるまで数分待ってからデータベースを起動しなければならない場合があります。</block>
  <block id="0b986cf2a434b03b097578ad444e72f0" category="summary">FLIカットオーバーの完了- Oracle</block>
  <block id="24bd7d2a01571aa270c81d8d9f8370e9" category="doc">FLIの完了- Oracle</block>
  <block id="b171714b39ad4102aced4daceef8c678" category="paragraph">ホスト側から見ると移行は完了しますが、インポート関係が削除されるまでは外部アレイからI/Oが提供されます。</block>
  <block id="f708d001227724fa0a8a3d57aacedb1a" category="paragraph">関係を削除する前に、すべてのLUNの移行プロセスが完了していることを確認する必要があります。</block>
  <block id="85cf20229bc9008553794abdaed507f5" category="section-title">インポート関係を削除します</block>
  <block id="b23ec325eb9c6278cb36e4c45c2c3499" category="paragraph">移行プロセスが完了したら、移行関係を削除します。I/O処理が完了すると、ONTAP上のドライブからのみI/Oが提供されます。</block>
  <block id="40b98b0023a7eea7c432c29e3c44ba7d" category="section-title">外部LUNの登録解除</block>
  <block id="5ccc14ae93ba94bd4183439a9f80f6c8" category="paragraph">最後に、ディスクを変更して<block ref="96ea0e5f46787e93e2970a086b47fdb6" prefix=" " category="inline-code"></block> 指定。</block>
  <block id="875bb561ba851d301052704e0ffb70f4" category="summary">ログ配布によるOracleの移行</block>
  <block id="e0f9c3b73fe5700df95f30eb98ca4034" category="doc">Oracleのログ配布</block>
  <block id="8e42b5809657e127c7e2d24f30bc493e" category="paragraph">ログ配布を使用した移行の目的は、元のデータファイルのコピーを新しい場所に作成し、変更を新しい環境に配布する方法を確立することです。</block>
  <block id="599df5f564506c95624dd78b0b75eeac" category="paragraph">いったん確立されると、ログの送信と再生を自動化して、レプリカデータベースをソースとほぼ同期した状態に保つことができます。たとえば、（a）最新のログを新しい場所にコピーし、（b）15分ごとに再生するようにcronジョブをスケジュールできます。再生が必要なアーカイブログは15分以内であるため、カットオーバー時のシステム停止は最小限に抑えられます。</block>
  <block id="41bec1b4ddc17b3367c68a025c0ddfb9" category="paragraph">次に示す手順は、基本的にはデータベースのクローニング処理です。表示されるロジックは、NetApp SnapManager for Oracle（SMO）およびNetApp SnapCenter Oracleプラグインのエンジンと似ています。一部のお客様は、スクリプトまたはWFAワークフローに表示されている手順をカスタムクローニング処理に使用しています。この手順はSMOやSnapCenterを使用するよりも手動で作成する必要がありますが、スクリプト化も容易で、ONTAP内のデータ管理APIによってプロセスがさらに簡易化されます。</block>
  <block id="f0616883a5ca70aa97676de436a7fb9e" category="section-title">ログ配布-ファイルシステムからファイルシステムへ</block>
  <block id="8f922b64f0bc64f6bba1d555a61ee3bb" category="paragraph">この例では、Waffleというデータベースを通常のファイルシステムから別のサーバにある別の通常のファイルシステムに移行する方法を示します。また、SnapMirrorを使用してデータファイルの高速コピーを作成する方法も示していますが、これは手順全体に不可欠な要素ではありません。</block>
  <block id="60100e1b826a4b972fc113c391f932e7" category="section-title">データベースバックアップの作成</block>
  <block id="80cf34e10dcfbc5e76c6b2f845f2708d" category="paragraph">まず、データベースのバックアップを作成します。具体的には、この手順には、アーカイブログの再生に使用できる一連のデータファイルが必要です。</block>
  <block id="0ba29c6a1afacf586b03a26162c72274" category="section-title">環境</block>
  <block id="82f9b672d88793b2ca5716b2a5427056" category="paragraph">この例では、ソースデータベースはONTAPシステム上にあります。データベースのバックアップを作成する最も簡単な方法は、Snapshotコピーを使用する方法です。データベースがホットバックアップモードになるまでの数秒間、<block ref="252ce13e6c150af4d3e7eea5fca266bc" prefix=" " category="inline-code"></block> この処理は、データファイルをホストしているボリュームで実行されます。</block>
  <block id="1fd3a22cf15d1e18a6507f539346c40d" category="paragraph">その結果、という名前のSnapshotコピーがディスクに作成されます。<block ref="a8b3bc9f12cd194b80d404c30e9015ee" prefix=" " category="inline-code"></block> ホットバックアップモード時のデータファイルのイメージを含むデータファイルを展開します。適切なアーカイブログと組み合わせてデータファイルの整合性を確保すると、このSnapshotコピー内のデータをリストアまたはクローンのベースとして使用できます。この場合、新しいサーバに複製されます。</block>
  <block id="744a73803cdac4a5067725ca5814a2cf" category="section-title">新しい環境へのリストア</block>
  <block id="46228bb2ce31b0d397faad2b805e8a37" category="paragraph">これで、新しい環境でバックアップをリストアする必要があります。これは、Oracle RMAN、NetBackupなどのバックアップアプリケーションからのリストア、ホットバックアップモードに設定されたデータファイルの単純なコピー操作など、さまざまな方法で実行できます。</block>
  <block id="ca7da361ad92f677545e12dd462c6e39" category="paragraph">この例では、SnapMirrorを使用して、hotbackupというSnapshotコピーを新しい場所にレプリケートします。</block>
  <block id="1f255556546f1fdfb53692e41f35eb6c" category="list-text">Snapshotデータを受信する新しいボリュームを作成します。ミラーリングの初期化<block ref="937e9fa808ccfe9a4f6b004a2a7caada" prefix=" " category="inline-code"></block> 終了：<block ref="96f9dacb3cb1b1f6f9b4ad02992a1a0e" prefix=" " category="inline-code"></block>。</block>
  <block id="5b1944ec8c0ed933e5b2ea2e3e5fa76e" category="list-text">SnapMirrorによって同期が完了したことを示す状態が設定されたら、目的のSnapshotに基づいてミラーを更新します。</block>
  <block id="f4d90c6c29b1f76ab9c87a9996c9751e" category="list-text">同期が正常に完了したかどうかは、<block ref="31952c255e722053d4cc3f82921e95db" prefix=" " category="inline-code"></block> フィールドを指定します。</block>
  <block id="0934c3fcad3065c2a479125e4a80b259" category="list-text">その後、ミラーを壊すことができます。</block>
  <block id="fcf1f505b94151a36eba8e1563e7176f" category="list-text">新しいファイルシステムをマウントします。ブロックベースのファイルシステムでは、使用するLVMによって正確な手順が異なります。FCゾーニングまたはiSCSI接続を設定する必要があります。LUNへの接続が確立されたら、Linuxなどのコマンド<block ref="302c49bbd5bcda5463eb5130804effc1" prefix=" " category="inline-code"></block> ASMで検出できるように設定する必要があるボリュームグループまたはLUNを検出する場合に、が必要になることがあります。</block>
  <block id="20c4d1d4163c2463cf15ff7df6424459" category="paragraph">この例では、シンプルなNFSファイルシステムを使用しています。このファイルシステムは直接マウントできます。</block>
  <block id="b2dd88a1f03a5fb4c2e3c0d46f425161" category="section-title">制御ファイル作成テンプレートの作成</block>
  <block id="1c30e11140f1d0a1093bedee34eef1e4" category="paragraph">次に、制御ファイルテンプレートを作成する必要があります。。<block ref="3177841b2335a6640ea3054199830f1c" prefix=" " category="inline-code"></block> コマンド制御ファイルを再作成するためのテキストコマンドを作成します。この機能は、状況によってはバックアップからデータベースをリストアする場合に役立ちます。また、データベースのクローニングなどのタスクを実行するスクリプトでよく使用されます。</block>
  <block id="3f51d58ec72b9d36cb5e0636525130b5" category="list-text">移行されたデータベースの制御ファイルを再作成するには、次のコマンドの出力を使用します。</block>
  <block id="cb395c3bf18fd427287caecc9b28058a" category="list-text">制御ファイルが作成されたら、ファイルを新しいサーバにコピーします。</block>
  <block id="cf5c9046a3617a19c0ccc24e4cf54a33" category="section-title">バックアップパラメータファイル</block>
  <block id="0d1d1a7db58f3f93ec977733f4909f5d" category="paragraph">新しい環境ではパラメータファイルも必要です。最も簡単な方法は、現在のspfileまたはpfileからpfileを作成することです。この例では、ソースデータベースでspfileが使用されています。</block>
  <block id="051a634cb1e9a53dbf139214e1d24001" category="section-title">oratabエントリの作成</block>
  <block id="2dabc26c8b55d44e25a184ba2624eed0" category="paragraph">oratabエントリの作成は、oraenvなどのユーティリティが適切に機能するために必要です。oratabエントリを作成するには、次の手順を実行します。</block>
  <block id="87ef75141d237e3b44e8310aad8fcf19" category="section-title">ディレクトリ構造の準備</block>
  <block id="12f833c44c11e6bbd970cc126bce2bcb" category="paragraph">必要なディレクトリがまだ存在していない場合は、作成する必要があります。作成しないと、データベースの起動手順が失敗します。ディレクトリ構造を準備するには、次の最小要件を満たしている必要があります。</block>
  <block id="60225c364a012796a6d886e8cf4ec486" category="section-title">パラメータファイルの更新</block>
  <block id="e36ee2d9a95a6b672917862d714af383" category="list-text">パラメータファイルを新しいサーバにコピーするには、次のコマンドを実行します。デフォルトの場所は<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> ディレクトリ。この場合、pfileは任意の場所に配置できます。これは、移行プロセスの中間ステップとしてのみ使用されます。</block>
  <block id="d437a40a59905247cfb39cf9dc9da256" category="list-text">必要に応じてファイルを編集します。たとえば、アーカイブログの場所が変更された場合は、新しい場所を反映するようにpfileを変更する必要があります。この例では、制御ファイルだけが再配置されています。その一部は、ログファイルシステムとデータファイルシステム間で制御ファイルを分散するためです。</block>
  <block id="55cc35656c3d28c1b3267c246b397521" category="list-text">編集が完了したら、このpfileに基づいてspfileを作成します。</block>
  <block id="a833a03e6af0b969524dcccb8f296f1c" category="section-title">制御ファイルの再作成</block>
  <block id="74a636ee3a009f08cd5623dc8066dd09" category="paragraph">前の手順では、<block ref="3177841b2335a6640ea3054199830f1c" prefix=" " category="inline-code"></block> が新しいサーバにコピーされました。必要な出力の具体的な部分は、<block ref="0ca1fba455d799b9a1cc2440b9ba7043" prefix=" " category="inline-code"></block> コマンドを実行しますこの情報は、ファイルのマークされたセクションの下に記載されています。<block ref="9fb76d62be749cec8bdd06f46c77bf5b" prefix=" " category="inline-code"></block>。次の行から始まります<block ref="13ac20c4a96b2ecfd703e831ad722907" prefix=" " category="inline-code"></block> 次の単語を含める必要があります。<block ref="c3c62948f78a7ccaabb9ef2eea80a895" prefix=" " category="inline-code"></block>。最後はセミコロン（;）文字です。</block>
  <block id="bf4b2a006646a8e77166a2a596425074" category="list-text">この手順の例では、ファイルは次のように表示されます。</block>
  <block id="a9a27c002ec883341220e267712250a7" category="list-text">このスクリプトを必要に応じて編集し、さまざまなファイルの新しい場所を反映します。たとえば、高I/Oをサポートすると認識されている特定のデータファイルは、ハイパフォーマンスストレージ階層上のファイルシステムにリダイレクトされる可能性があります。また、特定のPDBのデータファイルを専用ボリュームに分離するなど、管理者のみが変更を行う場合もあります。</block>
  <block id="2540fb1670d4f9ee8a704a7eb8d748fe" category="list-text">この例では、を使用しています<block ref="b86df74c6982de8dec7509d039294d7a" prefix=" " category="inline-code"></block> スタンザは変更されませんが、REDOログは<block ref="96bb85ed0fe822778c4e5a821e991ad8" prefix=" " category="inline-code"></block> アーカイブログでスペースを共有する代わりに<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block>。</block>
  <block id="8d47ad079859f2976fdc7ebf742f768d" category="paragraph">ファイルが正しく配置されていない場合やパラメータが正しく設定されていない場合は、修正が必要な項目を示すエラーが生成されます。データベースはマウントされていますが、使用中のデータファイルがホットバックアップモードとしてマークされているため、まだ開いておらず、開くことができません。データベースの整合性を維持するには、まずアーカイブログを適用する必要があります。</block>
  <block id="6b7c2d588ac708b58f7ac889090608f6" category="section-title">初期ログレプリケーション</block>
  <block id="2db2d3d6001a06d1a027904fa66bc78c" category="paragraph">データファイルの整合性を確保するには、少なくとも1つのログ応答処理が必要です。ログの再生には、さまざまなオプションを使用できます。場合によっては、元のサーバ上の元のアーカイブログの場所をNFS経由で共有し、ログの返信を直接行うことができます。それ以外の場合は、アーカイブログをコピーする必要があります。</block>
  <block id="5c394e6951584d114c6706d0768e30d7" category="paragraph">例えば、単純な<block ref="8a444a43bdf534c0c6338bb7809659b3" prefix=" " category="inline-code"></block> この処理では、現在のすべてのログを移行元サーバから移行先サーバにコピーできます。</block>
  <block id="5fdb3158ed28dd3aa90b94556476b781" category="section-title">初回のログ再生</block>
  <block id="c2f93ef52583f81f0eba05a39483e2d8" category="paragraph">アーカイブログの場所に保存されたファイルは、コマンドを実行して再生できます。<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block> その後に応答が続きます<block ref="e1f2d5134ed2543d38a0de9751cf75d9" prefix=" " category="inline-code"></block> 使用可能なすべてのログを自動的に再生します。</block>
  <block id="f30a45a22256018185c5d235292e4d5e" category="paragraph">最後のアーカイブログの応答でエラーが報告されますが、これは正常な動作です。ログは次のことを示します。<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 特定のログファイルを探していましたが、見つかりませんでした。ログファイルがまだ存在しない可能性があります。</block>
  <block id="80bea8a60412cace54760b223b2d799e" category="paragraph">アーカイブログをコピーする前にソースデータベースをシャットダウンできる場合、この手順は1回だけ実行する必要があります。アーカイブログがコピーされて再生されたら、重要なRedoログをレプリケートするカットオーバープロセスに直接進むことができます。</block>
  <block id="1e334141582a9dcb581c9b34ef2df071" category="section-title">差分ログのレプリケーションと再生</block>
  <block id="5fd2b0bf662c2b1ebdc677ea888536ce" category="paragraph">ほとんどの場合、移行はすぐには実行されません。移行プロセスが完了するまでに数日、場合によっては数週間かかることもあります。つまり、ログをレプリカデータベースに継続的に送信して再生する必要があります。そのため、カットオーバーが完了したら、最小限のデータを転送して再生する必要があります。</block>
  <block id="0c56d82ec6857bcef5475899b9f7b5cc" category="paragraph">これはさまざまな方法でスクリプト化できますが、最も一般的な方法の1つは、一般的なファイルレプリケーションユーティリティであるrsyncを使用することです。このユーティリティを使用する最も安全な方法は、このユーティリティをデーモンとして設定することです。たとえば、などです<block ref="b31375af035ed8a698a803a491084f61" prefix=" " category="inline-code"></block> 次のファイルは、という名前のリソースを作成する方法を示しています。<block ref="260e23541ff372b9bc53b4bd3c0c38ba" prefix=" " category="inline-code"></block> Oracleユーザクレデンシャルでアクセスされ、次にマッピングされます。<block ref="488a4921a81e36fca411e6f13cefbbf2" prefix=" " category="inline-code"></block>。最も重要なことは、リソースが読み取り専用に設定されていることです。これにより、本番データの読み取りは可能ですが、変更はできません。</block>
  <block id="eabf1b424989b2c7113ba3a538079afa" category="paragraph">次のコマンドは'新しいサーバのアーカイブログデスティネーションをrsyncリソースと同期します<block ref="260e23541ff372b9bc53b4bd3c0c38ba" prefix=" " category="inline-code"></block> 元のサーバ。。<block ref="e358efa489f58062f10dd7316b65649e" prefix=" " category="inline-code"></block> の引数<block ref="293e33723231f0504effabb52b054a31" prefix=" " category="inline-code"></block> タイムスタンプに基づいてファイルリストが比較され、新しいファイルのみがコピーされます。このプロセスでは、新しいサーバの増分アップデートが提供されます。このコマンドは、cronで定期的に実行するようにスケジュールすることもできます。</block>
  <block id="c775c44069da13c8f7ee5c5116e76e36" category="inline-link-macro">データベースのログを再生</block>
  <block id="c3bf9b2ef3e3ae2ae6a02f7f77cfcbc6" category="paragraph">ログを受信したら、それらのログを再生する必要があります。上記の例では、sqlplusを使用して手動で<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block>、簡単に自動化できるプロセス。この例では、で説明されているスクリプトを使用しています。 <block ref="3e57a2099043fa40c58f1e0d4eed995d" category="inline-link-macro-rx"></block>。スクリプトは、リプレイ操作を必要とするデータベースを指定する引数を受け入れます。これにより、同じスクリプトをマルチデータベース移行で使用できます。</block>
  <block id="4ea2a6c39b10b3e3076f976f58a861d1" category="section-title">カットオーバー</block>
  <block id="5de3f1ba0bbef459baa93f04f63b9ea1" category="paragraph">新しい環境にカットオーバーする準備ができたら、アーカイブログとREDOログの両方を含む最終的な同期を実行する必要があります。元のREDOログの場所が不明な場合は、次のように特定できます。</block>
  <block id="677f005cc0f8be0f891df5af72fb5688" category="list-text">ソースデータベースをシャットダウンします。</block>
  <block id="41b182875e12de118d17b3432cca93fa" category="list-text">目的の方法を使用して、新しいサーバでアーカイブログの最終的な同期を1回実行します。</block>
  <block id="37d6d9420cef8230249e7691315f0e13" category="list-text">ソースREDOログを新しいサーバにコピーする必要があります。この例では、REDOログがの新しいディレクトリに再配置されています。<block ref="96bb85ed0fe822778c4e5a821e991ad8" prefix=" " category="inline-code"></block>。</block>
  <block id="d0a5f1380bd67b0d0fd3bc72f22d88f2" category="list-text">この段階で、新しいデータベース環境には、ソースとまったく同じ状態にするために必要なすべてのファイルが含まれています。アーカイブログは最後に1回再生する必要があります。</block>
  <block id="c2721157205b2d2e96c656c45ca72992" category="list-text">完了したら、Redoログを再生する必要があります。というメッセージが表示されます<block ref="975df7a5099101ffbe47981cd1d37c2c" prefix=" " category="inline-code"></block> が返されると、プロセスが成功し、データベースが同期されてオープンできるようになります。</block>
  <block id="6acab27c5f334c66f06f3f74bc62d6d8" category="section-title">ログ配布- ASMからファイルシステムへ</block>
  <block id="a67ffcc8b155bb909a6f8c5d5ba2f334" category="paragraph">この例では、Oracle RMANを使用してデータベースを移行します。ファイルシステムからファイルシステムへのログ配布の前の例と非常によく似ていますが、ASM上のファイルはホストには表示されません。ASMデバイス上にあるデータを移行するには、ASM LUNを再配置するか、Oracle RMANを使用してコピー処理を実行するしかありません。</block>
  <block id="1c51600a778919f7f3abb5b25175220a" category="paragraph">Oracle ASMからファイルをコピーするにはRMANが必要ですが、RMANを使用できるのはASMに限られません。RMANを使用すると、任意のタイプのストレージから他のタイプのストレージに移行できます。</block>
  <block id="2cb6a5bfc4a76f651d496cddc685e078" category="paragraph">この例は'pancakeというデータベースをASMストレージから'パスにある別のサーバにある通常のファイルシステムに再配置する例を示しています<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> および<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block>。</block>
  <block id="d1d789c37f1c96d0a5de07798c14fcc5" category="paragraph">最初の手順では、代替サーバに移行するデータベースのバックアップを作成します。ソースではOracle ASMを使用するため、RMANを使用する必要があります。単純なRMANバックアップは、次のように実行できます。この方法で作成されるタグ付きバックアップは、あとでRMANで簡単に識別できるように手順なります。</block>
  <block id="ed927706d8abc2bbf3a5a8bc55e1e562" category="paragraph">最初のコマンドは、バックアップ先のタイプと使用する場所を定義します。2番目のコマンドでは、データファイルのみのバックアップが開始されます。</block>
  <block id="db85d05166dd65559ae5f426b51198e6" category="section-title">バックアップ制御ファイルバックアップセイギョファイル</block>
  <block id="a0b95d36955723a82dde7bbe40b6ccb9" category="paragraph">バックアップ制御ファイルは、手順の後半の工程で<block ref="08de2bfcc2d52d5bc4f3f2dcb97558ad" prefix=" " category="inline-code"></block> 操作。</block>
  <block id="76ff543de72e62217293a1d0ceade0aa" category="paragraph">新しい環境ではパラメータファイルも必要です。最も簡単な方法は、現在のspfileまたはpfileからpfileを作成することです。この例では、ソースデータベースでspfileが使用されています。</block>
  <block id="d28f3a5b77909b45c50e6c711bef8b60" category="section-title">ASMファイル名変更スクリプト</block>
  <block id="c242730c760d895368557f78141ff8b1" category="paragraph">データベースを移動すると、制御ファイルに現在定義されている複数のファイルの場所が変更されます。次のスクリプトは、プロセスを簡単にするためにRMANスクリプトを作成します。この例は、データファイルの数が非常に少ないデータベースを示していますが、通常、データベースには数百、場合によっては数千のデータファイルが含まれています。</block>
  <block id="359b84bcf7447a77b212e844aeaa9d89" category="inline-link-macro">ASMからファイルシステム名への変換</block>
  <block id="374a1a0facd7c604ac09ed0dca6efb3e" category="paragraph">このスクリプトは、 <block ref="288325982fd7bee6cf9eb66ad33f6f7a" category="inline-link-macro-rx"></block> 2つのことができます</block>
  <block id="42787fdca1cf792241ce03151ec7dbd3" category="paragraph">まず、REDOログの場所を再定義するパラメータを作成します。<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block>。基本的には交互のフィールドのリストです。最初のフィールドは現在のREDOログの場所で、2番目のフィールドは新しいサーバ上の場所です。その後、パターンが繰り返されます。</block>
  <block id="cf444fd96c87609516f0ad8212f41b01" category="paragraph">2つ目の機能は、データファイルの名前を変更するためのテンプレートを提供することです。スクリプトは、データファイルをループ処理し、名前とファイル番号の情報を取得して、RMANスクリプトとしてフォーマットします。次に、一時ファイルについても同じことが行われます。その結果、必要に応じて編集してファイルを目的の場所にリストアできるシンプルなRMANスクリプトが作成されます。</block>
  <block id="50614366822786a4f2ee3a5065543634" category="paragraph">この画面の出力をキャプチャします。。<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block> パラメータは、次のようにpfileに配置されます。RMANデータ・ファイルの名前変更および複製スクリプトを編集して、必要な場所にデータ・ファイルを配置する必要があります。この例では、これらはすべて<block ref="36c3572e381980ee1f1343988ae4a955" prefix=" " category="inline-code"></block>。</block>
  <block id="e60cd818b9f7ae02a73d8b3a6ea0a809" category="paragraph">スクリプトの実行準備はほぼ完了していますが、最初にディレクトリ構造を設定する必要があります。必要なディレクトリが存在しない場合は、それらのディレクトリを作成する必要があります。存在しないと、データベースの起動手順が失敗します。次の例は、最小要件を示しています。</block>
  <block id="2f2eed2ed14ba876a017aa9ea9515724" category="paragraph">次のコマンドは、oraenvなどのユーティリティが正常に動作するために必要です。</block>
  <block id="f34a9f7c077457a54f8838b55b9fc025" category="section-title">パラメータの更新</block>
  <block id="fd5c3a935e7374f8b1577e73e85ef375" category="paragraph">保存したpfileを更新して、新しいサーバ上のパスの変更を反映する必要があります。データ・ファイル・パスの変更は、RMAN複製スクリプトによって変更されます。ほとんどのデータベースでは、<block ref="d98137bd230dac4372cf20a2e7839463" prefix=" " category="inline-code"></block> および<block ref="2d205df7ae2efff1576140524b40b93c" prefix=" " category="inline-code"></block> パラメータ変更が必要な監査ファイルの場所や、次のようなパラメータが存在する場合もあります。<block ref="40f8833ae28ec69bcc89eb0eba090fe4" prefix=" " category="inline-code"></block> ASM以外では関連性がない可能性があります。経験豊富なデータベース管理者は、次に進む前に提案された変更を慎重に確認する必要があります。</block>
  <block id="b581dd429e9b4c24127b8940ca8e4346" category="paragraph">この例では、制御ファイルの場所、ログのアーカイブ先、<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block> パラメータ</block>
  <block id="bbba1f65801697ba3abd94d90c83ba71" category="paragraph">新しいパラメータが確認されたら、パラメータを有効にする必要があります。複数のオプションがありますが、ほとんどのお客様はテキストpfileに基づいてspfileを作成します。</block>
  <block id="3a17a12678d74dabb1032aaf373166d8" category="section-title">スタートアップの登録</block>
  <block id="a9dc570a0b3161e69edc31f3545cbf22" category="paragraph">データベースをレプリケートする前の最後の手順では、データベースプロセスを起動しますが、ファイルはマウントしません。この手順では、spfileの問題が明らかになる可能性があります。状況に応じて<block ref="357eedab214bb515c5622e275bc19cdb" prefix=" " category="inline-code"></block> パラメータエラーが原因でコマンドが失敗します。シャットダウンし、pfileテンプレートを修正し、spfileとしてリロードして、再試行するのは簡単です。</block>
  <block id="0257eff4bf9bf0cb483f2544fd42f109" category="section-title">データベースの複製</block>
  <block id="4632b675c558eda129fe6da4fbbae2b2" category="paragraph">以前のRMANバックアップを新しい場所にリストアするには、このプロセスの他の手順よりも時間がかかります。データベースID（DBID）を変更したり、ログをリセットしたりせずに、データベースを複製する必要があります。これにより、ログが適用されなくなります。これは、コピーを完全に同期するために必要な手順です。</block>
  <block id="06206ea0cdea741420d9f7619503db89" category="paragraph">前の手順で作成したスクリプトを使用して、RMANをauxとしてデータベースに接続し、DUPLICATE DATABASEコマンドを問題します。</block>
  <block id="5ae45dfed3c4aff7fe4fd6a7e3606cb0" category="paragraph">ソースデータベースから新しい場所に変更を出荷する必要があります。そのためには、いくつかの手順が必要になる場合があります。最も簡単な方法は、ソース・データベースのRMANでアーカイブ・ログを共有ネットワーク接続に書き込む方法です。共有の場所を使用できない場合は、RMANを使用してローカルファイルシステムに書き込み、rcpまたはrsyncを使用してファイルをコピーする方法もあります。</block>
  <block id="e355807335e5f05930a748afe1c3b23d" category="paragraph">この例では、を使用しています<block ref="45987b06d5eae35fc3e3487749a9ba27" prefix=" " category="inline-code"></block> ディレクトリは、元のデータベースと移行後のデータベースの両方で使用できるNFS共有です。</block>
  <block id="49fffa356bcd041918ce24ef714f3f72" category="paragraph">ここでの重要な問題の1つは、<block ref="6761e3b36547cd115b3966fcbc7192b2" prefix=" " category="inline-code"></block> 条項。バックアップのディスクフォーマットは次のとおりです。<block ref="9ae0f22d9fa2eac270499e74092af364" prefix=" " category="inline-code"></block>これは、スレッド番号、シーケンス番号、およびデータベースのアクティベーションIDの形式を使用する必要があることを意味します。文字は異なりますが、これは<block ref="03e92f2c3a8cae5315f0e42bf6acf436" prefix=" " category="inline-code"></block> パラメータをpfileに指定します。このパラメータは、スレッド番号、シーケンス番号、およびアクティベーションIDの形式でアーカイブログを指定します。最終的に、ソース上のログファイルのバックアップでは、データベースで想定される命名規則が使用されます。これにより、次のような操作が行われます。<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> sqlplusはアーカイブログの名前を正しく予測して再生できるため、はるかにシンプルです。</block>
  <block id="76d77393c7ffc6b0a0edd47ad09afe4d" category="paragraph">アーカイブログの場所に保存されたファイルは、コマンドを実行して再生できます。<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block> その後に応答が続きます<block ref="e1f2d5134ed2543d38a0de9751cf75d9" prefix=" " category="inline-code"></block> 使用可能なすべてのログを自動的に再生します。パラメータファイルは現在、アーカイブログを次の場所に転送しています：<block ref="e421a42fc6f604fcc78707336ed222b9" prefix=" " category="inline-code"></block>ただし、これは、RMANを使用してログを保存した場所と一致しません。この場所は、データベースをリカバリする前に、次のように一時的にリダイレクトできます。</block>
  <block id="0a96a4559ad3ab8c616a12a207e8daca" category="paragraph">最後のアーカイブログの応答でエラーが報告されますが、これは正常な動作です。エラーは、sqlplusが特定のログファイルを探していたが見つからなかったことを示しています。ログファイルがまだ存在しない可能性があります。</block>
  <block id="e2a234d3299b9e66f0756db00c9ee8c7" category="paragraph">ほとんどの場合、移行はすぐには実行されません。移行プロセスが完了するまでに数日、場合によっては数週間かかることもあります。つまり、ログをレプリカデータベースに継続的に送信して再生する必要があります。これにより、カットオーバーの到着時に最小限のデータの転送と再生が必要になります。</block>
  <block id="247e1695519da78866726a4dcb2c5252" category="paragraph">このプロセスは簡単にスクリプト化できます。たとえば、次のコマンドを元のデータベースでスケジュールして、ログ配布に使用される場所が継続的に更新されるようにすることができます。</block>
  <block id="3ce19ecb7c874f75b9a46e29abe2012e" category="inline-link-macro">スタンバイデータベースのリプレイログ</block>
  <block id="469d3082a0f3ad08223ba8fe69bf9311" category="paragraph">ログを受信したら、それらのログを再生する必要があります。上記の例では、sqlplusを使用して手動で<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block>をクリックします。これは簡単に自動化できます。この例では、で説明されているスクリプトを使用しています。 <block ref="7c7730292e0135c86626e1771f7f02ec" category="inline-link-macro-rx"></block>。スクリプトは、リプレイ操作を必要とするデータベースを指定する引数を受け取ります。このプロセスでは、同じスクリプトをマルチデータベース移行で使用できます。</block>
  <block id="15d3442f7626bb62f4b255c7ed5c5098" category="paragraph">新しい環境にカットオーバーする準備ができたら、最後の同期を1回実行する必要があります。通常のファイルシステムを使用する場合は、元のREDOログがコピーされて再生されるため、移行したデータベースが元のデータベースと完全に同期されていることを簡単に確認できます。ASMでこれを行う良い方法はありません。簡単に再コピーできるのはアーカイブログだけです。データが失われないようにするには、元のデータベースの最終的なシャットダウンを慎重に実行する必要があります。</block>
  <block id="f9952f2469fbec5fc9dca180322ff9ee" category="list-text">まず、データベースを休止して、変更が行われていないことを確認する必要があります。この休止には、スケジュールされた処理の無効化、リスナーのシャットダウン、アプリケーションのシャットダウンなどが含まれます。</block>
  <block id="58fd1c52efcde7151ac264a8f67b14ff" category="list-text">この手順を実行すると、ほとんどのDBAはダミーテーブルを作成し、シャットダウンのマーカーとして機能します。</block>
  <block id="442da9ab2cced82a6cbdd112be285bcf" category="list-text">ログを強制的にアーカイブし、ダミーテーブルの作成がアーカイブログに記録されるようにします。これを行うには、次のコマンドを実行します。</block>
  <block id="83fce8a41250d6af49205f9659468351" category="list-text">最後のアーカイブログをコピーするには、次のコマンドを実行します。データベースは使用可能であるが、開いていない必要があります。</block>
  <block id="1b0e887c1394d4617c2a5243da19e44e" category="list-text">アーカイブログをコピーするには、次のコマンドを実行します。</block>
  <block id="86a7e05acb17098c514dd570b9220302" category="list-text">最後に、残りのアーカイブログを新しいサーバで再生します。</block>
  <block id="a430882deb5403e7b4b8061dec17cc80" category="list-text">この段階では、すべてのデータをレプリケートします。データベースをスタンバイデータベースからアクティブ運用データベースに変換してオープンする準備が整いました。</block>
  <block id="077c7bcbf9a94bb62aecadc85045886e" category="list-text">ダミーテーブルの存在を確認してからドロップします。</block>
  <block id="6130a27b8ec8ccf18e06bb3389b0fbbd" category="section-title">Redoログの無停止移行</block>
  <block id="26c294f993888218237d5f9306bfcfc4" category="paragraph">REDOログを除き、データベース全体が正しく構成されている場合があります。これはさまざまな理由で発生する可能性がありますが、最も一般的なのはスナップショットに関連しています。SnapManager for Oracle、SnapCenter、NetApp Snap Creatorのストレージ管理フレームワークなどの製品では、データファイルボリュームの状態をリバートする場合にのみ、データベースをほぼ瞬時にリカバリできます。REDOログがデータファイルとスペースを共有している場合は、REDOログが破棄されてデータが失われる可能性があるため、リバートを安全に実行できません。そのため、REDOログを再配置する必要があります。</block>
  <block id="2c56f5081b94b926c93c40f4c935a44a" category="paragraph">この手順はシンプルで、無停止で実行できます。</block>
  <block id="2986f9fe7ed4aab5aaa64c2ee9fe4841" category="section-title">現在のREDOログ設定</block>
  <block id="dd786d22c88a5f1fe0c10cfec58c1b44" category="list-text">REDOロググループの数とそれぞれのグループ番号を確認します。</block>
  <block id="3cd0f7a32a4f5ee026702f8125f3dda7" category="list-text">Redoログのサイズを入力します。</block>
  <block id="7c2f6ada37d59f2be0bc1a3ead80f77c" category="section-title">新しいログを作成する</block>
  <block id="106b215e5d87fb1256e47932f2ebf9cf" category="list-text">Redoログごとに、サイズとメンバー数が一致する新しいグループを作成します。</block>
  <block id="0851b65f20b98420968e488fc3c0085e" category="list-text">新しい設定を確認します。</block>
  <block id="cbccec9e0905e0b7f5cd630a3fa12f64" category="section-title">古いログを削除</block>
  <block id="00f63618719701ddae7fc2ff1d406ec2" category="list-text">古いログ（グループ1、2、3）を削除します。</block>
  <block id="f00c8361a8acc818247282bb6420a8c1" category="list-text">アクティブなログをドロップできないエラーが発生した場合は、次のログに切り替えてロックを解除し、グローバルチェックポイントを強制的に実行します。このプロセスの次の例を参照してください。古い場所にあるログファイルグループ2を削除しようとしましたが、このログファイルにアクティブなデータが残っているため拒否されました。</block>
  <block id="5d49a93437a42d2926c8be7eb3c7a56f" category="list-text">ログアーカイブの後にチェックポイントを追加すると、ログファイルをドロップできます。</block>
  <block id="e3898c187d7edf64fc8e4d4e409fd244" category="list-text">次に、ファイルシステムからログを削除します。このプロセスは細心の注意を払って実行する必要があります。</block>
  <block id="eb290dfcb2d35cffcb49a22fd05168b5" category="summary">Oracleの移行計画</block>
  <block id="4e0761b3f22b38640f0d2291420d26f6" category="doc">驚異的な移行計画</block>
  <block id="dacc2a633e9981c9f91e43ac6b59e889" category="paragraph">Oracleのデータ移行は、データベース、ホスト、ストレージアレイの3つのレベルのいずれかで実行できます。</block>
  <block id="5153193d50d4c628312db2d5bc0132ed" category="paragraph">違いは、解決策全体のどのコンポーネント（データベース、ホストオペレーティングシステム、ストレージシステム）がデータの移動を担当しているかです。</block>
  <block id="cc3e73ae592a355b9beb405232d08fe2" category="paragraph">次の図は、移行レベルとデータフローの例を示しています。データベースレベルの移行では、元のストレージシステムからホストレイヤとデータベースレイヤを経由して新しい環境にデータが移動されます。ホストレベルの移行も同様ですが、データはアプリケーションレイヤを通過せず、代わりにホストプロセスを使用して新しい場所に書き込まれます。最後に、ストレージレベルの移行では、NetApp FASシステムなどのアレイがデータ移動を行います。</block>
  <block id="204415652114bfb773b51cd76c8c692e" category="paragraph"><block ref="204415652114bfb773b51cd76c8c692e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b059e0e23ffaa8fbd97f681942ce0018" category="paragraph">データベースレベルの移行とは、通常、スタンバイデータベースを介してOracleのログ配布を使用して、Oracleレイヤでの移行を完了することを指します。ホストレベルの移行は、ホストオペレーティングシステム構成の標準機能を使用して実行されます。この構成には、cp、tar、およびOracle Recovery Manager（RMAN）などのコマンドを使用するか、論理ボリュームマネージャ（LVM）を使用してファイルシステムの基盤となるバイトを再配置するファイルコピー処理が含まれます。Oracle Automatic Storage Management（ASM）は、データベースアプリケーションのレベル以下で実行されるため、ホストレベルの機能に分類されます。ASMは、ホスト上の通常の論理ボリュームマネージャの代わりに使用されます。最後に、データをストレージアレイレベル（オペレーティングシステムのレベル以下）で移行できます。</block>
  <block id="228d9e0418aa12bae73676a5743558db" category="section-title">計画に関する考慮事項</block>
  <block id="ce7eea640cd6ee20e55cbe868f4026e9" category="paragraph">移行に最適な方法は、移行する環境の規模、ダウンタイムの回避の必要性、移行の実行に必要な全体的な作業など、さまざまな要因の組み合わせによって異なります。大規模なデータベースの移行には明らかに多くの時間と労力が必要ですが、そのような移行の複雑さは最小限です。小規模なデータベースは迅速に移行できますが、数千ものデータベースを移行する必要がある場合は、規模の大きさによって複雑な作業が発生する可能性があります。最後に、データベースの規模が大きいほど、ビジネスクリティカルである可能性が高くなります。そのため、バックアウトパスを維持しながらダウンタイムを最小限に抑える必要があります。</block>
  <block id="d4b9b19593598d98059aae44d6a7bbe1" category="paragraph">ここでは、移行戦略を計画する際の考慮事項について説明します。</block>
  <block id="931c6f2c99380fbd899e3eaa31e97d98" category="section-title">データサイズ</block>
  <block id="64e4d570abeebacf6bdcb19dfb73fcae" category="paragraph">移動するデータベースのサイズは移行計画に明らかに影響しますが、サイズがカットオーバー時間に必ずしも影響するとは限りません。大量のデータを移行する必要がある場合、主に帯域幅を考慮する必要があります。コピー処理は通常、効率的なシーケンシャルI/Oを使用して実行されます。控えめな見積もりでは、コピー処理に使用できるネットワーク帯域幅の使用率が50%であると想定しています。たとえば、8GBのFCポートでは理論上約800MBpsの転送が可能です。使用率が50%であれば、約400Mbpsの速度でデータベースをコピーできます。そのため、この速度では約7時間で10TBのデータベースをコピーできます。</block>
  <block id="84a80a048e7abc027dd6bdce55fda9d2" category="inline-link-macro">データファイルのオンライン移動</block>
  <block id="96220ddfb388df1ec5c630828316520f" category="paragraph">長距離の移行では、通常、ログ配布プロセスなど、より創造的なアプローチが必要になります。詳細については、を参照してください。 <block ref="3a18b1903dadc58123e7db364a89a706" category="inline-link-macro-rx"></block>。長距離IPネットワークでは、LANやSANの速度に近い場所で帯域幅が使用されることはほとんどありません。あるケースでは、アーカイブログの生成頻度が非常に高い220TBデータベースの長距離移行をNetAppが支援しました。データ転送のために選択されたアプローチは、可能な限り最大の帯域幅を提供するため、テープの毎日の出荷でした。</block>
  <block id="1c169b76761527b28040655a783e50a2" category="section-title">データベース数</block>
  <block id="da3770c5d6d1215e9f2524b9d7b7c3c5" category="paragraph">多くの場合、大量のデータを移動する際の問題はデータサイズではなく、データベースをサポートする構成の複雑さです。50TBのデータベースを移行する必要があるというだけでは、十分な情報ではありません。1つの50TBのミッションクリティカルなデータベース、4、000個のレガシーデータベースの集まり、または本番環境と非本番環境の混在環境などが考えられます。場合によっては、ほとんどのデータがソースデータベースのクローンで構成されています。これらのクローンは簡単に再作成できるため、マイグレートする必要はありません。特に、新しいアーキテクチャでNetApp FlexCloneボリュームを利用するように設計されている場合は、クローンを簡単に再作成できるためです。</block>
  <block id="a1739e745a7544d2432b2b990a715817" category="paragraph">移行を計画するには、対象となるデータベースの数と、データベースの優先順位を決定する方法を理解しておく必要があります。データベースの数が増えるにつれて、優先される移行オプションはスタック内で徐 々 に低くなる傾向があります。たとえば、RMANを使用して単一のデータベースのコピーを簡単に実行でき、短時間の停止が発生する可能性があります。これはホストレベルのレプリケーションです。</block>
  <block id="284723d6a05b50ace5e5b96c761d03ac" category="paragraph">データベースが50個ある場合は、RMANコピーを受信する新しいファイルシステム構造を設定してデータを所定の場所に移動することを避けた方が簡単な場合があります。このプロセスは、ホストベースのLVM移行を利用して、古いLUNから新しいLUNにデータを再配置することで実行できます。これにより、データベース管理者（DBA）チームからOSチームに責任が移され、データベースに関して透過的にデータが移行されます。ファイルシステム構成は変更されません。</block>
  <block id="8e734da04d394519001f47f723341e9d" category="paragraph">最後に、200台のサーバにまたがる500個のデータベースを移行する必要がある場合は、ONTAP Foreign LUN Import（FLI）機能などのストレージベースのオプションを使用して、LUNの直接移行を実行できます。</block>
  <block id="39f43935349622951e0f392c83b6e736" category="section-title">リアーキテクチャノヨウケン</block>
  <block id="50f1558a3f9d47464b5d57f9d9d0f9d1" category="paragraph">通常、データベースファイルのレイアウトを変更して新しいストレージアレイの機能を利用する必要がありますが、必ずしもそうであるとは限りません。たとえば、EFシリーズオールフラッシュアレイの機能は、主にSANのパフォーマンスと信頼性を重視しています。ほとんどの場合、データレイアウトに関する特別な考慮事項なしに、データベースをEFシリーズアレイに移行できます。要件は、高いIOPS、低レイテンシ、堅牢な信頼性だけです。RAID構成やDynamic Disk Poolsなどの要素に関連するベストプラクティスはありますが、EFシリーズのプロジェクトでこれらの機能を活用するためにストレージアーキテクチャ全体を大幅に変更しなければならないことはほとんどありません。</block>
  <block id="0e2c78f7e9948e19ccb1bf2e1b7f0faf" category="paragraph">これとは対照的に、ONTAPへの移行では、最終的な構成で最大限の価値を実現するために、データベースレイアウトをより慎重に検討する必要があります。ONTAP自体は、特定のアーキテクチャの作業がなくても、データベース環境に多くの機能を提供します。最も重要なのは、現在のハードウェアが寿命に達したときに、システムを停止せずに新しいハードウェアに移行できることです。一般的には、ONTAPへの移行は最後に実行する必要があります。後続のハードウェアはインプレースでアップグレードされ、データは無停止で新しいメディアに移行されます。</block>
  <block id="ad93bd21d59f2286385dc519fd7e39fb" category="paragraph">いくつかの計画では、さらに多くの利点が利用可能です。スナップショットの使用には、最も重要な考慮事項があります。Snapshotは、バックアップ、リストア、クローニング処理をほぼ瞬時に実行するための基盤です。スナップショットの機能の一例として、最大の用途は、6台のコントローラ上の約250個のLUNで996TBの単一データベースを実行している場合です。このデータベースのバックアップは2分で完了し、リストアは2分で完了し、クローニングは15分で完了します。その他のメリットとしては、ワークロードの変化に応じてクラスタ内でデータを移動できる機能や、サービス品質（QoS）制御を適用して、マルチデータベース環境で安定した優れたパフォーマンスを提供できる機能などがあります。</block>
  <block id="6b48ce64da84423ce167ffb72f5f9a8b" category="inline-link-macro">Oracle移行手順の概要</block>
  <block id="1311d3b592e4da5950e91965dac1d593" category="paragraph">QoS制御、データ再配置、Snapshot、クローニングなどのテクノロジは、ほぼすべての構成で機能します。しかし、利益を最大化するためには、一般的にいくつかの考えが必要です。場合によっては、新しいストレージアレイへの投資を最大限に活用するために、データベースストレージのレイアウトの設計変更が必要になることがあります。ホストベースまたはストレージベースの移行では元のデータレイアウトがレプリケートされるため、このような設計の変更は移行戦略に影響する可能性があります。移行を完了してONTAP向けに最適化されたデータレイアウトを提供するには、追加の手順が必要になる場合があります。に示す手順 <block ref="d4d5600aaaced44e203002ec1910822d" category="inline-link-macro-rx"></block> また、データベースを移行するだけでなく、最小限の労力で最適な最終レイアウトに移行する方法についても説明します。</block>
  <block id="1fd9b0a8321228b5b8ad4be85e71cf64" category="section-title">カットオーバー時間</block>
  <block id="95b9194d9f06f6f70febc87c071f3050" category="paragraph">カットオーバー中のサービス停止の許容最大値を決定する必要があります。移行プロセス全体がシステム停止を引き起こすと想定するのはよくある間違いです。サービスの中断が発生する前に多くのタスクを完了できます。また、多くのオプションを使用すると、システム停止やシステム停止を伴わずに移行を完了できます。カットオーバーの時間は手順によって異なるため、システム停止が避けられない場合でも、許容されるサービス停止の最大値を定義する必要があります手順。</block>
  <block id="2671d3330eac790e8b14ba2a9cecd70b" category="paragraph">たとえば、10TBのデータベースのコピーには、通常、約7時間かかります。ビジネスニーズが7時間の停止を許容している場合、ファイルのコピーは簡単で安全な移行オプションです。5時間で対応できない場合は、シンプルなログ配布プロセス（ <block ref="d746c73310b8111ae91d5cedb4066344" category="inline-link-macro-rx"></block>最小限の労力でセットアップでき、カットオーバー時間を約15分に短縮できます。この間、データベース管理者はプロセスを完了できます。許容できない時間が15分であった場合は、スクリプトを使用して最終カットオーバープロセスを自動化し、カットオーバー時間をわずか数分に短縮できます。移行はいつでも高速化できますが、そのためには時間と労力がかかります。カットオーバーの所要時間は、ビジネス部門が許容できる範囲で決定する必要があります。</block>
  <block id="9cfeaf56d2fc41c2695a69adf260c3f8" category="section-title">バックアウトパス</block>
  <block id="f493e16f7e2caba820eba88a1c5f82d8" category="paragraph">完全にリスクのない移行はありません。テクノロジが完全に動作していても、ユーザエラーの可能性は常にあります。選択した移行パスに関連するリスクと、失敗した移行の結果を考慮する必要があります。たとえば、Oracle ASMの透過的オンラインストレージ移行機能は、Oracle ASMの主要機能の1つであり、この方法は、最も信頼性の高い方法の1つです。ただし、この方法ではデータが不可逆的にコピーされています。万一ASMで問題が発生した場合、簡単にバックアウトできるパスはありません。唯一の選択肢は、元の環境をリストアするか、ASMを使用して移行を元のLUNに戻すことです。このリスクは、元のストレージ・システムでスナップショット・タイプのバックアップを実行できる場合には、最小限に抑えることができますが、排除することはできません。</block>
  <block id="1886f1ab01daa4511ce537d1af675427" category="section-title">リハーサル</block>
  <block id="dd5dac65febd7071311b1ae3be1eca90" category="paragraph">一部の移行手順は、実行前に完全に検証する必要があります。移行とカットオーバープロセスのリハーサルは、ミッションクリティカルなデータベースへの一般的な要求であり、移行を成功させ、ダウンタイムを最小限に抑える必要があります。また、ユーザ受け入れテストは移行後の作業に含まれることが多く、システム全体を本番環境に戻すには、これらのテストが完了する必要があります。</block>
  <block id="7d06b32cdd06d27f7c62fb110d831e60" category="paragraph">リハーサルが必要な場合は、いくつかのONTAP機能を使用すると、プロセスがはるかに簡単になります。特に、スナップショットを使用すると、テスト環境をリセットして、データベース環境のスペース効率に優れた複数のコピーをすばやく作成できます。</block>
  <block id="440a667261bd94f099ef4dde5caf024f" category="summary">個 々 のOracleデータファイルの移行</block>
  <block id="727bb4db430517995ca651c4f57b0c9f" category="doc">データファイルの移動</block>
  <block id="fade70b277397e039e100bf0faa98d8e" category="paragraph">1つのコマンドで個 々 のOracleデータファイルを移動できます。</block>
  <block id="50c3d56e93d52f122bab9de1f2b35780" category="paragraph">たとえば、次のコマンドはデータファイルIOPST.dbfをファイルシステムから移動します。<block ref="87941c54be03c9785752ea54ac9a2dd4" prefix=" " category="inline-code"></block> ファイルシステムへ<block ref="eff8b2f7c4da1cf002bdea257a43fd10" prefix=" " category="inline-code"></block>。</block>
  <block id="53784088a62519d581c3dac4640c41b5" category="paragraph">この方法でデータファイルを移動すると時間がかかることがありますが、通常はI/Oが十分に発生しないため、日常のデータベースワークロードを妨げることはありません。一方、ASMのリバランシングを使用した移行ははるかに高速ですが、データの移動中にデータベース全体の処理速度が低下するという代償があります。</block>
  <block id="f92065612dfd409585ca08d95cc7a4dc" category="paragraph">データファイルの移動に要する時間は、テストデータファイルを作成して移動することで簡単に測定できます。操作の経過時間は、V$セッションデータに記録されます。</block>
  <block id="78fb69ccdf01155db62828d0bc182b84" category="paragraph">この例では、移動したファイルはデータファイル8です。データファイルのサイズは21GBで、移行に約6分かかりました。必要な時間は、ストレージシステムの機能、ストレージネットワーク、および移行時に発生する全体的なデータベースアクティビティによって異なります。</block>
  <block id="593b763e01de37a327966ee1abb3f8a2" category="summary">ホスト側のストレージスタックを使用したOracleの移行</block>
  <block id="174f3246d5f9cdf330404cb6158e67e2" category="doc">Oracleホストテエタコヒイ</block>
  <block id="3dc2d5f8d7209bb75e8d67aed68bc5ed" category="paragraph">データベースレベルの移行と同様に、ホストレイヤでの移行では、ストレージベンダーに依存しないアプローチが提供されます。</block>
  <block id="1686ceaaa0d8fb4f9a8adb5e717b029c" category="paragraph">言い換えれば、いつか「ファイルをコピーするだけ」が最良のオプションです。</block>
  <block id="d5732a4ab4c633ceb871cebdbf9ae34f" category="paragraph">このローテクなアプローチは基本的すぎるように思われるかもしれませんが、特別なソフトウェアは必要なく、プロセス中に元のデータに安全に触れることができないため、大きな利点があります。主な制限事項は、ファイルコピーデータの移行はシステムの停止を伴うプロセスであることです。これは、コピー処理を開始する前にデータベースをシャットダウンする必要があるためです。ファイル内の変更を同期する適切な方法はないため、コピーを開始する前にファイルを完全に休止する必要があります。</block>
  <block id="706e7514bb30a289d7ce786a1a5c2ca0" category="paragraph">コピー処理で必要なシャットダウンが望ましくない場合、次に推奨されるホストベースのオプションは論理ボリュームマネージャ（LVM）を利用することです。Oracle ASMを含む多くのLVMオプションは、すべて同様の機能を備えていますが、いくつかの制限事項を考慮する必要があります。ほとんどの場合、移行はダウンタイムやシステム停止なしで完了します。</block>
  <block id="f58e97ac8406ca3e8f0bb7a019a81985" category="section-title">ファイルシステムからファイルシステムへのコピー</block>
  <block id="a08ab728e75c63a41ce7571cb781cda2" category="paragraph">単純なコピー操作の有用性を過小評価してはなりません。この処理はコピープロセス中のダウンタイムを必要としますが、信頼性の高いプロセスであり、オペレーティングシステム、データベース、ストレージシステムに関する特別な専門知識は必要ありません。さらに、元のデータに影響を与えないため、非常に安全です。通常'システム管理者は'ソース・ファイル・システムを読み取り専用としてマウントするように変更してから'サーバを再起動して'現在のデータに損傷を与えないようにしますコピープロセスをスクリプト化して、ユーザーエラーのリスクなしにできるだけ迅速に実行できるようにすることができます。I/Oのタイプはデータの単純なシーケンシャル転送であるため、帯域幅効率に優れています。</block>
  <block id="ba0bd93801872993ce832352dd03b56a" category="paragraph">次の例は、安全かつ迅速な移行のための1つのオプションを示しています。</block>
  <block id="d8cb8bcd239bbe7a2a488c1d68dbe420" category="paragraph">移行する環境は次のとおりです。</block>
  <block id="3ffbdefc66ad1d1e707c1d6820afbdc0" category="list-text">現在のファイルシステム</block>
  <block id="bdc9e98c6b17bb14a7bce916054413ba" category="list-text">新しいファイルシステム</block>
  <block id="3b878279a04dc47d60932cb294d96259" category="section-title">概要</block>
  <block id="e76912cd513cc8cbcabc2735b524e814" category="paragraph">データベースは、データベースをシャットダウンしてファイルをコピーするだけで移行できますが、多数のデータベースを移行する必要がある場合や、ダウンタイムを最小限に抑えることが重要な場合は、プロセスを簡単にスクリプト化できます。スクリプトを使用すると、ユーザエラーの可能性も低くなります。</block>
  <block id="d21aae9692f3b1d4e53fd73131414b93" category="paragraph">このスクリプトの例では、次の処理が自動化されています。</block>
  <block id="66909ae9d06bad444f5a059b8ee2cd41" category="list-text">データベースのシャットダウン</block>
  <block id="ae737f3f8c04ccbefa99b2bbf87dccc2" category="list-text">既存のファイルシステムの読み取り専用状態への変換</block>
  <block id="1dd90b7b28cbd03687df6538c66ff494" category="list-text">ソース・ファイル・システムからターゲット・ファイル・システムへのすべてのデータのコピー（すべてのファイル権限を保持）</block>
  <block id="741341be7809d7f5765b2352e6ab0aab" category="list-text">古いファイルシステムと新しいファイルシステムのアンマウント</block>
  <block id="7465bc030ca3fe236bcf3ecdf8aaebe4" category="list-text">以前のファイルシステムと同じパスでの新しいファイルシステムの再マウント</block>
  <block id="8c4271e6faf2cea4cfc8e5b7108d8ee9" category="section-title">手順</block>
  <block id="b273f8d4284bd1f58cfbafe8065af9fa" category="list-text">データベースをシャットダウンします。</block>
  <block id="67eadd4b70772835f318e6d3027e4308" category="inline-link-macro">ファイルシステムを読み取り専用に変換</block>
  <block id="474aae6515223cc3ba71074c9d5abcae" category="list-text">ファイルシステムを読み取り専用に変換します。スクリプトを使用すると、に示すように、この処理をより迅速に実行できます。 <block ref="2d6e37849c641071fe1cf71ac348d28c" category="inline-link-macro-rx"></block>。</block>
  <block id="4879ec77723fce4974f8ae2a7f87121a" category="list-text">ファイルシステムが読み取り専用になったことを確認します。</block>
  <block id="c91e7f5dba3c873d0978f4892bf8b3f2" category="list-text">ファイルシステムの内容を<block ref="89a4551b0f29c1a652648b1cb8747021" prefix=" " category="inline-code"></block> コマンドを実行します</block>
  <block id="91e702884985853b8a7091ed5f2beceb" category="inline-link-macro">ファイルシステムの置き換え</block>
  <block id="ea27cab9fe7b891870e0ce59aa34e853" category="list-text">古いファイルシステムをアンマウントし、コピーしたデータを再配置します。スクリプトを使用すると、に示すように、この処理をより迅速に実行できます。 <block ref="fa3b775593af4f3de8972aced258710d" category="inline-link-macro-rx"></block>。</block>
  <block id="5fe2431acb45422c46eadf66a93851af" category="list-text">新しいファイルシステムが所定の位置にあることを確認します。</block>
  <block id="2d53403ab873059f92ad884eb271e8dc" category="list-text">データベースを起動します。</block>
  <block id="40351c33ab81b8b374a20fd292057481" category="section-title">カットオーバーを完全に自動化</block>
  <block id="3f70361470a11fb351c83257cd7aa63e" category="paragraph">このサンプルスクリプトでは、データベースSIDの引数に続いて、共通区切りのファイルシステムペアを指定します。上記の例では、コマンドは次のように実行されます。</block>
  <block id="5cddd7b314b7ae819e2cfcac85021426" category="paragraph">このサンプルスクリプトを実行すると、次のシーケンスが試行されます。いずれかの手順でエラーが発生すると終了します。</block>
  <block id="43d4fce7952ee09c0c8df60a17f5ea56" category="list-text">現在のファイルシステムを読み取り専用ステータスに変換します。</block>
  <block id="9d53d62d1e6dc69460f47c83e6c1919d" category="list-text">カンマで区切られた各ファイルシステム引数のペアを使用し、最初のファイルシステムを2番目のファイルシステムに同期します。</block>
  <block id="39ff0e6dfa9915344ec96f9e78a27267" category="list-text">以前のファイルシステムをディスマウントします。</block>
  <block id="e220fa2a2806386a64e9860f27372e43" category="list-text">を更新します<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> ファイルは次のとおりです。</block>
  <block id="232c2c4ddd45fc028ae13b58251c5f7e" category="list-text">バックアップの作成場所<block ref="9eb56e72a6bb8350a1453c2762d14178" prefix=" " category="inline-code"></block>。</block>
  <block id="d5082ae73767550813688202df21bc4d" category="list-text">以前のファイルシステムと新しいファイルシステムの前のエントリをコメントアウトします。</block>
  <block id="b8793b424d1738f1e00e545379867b0d" category="list-text">古いマウントポイントを使用する新しいファイルシステム用の新しいエントリを作成します。</block>
  <block id="29478980f354caa483bc0cfb827c7251" category="list-text">ファイルシステムをマウントします。</block>
  <block id="a0ec0d8bede7d9d58172084de7d5ce53" category="paragraph">次のテキストは、このスクリプトの実行例を示しています。</block>
  <block id="350265a378d2cb1183cd51d56f0e5843" category="section-title">Oracle ASM spfileとpasswdの移行</block>
  <block id="f37bc722651f2fd86ba4da87f947c4db" category="paragraph">ASMを含む移行を完了する際の難しさの1つに、ASM固有のspfileとパスワードファイルがあります。デフォルトでは、これらの重要なメタデータファイルは、最初に定義されたASMディスクグループに作成されます。特定のASMディスクグループを退避して削除する必要がある場合は、そのASMインスタンスを制御するspfileファイルとパスワードファイルを再配置する必要があります。</block>
  <block id="88e2a97e52f9854b59ce63e74c4b0cac" category="paragraph">これらのファイルの再配置が必要になる別のユースケースとして、SnapManager for OracleやSnapCenter Oracleプラグインなどのデータベース管理ソフトウェアを導入する場合があります。これらの製品の機能の1つは、データファイルをホストしているASM LUNの状態をリバートして、データベースを迅速にリストアすることです。そのためには、リストアを実行する前にASMディスクグループをオフラインにする必要があります。特定のデータベースのデータファイルが専用のASMディスクグループに分離されていれば、これは問題になりません。</block>
  <block id="24de04443b6bdae76336fcab04ae946c" category="paragraph">そのディスクグループにASM spfile/passwdファイルも含まれている場合、ディスクグループをオフラインにするには、ASMインスタンス全体をシャットダウンするしかありません。これはシステムの停止を伴うプロセスであり、spfile/passwdファイルを再配置する必要があります。</block>
  <block id="a6221bf4332cc966c69066295a843480" category="list-text">データベースSID =トースト</block>
  <block id="0af0da2831407b8130e7f2fabdfab87d" category="list-text">現在のデータファイル：<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block></block>
  <block id="24aa2824a0b52b46b301afdb3af9336f" category="list-text">現在のログファイルと制御ファイル<block ref="ad6062251d172504e3b3bed3a8256a5a" prefix=" " category="inline-code"></block></block>
  <block id="bb6de9ea84381f7d01fdd038f104e4ae" category="list-text">シンシイASMテイスククルウフノセツテイ<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block> および<block ref="5e20ccf28224fc0cc564f9825c208dbd" prefix=" " category="inline-code"></block></block>
  <block id="8b14bd9d310bf8b211c19645576201e3" category="section-title">ASM spfile/passwdファイルの場所</block>
  <block id="7c7d8dd5d09a73f06678562b66dcdc68" category="paragraph">これらのファイルは、システムを停止することなく再配置できます。ただし、安全のために、NetAppでは、ファイルが再配置され、構成が適切に更新されたことを確実に確認できるように、データベース環境をシャットダウンすることを推奨しています。サーバに複数のASMインスタンスが存在する場合は、この手順を繰り返す必要があります。</block>
  <block id="3666b74ddcf77306328ac5d6db94fecd" category="section-title">ASMインスタンスの識別</block>
  <block id="9d19a85576af8e1b3dbd78e343a2b022" category="paragraph">に記録されたデータに基づいてASMインスタンスを特定します。<block ref="9da4474b569071bcb2ece1d0bdfe7560" prefix=" " category="inline-code"></block> ファイル。ASMインスタンスは+記号で示されます。</block>
  <block id="3fe2dd8cf6f82ac15544fd96f9b59b28" category="paragraph">このサーバーには+asmというASMインスタンスが1つあります。</block>
  <block id="35a557b0490d5a93931025eaaf712cac" category="section-title">すべてのデータベースがシャットダウンされていることを確認する</block>
  <block id="e6b0819ae1eca7d408a097efc2fbf2cf" category="paragraph">表示されるSMONプロセスは、使用中のASMインスタンスのSMONだけです。別のSMONプロセスが存在する場合は、データベースが実行中であることを示します。</block>
  <block id="97639c779a60f010af01997e2363f4eb" category="paragraph">SMONプロセスはASMインスタンス自体のみです。これは、他のデータベースが実行されていないことを意味し、データベースの処理を中断するリスクを伴わずに、安全に処理を続行できることを意味します。</block>
  <block id="a8d157790e55d19378ddbbdfeb675ef8" category="section-title">ファイルの検索</block>
  <block id="12d8c982eb4072e31ac4bfe375193160" category="paragraph">次のコマンドを使用して、ASM spfileおよびパスワードファイルの現在の場所を特定します。<block ref="e258dbf5114b4df07f0d9e72deb386f2" prefix=" " category="inline-code"></block> および<block ref="bb41cdf6c9bb75ee17856f938070f23d" prefix=" " category="inline-code"></block> コマンド</block>
  <block id="bebe64e9d0d4ae3d44b4dfb3583e0109" category="paragraph">これらのファイルは両方とも、<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> ディスクグループ：</block>
  <block id="558f28628ba8ab4cb8420949524832d3" category="section-title">ファイルのコピー</block>
  <block id="c0c2c850cb11c5bb52abbd55a9578e54" category="paragraph">次のコマンドを使用して、ファイルを新しいASMディスクグループにコピーします。<block ref="c0baea639672c84505e661b9e369c68a" prefix=" " category="inline-code"></block> および<block ref="c7adee97d05083a7b65e4b6953045177" prefix=" " category="inline-code"></block> コマンド新しいディスクグループが最近作成され、現在空の場合は、最初にマウントする必要があります。</block>
  <block id="3ed2faf3e1299edd7d92d6c4064f1579" category="paragraph">ファイルは次の場所からコピーされました：<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 終了：<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block>。</block>
  <block id="1dba5fc559232a8dae45d9f88ed36030" category="section-title">ASMインスタンスの更新</block>
  <block id="1fe2cc6cf436a4bcc6bdc41f947a416a" category="paragraph">ASMインスタンスを更新して、場所の変更を反映する必要があります。。<block ref="c8b1affa9ec15d0c0e79347905e75d3e" prefix=" " category="inline-code"></block> および<block ref="73fb08020d8535b4123a8968c596038c" prefix=" " category="inline-code"></block> コマンドは、ASMディスクグループの起動に必要なASMメタデータを更新します。</block>
  <block id="626759f91a0458b0c068cce8a05a6468" category="section-title">更新ファイルを使用したASMのアクティブ化</block>
  <block id="69f08287c6faa04381e5a05f4087abe1" category="paragraph">この時点で、ASMインスタンスは引き続きこれらのファイルの以前の場所を使用します。新しい場所からファイルを強制的に再読み込みし、以前のファイルのロックを解除するには、インスタンスを再起動する必要があります。</block>
  <block id="5505cf0c514193b89221f1cef3004c58" category="section-title">古いspfileファイルとパスワードファイルを削除する</block>
  <block id="8f2d3ac58be7a91f51d7ce9ffa04e397" category="paragraph">手順が正常に実行されると、以前のファイルはロックされなくなり、削除できるようになります。</block>
  <block id="cfca2b2eb0d694e70904ec82f5d1c34e" category="section-title">Oracle ASMカラASMヘノコヒイ</block>
  <block id="12632d520b8d9518b5622ac00dc764a8" category="paragraph">Oracle ASMは、基本的に軽量なボリュームマネージャとファイルシステムを統合したものです。ファイルシステムはすぐには認識されないため、RMANを使用してコピー処理を実行する必要があります。コピーベースの移動プロセスは安全でシンプルですが、システム停止が発生することがあります。システム停止を最小限に抑えることはできますが、完全に排除することはできません。</block>
  <block id="152106ebb2aaa94cc87657d353331189" category="paragraph">ASMベースのデータベースを無停止で移行する場合は、ASMの機能を活用して、古いLUNを削除しながらASMエクステントを新しいLUNにリバランシングすることを推奨します。これは一般に安全でノンストップオペレーションですが、バックアウトパスは提供されません。機能またはパフォーマンスの問題が発生した場合、唯一の選択肢はデータをソースに戻すことです。</block>
  <block id="81fe23a1ac3b2bb348e579b2c5b0f5d5" category="paragraph">このリスクを回避するには、データを移動するのではなく、データベースを新しい場所にコピーして、元のデータに変更を加えないようにします。データベースは、稼働を開始する前に新しい場所で完全にテストすることができ、問題が見つかった場合は、元のデータベースをフォールバックオプションとして使用できます。</block>
  <block id="3028182db088e823770b3d02aa0eac9e" category="paragraph">この手順は、RMANに関連する多数のオプションの1つです。最初のバックアップが作成され、ログ再生によって後で同期される2段階のプロセスが可能になります。このプロセスでは、最初のベースラインコピーの実行中もデータベースの運用を維持し、データを提供できるため、ダウンタイムを最小限に抑えることが推奨されます。</block>
  <block id="634f50a6c6f112c46150a301d749dbcb" category="section-title">データベースコピー</block>
  <block id="5f0bd85dd65afab1472713e8e034fff7" category="paragraph">Oracle RMANは、ASMディスクグループに現在配置されているソースデータベースのレベル0（完全）コピーを作成します。<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 次の場所に移動します：<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block>。</block>
  <block id="b51dc519efad4b151a05682b68f4b182" category="section-title">アーカイブログの強制切り替え</block>
  <block id="10793485747151dfa2eaddb0854c84b2" category="paragraph">コピーの完全な整合性を確保するために必要なすべてのデータがアーカイブログに含まれていることを確認するには、アーカイブログを強制的に切り替えます。このコマンドを使用しないと、REDOログにキーデータが残っている可能性があります。</block>
  <block id="c55a88a6b8fdc5972d4e2a4924f93dbf" category="section-title">ソースデータベースのシャットダウン</block>
  <block id="9ec82bff06c706f42a8170befdd6cf39" category="paragraph">データベースがシャットダウンされ、アクセスが制限された読み取り専用モードになるため、システムが停止します。ソースデータベースをシャットダウンするには、次のコマンドを実行します。</block>
  <block id="6ecf02e1343e82cf0cd95d7303346ff1" category="section-title">制御ファイルのバックアップ</block>
  <block id="e7bc82f6d1381df55ace121dc02368e6" category="paragraph">移行を中止して元のストレージの場所に戻す必要がある場合に備えて、制御ファイルをバックアップする必要があります。バックアップ制御ファイルのコピーは100%必要ではありませんが、データベースファイルの場所を元の場所にリセットする処理が簡単になります。</block>
  <block id="4e7a51f2c1ee60c69cd719d415f5e87a" category="paragraph">現在のspfileには、古いASMディスクグループ内の現在の場所にある制御ファイルへの参照が含まれています。編集する必要があります。これは、中間のpfileバージョンを編集することで簡単に実行できます。</block>
  <block id="253e30479f86461bc79f2fca58ee4cb1" category="section-title">pfileの更新</block>
  <block id="35db8a54b9c7581f0f77b059233cc61b" category="paragraph">古いASMディスクグループを参照しているすべてのパラメータを更新し、新しいASMディスクグループ名を反映させます。次に、更新されたpfileを保存します。次のことを確認します。<block ref="5fa1d01559c04dcdb3ba05775712b1ab" prefix=" " category="inline-code"></block> パラメータが存在します。</block>
  <block id="bb607fbd46f48c3a4080ecda83288b69" category="paragraph">次の例では、<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 変更されました<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block> 黄色で強調表示されます。主なパラメータは次の2つです。<block ref="5fa1d01559c04dcdb3ba05775712b1ab" prefix=" " category="inline-code"></block> 正しい場所に新しいファイルを作成するパラメータ。</block>
  <block id="5275e85db4d606621d8f074e44b95748" category="section-title">init.oraファイルの更新</block>
  <block id="17a2b5d1af48f7f8d1511d5372896f7a" category="paragraph">ほとんどのASMベースのデータベースでは、<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> ファイルはにあります<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> ディレクトリ。ASMディスクグループ上のspfileへのポイントです。このファイルは、新しいASMディスクグループの場所にリダイレクトする必要があります。</block>
  <block id="6ad274256421918b584abff3b9446b09" category="paragraph">このファイルを次のように変更します。</block>
  <block id="b6638505615764c377e2cf2585993fd0" category="section-title">パラメータファイルの再作成</block>
  <block id="52b21c2e6103a3b8d888a4185e21a787" category="paragraph">これで'編集したpfileのデータをspfileに入力する準備が整いました</block>
  <block id="37f4738eddd35e77d15af55a40e1ab1c" category="section-title">新しいspfileの使用を開始するには'データベースを起動します</block>
  <block id="79f8a930424fe3b21dc30a72791171d4" category="paragraph">データベースを起動して、新しく作成されたspfileが使用されていること、およびシステムパラメータに対するそれ以降の変更が正しく記録されていることを確認します。</block>
  <block id="231ef0ea12d142611eeea2fdfad67114" category="section-title">制御ファイルのリストア</block>
  <block id="33cdbbeabc7f2c647f20b3f8b924307f" category="paragraph">RMANによって作成されたバックアップ制御ファイルは、RMANによって、新しいspfileに指定された場所に直接リストアすることもできます。</block>
  <block id="ce656b7f351ebdc7c599aff6a99e0f2a" category="paragraph">データベースをマウントし、新しい制御ファイルが使用されていることを確認します。</block>
  <block id="fda1e79fe400519496075b7e2871092a" category="section-title">ログ再生</block>
  <block id="daaec4441f16b5bac11476d4582a296c" category="paragraph">データベースは現在、古い場所にあるデータファイルを使用しています。コピーを使用する前に、コピーを同期する必要があります。最初のコピープロセスで時間が経過し、主にアーカイブログに変更が記録されました。これらの変更は次のように複製されます。</block>
  <block id="fca6726270a94f51cab3142509d32919" category="list-text">アーカイブ・ログを含むRMAN増分バックアップを実行します。</block>
  <block id="8b8a5667b011b5f37163ff4da1004343" category="list-text">ログを再生します。</block>
  <block id="a9a62e70841c4d06dd16306a85700d36" category="section-title">アクティブ化</block>
  <block id="8fecb0145484a35b1d9d5926c945ca30" category="paragraph">リストアされた制御ファイルは元の場所にあるデータ・ファイルを参照しており、コピーされたデータ・ファイルのパス情報も含まれています。</block>
  <block id="f590db5fdc10f6942f7cd173c0bb578b" category="list-text">アクティブなデータファイルを変更するには、<block ref="7705ebb59373d0b1dfc71d86ef726f93" prefix=" " category="inline-code"></block> コマンドを実行します</block>
  <block id="2c5c2b5174eafe321358329636e80f5e" category="paragraph">アクティブなデータファイルがコピーされたデータファイルになりますが、最終的なREDOログに変更が含まれている可能性があります。</block>
  <block id="fe83c5826bec1aa20e26802fa94a4a0f" category="list-text">残りのログをすべて再生するには、<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> コマンドを実行しますというメッセージが表示されます<block ref="cef3519da39a73834e89a18ca91951f1" prefix=" " category="inline-code"></block> と表示され、プロセスは成功しました。</block>
  <block id="15434ad90ad32205a804fe96f265b91d" category="paragraph">このプロセスで変更されるのは、通常のデータファイルの場所だけです。一時データファイルの名前は変更する必要がありますが、一時データファイルであるためコピーする必要はありません。データベースは現在ダウンしているため、一時データファイルにアクティブなデータはありません。</block>
  <block id="2a7c5560f8e4ad220c853666c46eb051" category="list-text">一時データファイルを移動するには、まずその場所を特定します。</block>
  <block id="10b2632cf9c3bf6568b36f6a37e627c2" category="list-text">各データファイルに新しい名前を設定するRMANコマンドを使用して、一時データファイルを移動します。Oracle Managed Files（OMF）では、完全な名前は必要ありません。ASMディスクグループで十分です。データベースが開くと、OMFはASMディスクグループ上の適切な場所にリンクします。ファイルを再配置するには、次のコマンドを実行します。</block>
  <block id="2c592b1e2841899b280deafe27eeefbf" category="section-title">Redoログの移行</block>
  <block id="3f53598059c3bf11ff505ad9dc0d6776" category="paragraph">移行プロセスはほぼ完了していますが、REDOログは元のASMディスクグループに残ります。REDOログは直接再配置できません。代わりに、新しいREDOログセットが作成されて設定に追加され、古いログがドロップされます。</block>
  <block id="d54f1c98a924385411a8488657b21dad" category="list-text">Redoログごとに、設定が一致する新しいグループを作成します。OMFを使用しない場合は、フルパスを指定する必要があります。また、この例では、<block ref="c9655c773db3ebd5871fbe76c0e38a52" prefix=" " category="inline-code"></block> パラメータ前述のように、このパラメータは+NEWLOGSに設定されています。この設定では、次のコマンドを使用して、ファイルの場所や特定のASMディスクグループを指定することなく、新しいオンラインログを作成できます。</block>
  <block id="3e0c7c8ee841e9919343fe45e3e04f2d" category="list-text">データベースを開きます。</block>
  <block id="7e4b38db083a404d0d628bdb1ad83311" category="list-text">古いログを削除します。</block>
  <block id="37e48dd687a01e58ed329feebebf3198" category="list-text">アクティブなログをドロップできないエラーが発生した場合は、次のログに切り替えてロックを解除し、グローバルチェックポイントを強制的に実行します。以下に例を示します。古い場所にあるログファイルグループ3を削除しようとしましたが、このログファイルにアクティブなデータが残っているため拒否されました。チェックポイントに続くログアーカイブでは、ログファイルを削除できます。</block>
  <block id="79d08abfbe5fd73dc85c55cd20ad4974" category="list-text">環境をレビューして、すべてのロケーションベースのパラメータが更新されていることを確認します。</block>
  <block id="799f5ce04f1d9cad4455676b2fd908d9" category="list-text">次のスクリプトは、このプロセスを簡素化する方法を示しています。</block>
  <block id="9867dfc0eee2725f24f86d8114c356a0" category="list-text">ASMディスクグループが完全に退避された場合は、次のコマンドを使用してアンマウントできます。<block ref="ae709dc3414219bf2c9c8abc9ff6c67a" prefix=" " category="inline-code"></block>。ただし、多くの場合、他のデータベースまたはASM spfile/passwdファイルに属するファイルが存在する可能性があります。</block>
  <block id="49f8dc5754bd205ea0da17521cb89a1f" category="section-title">Oracle ASMからファイルシステムへのコピー</block>
  <block id="0f5b1767a58e43cb548226e94441dc07" category="paragraph">Oracle ASMからファイルシステムへのコピー手順は、ASMからASMへのコピー手順と非常によく似ていますが、利点と制限は似ています。主な違いは、ASMディスクグループではなく可視ファイルシステムを使用する場合の、さまざまなコマンドや設定パラメータの構文です。</block>
  <block id="b533404c568b600f9fceddeac9253964" category="paragraph">Oracle RMANを使用して、ASMディスクグループに現在配置されているソースデータベースのレベル0（完全）コピーを作成します。<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 次の場所に移動します：<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block>。</block>
  <block id="f78b0ab71e2863c28dbe331056451135" category="paragraph">コピーの完全な整合性を確保するために必要なすべてのデータがアーカイブログに含まれていることを確認するには、アーカイブログの切り替えを強制する必要があります。このコマンドを使用しないと、REDOログにキーデータが残っている可能性があります。アーカイブログを強制的に切り替えるには、次のコマンドを実行します。</block>
  <block id="c37c761fc28428b9ead4533aba9ee148" category="paragraph">データベースがシャットダウンされ、アクセスが制限された読み取り専用モードになるため、システムが停止します。ソースデータベースをシャットダウンするには、次のコマンドを実行します。</block>
  <block id="3abd8870d8a333edcaec6a1082520c67" category="paragraph">移行を中止して元のストレージの場所に戻す必要がある場合に備えて、制御ファイルをバックアップします。バックアップ制御ファイルのコピーは100%必要ではありませんが、データベースファイルの場所を元の場所にリセットする処理が簡単になります。</block>
  <block id="38825215f02e25ca63ff64387b01c1c2" category="paragraph">古いASMディスクグループを参照するすべてのパラメータは、関連性がなくなったときに更新し、場合によっては削除する必要があります。新しいファイルシステムパスを反映するように更新し、更新されたpfileを保存します。完全なターゲットパスが表示されていることを確認します。これらのパラメータを更新するには、次のコマンドを実行します。</block>
  <block id="9d0dce3e570fa0ec18269ca508809401" category="section-title">元のinit.oraファイルを無効にする</block>
  <block id="03dda6526778417460fd0bbb7716b373" category="paragraph">このファイルは、<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> ディレクトリとは、通常、ASMディスクグループ上のspfileへのポインタとして機能するpfile内にあります。元のspfileが使用されていないことを確認するには、名前を変更します。ただし、このファイルは移行を中止する必要がある場合に必要になるため、削除しないでください。</block>
  <block id="6087f741090627369fd114fbc794abc4" category="paragraph">これは'spfile再配置の最後の手順です元のspfileは使用されなくなり'中間ファイルを使用してデータベースが現在起動されています（マウントされていません）このファイルの内容は'次のようにして新しいspfileの場所に書き出すことができます</block>
  <block id="3f62847435205b7b2af1bd5aaf1d3277" category="paragraph">中間ファイルのロックを解除するには、データベースを起動し、新しいspfileファイルのみを使用してデータベースを起動する必要があります。データベースを起動すると、新しいspfileの場所が正しいことと、そのデータが有効であることも証明されます。</block>
  <block id="ea164abfd83078cd71a2f3ba5d237900" category="paragraph">バックアップ制御ファイルがパスに作成されました<block ref="7a1a1280501cff0194d8ce6e351f2a2c" prefix=" " category="inline-code"></block> 手順の初期段階。新しいspfileでは、制御ファイルの場所を次のように定義します。 <block ref="b4d54c88ccade13a82dcaf8f7c07cac5" prefix="/" category="inline-code"></block> および<block ref="cd300fb0386526438b368e7a6d1b8ace" prefix=" " category="inline-code"></block>。ただし、これらのファイルはまだ存在しません。</block>
  <block id="f7ed72e578ca8d23dd45bfa2c0a61ed8" category="list-text">このコマンドは、spfileに定義されているパスに制御ファイルのデータをリストアします。</block>
  <block id="c947c89cb4c7a595782d0be73bbe8cfa" category="list-text">mountコマンドを問題して、制御ファイルが正しく検出され、有効なデータが含まれていることを確認します。</block>
  <block id="da4ae71a31a1286600968f8a340fddb2" category="paragraph">を検証するには<block ref="d98137bd230dac4372cf20a2e7839463" prefix=" " category="inline-code"></block> パラメータを指定して、次のコマンドを実行します。</block>
  <block id="c25a81770c591c46d6909aae84bf5814" category="paragraph">データベースは現在、古い場所にあるデータファイルを使用しています。コピーを使用する前に、データファイルを同期する必要があります。最初のコピープロセスで時間が経過し、変更は主にアーカイブログに記録されました。これらの変更は、次の2つのステップで複製されます。</block>
  <block id="95ea23a5654037c0ab2a5418478d9da2" category="list-text">ログを再生します。</block>
  <block id="e726fdb8508ef59abc6d8ef533186382" category="list-text">アクティブなデータファイルを変更するには、<block ref="7705ebb59373d0b1dfc71d86ef726f93" prefix=" " category="inline-code"></block> コマンドを実行します</block>
  <block id="7fdba4cfea0e0d298cda23e7f46e40c4" category="list-text">データファイルの整合性は完全である必要がありますが、オンラインREDOログに記録された残りの変更を再生するには、最後に1つの手順を実行する必要があります。を使用します<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> これらの変更を再生し、コピーを元のコピーと100%同一にするコマンド。ただし、コピーはまだ開いていません。</block>
  <block id="8eb94d53286760da56ca9c892a49cd8b" category="section-title">一時データファイルの再配置</block>
  <block id="a1e7f15bee0eaa976661307aa884fd99" category="list-text">元のディスクグループでまだ使用されている一時データファイルの場所を特定します。</block>
  <block id="89b79c94ceba42d5bc646c1b4b1acd24" category="list-text">データファイルを移動するには、次のコマンドを実行します。一時ファイルが多数ある場合は、テキスト・エディタを使用してRMANコマンドを作成し、それをカットアンドペーストします。</block>
  <block id="81aa65cb154a5f125bbf3ede064d4b3f" category="paragraph">移行プロセスはほぼ完了していますが、REDOログは元のASMディスクグループに残ります。REDOログは直接再配置できません。代わりに、新しいREDOログセットが作成され、古いログがドロップされて設定に追加されます。</block>
  <block id="6e46687c6cc5deabe53fa42932683c4d" category="list-text">Redoログごとに、新しいファイルシステムの場所を使用して、現在のRedoロググループと同じサイズを使用して新しいグループを作成します。</block>
  <block id="22fd48a866ce4d04edb57c15b2fad5da" category="list-text">以前のストレージにまだ配置されている古いログファイルグループを削除します。</block>
  <block id="94158400e59555bf69ecd550887bd9f6" category="list-text">アクティブログのドロップをブロックするエラーが発生した場合は、次のログに強制的に切り替えてロックを解除し、グローバルチェックポイントを強制的に実行します。以下に例を示します。古い場所にあるログファイルグループ3を削除しようとしましたが、このログファイルにアクティブなデータが残っているため拒否されました。ログをアーカイブしたあとにチェックポイントを追加すると、ログファイルの削除が可能になります。</block>
  <block id="326770a786c5933416b6a167c854e7b8" category="list-text">次のスクリプトは、このプロセスを簡単にする方法を示しています。</block>
  <block id="ffdcdc8ee9653232a906773fa11358fd" category="list-text">ASMディスクグループが完全に退避された場合は、次のコマンドを使用してアンマウントできます。<block ref="ae709dc3414219bf2c9c8abc9ff6c67a" prefix=" " category="inline-code"></block>。多くの場合、他のデータベースまたはASM spfile/passwdファイルに属するファイルは引き続き存在する可能性があります。</block>
  <block id="3d8b8f4734039817e35d5fb6993c8d08" category="section-title">データファイルのクリーンアップ手順</block>
  <block id="637607e2203ac522fc9dbc88deb6c36f" category="inline-link-macro">ASM移行クリーンアップ</block>
  <block id="18325b8b206963bc1ae6cca25406f942" category="paragraph">Oracle RMANの使用方法によっては、移行プロセスの結果、構文が長いデータファイルや暗号化されたデータファイルが生成されることがあります。この例では、次のファイル形式でバックアップが実行されています：<block ref="1da91ad80bcfeb818066022a42cde773" prefix=" " category="inline-code"></block>。<block ref="432459869b7d0085e120ec9454032267" prefix=" " category="inline-code"></block> RMANが各データ・ファイルにデフォルトの一意の名前を作成する必要があることを示します。結果は次のテキストに示されているものと似ています。データファイルの従来の名前は、名前の中に埋め込まれています。これは、に示すスクリプト化されたアプローチを使用してクリーンアップできます。 <block ref="bf0c2c579af181f7d1e4d0267c1385fe" category="inline-link-macro-rx"></block>。</block>
  <block id="5e8488a95f83d2789417a1f3298f2f31" category="section-title">Oracle ASMのリバランシング</block>
  <block id="2768938325db3a71a6713959a0f309d9" category="paragraph">前述したように、Oracle ASMディスクグループは、リバランシングプロセスを使用して新しいストレージシステムに透過的に移行できます。つまり、リバランシングプロセスでは、既存のLUNグループに同じサイズのLUNを追加してから、前のLUNを破棄する必要があります。Oracle ASMは、基盤となるデータを最適なレイアウトで新しいストレージに自動的に再配置し、完了すると古いLUNを解放します。</block>
  <block id="24a638b29b3c55f26c731aa4b9943a52" category="paragraph">マイグレーションプロセスでは効率的なシーケンシャルI/Oを使用し、通常は原因パフォーマンスの中断は発生しませんが、必要に応じてマイグレーション速度を調整できます。</block>
  <block id="25d06b03dd002ad791b19500c58e9f72" category="section-title">移行するデータを特定</block>
  <block id="3709d4034873467e8e6ae138da54a443" category="section-title">新しいLUNを作成する</block>
  <block id="32176bd565539329eafb96db9447e517" category="paragraph">同じサイズの新しいLUNを作成し、必要に応じてユーザとグループのメンバーシップを設定します。LUNはと表示されます。<block ref="bea4821516973214973a70aea8337c38" prefix=" " category="inline-code"></block> ディスク：</block>
  <block id="6e59535a7b8dd239c67b8d015618f5e1" category="section-title">新しいLUNの追加</block>
  <block id="71f7e1ff1a6e075f8364d083f145b655" category="paragraph">追加処理と削除処理は同時に実行できますが、新しいLUNを追加する方が2つの手順で簡単に実行できます。まず、新しいLUNをディスクグループに追加します。この手順により、エクステントの半分が現在のASM LUNから新しいLUNに移行されます。</block>
  <block id="7989dfdf722e8bee00001dac817e4833" category="paragraph">リバランシング電力は、データが転送される速度を示します。数値が大きいほど、データ転送の並列性が高くなります。移行は、効率的なシーケンシャルI/O処理を使用して実行されますが、原因のパフォーマンスに問題が生じることはほとんどありません。ただし、必要に応じて、進行中の移行のリバランシング機能を<block ref="e20ea7dfbbe351f6a5275d7adc71efbd" prefix=" " category="inline-code"></block> コマンドを実行します一般的な移行では、値5が使用されます。</block>
  <block id="2b69f08c262a142b3fb0868f4d31ab4f" category="section-title">動作の監視</block>
  <block id="a5097a0967c777285f74d63bf0cc26a1" category="paragraph">リバランシング処理は、さまざまな方法で監視および管理できます。この例では、次のコマンドを使用しました。</block>
  <block id="5d68829c11bdb5ae7a50b847bb126d44" category="paragraph">移行が完了しても、リバランシング処理は報告されません。</block>
  <block id="957310262614cddc1992368d2d0b14b3" category="section-title">古いLUNを削除する</block>
  <block id="260c16583c8eb689202ed5b4a44708b1" category="paragraph">移行は途中で完了しました。環境が健全であることを確認するために、いくつかの基本的なパフォーマンステストを実行することを推奨します。確認後、古いLUNを削除して残りのデータを再配置できます。これによってLUNがすぐに解放されるわけではないことに注意してください。drop処理は、最初にエクステントを再配置してからLUNを解放するようOracle ASMに通知します。</block>
  <block id="90423249814011b02ba06afd9fb2d617" category="paragraph">リバランシング処理は、さまざまな方法で監視および管理できます。この例では、次のコマンドを使用しました。</block>
  <block id="1544b3a52519b3856f1f7d1e704cb56f" category="section-title">古いLUNを削除する</block>
  <block id="983d704730b30910fc03d3ed444278f0" category="paragraph">ディスクグループから古いLUNを削除する前に、ヘッダーのステータスを最後に確認する必要があります。ASMからLUNを解放すると、LUNの名前は表示されなくなり、ヘッダーステータスが<block ref="e2ffc99cf675f5f0f1a3456438551a9a" prefix=" " category="inline-code"></block>。これは、これらのLUNをシステムから安全に削除できることを示します。</block>
  <block id="22a67c375eff91d37f2363ea69b0c41f" category="section-title">LVMの移行</block>
  <block id="d52f83c78118c243801797ba9b795b72" category="paragraph">ここに示す手順は、LVMベースのボリュームグループ移動の原則を示しています。<block ref="ec2db4422261eae02091227fb9e53c88" prefix=" " category="inline-code"></block>。これらの例はLinux LVMを参考にしていますが、原則はAIX、HP-UX、VxVMにも当てはまります。正確なコマンドは異なる場合があります。</block>
  <block id="64a375907ede7a86c9e8a1b4b142f22e" category="list-text">現在に含まれているLUNを特定します。<block ref="ec2db4422261eae02091227fb9e53c88" prefix=" " category="inline-code"></block> ボリュームグループ：</block>
  <block id="0ae75856dd12545cdd98b8cad5c12ad8" category="list-text">物理サイズが同じか少し大きい新しいLUNを作成し、物理ボリュームとして定義します。</block>
  <block id="2426fa707e9d362c711977b79acd65bb" category="list-text">新しいボリュームをボリュームグループに追加します。</block>
  <block id="02443ebd7f86c3a688a1e3466d3f106a" category="list-text">問題<block ref="8167c9a6bd495f7ed235364201039099" prefix=" " category="inline-code"></block> コマンドを使用して、現在の各LUNのエクステントを新しいLUNに再配置します。。<block ref="1b464374742cfda0167b82bc6f9462f1" prefix=" " category="inline-code"></block> 引数は、操作の進行状況を監視します。</block>
  <block id="ce4a174d56245f6ba5b8808527919921" category="list-text">このプロセスが完了したら、<block ref="3a4d1e7b0af1cf3d80e419c09d238535" prefix=" " category="inline-code"></block> コマンドを実行します成功すると、LUNをシステムから安全に削除できるようになります。</block>
  <block id="599a80136f745b38f35077e1c7eb020e" category="summary">Oracleの移行手順</block>
  <block id="329ffa7a9038afa62748f87628b749d5" category="paragraph">Oracleデータベースへの移行には、さまざまな手順を使用できます。最適なソリューションは、ビジネスニーズに応じて異なります。</block>
  <block id="48a2d08de8943e7ca4718c02e6b791b6" category="paragraph">多くの場合、システム管理者とDBAには、物理ボリュームのデータの再配置、ミラーリングとミラーリングの解除、Oracle RMANを使用したデータのコピーなど、独自の方法があります。</block>
  <block id="79d01f6e7efcfef7db530c0b3c5ea516" category="paragraph">これらの手順は、主に、利用可能なオプションの一部に慣れていないITスタッフ向けのガイダンスとして提供されています。さらに、各移行アプローチのタスク、時間要件、スキルセットの要求についても説明します。これにより、NetAppやパートナーのプロフェッショナルサービスやIT管理者などの他の関係者が、各手順の要件をより十分に理解できるようになります。</block>
  <block id="5604c71a7d9ae37df511cc85052c1894" category="paragraph">移行戦略を作成するための単一のベストプラクティスはありません。計画を作成するには、まず可用性オプションを理解してから、ビジネスのニーズに最適な方法を選択する必要があります。次の図は、基本的な考慮事項と一般的な結論を示していますが、すべての状況に当てはまるわけではありません。</block>
  <block id="fa2e72668f7d48694bef3ba5474e3967" category="paragraph">たとえば、1つのステップで合計データベースサイズの問題が生成されます。次の手順は、データベースが1TBを超えているかどうかによって異なります。推奨される手順は、一般的なお客様の慣行に基づいた推奨事項です。ほとんどのお客様は、DataGuardを使用して小規模なデータベースをコピーすることはありませんが、場合によってはコピーすることもあります。ほとんどのお客様は、時間がかかるため50TBのデータベースをコピーしようとはしませんが、一部のお客様では、このような処理を実行できるだけの十分なメンテナンス時間がある場合があります。</block>
  <block id="82f59f5f005a6ea06f0466a4ffc18b6c" category="paragraph">移行パスが最適な考慮事項のタイプのフローチャートを確認できます。 <block ref="d197151b12289ca0258c12e9b0e8fb1c" category="inline-link-macro-rx"></block>。</block>
  <block id="e38af1623479eee6cfe1782df43819d3" category="paragraph">Oracle 12cR1以降では、データベースをオンラインにしたままデータファイルを移動できます。さらに、異なる種類のファイルシステム間で動作します。たとえば、データファイルをxfsファイルシステムからASMに再配置できます。個 々 のデータファイルの移動処理が必要になるため、この方法は一般に大規模な環境では使用されませんが、データファイルの数が少ない小規模なデータベースの場合は検討する価値があります。</block>
  <block id="5972a038819f045814401b2baea9ee09" category="paragraph">また、データファイルを移動するだけで、既存のデータベースの一部を移行することもできます。たとえば、アクティブでないデータファイルをコスト効率に優れたストレージ（アイドルブロックをオブジェクトストアに格納できるFabricPoolなど）に再配置できます。</block>
  <block id="fcdd0d9eae6df775f1bdc52f950a0160" category="section-title">データベースレベルの移行</block>
  <block id="2b619622b2b8505c335acc8be3a2c3fd" category="paragraph">データベースレベルでの移行とは、データベースがデータを再配置できることを意味します。具体的には、ログ配布を意味します。RMANやASMなどのテクノロジはOracle製品ですが、移行の目的では、ファイルのコピーやボリュームの管理を行うホストレベルで動作します。</block>
  <block id="1048000638cc5357b8b2b36ab55cbc5a" category="section-title">ログ配布</block>
  <block id="36f7294e33f88b462199b92362434684" category="paragraph">データベースレベルの移行の基盤となるのがOracleアーカイブログです。このログには、データベースに対する変更のログが記録されます。ほとんどの場合、アーカイブログはバックアップおよびリカバリ戦略の一部です。リカバリプロセスでは、まずデータベースをリストアし、次に1つ以上のアーカイブログを再生して、データベースを目的の状態に戻します。これと同じ基本テクノロジを使用して、運用の中断をほとんどまたはまったく伴わずに移行を実行できます。さらに重要なのは、このテクノロジにより、元のデータベースに手を加えずに移行できるため、バックアウトパスが維持されます。</block>
  <block id="d43de5ded302797939b76670bc488b51" category="paragraph">移行プロセスは、まずセカンダリサーバへのデータベースバックアップのリストアから始まります。これにはさまざまな方法がありますが、ほとんどのお客様は通常のバックアップアプリケーションを使用してデータファイルをリストアしています。データファイルがリストアされたら、ユーザはログの配布方法を設定します。その目的は、プライマリデータベースで生成されたアーカイブログの一定のフィードを作成し、リストアしたデータベースでそれらのログを再生して、両方を同じ状態に保つことです。カットオーバー時間に達すると、ソースデータベースが完全にシャットダウンされ、最終的なアーカイブログと場合によってはREDOログがコピーされて再生されます。コミットされた最終トランザクションの一部がREDOログに含まれている可能性があるため、REDOログも考慮することが重要です。</block>
  <block id="f6fc42763ddbd981d5803ee6676dc7c3" category="paragraph">これらのログが転送されて再生されると、両方のデータベースの整合性が維持されます。この時点で、ほとんどのお客様はいくつかの基本的なテストを実施します。移行プロセス中にエラーが発生した場合は、ログ再生でエラーが報告されて失敗します。構成が最適であることを確認するために、既知のクエリまたはアプリケーションベースのアクティビティに基づいていくつかのクイックテストを実行することをお勧めします。また、移行したデータベースに元のデータベースが存在するかどうかを確認する前に、最後のテストテーブルを1つ作成してから元のデータベースをシャットダウンすることも一般的です。この手順では、最終的なログ同期中にエラーが発生していないことを確認します。</block>
  <block id="d8e9d23b4beb4db3da15d77542782747" category="paragraph">シンプルなログ配布移行は、元のデータベースに対してアウトオブバンドで構成できるため、ミッションクリティカルなデータベースに特に役立ちます。ソースデータベースの構成の変更は必要ありません。移行環境のリストアと初期設定は、本番環境の運用には影響しません。ログ配布を構成すると、一部のI/O要求が本番サーバに送信されます。ただし、ログ配布ではアーカイブログの単純なシーケンシャル読み取りが行われるため、本番データベースのパフォーマンスへの影響はほとんどありません。</block>
  <block id="2c31403002a9f424c6ef56460c6b3715" category="paragraph">ログ配布は、長距離の変更率の高い移行プロジェクトに特に有用であることが証明されています。たとえば、1つの220TBデータベースを約500マイル離れた場所に移行しました。変更率は非常に高く、セキュリティ上の制約があるため、ネットワーク接続を使用できませんでした。ログ配布はテープと宅配便を使用して実施しました。ソース・データベースのコピーは'最初に以下の手順を使用してリストアされましたログは、カットオーバーの最終セットが配信され、ログがレプリカデータベースに適用されるまで、宅配便によって毎週出荷されました。</block>
  <block id="b8efa655c4deb7af8a24fc241f8b53ff" category="section-title">Oracle DataGuard</block>
  <block id="d3165c4060fc6d19c0a6364e7c4580ee" category="paragraph">場合によっては、完全なDataGuard環境が保証されることもあります。ログ配布またはスタンバイデータベースの構成をDataGuardと呼ぶのは正しくありません。Oracle DataGuardは、データベースレプリケーションを管理するための包括的なフレームワークですが、レプリケーションテクノロジではありません。移行作業における完全なDataGuard環境の主なメリットは、データベース間で透過的にスイッチオーバーできることです。また、新しい環境とのパフォーマンスやネットワーク接続問題などの問題が検出された場合に、元のデータベースに透過的にスイッチオーバーすることもできます。DataGuard環境を完全に構成するには、データベースレイヤだけでなくアプリケーションも構成して、アプリケーションがプライマリデータベースの場所の変更を検出できるようにする必要があります。一般的に、DataGuardを使用して移行を完了する必要はありませんが、DataGuardに関する豊富な専門知識を社内に持ち、移行作業にすでにDataGuardを利用しているお客様もいます。</block>
  <block id="f17c0a1ce359c1a6665412f89234bf41" category="section-title">再アーキテクチャ</block>
  <block id="ece8d784e248d63091fc0d248cdeebc3" category="paragraph">前述したように、ストレージアレイの高度な機能を活用するには、データベースレイアウトの変更が必要になる場合があります。さらに、ASMからNFSファイルシステムへの移行などのストレージプロトコルの変更によって、ファイルシステムのレイアウトが変更される必要があります。</block>
  <block id="71843fb61639ed5fe216bfebc85af16f" category="paragraph">DataGuardなどのログ配布方法の主な利点の1つは、レプリケーション先がソースと一致している必要がないことです。ログ配布アプローチを使用してASMから通常のファイルシステムに（またはその逆に）移行する場合、問題はありません。データファイルの正確なレイアウトを宛先で変更して、Pluggable Database（PDB）テクノロジの使用を最適化したり、特定のファイルに対してQoS制御を選択的に設定したりできます。つまり、ログ配布に基づく移行プロセスを使用すると、データベースストレージレイアウトを簡単かつ安全に最適化できます。</block>
  <block id="f00ec1b23f539163f4c748a85e49e2dd" category="section-title">サーバリソース</block>
  <block id="76c5d43a72d856a95b0eed94694ae696" category="paragraph">データベースレベルの移行の制限事項の1つに、2台目のサーバの必要性があります。この2台目のサーバは、次の2つの方法で使用できます。</block>
  <block id="6cb133f8b5045ef30c17e96ab281749e" category="list-text">2番目のサーバは、データベースの永続的な新しいホームとして使用できます。</block>
  <block id="f5133929790fe62dbc76a73db4c88544" category="list-text">2番目のサーバーを一時的なステージングサーバーとして使用できます。新しいストレージアレイへのデータ移行が完了してテストされると、LUNまたはNFSファイルシステムがステージングサーバから切断され、元のサーバに再接続されます。</block>
  <block id="48a00ba9881b62c610201cd833ee9c88" category="paragraph">最初のオプションは最も簡単ですが、非常に強力なサーバを必要とする非常に大規模な環境では使用できない可能性があります。2番目のオプションでは、ファイルシステムを元の場所に再配置するための追加作業が必要です。ファイルシステムをステージングサーバからアンマウントして元のサーバに再マウントできるため、NFSをストレージプロトコルとして使用する単純な操作にすることができます。</block>
  <block id="c223252c2d577984b75caddbd1dff9dc" category="paragraph">ブロックベースのファイルシステムでは、FCゾーニングまたはiSCSIイニシエータを更新するために追加の作業が必要です。ほとんどの論理ボリュームマネージャ（ASMを含む）では、元のサーバでLUNが使用可能になると、LUNが自動的に検出されてオンラインになります。ただし、ファイルシステムやLVMの実装によっては、データのエクスポートとインポートにより多くの作業が必要になる場合があります。正確な手順は異なる場合がありますが、通常は、移行を完了し、元のサーバにデータをリホームするためのシンプルで反復可能な手順を確立するのは簡単です。</block>
  <block id="2d22ab8be3661ce5dfd8c9910d1cc003" category="paragraph">単一のサーバ環境内でログ配布を設定してデータベースをレプリケートすることは可能ですが、ログを再生するには、新しいインスタンスに別のプロセスSIDを設定する必要があります。異なるSIDを持つ別のプロセスIDセットの下でデータベースを一時的に起動し、後で変更することができます。ただし、管理作業が複雑になり、データベース環境がユーザミスのリスクにさらされる可能性があります。</block>
  <block id="2660e825d3a58f68aeec49e1c749f477" category="section-title">ホストレベルの移行</block>
  <block id="fae5bb68519bf78c1b3711566283f4ef" category="paragraph">ホストレベルでデータを移行するとは、ホストオペレーティングシステムと関連するユーティリティを使用して移行を完了することを意味します。このプロセスには、Oracle RMANやOracle ASMなど、データをコピーするすべてのユーティリティが含まれます。</block>
  <block id="01070e0746a412afd171ccf162d3a170" category="section-title">データコピー</block>
  <block id="180e717e34d5e4bd2991c47960d00f51" category="paragraph">単純なコピー操作の値を過小評価してはなりません。最新のネットワークインフラでは、1秒あたりのギガバイト数でデータを移動できます。ファイルのコピー処理は、効率的なシーケンシャル読み取り/書き込みI/Oに基づいています。ログ配布と比較すると、ホストのコピー処理ではこれ以上のシステム停止は避けられませんが、移行は単なるデータ移動ではありません。通常は、ネットワークへの変更、データベースの再起動時間、移行後のテストが含まれます。</block>
  <block id="750e04d167938f35054d1c30fd06af58" category="paragraph">データのコピーに実際に必要な時間はそれほど長くはありません。さらに、コピー処理では、元のデータが変更されないため、保証されたバックアウトパスが維持されます。移行プロセス中に問題が発生した場合は、元のデータを持つ元のファイルシステムを再アクティブ化できます。</block>
  <block id="5a3572c65171e06d99a4e055f9d35d32" category="section-title">プラットフォームの変更</block>
  <block id="d123cc133e4de7ab3a4b1a5af3bf37a7" category="paragraph">再プラットフォーム化とは、CPUタイプの変更を指します。従来のSolaris、AIX、またはHP-UXプラットフォームからx86 Linuxにデータベースを移行する場合、CPUアーキテクチャの変更により、データを再フォーマットする必要があります。SPARC、IA64、POWER CPUはビッグエンディアンプロセッサとして知られ、x86とx86_64アーキテクチャはリトルエンディアンとして知られている。その結果、Oracleデータファイル内の一部のデータは、使用中のプロセッサによって順序が異なります。</block>
  <block id="6a03806f9c4b1f0048478bab7863fd2c" category="paragraph">従来、お客様はDataPumpを使用してプラットフォーム間でデータをレプリケートしてきました。データダンプは、ターゲットデータベースでより迅速にインポートできる特別なタイプの論理データエクスポートを作成するユーティリティです。データの論理コピーが作成されるため、DataPumpはプロセッサエンディアンの依存関係を残します。一部のお客様はデータダンプを再プラットフォーム化に使用していますが、Oracle 11gではより高速なオプションが利用できるようになりました。クロスプラットフォームで移動可能な表領域です。このアドバンスにより、テーブルスペースを別のエンディアン形式に変換できます。これは、DataPumpエクスポートよりも優れたパフォーマンスを提供する物理的な変換です。DataPumpエクスポートでは、物理バイトを論理データに変換してから、物理バイトに戻す必要があります。</block>
  <block id="713bf8ff4ea4c4ece861f3345e15e3ea" category="paragraph">DataPumpと移動可能な表領域の詳細については、NetAppのドキュメントでは説明していませんが、NetAppでは、新しいCPUアーキテクチャを使用して新しいストレージアレイログに移行する際にお客様をサポートしてきた経験に基づいて、次のような推奨事項がいくつかあります。</block>
  <block id="86b0ebca28354c7f55b4cc2fe79bee0e" category="list-text">DataPumpを使用している場合は、移行の完了に必要な時間をテスト環境で測定する必要があります。お客様は、移行の完了に必要な時間に驚かれることがあります。このような予期しないダウンタイムが発生すると、原因の停止が発生</block>
  <block id="8a592f25a72fd6f3718b1b01869ade30" category="list-text">多くのお客様は、クロスプラットフォームの移動可能な表領域はデータ変換を必要としないと誤って考えています。異なるエンディアンを持つCPUが使用されている場合、RMAN<block ref="31168275dcaac634489082b54c4c66d0" prefix=" " category="inline-code"></block> データファイルに対しては、事前に操作を実行しておく必要があります。これは瞬間的な操作ではありません。場合によっては、異なるデータファイルで複数のスレッドを動作させることで変換処理を高速化することができますが、変換処理を回避することはできません。</block>
  <block id="db7b3f86f4c9a2a6a76adac81614c03b" category="section-title">論理ボリュームマネージャによる移行</block>
  <block id="86586aa50b0df80a7c68bcd3e86c8606" category="paragraph">LVMは、1つ以上のLUNのグループを作成し、それらをエクステントと呼ばれる小さな単位に分割することで機能します。次に、エクステントのプールをソースとして使用して、基本的に仮想化された論理ボリュームを作成します。この仮想化レイヤーは、さまざまな方法で価値を提供します。</block>
  <block id="68d083c44669b8b20f0421b0389c6ded" category="list-text">論理ボリュームは、複数のLUNから取得されたエクステントを使用できます。論理ボリューム上に作成されたファイルシステムは、すべてのLUNのパフォーマンス機能をフルに使用できます。また、ボリュームグループ内のすべてのLUNの均等なロードが促進され、より予測可能なパフォーマンスが提供されます。</block>
  <block id="10d1e748082641ce33e82f457cabcbe7" category="list-text">論理ボリュームのサイズは、エクステントを追加したり、場合によっては削除したりすることで変更できます。論理ボリューム上のファイルシステムのサイズ変更は、通常無停止で実行されます。</block>
  <block id="5efed6e7bf2fda8321882aff35768721" category="list-text">基盤となるエクステントを移動することで、論理ボリュームを無停止で移行できます。</block>
  <block id="96371ba57b3d2f331cc9bd7b5e34708b" category="paragraph">LVMを使用した移行は、エクステントの移動またはエクステントのミラーリング/ミラーリングという2つの方法のいずれかで機能します。LVMの移行では、効率的な大容量ブロックのシーケンシャルI/Oが使用され、パフォーマンスに関する懸念が生じることはほとんどありません。これが問題になった場合は、通常、I/O速度を調整するオプションがあります。これにより、移行の完了に必要な時間が長くなりますが、ホストとストレージシステムのI/O負荷が軽減されます。</block>
  <block id="28084a93e6570f55c3923991e269816e" category="section-title">ミラーおよびデミラー</block>
  <block id="f5b05967100f74bb14ae26d5021ef4e3" category="paragraph">AIX LVMなどの一部のボリュームマネージャでは、各エクステントのコピー数を指定したり、各コピーをホストするデバイスを制御したりできます。移行では、既存の論理ボリュームを取得し、基盤となるエクステントを新しいボリュームにミラーリングし、コピーの同期を待ってから、古いコピーをドロップします。バックアウトパスが必要な場合は、ミラーコピーが破棄される前に元のデータのSnapshotを作成できます。または、サーバを短時間シャットダウンして元のLUNをマスクしてから、格納されているミラーコピーを強制的に削除することもできます。これにより、リカバリ可能なデータのコピーが元の場所に保持されます。</block>
  <block id="7151373ff69a9fafa4a579b40282beeb" category="section-title">エクステントの移行</block>
  <block id="682ba6adb168511d03877bdbf940a0b7" category="paragraph">ほとんどすべてのボリューム・マネージャではエクステントの移行が可能であり'複数のオプションが存在する場合もありますたとえば、一部のボリュームマネージャでは、管理者が特定の論理ボリュームの個 々 のエクステントを古いストレージから新しいストレージに再配置できます。Linux LVM2などのボリュームマネージャは、<block ref="8167c9a6bd495f7ed235364201039099" prefix=" " category="inline-code"></block> コマンド。指定したLUNデバイス上のすべてのエクステントを新しいLUNに再配置します。古いLUNは退避後に削除できます。</block>
  <block id="8c232bd157fb78062260d11e1ec3fc2c" category="admonition">運用の主なリスクは、古い未使用のLUNを構成から削除することです。FCゾーニングを変更したり、古いLUNデバイスを削除したりする場合は、十分に注意する必要があります。</block>
  <block id="41175a8b2053bedbf868e340edf92f55" category="section-title">Oracle自動ストレージ管理</block>
  <block id="dce3f0c1b1c85aaee6448197054602d1" category="paragraph">Oracle ASMは、論理ボリュームマネージャとファイルシステムを組み合わせたものです。大まかに言えば、Oracle ASMはLUNの集まりを受け取り、それらを小さな割り当て単位に分割して、ASMディスクグループと呼ばれる単一のボリュームとして提供します。ASMには、冗長性レベルを設定してディスクグループをミラーリングする機能もあります。ボリュームは、ミラーリングされていない（外部冗長性）、ミラーリングされている（通常の冗長性）、または3方向ミラーリングされている（高冗長性）ことができます。冗長性レベルの設定は作成後に変更できないため、慎重に行う必要があります。</block>
  <block id="d0ac5c14a6207835f733f4366345089d" category="paragraph">ASMは、ファイルシステム機能も提供します。ファイルシステムはホストから直接認識されませんが、OracleデータベースではASMディスクグループ上のファイルやディレクトリを作成、移動、削除できます。また、asmcmdユーティリティを使用して構造体をナビゲートすることもできます。</block>
  <block id="e72c9da30cbec4daedddc9b6e6fdf03b" category="paragraph">他のLVM実装と同様に、Oracle ASMは、使用可能なすべてのLUNにわたって各ファイルのI/Oをストライピングおよびロードバランシングすることで、I/Oパフォーマンスを最適化します。次に、基盤となるエクステントを再配置して、ASMディスクグループのサイズ変更と移行の両方を可能にします。Oracle ASMは、リバランシング処理を通じてプロセスを自動化します。新しいLUNがASMディスクグループに追加され、古いLUNが削除されると、エクステントの再配置と、退避したLUNがディスクグループから削除されます。このプロセスは、最も実証された移行方法の1つであり、透過的な移行を提供するASMの信頼性は、ASMの最も重要な機能である可能性があります。</block>
  <block id="d4ad443888b51ec4e13912c45da68f76" category="admonition">Oracle ASMのミラーリングレベルは固定されているため、mirrorおよびdemirror方式の移行では使用できません。</block>
  <block id="048429277e643e20907317612c1f3318" category="section-title">ストレージレベルの移行</block>
  <block id="623bb7ffbb3730716ea39b5086d26f18" category="paragraph">ストレージレベルの移行とは、アプリケーションレベルとオペレーティングシステムレベルの両方を下回るレベルで移行を実行することを意味します。以前は、これはネットワークレベルでLUNをコピーする専用のデバイスを使用することを意味していましたが、現在ではこれらの機能はONTAPに標準で搭載されています。</block>
  <block id="794cb725c5631ad99b5b7c000307f0df" category="section-title">SnapMirror</block>
  <block id="963ce762febea70d619f1fd5c114d85c" category="paragraph">NetAppシステム間でのデータベースの移行は、ほとんどの場合、NetApp SnapMirrorデータレプリケーションソフトウェアを使用して実行されます。このプロセスでは、移動するボリュームのミラー関係を設定して同期を許可し、カットオーバー時間を待機します。到着すると、ソースデータベースがシャットダウンされ、最後のミラー更新が1回実行され、ミラーが解除されます。レプリカボリュームは、格納されているNFSファイルシステムディレクトリをマウントするか、格納されているLUNを検出してデータベースを開始することで、使用できる状態になります。</block>
  <block id="1871452e5ea7e53152b5c874a12a890b" category="paragraph">単一のONTAPクラスタ内でのボリュームの再配置は、移動とはみなされず、日常的な作業です。<block ref="0fc2ecb8aa71bddc595fbc39f593496a" prefix=" " category="inline-code"></block> 操作。SnapMirrorは、クラスタ内でデータレプリケーションエンジンとして使用されます。このプロセスは完全に自動化されています。LUNマッピングやNFSエクスポート権限など、ボリュームの属性がボリューム自体と一緒に移動された場合に実行する追加の移行手順はありません。再配置では、ホストの処理が中断されません。場合によっては、再配置されたデータに可能な限り効率的にアクセスできるようにネットワークアクセスを更新する必要がありますが、これらのタスクも無停止で実行できます。</block>
  <block id="19fee3ea4b7f4472b5c1853122e8f47b" category="section-title">Foreign LUN Import（FLI）</block>
  <block id="a73cf458eed5aeff5c15aa5d70298cce" category="paragraph">FLIは、8.3以降を実行するData ONTAPシステムで既存のLUNを別のストレージアレイから移行できる機能です。手順はシンプルです。ONTAPシステムは、他のSANホストと同様に既存のストレージアレイにゾーニングされます。次に、Data ONTAPが必要な従来型LUNを制御し、基盤となるデータを移行します。また、インポートプロセスでは、データの移動時に新しいボリュームの効率化設定が使用されます。つまり、移動プロセス中にデータをインラインで圧縮したり重複排除したりできます。</block>
  <block id="0ee4b09881406835f151f103412a2f1e" category="paragraph">Data ONTAP 8.3で初めて実装されたFLIでは、オフライン移行のみが可能でした。これは非常に高速な転送でしたが、移行が完了するまでLUNデータを使用できないことを意味していました。オンライン移行はData ONTAP 8.3.1で導入されました。このような移行では、転送プロセス中にONTAPがLUNデータを提供できるようになるため、システム停止を最小限に抑えることができます。ONTAP経由でLUNを使用するようにホストをゾーニングしている間、システムが短時間停止します。ただし、これらの変更が行われるとすぐに、データに再びアクセスでき、移行プロセス中も引き続きアクセスできます。</block>
  <block id="19d95ee75467fc2f9a06d150cc99d944" category="paragraph">コピー処理が完了するまで読み取りI/OはONTAP経由でプロキシされ、書き込みI/Oは外部LUNとONTAP LUNの両方に同期的に書き込まれます。管理者が完全なカットオーバーを実行して外部LUNを解放し、書き込みをレプリケートしなくなるまで、2つのLUNコピーはこの方法で同期されます。</block>
  <block id="5caad387757ca99ada41709ce30a31a5" category="paragraph">FLIはFCと連携するように設計されていますが、iSCSIに変更する必要がある場合は、移行の完了後に、移行したLUNをiSCSI LUNとして簡単に再マッピングできます。</block>
  <block id="7fa6cfc683e0f5f9e3a79f6be14e23f4" category="paragraph">FLIの機能の1つに、アライメントの自動検出と調整があります。アライメントという用語は、LUNデバイス上のパーティションを指します。パフォーマンスを最適化するには、I/Oが4Kブロックにアライメントされている必要があります。パーティションを4Kの倍数ではないオフセットに配置すると、パフォーマンスが低下します。</block>
  <block id="7b4ef266729f1ddfbc724cad17af4efc" category="paragraph">アライメントには、パーティションオフセット（ファイルシステムのブロックサイズ）を調整して修正できないもう1つの側面があります。たとえば、ZFSファイルシステムのデフォルトの内部ブロックサイズは512バイトです。AIXを使用しているお客様の中には、ブロックサイズが512バイトまたは1バイトのJFS2ファイルシステムを作成するケースもあります。ファイルシステムは4Kの境界にアライメントされていても、そのファイルシステム内に作成されたファイルはアライメントされず、パフォーマンスが低下します。</block>
  <block id="1d6b28ed67b1d554df806b0b5a020711" category="paragraph">このような状況ではFLIを使用しないでください。移行後はデータにアクセスできますが、その結果、ファイルシステムのパフォーマンスが大幅に制限されます。一般的な原則として、ONTAPでランダムオーバーライトワークロードをサポートするファイルシステムでは、4Kブロックサイズを使用する必要があります。これは主に、データベースデータファイルやVDI環境などのワークロードに該当します。ブロックサイズは、関連するホストオペレーティングシステムコマンドを使用して特定できます。</block>
  <block id="4941562ef813562e0d6aaef673158b99" category="paragraph">たとえば、AIXでは、ブロックサイズを<block ref="10c9a985c983a826424b496a708263ec" prefix=" " category="inline-code"></block>。Linuxの場合、<block ref="ba5265473f00b27178098cc38d3aef24" prefix=" " category="inline-code"></block> および<block ref="1f8a87190704df357c64a49aee936874" prefix=" " category="inline-code"></block> 次の用途に使用できます。<block ref="310201b6353c5f38bc039e0e51b079d3" prefix=" " category="inline-code"></block> および<block ref="5382133ffbecb9bce9d47f2e44327b16" prefix=" " category="inline-code"></block>をクリックします。を使用<block ref="8cbc6ba7c8bba133ce2bc44780d88742" prefix=" " category="inline-code"></block>コマンドは次のようになります。<block ref="1615297782a0dff59b20451e2ca97ea7" prefix=" " category="inline-code"></block>。</block>
  <block id="033a4cb04b5225e2b7cf966f2ce16598" category="paragraph">ブロックサイズを制御するパラメータは次のとおりです。<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 通常、デフォルト値は9です。これは2^9、つまり512バイトを意味します。最適なパフォーマンスを実現するには、<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 値は12（2^12=4K）である必要があります。この値はzpoolの作成時に設定され、変更することはできません。つまり、<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 12以外の場合は、新しく作成したzpoolにデータをコピーして移行する必要があります。</block>
  <block id="8bd9661d8c8eb9924c62b8242191af4e" category="paragraph">Oracle ASMには基本ブロックサイズはありません。唯一の要件は、ASMディスクを構築するパーティションが適切にアライメントされていることです。</block>
  <block id="ea7f7e1e8119ee64585b6173afe720e8" category="section-title">7-Mode Transition Tool</block>
  <block id="75df51cc2f43b8dde951695f97b838c0" category="paragraph">7-Mode Transition Tool（7MTT）は、7-Modeの大規模な構成をONTAPに移行するための自動化ユーティリティです。データベースをご利用のお客様は、ストレージの設置面積全体を移動するのではなく、データベース単位で環境のデータベースを移行することが多いため、他の方法を簡単に見つけることができます。また、多くの場合、データベースは大規模なストレージ環境の一部にすぎません。そのため、データベースは多くの場合個別に移行され、その後7MTTを使用して残りの環境を移動できます。</block>
  <block id="85fd7dcbc2206c27059ae7f88712154d" category="paragraph">複雑なデータベース環境に特化したストレージシステムを運用しているお客様は少なくありませんが、かなりの数のお客様がいらっしゃいます。これらの環境には、多数のボリュームやSnapshotのほか、エクスポート権限、LUNイニシエータグループ、ユーザ権限、Lightweight Directory Access Protocolの設定など、さまざまな設定の詳細が含まれている可能性があります。このような場合は、7MTTの自動化機能によって移動が簡易化されます。</block>
  <block id="2c87fbdecbf0dfe299f9f89958d61085" category="paragraph">7MTTは次の2つのモードのいずれかで動作します。</block>
  <block id="dc818e71a5519d1b99c7e996cf21fd74" category="list-text">*コピーベースの移行（CBT）。* 7MTTとCBTにより、新しい環境の既存の7-ModeシステムからSnapMirrorボリュームがセットアップされます。データの同期が完了すると、7MTTによってカットオーバープロセスがオーケストレーションされます。</block>
  <block id="453bbc96e365e25cc2d091dced3565a6" category="list-text">*コピーフリーの移行（CFT）。* CFTを使用する7MTTは、既存の7-Modeディスクシェルフのインプレース変換に基づいています。データはコピーされず、既存のディスクシェルフは再利用できます。データ保護とStorage Efficiencyの既存の設定は維持されます。</block>
  <block id="16262236c3981cb3310b9320b5a67fd0" category="paragraph">これら2つのオプションの主な違いは、コピーフリーの移行はビッグバンアプローチであり、元の7-Mode HAペアに接続されているすべてのディスクシェルフを新しい環境に再配置する必要がある点です。シェルフのサブセットを移動するオプションはありません。コピーベースのアプローチでは、選択したボリュームを移動できます。また、ディスクシェルフを再ケーブル接続してメタデータを変換する際にも同様の接続が必要になるため、コピーフリーの移行ではカットオーバー時間が長くなる可能性があります。NetAppでは、現場での経験に基づき、ディスクシェルフの再配置と再接続には1時間、メタデータ変換には15分から2時間かかることを推奨しています。</block>
  <block id="c8365c28332d425fd91f2de2e2c22dfb" category="summary">FLI移行のためのONTAPの準備</block>
  <block id="25c18537e56595b3e7f3ce78905917ba" category="doc">FLIの計画- Oracle</block>
  <block id="f1033948d9d2d14612d27f1808720f12" category="inline-link">TR-4380：『SAN Migration Using Foreign LUN Import』</block>
  <block id="58fc59a248fefa86003ac1867e5bd279" category="paragraph">FLIを使用してSANリソースを移行する手順については、NetAppを参照してください。<block ref="5abd855dd5d8332b78fa966ac34c0f22" category="inline-link-rx"></block>。</block>
  <block id="795bbfbd054829fad905065087ba2d5a" category="paragraph">データベースとホストの観点からは、特別な手順は必要ありません。FCゾーンが更新されてLUNがONTAPで使用可能になると、LVMはLUNからLVMメタデータを読み取れるようになります。また、ボリュームグループを使用するための準備が整い、それ以上の設定手順は必要ありません。まれに、以前のストレージアレイへの参照がハードコーディングされた構成ファイルが環境に含まれることがあります。例えばLinuxシステムには<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 特定のデバイスのWWNを参照するルールは、FLIで導入された変更を反映するように更新する必要があります。</block>
  <block id="9e7ddc2ddefcd6f202fb11a82a80bc7e" category="admonition">サポートされている構成については、NetApp互換性マトリックスを参照してください。お使いの環境が含まれていない場合は、NetAppの担当者にお問い合わせください。</block>
  <block id="0f5b3758229b3e28c8605b6c42398115" category="paragraph">この例は、LinuxサーバでホストされているASM LUNとLVM LUNの両方の移行を示しています。FLIは他のオペレーティングシステムでもサポートされており、ホスト側のコマンドは異なる場合がありますが、原則は同じで、ONTAPの手順も同じです。</block>
  <block id="f1036cd97e461d07351c9df32fc5948d" category="section-title">LVM LUNの特定</block>
  <block id="88f7413f9621a816ee3d370703168647" category="paragraph">準備の最初の手順は、移行するLUNを特定することです。この例では、2つのSANベースのファイルシステムが<block ref="572f241ef88fdb17d16eba97133d861f" prefix=" " category="inline-code"></block> および<block ref="d14bc7787c7396144583e99a7df52f67" prefix=" " category="inline-code"></block>。</block>
  <block id="ecad615a52fda392a9b7c1075d2cb2c5" category="paragraph">ボリューム・グループの名前は'（ボリューム・グループ名）-（論理ボリューム名）という形式のデバイス名から抽出できますこの場合、ボリュームグループの名前は<block ref="bb97320b8c517da828eae4ec543113db" prefix=" " category="inline-code"></block>。</block>
  <block id="b08986bb1757d5ae8de06d523c71803d" category="paragraph">。<block ref="f1e2c495108b111c930735e3a0f9a04e" prefix=" " category="inline-code"></block> このボリュームグループをサポートするLUNを特定するには、コマンドを次のように使用します。この例では、<block ref="bb97320b8c517da828eae4ec543113db" prefix=" " category="inline-code"></block> ボリュームグループ：</block>
  <block id="8b47fac6803dfff2e8d2cdad6f297cfa" category="section-title">ASM LUNの識別</block>
  <block id="a23d0124954ecdbfe9d0f3aceb9e17a2" category="paragraph">ASM LUNも移行する必要があります。LUNとLUNパスの数をsqlplusからSYSASMユーザとして取得するには、次のコマンドを実行します。</block>
  <block id="918841992da84786f00de7c4c7d83dbf" category="paragraph">現在の環境には、移行するLUNが20個含まれています。現在のSANを更新して、ONTAPが現在のLUNにアクセスできるようにします。データはまだ移行されていませんが、ONTAPは現在のLUNから構成情報を読み取って、そのデータの新しいホームを作成する必要があります。</block>
  <block id="5816768a5d83977f34ffa5025c14f430" category="paragraph">AFF / FASシステムの少なくとも1つのHBAポートをイニシエータポートとして設定する必要があります。また、ONTAPが外部ストレージアレイ上のLUNにアクセスできるように、FCゾーンを更新する必要があります。一部のストレージアレイでは、特定のLUNにアクセスできるWWNを制限するLUNマスキングが設定されています。その場合は、LUNマスキングも更新して、ONTAP WWNへのアクセスを許可する必要があります。</block>
  <block id="030a992b1340f67584d67ef6230e9adf" category="paragraph">この手順が完了すると、ONTAPは外部ストレージアレイを<block ref="d90ba20b63acab53952d68665c50ec47" prefix=" " category="inline-code"></block> コマンドを実行します返されるキーフィールドは、システム上の外部LUNの識別に使用されるプレフィックスです。次の例では、外部アレイ上のLUN<block ref="25103eba8d70e82b5bd837be0d2f63c4" prefix=" " category="inline-code"></block> プレフィックスを使用してONTAP内に表示されます。<block ref="6b35470d99880c4630ed3ca7b4c842e7" prefix=" " category="inline-code"></block>。</block>
  <block id="c1a0f5174323df40a8b659eb65ac5155" category="section-title">外部アレイの識別</block>
  <block id="6c1b8919e2e706972b3ec48cb7f014ba" category="section-title">外部LUNの識別</block>
  <block id="63841e312d3a8531331e35bd826268d1" category="paragraph">LUNを表示するには、<block ref="907702f5103a7823393b8dd296a75c26" prefix=" " category="inline-code"></block> に移動します<block ref="242f4ce1948273386f8bb487bdd3732f" prefix=" " category="inline-code"></block> コマンドを実行します返されるデータは、移行手順中に複数回参照されます。</block>
  <block id="e5e94f7e2098883f0d621e064b1104f4" category="section-title">外部アレイLUNをインポート候補として登録</block>
  <block id="c968ec41c1c0c449b0263962966d8293" category="paragraph">外部LUNは、最初は特定のLUNタイプとして分類されます。データをインポートする前に、LUNを外部としてタグ付けする必要があるため、インポートプロセスの候補になる必要があります。この手順は、シリアル番号を<block ref="93c633f7fa188f1b27df574c0e5e929a" prefix=" " category="inline-code"></block> 次の例に示すように、コマンドを実行します。このプロセスでは、ONTAP内でLUNのみが外部としてタグ付けされることに注意してください。外部LUN自体にはデータは書き込まれません。</block>
  <block id="33380a523841f23815f2f83c9de1a628" category="section-title">移行したLUNをホストするボリュームの作成</block>
  <block id="2c2ba8ca6bdd77da1da981b91a3fae4a" category="paragraph">移行したLUNをホストするにはボリュームが必要です。正確なボリューム構成は、ONTAPの機能を活用する全体的な計画によって異なります。この例では、ASM LUNが1つのボリュームに配置され、LVM LUNが2つ目のボリュームに配置されています。これにより、階層化、Snapshotの作成、QoS制御の設定などの目的で、LUNを独立したグループとして管理できます。</block>
  <block id="8bc7d64e68e4be8f4908effd57293a2a" category="paragraph">を設定します<block ref="fb983ebeedc63d8723c0d4aa558a4c02" prefix=" " category="inline-code"></block>。移行プロセスには、大量のデータの入れ替えが含まれる場合があります。そのため、Snapshotに不要なデータがキャプチャされるために誤ってSnapshotを作成すると、スペース消費が大幅に増加する可能性があります。</block>
  <block id="8c0675d07e44f55f1f5aa6d45abe0cdb" category="section-title">ONTAP LUNの作成</block>
  <block id="0b799020dac78a5e12a3d1a6400fd0c8" category="paragraph">ボリュームを作成したら、新しいLUNを作成する必要があります。通常、LUNを作成する際にはLUNサイズなどの情報を指定する必要がありますが、この場合はforeign-disk引数がコマンドに渡されます。その結果、ONTAPは指定されたシリアル番号から現在のLUN設定データを複製します。また、LUNジオメトリとパーティションテーブルのデータを使用してLUNのアライメントを調整し、最適なパフォーマンスを確立します。</block>
  <block id="5272a1dc3854f1eddc353c8073234e03" category="paragraph">この手順では、外部アレイに対してシリアル番号を相互参照して、正しい外部LUNが正しい新しいLUNに照合されるようにする必要があります。</block>
  <block id="f6ee70ec9fce7bd34fa5a33d8969fb5e" category="section-title">インポート関係を作成する</block>
  <block id="94700a911b95416221efe4064acbc2ba" category="paragraph">LUNは作成されましたが、レプリケーション先としては設定されていません。この手順を実行する前に、LUNをオフラインにする必要があります。この追加手順は、ユーザエラーからデータを保護するように設計されています。ONTAPでオンラインのLUNで移行を実行できると、入力ミスが原因でアクティブなデータが上書きされるリスクがあります。ユーザに最初にLUNをオフラインにするよう強制する追加手順は、正しいターゲットLUNが移行先として使用されていることを確認するのに役立ちます。</block>
  <block id="85255e52054af9c6ffd3c4e79c723a34" category="paragraph">LUNがオフラインになったら、外部LUNのシリアル番号を<block ref="04c2f87857699971f5aedd525e65690a" prefix=" " category="inline-code"></block> コマンドを実行します</block>
  <block id="8e3c921431d2b7f66fa0cc85f3ae5c9d" category="paragraph">すべてのインポート関係が確立されたら、LUNをオンラインに戻すことができます。</block>
  <block id="ea382cbfdb353cee0cf25eaae9bba150" category="section-title">イニシエータグループの作成</block>
  <block id="152c4728a5fb152525a639439b9d7cb9" category="inline-link-macro">プロトコル変換</block>
  <block id="2ba97db75ee4a901edea96edf3d2ddaa" category="paragraph">イニシエータグループ（igroup）は、ONTAP LUNマスキングアーキテクチャの一部です。新しく作成したLUNには、ホストに最初にアクセスを許可しないかぎりアクセスできません。そのためには、アクセスを許可するFC WWNまたはiSCSIイニシエータ名をリストするigroupを作成します。このレポートの作成時点では、FLIはFC LUNでのみサポートされていました。ただし、移行後のiSCSIへの変換は簡単です（を参照）。 <block ref="4f9fd7f3e31161eaca60ca6de385a92c" category="inline-link-macro-rx"></block>。</block>
  <block id="298a1c3c736859f2cfa3cb8eb1f3fdcc" category="paragraph">この例では、ホストのHBAで使用可能な2つのポートに対応する2つのWWNを含むigroupが作成されます。</block>
  <block id="4f6f03762bfcdc7174cdd30240ce45b3" category="section-title">新しいLUNをホストにマッピング</block>
  <block id="c22fee2d07a149be91ae1ae2ada1cb57" category="paragraph">igroupの作成後、LUNは定義したigroupにマッピングされます。これらのLUNは、このigroupに含まれるWWNでのみ使用できます。NetAppでは、移動プロセスのこの段階で、ホストがONTAPにゾーニングされていないことを前提としています。これは重要なことです。ホストが外部アレイと新しいONTAPシステムに同時にゾーニングされていると、各アレイで同じシリアル番号のLUNが検出されるリスクがあるためです。マルチパスの誤動作やデータの破損が発生する可能性があります。</block>
  <block id="ecca392290c36269e0489c0b1cf36f50" category="summary">Oracle移行処理を自動化するサンプルスクリプト</block>
  <block id="fc53c036602508ed6c2afc18e2fbdf51" category="doc">サンプルスクリプト</block>
  <block id="6f78af00b87bcad5d08c95c7b6066ad0" category="paragraph">ここで紹介するスクリプトは、さまざまなOSおよびデータベースタスクのスクリプト作成方法の例として提供されています。それらはそのまま供給されます。特定の手順のサポートが必要な場合は、NetAppまたはNetAppリセラーにお問い合わせください。</block>
  <block id="3146889e40b3ca2b78c56a19178bff84" category="section-title">データベースのシャットダウン</block>
  <block id="5b98b9877c0c74dc3a3daf46cf943d3f" category="paragraph">次のPerlスクリプトは、Oracle SIDの引数を1つ指定してデータベースをシャットダウンします。Oracleユーザまたはrootとして実行できます。</block>
  <block id="7df41a3619af59182fb5df6d1920d11a" category="section-title">データベースの起動</block>
  <block id="57249fb9cdac8ddc9ea8843636c4e088" category="section-title">ファイルシステムを読み取り専用に変換</block>
  <block id="f2977a22ba44544ca8921e2d75bce435" category="paragraph">次のスクリプトは、ファイルシステム引数を取り、ディスマウントして読み取り専用として再マウントしようとします。これは、データをレプリケートするためにファイルシステムの可用性を維持しつつ、偶発的な破損から保護する必要がある移行プロセスで役立ちます。</block>
  <block id="4eac395595a8d266839db0b88fae31e4" category="section-title">ファイルシステムの交換</block>
  <block id="988d7030a130298e1641007b5b0aae20" category="paragraph">次のスクリプト例は、あるファイルシステムを別のファイルシステムに置き換えるために使用します。`/etc/fstab`ファイルを編集するので、rootとして実行する必要があります。古いファイルシステムと新しいファイルシステムの単一のカンマ区切り引数を受け入れます。</block>
  <block id="149c75d086adf78a50a16bcb5e349158" category="list-text">ファイルシステムを交換するには、次のスクリプトを実行します。</block>
  <block id="67a4c588434c781febb12c165c3e860a" category="paragraph">このスクリプトの使用例として、<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> の移行先<block ref="27df80f143a5812bda1553d09c712efc" prefix=" " category="inline-code"></block> および<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block> の移行先<block ref="1c988fc7a325635f00f9b55992128a08" prefix=" " category="inline-code"></block>。このタスクを実行する最も簡単な方法の1つは、単純なファイルコピー操作を使用して、新しいデバイスを元のマウントポイントに再配置することです。</block>
  <block id="4a3d90c30a5e921650fe8ad0decf4827" category="list-text">古いファイルシステムと新しいファイルシステムが<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> ファイルは次のとおりです。</block>
  <block id="4588a4e3d2f8d0f7c036f59c1be2163f" category="list-text">このスクリプトを実行すると、現在のファイルシステムがアンマウントされ、新しいファイルシステムに置き換えられます。</block>
  <block id="2d808cb44231d0a80164567e7220fc44" category="list-text">このスクリプトでは、<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 必要に応じてファイルを作成この例では、次の変更が含まれています。</block>
  <block id="840967a448e36b9efeaacf7673f825aa" category="section-title">データベース移行の自動化</block>
  <block id="1107dd36fe8ba0c18ea8abc8734986e2" category="paragraph">この例では、シャットダウン、起動、およびファイルシステム置換スクリプトを使用して移行を完全に自動化する方法を示します。</block>
  <block id="36881541e7d9c7bced65fcac337ac327" category="section-title">ファイルの場所を表示する</block>
  <block id="1e9a1acc40d4943a73e6865cdebaf560" category="paragraph">このスクリプトは、多数の重要なデータベースパラメータを収集し、読みやすい形式で出力します。このスクリプトは、データレイアウトを確認する場合に役立ちます。また、他の用途に合わせてスクリプトを変更することもできます。</block>
  <block id="6172b49b7fdf806b59af0aeef8de71e3" category="section-title">ASM移行のクリーンアップ</block>
  <block id="dd8d75d6766af495b5442e67eb27d387" category="section-title">ASMからファイルシステム名への変換</block>
  <block id="abc3fc91423668bb4bd49e6e837fa3e4" category="section-title">データベースでログを再生</block>
  <block id="cc7b9a518bb2532f61662a9893248133" category="paragraph">このスクリプトは、マウントモードのデータベースに対してOracle SIDの引数を1つ指定し、現在使用可能なすべてのアーカイブログを再生します。</block>
  <block id="2a5bd3a209a1ed33b81c5306780227ce" category="section-title">スタンバイデータベースでログを再生</block>
  <block id="ea7bebed0b4151a9b28acbde55fc0eb3" category="paragraph">このスクリプトは、スタンバイデータベース用に設計されている点を除き、上記のスクリプトと同じです。</block>
  <block id="109be8945d38cda6c034a22373bdbd3b" category="summary">FLI移行後のSANプロトコルの変更</block>
  <block id="b5e65fbdff41aa940dad918d9f7c0b9e" category="doc">FLIプロトコルの変更- Oracle</block>
  <block id="2adcfd589637337984e39e94dd14ae33" category="paragraph">LUNへのアクセスに使用するプロトコルの変更は、一般的な要件です。</block>
  <block id="38fe6838f11a6023172d11d806adbfcf" category="paragraph">場合によっては、全体的な戦略の一環としてデータをクラウドに移行することもあります。TCP/IPはクラウドのプロトコルであり、FCからiSCSIに変更することで、さまざまなクラウド環境への移行が容易になります。また、IP SANのコスト削減を活用するためにiSCSIが望ましい場合もあります。移行では、一時的な手段として別のプロトコルが使用されることがあります。たとえば、外部アレイとONTAPベースのLUNを同じHBA上に共存させることができない場合は、iSCSI LUNを使用して古いアレイからデータをコピーできます。その後、古いLUNをシステムから削除したあとにFCに変換し直すことができます。</block>
  <block id="832c81bd0db3ad98a3804ff5ce996a58" category="paragraph">次の手順はFCからiSCSIへの変換を示していますが、全体的な原則はiSCSIからFCへの逆変換に適用されます。</block>
  <block id="e21180783b17ea695cf9275fce8a0bc7" category="section-title">iSCSIイニシエータのインストール</block>
  <block id="0e1ddcc32a3ef636c9ca084a3d7706f5" category="paragraph">ほとんどのオペレーティングシステムには、デフォルトでソフトウェアiSCSIイニシエータが含まれていますが、含まれていない場合は簡単にインストールできます。</block>
  <block id="289fe013df899f5f74fb362d4efcdd5d" category="section-title">iSCSIイニシエータ名の識別</block>
  <block id="8242e97b190184a6c7b8ec96c5662886" category="paragraph">インストールプロセス中に一意のiSCSIイニシエータ名が生成されます。Linuxの場合は、<block ref="22565a44e8f73044eb2029acbb069639" prefix=" " category="inline-code"></block> ファイル。この名前は、IP SAN上のホストを識別するために使用されます。</block>
  <block id="721a96eb0b922b337fa815839839b328" category="section-title">新しいイニシエータグループを作成する</block>
  <block id="cda1311d977b7b77ad3aebe4a813b3bd" category="paragraph">イニシエータグループ（igroup）は、ONTAP LUNマスキングアーキテクチャの一部です。新しく作成したLUNには、ホストに最初にアクセスを許可しないかぎりアクセスできません。そのためには、アクセスが必要なFC WWNまたはiSCSIイニシエータ名のいずれかをリストするigroupを作成します。</block>
  <block id="6548788f050643897f7354b6df4488db" category="paragraph">この例では、LinuxホストのiSCSIイニシエータを含むigroupを作成しています。</block>
  <block id="da8490d81c1ef6b559b09c2ab94631d2" category="section-title">環境をシャットダウンする</block>
  <block id="0bf211160ad57fedca3499176f213b11" category="paragraph">LUNプロトコルを変更する前に、LUNを完全に休止する必要があります。変換するLUNのいずれかのデータベースをシャットダウンし、ファイルシステムをディスマウントし、ボリュームグループを非アクティブ化する必要があります。ASMを使用する場合は、ASMディスクグループがディスマウントされていることを確認し、すべてのグリッドサービスをシャットダウンします。</block>
  <block id="2ba1c509ee5f5e31f05b24aed2d23054" category="section-title">FCネットワークからのLUNのマッピング解除</block>
  <block id="2f9e42c479a76dd54d7946c181049dd4" category="paragraph">LUNが完全に休止されたら、元のFC igroupからマッピングを削除します。</block>
  <block id="5f889f52ef85be290c3e5c0211bbb8fa" category="section-title">IPネットワークへのLUNの再マッピング</block>
  <block id="4ac84701530b31d8d33d9aa742715d25" category="paragraph">新しいiSCSIベースのイニシエータグループに各LUNへのアクセスを許可します。</block>
  <block id="3d59eaa280c8b75d8e997eac2cf5b3e6" category="section-title">iSCSIターゲットの検出</block>
  <block id="981b782c3eacf8b87d8231b887873f03" category="paragraph">iSCSI検出には2つのフェーズがあります。1つ目はターゲットの検出です。これは、LUNの検出とは異なります。。<block ref="f88921f58beaaae5bcb9dffac54bf5ad" prefix=" " category="inline-code"></block> 次のコマンドは、<block ref="24e12535882a30ad33a21d76d76bd0ff" prefix=" " category="inline-code"></block> およびには、iSCSIサービスを提供するすべてのIPアドレスとポートのリストが格納されます。この場合、デフォルトポート3260にiSCSIサービスを持つIPアドレスが4つあります。</block>
  <block id="0ab5dd035c7f92f4dce1026744c01604" category="admonition">いずれかのターゲットIPアドレスに到達できない場合、このコマンドは完了までに数分かかることがあります。</block>
  <block id="1dba8f39914c5f44e3cb635e7ac7563e" category="section-title">iSCSI LUNの検出</block>
  <block id="68307bef4b9dc4071d875a0c2aadd321" category="paragraph">iSCSIターゲットが検出されたら、iSCSIサービスを再起動して使用可能なiSCSI LUNを検出し、マルチパスやASMlibデバイスなどの関連デバイスを構築します。</block>
  <block id="25d811252f87ae85dda97f2ab9dd1f3a" category="section-title">環境の再起動</block>
  <block id="8a9aae851d31dae8baf96171f114955e" category="paragraph">ボリュームグループの再アクティブ化、ファイルシステムの再マウント、RACサービスの再起動などを実行して、環境を再起動します。予防措置としてNetApp、変換プロセスの完了後にサーバを再起動して、すべての構成ファイルが正しいことと古いデバイスがすべて削除されることを確認することをお勧めします。</block>
  <block id="00f4c8378b0bf837cee4b0aed8886f31" category="paragraph">注意：ホストを再起動する前に、<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 移行されたSANリソースについては、コメントアウトされています。この手順を実行せず、LUNアクセスに問題があると、OSがブートしない可能性があります。この問題はデータに損傷を与えません。ただし、レスキューモードまたは同様のモードで起動して修正するのは非常に不便な場合があります。<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> OSを起動してトラブルシューティング作業を開始できるようにします。</block>
  <block id="7e712b6bec5dd0821f1822121da9f0c6" category="summary">QoSによるOracleのパフォーマンス管理</block>
  <block id="ff8b87ff7571fb54e71c9589f1b886a3" category="doc">OracleデータベースでのQuality of Service（QoS；サービス品質）</block>
  <block id="08e3cfb3c3dfa08d34bcbbfe07fe5f28" category="paragraph">複数のOracleデータベースを安全かつ効率的に管理するには、効果的なQoS戦略が必要です。その理由は、最新のストレージシステムのパフォーマンス機能が絶えず向上していることです。</block>
  <block id="3408fe4b6e4b2ed9366356f08e3b9ab0" category="summary">OracleデータベースとStorage Efficiency</block>
  <block id="151654fbc652cca26707bd7a060073d3" category="doc">OracleデータベースとONTAPの効率化機能</block>
  <block id="4564218d346b0ef8263512ebe659337d" category="paragraph">ONTAPのスペース効率化機能は、Oracleデータベース向けに最適化されています。ほとんどの場合、すべての効率化機能を有効にした状態でデフォルトのままにすることを推奨します。</block>
  <block id="794c6d3bb54da92d9a4a4022bc5c4e94" category="summary">RAIDとOracleデータベース</block>
  <block id="ead1ce56c368cc12c4f8932e01c92f65" category="doc">Oracle RAIDの要件</block>
  <block id="e959fe6bb794f67f31a0d4e6bc5d5bf4" category="paragraph">RAIDとは、冗長性を使用してドライブの損失からデータを保護することです。</block>
  <block id="b60b0e7c75501fe2f322675f2e6da6d7" category="paragraph">Oracleデータベースやその他のエンタープライズアプリケーションに使用するNetAppストレージの構成では、RAIDレベルに関して疑問が生じることがあります。ストレージアレイ構成に関する従来のOracleのベストプラクティスの多くには、RAIDミラーリングの使用や特定のタイプのRAIDの回避に関する警告が含まれています。これらは有効なポイントを上げますが、これらのソースは、RAID 4およびONTAPで使用されているNetApp RAID DPおよびRAID-TECテクノロジには適用されません。</block>
  <block id="6de6bcceac7c1a53ecb774d42b8d5c9a" category="summary">OracleとONTAPのシンプロビジョニング</block>
  <block id="e04c5c8668870edf8392b07169f96644" category="doc">Oracleでのシンプロビジョニング</block>
  <block id="26c71bfc140fc9f2d56f83f7aedffd53" category="paragraph">Oracleデータベースのシンプロビジョニングでは、ストレージシステムに物理的に使用可能なスペースよりも多くのスペースが設定されるため、慎重な計画が必要になります。適切に行うと、大幅なコスト削減と管理性の向上につながるため、努力する価値は非常に高くなります。</block>
  <block id="c9a6446e7a1a2aa2d3d06c76b3dd02ae" category="summary">Oracleデータベース用のSVMプロビジョニング</block>
  <block id="eaa6380760494a867d1be23523aaba3e" category="doc">OracleデータベースとStorage Virtual Machine</block>
  <block id="ffa2dec61afa63c15c9906328e62e2e8" category="paragraph">Oracleデータベースのストレージ管理をStorage Virtual Machine（SVM）で一元化</block>
  <block id="ba0fd7b6bfa61ad7f7ad5326a0934d01" category="summary">Oracleデータベースの処理が中断されないようにするには、ストレージのテイクオーバーとスイッチオーバーの機能を理解しておく必要があります。また、テイクオーバー処理やスイッチオーバー処理で使用される引数を正しく使用しないと、データの整合性に影響する可能性があります。</block>
  <block id="75f921b4326183319e82bc907e80cc42" category="doc">OracleおよびONTAPコントローラのフェイルオーバー/スイッチオーバー</block>
  <block id="999548558d2844d78a3b5f9186c231a4" category="summary">データベースとONTAPのストレージ容量と空きスペース</block>
  <block id="3736e7d9912dca1541f3d86788010d1d" category="doc">Oracleとストレージ容量の管理</block>
  <block id="360612d74cdd78953036946ec943f795" category="paragraph">データベースやその他のエンタープライズアプリケーションを、予測性と管理性に優れたハイパフォーマンスのエンタープライズストレージで管理するには、データとメタデータを管理するためにドライブ上の空きスペースがいくらか必要です。必要な空きスペースの量は、使用するドライブのタイプやビジネスプロセスによって異なります。</block>
  <block id="655dc175973dc3d055e6e798ce1399a6" category="summary">Oracleマルチブロック読み取りパラメータ</block>
  <block id="d3cc759510a3aba837fc8efeb2e24b91" category="doc">db_file_multiblock_read_count</block>
  <block id="32faf0a922da10425f2be9f86a5f5e18" category="paragraph">。<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> パラメータは、シーケンシャルI/OでOracleが単一の処理として読み取るOracleデータベースブロックの最大数を制御します。</block>
  <block id="36cb03af3dc688208e0e94fda31ca7a4" category="paragraph">ただし、このパラメータは、すべての読み取り処理でOracleが読み取るブロック数には影響しません。また、ランダムI/Oにも影響しません。影響を受けるのはシーケンシャルI/Oのブロックサイズだけです。</block>
  <block id="2565c992b3732464484104f4c846d9b4" category="paragraph">Oracleでは、このパラメータを未設定のままにしておくことを推奨しています。これにより、データベースソフトウェアは自動的に最適な値を設定できます。つまり、このパラメータは通常、I/Oサイズが1MBになる値に設定されます。たとえば、8KBブロックの1MB読み取りでは128ブロックを読み取る必要があるため、このパラメータのデフォルト値は128になります。</block>
  <block id="0fd26e725a6c1a81508e013094776e2c" category="paragraph">顧客サイトのNetAppで発生したデータベースパフォーマンスの問題のほとんどには、このパラメータの設定が誤っています。Oracleバージョン8および9では、この値を変更する正当な理由があります。そのため、パラメータが<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> ファイル：データベースがOracle 10以降にアップグレードされたため。従来の設定である8または16をデフォルト値の128と比較すると、シーケンシャルI/Oのパフォーマンスが大幅に低下します。</block>
  <block id="3f594bb922365c7a9f095f44822fa22e" category="admonition">* NetApp推奨*設定<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> パラメータがに存在していてはなりません。<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> ファイル。NetAppでは、このパラメータを変更することでパフォーマンスが向上するという状況は発生していませんが、シーケンシャルI/Oのスループットに明らかな影響を及ぼすケースは少なくありません。</block>
  <block id="669ebbf33c0b19005e2ccaf02ba69e5f" category="summary">ネットワーク・ストレージを使用したOracle RAC設定</block>
  <block id="5c87e825763ec1e41a459f6baa4b2a44" category="doc">Oracle Real Application Clusters （ RAC ）</block>
  <block id="0eec903bb9d87349e379892ca99ef9ec" category="paragraph">Oracle RACは、クラスタの健常性を監視する複数のタイプの内部ハートビートプロセスを備えたクラスタウェア製品です。</block>
  <block id="7c13d022c9fda6e792c4349a043a6c74" category="inline-link-macro">MissCount</block>
  <block id="bab4ae46619fcbbb84e3375ef205e61c" category="admonition">の情報 <block ref="9cd17d807316d35ef47b12cbecab4ec8" category="inline-link-macro-rx"></block> セクションには、ネットワーク・ストレージを使用するOracle RAC環境に関する重要な情報が記載されています。多くの場合、RACクラスタがネットワーク・パスの変更やストレージのフェイルオーバー/スイッチオーバー操作に耐えられるように、デフォルトのOracle RAC設定を変更する必要があります。</block>
  <block id="0494651671c3dc7f1ccdf99a4368a2cf" category="section-title">ディスクタイムアウト</block>
  <block id="1973cfff3b7c6d828ede9d420b8481b5" category="paragraph">プライマリストレージ関連のRACパラメータはです。<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。このパラメータは、投票ファイルI/Oが完了しなければならないしきい値を制御します。状況に応じて<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> パラメータの値を超えると、そのRACノードがクラスタから削除されます。このパラメータのデフォルトは200です。ストレージのテイクオーバーとギブバックの標準的な手順では、この値で十分です。</block>
  <block id="4aa33fc988e36b9531d36da80d35ec2f" category="paragraph">テイクオーバーやギブバックには多くの要素が影響するため、NetAppでは、RAC構成を本番環境に導入する前に徹底的にテストすることを強く推奨します。ストレージフェイルオーバーの完了に必要な時間に加えて、Link Aggregation Control Protocol（LACP；リンクアグリゲーション制御プロトコル）の変更が伝播されるまでの時間も長くなります。また、SANマルチパスソフトウェアはI/Oタイムアウトを検出し、代替パスで再試行する必要があります。データベースが非常にアクティブな場合は、投票ディスクI/Oが処理される前に、大量のI/Oをキューに入れて再試行する必要があります。</block>
  <block id="655a10764a0781d26dca3bfb939457b7" category="paragraph">ストレージのテイクオーバーやギブバックを実際に実行できない場合は、データベースサーバでケーブルを取り外すテストを実行して影響をシミュレートできます。</block>
  <block id="b2a9e8dd67b2d9a7333cb2c2495c2aa5" category="list-text">を終了します。<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> パラメータを指定します。デフォルト値は200です。</block>
  <block id="971a52f4b805c654dd133cf142457c53" category="list-text">RAC構成は常に十分にテストしてください。</block>
  <block id="cd7a91511dbfbe5c79de12fa7d394dc0" category="paragraph">。<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> パラメータは通常、RACノード間のネットワークハートビートにのみ影響します。デフォルトは30秒です。Gridバイナリがストレージアレイ上にある場合やOSのブートドライブがローカルでない場合は、このパラメータが重要になることがあります。これには、ブートドライブがFC SANに配置されたホスト、NFSブートOS、およびVMDKファイルなどの仮想データストアに配置されたブートドライブが含まれます。</block>
  <block id="9c1fd24d7d8e04847dadb944a6643121" category="paragraph">ブートドライブへのアクセスがストレージのテイクオーバーやギブバックによって中断された場合、Gridバイナリの場所またはOS全体が一時的に停止する可能性があります。ONTAPがストレージ処理を完了するのに必要な時間、およびOSがパスを変更してI/Oを再開するのに必要な時間が、<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> しきい値。そのため、ブートLUNまたはGridバイナリへの接続がリストアされたあと、ノードはただちに削除されます。ほとんどの場合、削除とその後のリブートは実行されますが、リブートの理由を示すログメッセージは表示されません。すべての構成に影響するわけではないので、RAC環境内のSANブート、NFSブート、またはデータストアベースのホストをテストして、ブートドライブへの通信が中断してもRACが安定した状態になるようにします。</block>
  <block id="2b875dbca82565f3d7e2fa51633bc2c9" category="paragraph">ローカルでないブートドライブまたはローカルでないファイルシステムをホストしている場合<block ref="ff4a008470319a22d9cf3d14af485977" prefix=" " category="inline-code"></block> バイナリ、<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 一致するように変更する必要があります<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。このパラメータを変更した場合は、さらにテストを行い、ノードのフェイルオーバー時間など、RACの動作への影響を特定します。</block>
  <block id="08d7a86ed9292993deaa28bee18d5ce5" category="list-text">そのままにします。<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 次のいずれかの条件が適用されない場合は、デフォルト値の30のパラメータを使用します。</block>
  <block id="5b46e861366ffd98cd94c26abf2bf550" category="list-text"><block ref="ff4a008470319a22d9cf3d14af485977" prefix="" category="inline-code"></block> バイナリが、ネットワークに接続されたドライブ（NFS、iSCSI、FC、データストアベースのドライブを含む）に配置されている。</block>
  <block id="7ace6d79e63cb29c86093526fbddf845" category="list-text">OSがSANブートである。</block>
  <block id="985511d6258bbf659d35bd76e0b0cea1" category="list-text">このような場合は、ネットワークの中断がOSへのアクセスに影響するか、<block ref="9599929f8663b5e2093f7bc5cb20b0c2" prefix=" " category="inline-code"></block> ファイルシステム：このような中断によって原因Oracle RACデーモンが停止し、<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block>-ベースのタイムアウトおよび削除。タイムアウトのデフォルトは27秒です。これは<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> マイナス<block ref="c9333b0a26b9f9e9fd808e6238d613b0" prefix=" " category="inline-code"></block>。このような場合、<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 200にして一致させる<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。</block>
  <block id="6cde0106c3eb71034259ac34de5e6a2c" category="summary">Oracleファイルシステムオプション</block>
  <block id="a3f7c31b8d967e0ac9f9dd30fc81c061" category="paragraph">Oracle初期化パラメータ<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 非同期I/OとダイレクトI/Oの使用を制御します。</block>
  <block id="d1fa3441fd96418a75a509ac2907d644" category="paragraph">一般的な考え方に反して、非同期I/OとダイレクトI/Oは相互に排他的ではありません。NetAppでは、お客様の環境でこのパラメータの設定ミスが頻繁に発生し、この設定ミスが多くのパフォーマンス問題の直接的な原因となっていることを確認しています。</block>
  <block id="0775b72ddf51e2a16e466ee2df8f75ab" category="paragraph">非同期I/Oとは、Oracle I/O処理を並行処理できることを意味します。さまざまなOSで非同期I/Oが使用可能になる前は、ユーザが多数のdbwriterプロセスを設定し、サーバプロセスの設定を変更していました。非同期I/Oでは、OS自体がデータベースソフトウェアに代わって効率的かつ並列的にI/Oを実行します。このプロセスによってデータがリスクにさらされることはなく、OracleのRedoロギングなどの重要な処理も同期的に実行されます。</block>
  <block id="6b72950206966c1983e559eb6886ec69" category="paragraph">ダイレクトI/OはOSのバッファキャッシュをバイパスします。UNIXシステムのI/Oは、通常、OSのバッファキャッシュを通過します。これは内部キャッシュを持たないアプリケーションでは便利ですが、OracleはSGA内に独自のバッファキャッシュを備えています。ほとんどの場合、OSのバッファキャッシュを使用するよりも、ダイレクトI/Oを有効にしてサーバRAMをSGAに割り当てる方が適しています。Oracle SGAはメモリをより効率的に使用します。さらに、I/OがOSバッファを通過すると、追加の処理が発生し、レイテンシが増加します。レイテンシの増加は、低レイテンシが重要な要件である書き込みI/Oの負荷が高い場合に特に顕著です。</block>
  <block id="d8590a940a5bb30d8a845f4359f3c779" category="paragraph">オフシヨン<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 次のとおりです。</block>
  <block id="0aea10c6719256027228a859db38f291" category="list-text">* async。* OracleはI/O要求をOSに送信して処理します。このプロセスにより、OracleはI/Oの完了を待たずに他の処理を実行できるため、I/Oの並列化が促進されます。</block>
  <block id="00cb0cc309682c42b3b936a19a042434" category="list-text">* directio.* Oracleは、ホストOSキャッシュを介してI/Oをルーティングするのではなく、物理ファイルに対して直接I/Oを実行します。</block>
  <block id="f9941e1b6cc84711e95db0e757efc36a" category="list-text">*なし。* Oracleは同期I/OとバッファI/Oを使用します。この構成では、共有サーバプロセスと専用サーバプロセスの選択、およびdbwriterの数がより重要になります。</block>
  <block id="f0939ff6231565c83c5c8c9ce1eddc9d" category="list-text">* SETALL。* Oracleは非同期I/OとダイレクトI/Oの両方を使用します。ほとんどすべての場合、<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block> 最適です。</block>
  <block id="8647b2eaf101a9425f69e6f2e67aeb9d" category="admonition">。<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> パラメータは、DNFS環境とASM環境では効果がありません。DNFSまたはASMを使用すると、自動的に非同期I/OとダイレクトI/Oの両方が使用されます。</block>
  <block id="6dd5604aa0be2956f8b1b41c74fa648e" category="paragraph">一部のお客様では、特に以前のRed Hat Enterprise Linux 4（RHEL4）リリースで、過去に非同期I/Oの問題が発生していました。インターネット上のいくつかの時代遅れのアドバイスは、時代遅れの情報のために非同期IOを避けることを提案しています。非同期I/Oは、現在のすべてのOSで安定しています。OSの既知のバグがない限り、無効にする理由はありません。</block>
  <block id="1ea377466376b194b2d1bfc3ab2fa4c4" category="paragraph">データベースでバッファI/Oが使用されている場合は、ダイレクトI/Oに切り替えてもSGAサイズの変更が必要になることがあります。バッファI/Oを無効にすると、ホストOSキャッシュがデータベースに提供するパフォーマンス上のメリットがなくなります。RAMをSGAに再度追加すると、この問題が解決します。最終的には、I/Oパフォーマンスの向上につながります。</block>
  <block id="787b3d8b62af05ac3efd1c9ca7a8fc7e" category="paragraph">RAMはOSのバッファキャッシュよりもOracle SGAに使用する方がほとんどですが、最適な値を特定できない場合もあります。たとえば、断続的にアクティブになるOracleインスタンスが多数あるデータベースサーバでは、SGAサイズが非常に小さいバッファI/Oを使用することを推奨します。この方法では、実行中のすべてのデータベースインスタンスが、空いているOSのRAMを柔軟に使用できます。これは非常にまれな状況ですが、一部のお客様のサイトで確認されています。</block>
  <block id="d4157ab77eb31459bd406aa0f873e20c" category="admonition">* NetApp推奨*設定<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 終了：<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block>ただし、状況によっては、ホストのバッファキャッシュが失われた場合にOracle SGAの拡張が必要になることがあります。</block>
  <block id="caa6d47f2f011d5d1b5fb830e85a37f0" category="summary">Oracleブロックサイズ</block>
  <block id="6db776dab2989df63d245511a4dccf08" category="doc">Oracleのブロックサイズ</block>
  <block id="f8b42f9efd1a05ede10b0e0c11dfa8b0" category="paragraph">ONTAPでは内部的に可変ブロックサイズが使用されるため、Oracleデータベースには任意のブロックサイズを設定できます。ただし、ファイルシステムのブロックサイズがパフォーマンスに影響することがあり、場合によってはRedoブロックサイズを大きくすることでパフォーマンスが向上することがあります。</block>
  <block id="0944aedb4703c4a5e94fb90de9d7a22f" category="section-title">データファイルのブロックサイズ</block>
  <block id="cc4662c047050e0082701ce6f052dcb7" category="paragraph">OSによっては、ファイルシステムのブロックサイズを選択できます。Oracleデータファイルをサポートするファイルシステムでは、圧縮を使用する場合にブロックサイズを8KBにする必要があります。圧縮が不要な場合は、8KBまたは4KBのブロックサイズを使用できます。</block>
  <block id="e1a001cf8c7e2072c7a44ee65e8fee11" category="paragraph">512バイトのブロックを使用するファイルシステムにデータファイルが配置されていると、ファイルのミスアライメントが発生する可能性があります。LUNとファイルシステムはNetAppの推奨事項に基づいて適切にアライメントされていても、ファイルI/Oはミスアライメントされます。このようなミスアライメントが発生すると、原因で重大なパフォーマンス問題が発生します。</block>
  <block id="9514c8638f798f68108498dd218ec793" category="paragraph">Redoログをサポートするファイルシステムでは、Redoブロックサイズの倍数のブロックサイズを使用する必要があります。そのためには、通常、RedoログファイルシステムとRedoログ自体の両方で512バイトのブロックサイズを使用する必要があります。</block>
  <block id="cac7d87a1164763b666ca7d02109d153" category="section-title">Redoブロックサイズ</block>
  <block id="fa06b9584ea36af182742c07894220f0" category="paragraph">Redo率が非常に高い場合は、少ない処理で効率よくI/Oを実行できるため、4KBのブロックサイズの方がパフォーマンスが向上する可能性があります。Redo率が50MBpsを超える場合は、4KBのブロックサイズをテストすることを検討してください。</block>
  <block id="781000593b4913b5625dd5ed9eebe87e" category="paragraph">一部のお客様では、ブロックサイズが512バイトのRedoログをブロックサイズが4KBのファイルシステムで使用し、非常に小さなトランザクションが大量に発生するという問題が報告されています。このパフォーマンスの問題は、複数の512バイトの変更を4KBの単一のファイルシステムブロックに適用する際のオーバーヘッドが原因で発生していましたが、ファイルシステムのブロックサイズを512バイトに変更することで解決されました。</block>
  <block id="a02416fde36b174cf1196213fcf1bef6" category="admonition">* NetAppでは、関連するカスタマーサポートまたはプロフェッショナルサービス部門から指示があった場合、または正式な製品ドキュメントに基づく場合を除き、Redoブロックサイズを変更しないことを推奨しています*。</block>
  <block id="00783c075f877e6e69c64079296967ed" category="summary">ONTAPによるOracle向けディザスタリカバリ</block>
  <block id="6a87f84ba62b57e5643d5bfa5967c7a8" category="doc">ONTAPによるディザスタリカバリ</block>
  <block id="65a6ece62f52a5e2ff74baaae821ae86" category="paragraph">ディザスタリカバリとは、火災によってストレージシステムやサイト全体が破壊されるなど、重大な災害が発生した場合にデータサービスをリストアすることです。</block>
  <block id="e168b3b0b2f075f39012df52c5ea3c0a" category="admonition">このドキュメントは、以前に公開されたテクニカルレポート_TR-4591：『Oracle Data Protection_and_TR-4592：Oracle on MetroCluster』を差し替えます。_</block>
  <block id="a91982f09e6a0341a90dae002865ea11" category="paragraph">ディザスタリカバリは、もちろんSnapMirrorを使用してデータを単純にレプリケーションすることで実現できます。多くのお客様は、ミラーされたレプリカを1時間に何度も更新します。</block>
  <block id="0f1b72a875a2bcb3d0e844ca2dcee233" category="paragraph">ほとんどのお客様にとって、DRに必要なのはデータのリモートコピーだけではなく、そのデータを迅速に利用できることです。NetAppは、このニーズに対応する2つのテクノロジを提供します。MetroClusterとSnapMirrorビジネス継続性（SM-BC）です。</block>
  <block id="ad2c5e9521f13e89cd84fdd65ec96c7d" category="paragraph">MetroClusterとは、低レベルの同期ミラーリングストレージと多数の追加機能を含むハードウェア構成のONTAPのことです。MetroClusterなどの統合ソリューションは、今日の複雑なスケールアウトデータベース、アプリケーション、仮想化インフラストラクチャを簡素化します。複数の外部データ保護製品や戦略を、1つのシンプルな中央集中型ストレージアレイに置き換えます。また、単一のクラスタストレージシステム内に、バックアップ、リカバリ、ディザスタリカバリ、高可用性（HA）が統合されています。</block>
  <block id="05be1e741eba1ac3f0b7c924f261403b" category="paragraph">SnapMirrorビジネス継続性（SM-BC）はSnapMirror Synchronousに基づいています。MetroClusterでは、各ONTAPコントローラがドライブデータをリモートサイトにレプリケートします。SM-BCを使用すると、基本的に2つの異なるONTAPシステムでLUNデータの独立したコピーを維持しながら、このLUNの単一インスタンスを提供できます。ホストの観点からは、単一のLUNエンティティです。</block>
  <block id="70f47db03a0843fec433c8cc41a54635" category="paragraph">SM-BCとMetroClusterの内部的な動作は大きく異なりますが、ホストにとっては結果は非常によく似ています。主な違いは粒度です。同期レプリケーション対象のワークロードのみを選択する場合は、SM-BCを使用することを推奨します。環境全体やデータセンターをレプリケートする必要がある場合は、MetroClusterをお勧めします。また、現時点ではSM-BCはSAN専用ですが、MetroClusterはSAN、NFS、SMBなどのマルチプロトコルです。</block>
  <block id="7389dc8e47495ffdde7fd2e0fc19df20" category="summary">SM-BCを使用したOracleフェイルオーバー</block>
  <block id="0a54809bbd5dc721967217b79aa04429" category="paragraph">SM-BCでOracleデータベースをホストする主な理由は、計画的または計画外のストレージイベント時に透過的なフェイルオーバーを実現するためです。</block>
  <block id="cfb8f86af03363ef2c73933e34108390" category="summary">SM-BCを使用するONTAP上のOracle単一インスタンス</block>
  <block id="f25228759326d365adf4dca6b7b2cb8b" category="doc">シングルインスタンスOracleとSM-BC</block>
  <block id="a38cb04f35bd24313f90398cdc07e149" category="paragraph">次の図は、Oracleデータベースのプライマリストレージクラスタとリモートストレージクラスタの両方からストレージデバイスをゾーニングまたは接続するシンプルな導入モデルを示しています。</block>
  <block id="ac38db4f14e512b48d088eedb84cd611" category="paragraph">Oracleはプライマリにのみ設定されます。このモデルは、ストレージ側で災害が発生した場合にシームレスなストレージフェイルオーバーに対応し、アプリケーションのダウンタイムを発生させることなくデータの損失をゼロにします。ただし、このモデルでは、サイト障害時のデータベース環境の高可用性を実現できません。このタイプのアーキテクチャは、データ損失ゼロの解決策でストレージサービスの高可用性を実現したいが、データベースクラスタが完全に失われた場合には手動での作業が必要である場合に便利です。</block>
  <block id="ccc53ca027c7d8fb1e0d647249fd67cd" category="paragraph"><block ref="ccc53ca027c7d8fb1e0d647249fd67cd" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4e072ef2eba1c46e59475046cd4fb880" category="paragraph">このアプローチでは、Oracleのライセンスコストも削減できます。リモートサイトでOracleデータベースノードを事前に設定するには、ほとんどのOracleライセンス契約に基づいてすべてのコアがライセンスされている必要があります。Oracleデータベースサーバのインストールと、稼働しているデータコピーのマウントにかかる時間が原因で遅延が発生しても問題ない場合は、コスト効率に優れた設計にすることができます。</block>
  <block id="5e2dd7c2fa063e6d7af964efc0e488a0" category="summary">SM-BCを使用したONTAP上のOracle RAC</block>
  <block id="f7d366254f13816be07d3c8dff4ef00c" category="doc">SM-BCを使用したOracle RAC</block>
  <block id="67bbc9e19672ee6c9c548cae8a472396" category="paragraph">SM-BCでは、ロードバランシングや個 々 のアプリケーションのフェイルオーバーなどの目的で、データセットのレプリケーションをきめ細かく制御できます。アーキテクチャ全体は拡張RACクラスタのように見えますが、一部のデータベースは特定のサイト専用で、全体の負荷は分散されます。</block>
  <block id="9331b3ad2bcf259818157930e1c82ad3" category="paragraph">たとえば、6つのデータベースを個別にホストするOracle RACクラスタを構築できます。3つのデータベースのストレージは主にサイトAでホストされ、残りの3つのデータベースのストレージはサイトBでホストされます。この構成により、クロスサイトトラフィックが最小限に抑えられ、可能な限り最高のパフォーマンスが保証されます。また、ストレージシステムに対してローカルなデータベースインスタンスをアクティブパスで使用するようにアプリケーションを設定します。これにより、RACインターコネクトトラフィックが最小限に抑えられます。最後に、この全体的な設計により、すべてのコンピューティングリソースが均等に使用されます。ワークロードの変化に応じて、データベースをサイト間で選択的にフェイルバックして、ロードが均一になるようにすることができます。</block>
  <block id="4278792a47efb1e599476fe07109dca4" category="inline-link-macro">MetroCluster上のOracle RAC</block>
  <block id="1c6753ccdcc6629af3e1febabbf271b5" category="paragraph">細かさを除けば、SM-BCを使用するOracle RACの基本原則とオプションは次のとおりです。 <block ref="f7453402f1e4779ea0ec67d873358932" category="inline-link-macro-rx"></block></block>
  <block id="7e544b57620f5cdeb71865606eab0549" category="summary">OracleとSnapMirrorビジネス継続性（SM-BC）</block>
  <block id="33aa8b7a84723347d228956fab2a4de8" category="doc">OracleとSnapMirrorのビジネス継続性</block>
  <block id="41eec95e0dbb542c5cd25248ec5759d5" category="paragraph">SM-BCでは、個 々 のOracleデータベースおよびアプリケーション環境に対して、選択的なRPO=0同期ミラーリングが可能です。</block>
  <block id="563d0bf19fd5d623a031d90c30128dc1" category="summary">Oracle SM-BC障害シナリオ</block>
  <block id="3c1ea312a3c6648fc3f94a1ccd12bebc" category="doc">Oracle SM-BCの障害シナリオ</block>
  <block id="87777c84375810d8b6fd65f604dd2561" category="paragraph">SnapMirrorビジネス継続性（SM-BC）の障害シナリオでは、それぞれ結果が異なります。</block>
  <block id="8eea62084ca7e541d918e823422bd82e" category="cell">結果</block>
  <block id="ee70ac41df7240931fee4110b599c39f" category="cell">レプリケーションリンク障害</block>
  <block id="e79e76eca171f3e596eb56ba4bb24743" category="cell">Mediatorはこのスプリットブレインシナリオを認識し、マスターコピーを保持するノードでI/Oを再開します。サイト間の接続がオンラインに戻ると、代替サイトで自動再同期が実行されます。</block>
  <block id="98a638ba6cee257a8f751bcf8d30e1f2" category="cell">プライマリサイトストレージの障害</block>
  <block id="b92af6cefecfe68535bbd851b797379f" category="cell">自動計画外フェイルオーバーはMediatorによって開始されます。

I/Oの中断はありません。</block>
  <block id="ce9a584219636ca5b159a27f2dd8c445" category="cell">リモートサイトのストレージ障害</block>
  <block id="68a293bd16c4e2589057d43506a5afbd" category="cell">I/Oの中断はありません。ネットワークが原因で一時的に停止し、同期レプリケーションが中断され、マスターがI/O処理を継続する正当な所有者であることが確認されます（コンセンサス）。そのため、数秒間I/Oが一時停止してから、I/Oが再開されます。

サイトがオンラインの場合は自動再同期が実行されます。</block>
  <block id="64f4e3573d0b569ef7b5a08476fb9f7d" category="cell">MediatorまたはMediatorとストレージアレイの間のリンクの停止</block>
  <block id="7e7abe23ef8e465ee1b6879b35e6bab3" category="cell">I/Oは継続してリモートクラスタとの同期が維持されますが、Mediatorがないと、計画外フェイルオーバーや自動フェイルバックは実行できません。</block>
  <block id="96b352ebd03c8c5b7589a527b18f1a2d" category="cell">HAクラスタ内の一方のストレージコントローラの停止</block>
  <block id="426c4468c3cc76191842240593fcfec3" category="cell">HAクラスタのパートナーノードでテイクオーバー（NDO）が試行されます。テイクオーバーに失敗すると、Mediatorはストレージの両方のノードが停止していることを認識し、リモートクラスタへの自動計画外フェイルオーバーを実行します。</block>
  <block id="0e578c93ab393c3d449d484e9fa4b84e" category="cell">ディスクノテイシ</block>
  <block id="3d5fea5d89ec844fc92c08a585050e4e" category="cell">IOは、連続して3つのディスク障害が発生しても継続されます。これはRAID-TECの一部です。</block>
  <block id="bd300f92769c0ee071832cadaff91f04" category="cell">一般的な環境でサイト全体が停止する</block>
  <block id="9cfa40a514d333ea10de6fc8a75ac663" category="cell">障害が発生したサイトのサーバは、明らかに使用できなくなります。クラスタリングをサポートするアプリケーションは、両方のサイトで実行し、代替サイトで処理を継続するように設定できます。ただし、ほとんどのアプリケーションでは、SM-BCでメディエーターが必要な場合と同様の第3のサイトTiebreakerが必要です。

アプリケーションレベルのクラスタがない場合は、サバイバーサイトでアプリケーションを起動する必要があります。これは可用性に影響しますが、RPO=0は維持されます。データが失われることはありません。</block>
  <block id="f2762385d394491398659925e75d5d01" category="summary">MetroCluster物理アーキテクチャ- Oracle</block>
  <block id="5be41b602a41d06df45e8986ec09a8dc" category="doc">MetroCluster物理アーキテクチャ- Oracle</block>
  <block id="d12be40db836559c628e8024f5d6ff56" category="paragraph">MetroCluster環境でのOracleデータベースの動作を理解するには、MetroClusterシステムの物理設計についてある程度の説明が必要です。</block>
  <block id="5e33c0d8a2417ce5fb6e7a211ad063bb" category="admonition">このドキュメントは、以前に公開されていたテクニカルレポート（TR-4592：『Oracle on MetroCluster』）に代わるものです。_</block>
  <block id="bdec122112fe3ad35d588380dc643e48" category="summary">MetroCluster論理アーキテクチャ- Oracle</block>
  <block id="141402e8d9fa946970f252a09a01a462" category="doc">MetroCluster論理アーキテクチャ- Oracle</block>
  <block id="37fa92fc2662529308c62c84eb1b38ea" category="paragraph">MetroCluster環境でOracleデータベースがどのように動作するかを理解するAlsopでは、MetroClusterシステムの論理機能について説明する必要があります。</block>
  <block id="8b2ad15147d13b66fb05bc4b7f95e653" category="summary">Oracle on MetroCluster - NVFAIL</block>
  <block id="67be2475945283126e261087dcc833b7" category="doc">MetroClusterとNVFAIL</block>
  <block id="2623b589ddbc1cdb6184ba32aa06e83f" category="inline-link-macro">NVFail</block>
  <block id="8b048af13e99be5215d8b6ba7542bd1d" category="paragraph">NVFailは、ONTAPの一般的なデータ整合性機能で、データベースワークロードに特に重要です。詳細については、 <block ref="b361c920d00a4a9bf82fc2698602aeab" category="inline-link-macro-rx"></block>。NVFAILに関するMetroCluster固有の考慮事項もあります。</block>
  <block id="a59556e5d6eba6a88829152216638f70" category="section-title">手動で強制NVFAILを使用した拡張RAC</block>
  <block id="c8d0ea777fef88ebdbbedcb6a8534001" category="paragraph">拡張RACクラスタでスイッチオーバーを強制的に実行する最も安全なオプションは、<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> コマンドラインで。このオプションは、キャッシュされたすべてのデータが確実にフラッシュされるようにするための緊急措置として使用できます。災害が発生したサイトにもともと配置されていたストレージリソースをホストが使用している場合、I/Oエラーまたは古いファイルハンドルのいずれかを受信します。 <block ref="a3c6541ac12f1f06a81cc9b03e6bd094" prefix="(" category="inline-code"></block>）エラー。Oracleデータベースがクラッシュし、ファイルシステムが完全にオフラインになるか、読み取り専用モードに切り替わります。</block>
  <block id="193392122201d82edb280636f4751f06" category="paragraph">スイッチオーバーが完了すると、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> フラグをクリアし、LUNをオンラインにする必要があります。このアクティビティが完了したら、データベースを再起動できます。これらのタスクを自動化してRTOを短縮できます。</block>
  <block id="2d77d18df7345b1b12c19fed37f30094" category="section-title">dr-force-nvfailを使用した拡張RAC</block>
  <block id="ce1c367fd3b2234c847cdcde6df93cf6" category="paragraph">最も安全な設定は、<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> リモートサイトからアクセスするすべてのボリュームにフラグを設定します。そのため、ボリュームが開始されたときに使用できなくなります。<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> スイッチオーバー中。スイッチオーバーが完了すると、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> フラグをクリアし、LUNをオンラインにする必要があります。これらのアクティビティが完了したら、データベースを再起動できます。これらのタスクを自動化してRTOを短縮できます。</block>
  <block id="7227c057accb7ced8902796f7b957b5a" category="paragraph">結果は、<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> フラグ。ただし、影響を受けるボリュームの数は、古いキャッシュを使用するアプリケーションまたはオペレーティングシステムから保護する必要があるボリュームだけに制限される場合があります。</block>
  <block id="ae929f778e3706520521bed541a8b46e" category="section-title">dr-force-nvfailを使用しない拡張RAC</block>
  <block id="91b508022987523900b69bdaf7649555" category="paragraph">を使用しない環境には、次の2つの重要な要件があります。<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> データベースボリューム：</block>
  <block id="e6b6543ad688c7163e581e8cc41e14bf" category="list-text">メンテナンスタスクの実行中や、SyncMirrorプレックスまたはNVRAMレプリケーションが同期されていないその他の状態のときは、スイッチオーバーを実行しないでください。最初の要件を満たすには、サイト障害から30秒以内にスイッチオーバーを実行するように設定されたTiebreakerソフトウェアを使用します。これは、サイト障害が検出されてから30秒以内にスイッチオーバーを実行する必要があるという意味ではありません。これは、サイトが動作していることが確認されてから30秒が経過した場合に強制的にスイッチオーバーを実行しても安全ではないことを意味します。</block>
  <block id="6ddd3d6bc3ad92b983699970b1596e0f" category="summary">OracleとMetroCluster</block>
  <block id="c1fac7a72cd91bcd345e567f6d6d93a3" category="doc">MetroClusterでのOracleフェイルオーバー</block>
  <block id="7a60cb119af7ddcdfe38fc872d2027a1" category="paragraph">MetroClusterを使用しても、エンタープライズアプリケーションやデータベースの運用に関するベストプラクティスが追加されたり変更されたりするとは限りません。</block>
  <block id="a4feacea8b05d0f24e5a4612a164a055" category="paragraph">通常のベストプラクティスも引き続き適用され、必要なデータ保護がRPO=0の場合はMetroClusterで対応します。しかし、ほとんどのお客様は、RPO=0のデータ保護だけでなく、災害時のRTOを向上させ、サイトメンテナンス作業の一環として透過的なフェイルオーバーを実現するためにMetroClusterを使用しています。</block>
  <block id="3ff8bcf18c694581aa25b0a347508e0f" category="section-title">事前設定されたOSを使用したフェイルオーバー</block>
  <block id="9bd9ad7f296a0e8ac3df804b3c6a392f" category="paragraph">SyncMirrorはディザスタリカバリサイトにデータの同期コピーを提供しますが、そのデータを利用できるようにするには、オペレーティングシステムと関連するアプリケーションが必要です。基本的な自動化により、環境全体のフェイルオーバー時間を大幅に短縮できます。Oracle RAC、Veritas Cluster Server（VCS）、VMware HAなどのClusterware製品は、サイト間でクラスタを作成するためによく使用されます。多くの場合、フェイルオーバープロセスは単純なスクリプトで実行できます。</block>
  <block id="c5a2f3b867d990c681a218d29a55fcfa" category="paragraph">プライマリノードが失われた場合、代替サイトでアプリケーションをオンラインにするようにクラスタウェア（またはスクリプト）が設定されます。1つは、アプリケーションを構成するNFSリソースまたはSANリソース用に事前設定されたスタンバイサーバを作成する方法です。プライマリサイトに障害が発生すると、クラスタウェアまたはスクリプト化された代替サイトが次のような一連の処理を実行します。</block>
  <block id="442f34633164f1be348a442b2c62d29d" category="list-text">MetroClusterスイッチオーバーの強制実行</block>
  <block id="e081e79ea1b1040c51d4a452e46de76d" category="list-text">FC LUNの検出の実行（SANのみ）</block>
  <block id="6f3fd86521759fc98ed93853eaf8a03a" category="list-text">ファイルシステムのマウント</block>
  <block id="9d9ea7a9c532a3cec63305130018a45b" category="list-text">アプリケーションの起動</block>
  <block id="b8eca7b573624230962095fcadb03ddf" category="paragraph">このアプローチの主な要件は、リモートサイトでOSを実行することです。アプリケーションバイナリを使用して事前に設定する必要があります。つまり、パッチ適用などのタスクをプライマリサイトとスタンバイサイトで実行する必要があります。また、災害が発生した場合は、アプリケーションバイナリをリモートサイトにミラーリングしてマウントすることもできます。</block>
  <block id="e60946bf73021e18706a6ac33386b376" category="paragraph">実際のアクティベーション手順は簡単です。LUN検出などのコマンドでは、FCポートあたりのコマンド数が少なくて済みます。ファイル・システムのマウントは'<block ref="19822b1b15d9eefc54c07ab49f87b100" prefix=" " category="inline-code"></block> コマンドを実行し、データベースとASMの両方をCLIで1つのコマンドで起動および停止できます。スイッチオーバーの前にディザスタリカバリサイトでボリュームとファイルシステムを使用していない場合は、<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> ボリューム：</block>
  <block id="486eed21f55b6fb544db5504294592e6" category="section-title">仮想OSによるフェイルオーバー</block>
  <block id="bf65e943f86f26b49698bfdac9b95f81" category="paragraph">データベース環境のフェイルオーバーを拡張して、オペレーティングシステム自体を含めることができます。理論的には、このフェイルオーバーはブートLUNで実行できますが、ほとんどの場合、仮想OSで実行されます。手順の手順は次のようになります。</block>
  <block id="7c37589384e83d2b43bba430c18a45aa" category="list-text">データベースサーバ仮想マシンをホストするデータストアのマウント</block>
  <block id="3d4d04d6cdab90b7ca0deb0344f04eec" category="list-text">仮想マシンの起動</block>
  <block id="ba2f22f63087151f0a0694be5f35fcf2" category="list-text">データベースを手動で起動するか、またはデータベースを自動的に起動するように仮想マシンを設定する</block>
  <block id="810078f3b19b93e24de8638d68f727b5" category="paragraph">たとえば、ESXクラスタが複数のサイトにまたがっているとします。災害が発生した場合は、スイッチオーバー後にディザスタリカバリサイトで仮想マシンをオンラインにすることができます。災害発生時に仮想データベースサーバをホストするデータストアが使用されていないかぎり、<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 関連付けられているボリューム。</block>
  <block id="681afe3bdc351138642f233429d64762" category="summary">OracleとSyncMirror</block>
  <block id="bc8a6c6eac662831d2ddce97adbd4324" category="doc">SyncMirror - Oracle</block>
  <block id="c702c387f07bcb4f18482e68d69a155a" category="paragraph">MetroClusterシステムを使用したOracleデータ保護の基盤となるのは、最大パフォーマンスのスケールアウト同期ミラーリングテクノロジであるSyncMirrorです。</block>
  <block id="9028b52caaa7bdbfb9be779eeb1fe00e" category="summary">MetroClusterを使用したOracle拡張RAC</block>
  <block id="dbcedb2fd86e6012347a3c9ad111f3a8" category="doc">MetroCluster上の拡張Oracle RAC</block>
  <block id="4d4d8a609e5b2ac58e622eb1e90f9e39" category="paragraph">多くのお客様が、Oracle RACクラスタを複数のサイトにまたがって構成し、完全なアクティブ/アクティブ構成を実現することで、RTOを最適化しています。Oracle RACのクォーラム管理を含める必要があるため、設計全体が複雑になります。また、データは両方のサイトからアクセスされるため、強制的スイッチオーバーによって古いデータコピーが使用される可能性があります。</block>
  <block id="89ffaa1a7d089080e9a1ce912bb8c2d3" category="paragraph">データのコピーは両方のサイトに存在しますが、データを提供できるのはアグリゲートを現在所有しているコントローラだけです。そのため、拡張RACクラスタでは、リモートのノードがサイト間接続でI/Oを実行する必要があります。その結果、I/Oレイテンシが増加しますが、このレイテンシは一般的には問題になりません。RACインターコネクトネットワークは複数のサイトにまたがって拡張する必要があるため、とにかく高速で低レイテンシのネットワークが必要です。レイテンシが増加して原因に問題が発生した場合は、クラスタをアクティブ/パッシブで運用できます。I/O負荷の高い処理は、アグリゲートを所有するコントローラに対してローカルなRACノードに対して実行する必要があります。リモートノードは、より軽いI/O処理を実行するか、純粋にウォームスタンバイサーバとして使用されます。</block>
  <block id="375c3caa97162bd0c2c07869d9c5b026" category="paragraph">アクティブ/アクティブの拡張RACが必要な場合は、MetroClusterではなくASMミラーリングを検討する必要があります。ASMミラーリングでは、データの特定のレプリカを優先することができます。したがって、すべての読み取りがローカルに行われる拡張RACクラスタを構築できます。読み取りI/Oがサイトを経由することはないため、レイテンシは最小限に抑えられます。すべての書き込みアクティビティは引き続きサイト間接続を転送する必要がありますが、このようなトラフィックは同期ミラーリング解決策では回避できません。</block>
  <block id="f441d5fdc388f3419fb87e071534f3ce" category="inline-link-macro">ONTAPを使用したOracle RAC</block>
  <block id="59d934fc4614a6275fef2828bfab30cf" category="admonition">仮想ブートディスクを含むブートLUNがOracle RACで使用されている場合は、<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> パラメータの変更が必要になる場合があります。RACタイムアウトパラメータの詳細については、を参照してください。 <block ref="75080d28a1748f78cf8a666ababf51af" category="inline-link-macro-rx"></block>。</block>
  <block id="58285fb769eb7fb05ab12d9e0efb3e50" category="section-title">2サイト構成</block>
  <block id="af1184f29d838fbfec8d5b5bf5225f66" category="paragraph">2サイトの拡張RAC構成では、すべてではないが多くの災害シナリオに無停止で対応できるアクティブ/アクティブデータベースサービスを提供できます。</block>
  <block id="7544489c7854fcae445508015240a865" category="section-title">RAC投票ファイル</block>
  <block id="8b6e46422f88dab6ea82f2dbcadfc76b" category="paragraph">MetroClusterに拡張RACを導入する場合は、クォーラム管理を最初に検討する必要があります。Oracle RACには、クォーラムを管理するための2つのメカニズム（ディスクハートビートとネットワークハートビート）があります。ディスクハートビートは、投票ファイルを使用してストレージアクセスを監視します。単一サイトのRAC構成では、基盤となるストレージシステムがHA機能を提供していれば、単一の投票リソースで十分です。</block>
  <block id="fafd618b82d1827eeb8197e1c38722bc" category="paragraph">以前のバージョンのOracleでは、投票ファイルは物理ストレージデバイスに配置されていましたが、現在のバージョンのOracleでは、投票ファイルはASMディスクグループに格納されていました。</block>
  <block id="aeab2391a07321ac474989b9c9047226" category="admonition">Oracle RACはNFSでサポートされています。グリッドのインストールプロセスでは、一連のASMプロセスが作成され、グリッドファイルに使用されるNFSの場所がASMディスクグループとして提供されます。このプロセスはエンドユーザに対してほぼ透過的であり、インストール完了後にASMを継続的に管理する必要はありません。</block>
  <block id="42aca4aae768d5ec1cb0c50d41b7b8b7" category="paragraph">2サイト構成の最初の要件は、無停止のディザスタリカバリプロセスを保証する方法で、各サイトが常に半数以上の投票ファイルにアクセスできるようにすることです。このタスクは、投票ファイルがASMディスクグループに格納される前は簡単でしたが、今日の管理者はASM冗長性の基本原則を理解する必要があります。</block>
  <block id="60a723853bb2c173648452baf2199e73" category="paragraph">ASMディスクグループには3つの冗長性オプションがあります。<block ref="6a21b6995a068148bbb65c8f949b3fb2" prefix=" " category="inline-code"></block>、<block ref="fea087517c26fadd409bd4b9dc642555" prefix=" " category="inline-code"></block>および<block ref="8d966b2253a917086c8604959e152243" prefix=" " category="inline-code"></block>。つまり、ミラーリングされていない、ミラーリングされている、3方向ミラーリングされているということです。という新しいオプションがあります。<block ref="09d2bd168181f1e64c2b1651a80a8aa8" prefix=" " category="inline-code"></block> 利用可能ですが、めったに使用されません。冗長デバイスの冗長性レベルと配置によって、障害が発生した場合の動作が制御されます。例：</block>
  <block id="32cdeb2c0245b51a0b590e6054f03c21" category="list-text">投票ファイルをに配置する<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> を使用<block ref="6a21b6995a068148bbb65c8f949b3fb2" prefix=" " category="inline-code"></block> 冗長性リソースを使用すると、サイト間接続が失われた場合に一方のサイトの削除が保証されます。</block>
  <block id="a549b4f1fc0c2d14bc333c70bbde73dc" category="list-text">投票ファイルをに配置する<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> を使用<block ref="fea087517c26fadd409bd4b9dc642555" prefix=" " category="inline-code"></block> 各サイトにASMディスクが1つしかない冗長性を確保すると、どちらのサイトにもマジョリティクォーラムが存在しないためにサイト間接続が失われた場合に、両方のサイトでノードが削除されます。</block>
  <block id="c15f1c43a368db0ab3dde90eca52582d" category="list-text">投票ファイルをに配置する<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> を使用<block ref="8d966b2253a917086c8604959e152243" prefix=" " category="inline-code"></block> 一方のサイトに2本のディスクを配置し、もう一方のサイトに1本のディスクを配置する冗長性により、両方のサイトが動作していて相互にアクセスできる場合にアクティブ/アクティブ処理が可能になります。ただし、シングルディスクサイトがネットワークから分離されている場合、そのサイトは削除されます。</block>
  <block id="478ced47a1ea1d6f0db02af749bfdaec" category="section-title">RACネットワークハートビート</block>
  <block id="2432333dc52d6150fb3d58051bc8b0c2" category="paragraph">Oracle RACネットワークハートビートは、クラスタインターコネクト経由でノードに到達できるかどうかを監視します。クラスタに残すには、あるノードが他のノードの半数以上にアクセスできる必要があります。この要件により、2サイトアーキテクチャのRACノード数は次のように選択されます。</block>
  <block id="3e36a59c8a51ee9cc2cba0e7051ed35f" category="list-text">サイトごとに同じ数のノードを配置すると、ネットワーク接続が失われた場合に1つのサイトが削除されます。</block>
  <block id="4955aede919912b3c62fadbc1039671b" category="list-text">一方のサイトにN個のノードを配置し、もう一方のサイトにN+1個のノードを配置すると、サイト間接続が失われてネットワーククォーラムに残っているノードの数が多くなり、削除するノードの数が少なくなります。</block>
  <block id="80bd651a66488201c928634689e2e5cc" category="paragraph">Oracle 12cR2より前のバージョンでは、サイト障害時にどの側で削除するかを制御することは不可能でした。各サイトのノード数が同じ場合、削除はマスターノード（通常は最初にブートするRACノード）によって制御されます。</block>
  <block id="d128c05245b2e633856a5061db176b7e" category="paragraph">Oracle 12cR2では、ノードの重み付け機能が導入されています。この機能により、管理者はOracleによるスプリットブレイン状態の解決方法をより細かく制御できます。簡単な例として、次のコマンドはRAC内の特定のノードの優先順位を設定します。</block>
  <block id="104c5747f0d9dbb47b0d09953c709a8d" category="paragraph">Oracle High-Availability Servicesを再起動すると、構成は次のようになります。</block>
  <block id="693cce334ab6658c73ea67674775156b" category="paragraph">ノード<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> が重要なサーバとして指定されました。2つのRACノードが分離されている場合は、<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 生き残って<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 削除されます。</block>
  <block id="386839b09451962d03e26b7bbfabce74" category="admonition">詳細については、Oracleのホワイトペーパー『Oracle Clusterware 12c Release 2 Technical Overview』を参照してください。」</block>
  <block id="11f65689342acc8f71c8014eeb7945ee" category="paragraph">12cR2より前のバージョンのOracle RACでは、CRSログを確認することでマスターノードを特定できます。</block>
  <block id="c8b8cd80b31dac17fb85459c341042bd" category="paragraph">このログは、マスターノードが<block ref="c81e728d9d4c2f636f067f89cc14862c" prefix=" " category="inline-code"></block> ノード<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> ID：<block ref="c4ca4238a0b923820dcc509a6f75849b" prefix=" " category="inline-code"></block>。これはつまり<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> はマスターノードではありません。マスターノードのIDは、コマンドで確認できます。<block ref="08e7c60bbf8289a563b25cc033d431f7" prefix=" " category="inline-code"></block>。</block>
  <block id="fdf6179b59d3f4873b042609a5f09bc4" category="paragraph">IDがのノード<block ref="c81e728d9d4c2f636f067f89cc14862c" prefix=" " category="inline-code"></block> はです<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block>をクリックします。これはマスターノードです。各サイトに同じ数のノードがある構成では、<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 2つのセットが何らかの理由でネットワーク接続を失った場合に存続するサイトです。</block>
  <block id="f2932b43ad604fa01d57212558608ed6" category="paragraph">マスターノードを識別するログエントリがシステムから期限切れになる可能性があります。この場合、Oracle Cluster Registry（OCR）バックアップのタイムスタンプを使用できます。</block>
  <block id="50cd29958db0c1dcb6505d470f553e54" category="paragraph">次の例では、マスターノードが<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block>。また、マスターノードの変更も示します。<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 終了：<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 5月4日の2時5分から21時39分までの間。マスターノードを識別するこの方法は、前回のOCRバックアップ以降にマスターノードが変更されている可能性があるため、CRSログもチェックされている場合にのみ使用できます。この変更が発生した場合は、OCRログに表示されます。</block>
  <block id="df044a3c3d7f7f244db7c42b347b9a90" category="paragraph">ほとんどのお客様は、環境全体と各サイトで同数のRACノードにサービスを提供する投票ディスクグループを1つ選択しています。ディスクグループは、データベースが格納されているサイトに配置する必要があります。接続が失われると、リモートサイトが削除されます。リモートサイトにはクォーラムがなくなり、データベースファイルにもアクセスできなくなりますが、ローカルサイトは通常どおり稼働し続けます。接続が回復したら、リモートインスタンスを再びオンラインにすることができます。</block>
  <block id="84a24276bfdfbe485b9d961c1a57a830" category="paragraph">災害が発生した場合は、サバイバーサイトでデータベースファイルと投票ディスクグループをオンラインにするためにスイッチオーバーが必要です。災害によってAUSOでスイッチオーバーがトリガーされた場合、クラスタが同期されていてストレージリソースが正常にオンラインになるため、NVFAILはトリガーされません。AUSOは非常に高速な操作であり、<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 有効期限が切れます。</block>
  <block id="6244ee13e435dcc768edbc9b0b38b73e" category="paragraph">サイトが2つしかないため、自動化された外部タイブレークソフトウェアを使用することは不可能であり、強制スイッチオーバーは手動で行う必要があります。</block>
  <block id="568c8c12fdb7c74f65125732ee717ad3" category="section-title">3サイト構成</block>
  <block id="2c7696fb04f52eb5687d059415066fa7" category="paragraph">3つのサイトで拡張RACクラスタを構築する方がはるかに簡単です。MetroClusterシステムの各半分をホストする2つのサイトもデータベースワークロードをサポートし、3つ目のサイトはデータベースとMetroClusterシステムの両方のTiebreakerとして機能します。Oracle Tiebreakerの構成は、第3のサイトに投票に使用するASMディスクグループのメンバーを配置するだけで簡単に構成できます。また、RACクラスタに奇数のノードを配置するために、第3のサイトに運用インスタンスを配置することもできます。</block>
  <block id="6265611ca77e9ad52249c5fdd4780da9" category="admonition">拡張RAC構成でNFSを使用する場合の重要な情報については、「クォーラム障害グループ」に関するOracleのドキュメントを参照してください。要するに、クォーラムリソースをホストする3番目のサイトへの接続が失われても、プライマリOracleサーバまたはOracle RACプロセスが停止しないように、NFSマウントオプションを変更してsoftオプションを含める必要がある場合があります。</block>
  <block id="d84d0eea463e72a6e15018c70a45af46" category="doc">Oracle、MetroCluster、NVFAIL</block>
  <block id="ee6c613c07239c0923d940dfd448493f" category="paragraph">NVFailは、ONTAPの一般的なデータ整合性機能であり、データベースワークロードで特に重要です。</block>
  <block id="9dc6a9986107298da2a22e7c5a3efb00" category="summary">MetroCluster上のOracle単一インスタンス</block>
  <block id="f8b28e31633ae72c2971ee8b815ed4af" category="paragraph">前述したように、MetroClusterシステムが存在しても、データベースの運用に関するベストプラクティスが必ずしも追加されたり変更されたりするわけではありません。お客様のMetroClusterシステムで現在実行されているデータベースの大部分はシングルインスタンスであり、Oracle on ONTAPドキュメントに記載されている推奨事項に従っています。</block>
  <block id="f4872c843923dd8d8731ef66462b5a99" category="paragraph">SyncMirrorはディザスタリカバリサイトにデータの同期コピーを提供しますが、そのデータを利用できるようにするには、オペレーティングシステムと関連するアプリケーションが必要です。基本的な自動化により、環境全体のフェイルオーバー時間を大幅に短縮できます。Veritas Cluster Server（VCS）などのClusterware製品は、サイト間でクラスタを作成するためによく使用されます。多くの場合、フェイルオーバープロセスは単純なスクリプトで実行できます。</block>
  <block id="c50820a41eb4f23d0a3acc1eeddb391b" category="paragraph">プライマリノードが失われた場合、代替サイトでデータベースをオンラインにするようにクラスタウェア（またはスクリプト）が設定されます。1つは、データベースを構成するNFSリソースまたはSANリソース用に事前設定されたスタンバイサーバを作成する方法です。プライマリサイトに障害が発生すると、クラスタウェアまたはスクリプト化された代替サイトが次のような一連の処理を実行します。</block>
  <block id="2a6f458321ddf666cb0c876ee39255f3" category="list-text">ファイルシステムのマウント、ASMディスクグループのマウント</block>
  <block id="3dee93bd9bc9b8b50dcdd2066a86009f" category="list-text">データベースの起動</block>
  <block id="620515885465a26daea6cc6441403e34" category="paragraph">このアプローチの主な要件は、リモートサイトでOSを実行することです。Oracleバイナリを使用して事前に設定する必要があります。つまり、Oracleのパッチ適用などのタスクをプライマリサイトとスタンバイサイトで実行する必要があります。また、災害が発生した場合は、Oracleバイナリをリモートサイトにミラーリングしてマウントすることもできます。</block>
  <block id="edb5332feef69c0aa60ea10ed5d31a9f" category="list-text">データベースを手動で起動するか、データベースを自動的に起動するように仮想マシンを設定します。たとえば、ESXクラスタが複数のサイトにまたがっている場合があります。災害が発生した場合は、スイッチオーバー後にディザスタリカバリサイトで仮想マシンをオンラインにすることができます。災害発生時に仮想データベースサーバをホストするデータストアが使用されていないかぎり、<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 関連付けられているボリューム。</block>
  <block id="6c2e01aca4f10a83d34e3f3046435e82" category="summary">SnapMirrorとSyncMirror</block>
  <block id="64bba30b717cb45555458da4fed880a1" category="paragraph">ほぼすべてのアプリケーションでデータレプリケーションが必要です。</block>
  <block id="25fb1fa02f326334533a22c105ad3e69" category="paragraph">最も基本的なレベルでは、レプリケーションとは、オフサイトに保管されたテープ上のコピー、またはスタンバイロケーションへのアプリケーションレベルのレプリケーションを意味します。ディザスタリカバリとは、サービスが壊滅的に失われた場合に、これらのレプリカコピーを使用してサービスをオンラインにすることです。</block>
  <block id="eab6cb3a1168ef2311865e6155b8272c" category="paragraph">ONTAPには、ストレージアレイ内でネイティブにさまざまな要件に対応するための複数のレプリケーションオプションが用意されており、あらゆるニーズに対応します。これらのオプションには、同じプラットフォームでディザスタリカバリと高可用性の両方を実現する、完全に自動化された同期解決策まで、リモートサイトへのシンプルなバックアップレプリケーションが含まれます。</block>
  <block id="32df0c1cabf839652741a56bdaac7def" category="paragraph">アプリケーションに適用される主要なONTAPレプリケーションテクノロジは、NetAppのSnapMirrorテクノロジとNetApp SyncMirrorテクノロジです。これらはアドオン製品ではなく、ONTAPに完全に統合され、ライセンスキーを追加するだけでアクティブ化されます。また、ストレージレベルのレプリケーションだけが選択肢ではありません。Oracle DataGuardなどのアプリケーションレベルのレプリケーションを、ONTAPに基づくデータ保護戦略に統合することもできます。</block>
  <block id="a2259fa074bae962e46ca7fc7aa31be1" category="paragraph">適切な選択は、特定のレプリケーション、リカバリ、保持の要件によって異なります。</block>
  <block id="0d3b37ff5855bf299f3c4a154373c1e2" category="section-title">ONTAP SnapMirror</block>
  <block id="296e89e943f5160d338484b3b705a44e" category="paragraph">SnapMirrorは、NetAppの非同期レプリケーション解決策です。データベースやその関連アプリケーションなど、複雑で動的な大規模データセットの保護に最適です。主な値は次のとおりです。</block>
  <block id="d9f36dae2818ace926c4259271530724" category="list-text">*管理性。* SnapMirrorは、ストレージソフトウェアに標準で組み込まれているため、設定と管理が容易です。アドオン製品は必要ありません。レプリケーション関係は数分で確立でき、ストレージシステム上で直接管理できます。</block>
  <block id="8f761eff026903aa0140319f597d1fb0" category="list-text">*シンプルさ。*レプリケーションはボリュームに基づいています。FlexVolボリュームはLUNまたはファイルのコンテナであり、単一の整合グループとしてレプリケートされます。</block>
  <block id="8b737d6a9db3de6436966db508cb51d4" category="list-text">*効率性。*最初のレプリケーション関係が確立されると、変更のみがレプリケートされます。さらに、重複排除や圧縮などの効率化機能が維持されるため、リモートサイトに転送するデータ量がさらに削減されます。</block>
  <block id="0783dadb67ff77ed26bbfc5d80fa0cbd" category="list-text">*柔軟性。*ミラーを一時的に切断して災害復旧手順をテストできるため、完全な再ミラーリングを必要とせずにミラーリングを簡単に再確立できます。ミラーを同期状態に戻すには、変更されたデータのみを適用する必要があります。ミラーリングを反転することで、災害が終了して元のサイトが稼働状態に戻ったあとに迅速に再同期することもできます。最後に、レプリケートされたデータの読み取り/書き込みクローンをテストと開発に使用できます。</block>
  <block id="8a00f09d8937e890f2cfb4d7acf72733" category="paragraph">ONTAPにはさまざまなレプリケーションテクノロジが用意されていますが、最も柔軟性に優れたのは、ボリューム間の非同期ミラーリングオプションであるSnapMirrorです。</block>
  <block id="80c8fae3d0b5dd100cc984d9ba3eced7" category="paragraph">前述したように、FlexVolボリュームは、SnapshotベースのバックアップとSnapRestoreベースのリカバリの基本的な管理単位です。FlexVolボリュームは、SnapMirrorベースのレプリケーションの基本単位でもあります。最初に、ソースボリュームからデスティネーションボリュームへのベースラインミラーを確立します。このミラー関係を初期化すると、以降のすべての処理は変更されたデータのみのレプリケーションに基づいて行われます。</block>
  <block id="c1020b1755f65f23643158ce6a4d22cc" category="paragraph">リカバリの観点から見ると、SnapMirrorの主な価値は次のとおりです。</block>
  <block id="50bde20b37cd4d57fbff2b95f2f8ec97" category="list-text">SnapMirrorの操作は理解しやすく、簡単に自動化できます。</block>
  <block id="66162be45733f65fee4abb22e989eb78" category="list-text">SnapMirrorレプリカを単純に更新するには、差分の変更のみをレプリケートする必要があるため、帯域幅の需要が減り、更新頻度が向上します。</block>
  <block id="a3b4fbe416387a4991ccaa8b325a68be" category="list-text">SnapMirrorは非常にきめ細かな機能です。シンプルなボリューム間の関係に基づいているため、独立して管理される数百個のレプリカやレプリケーション間隔を作成できます。レプリケーションを万能である必要はありません。</block>
  <block id="4e3785883ef3ccad9938d7e35e493057" category="list-text">変更だけに基づいて関係を更新する機能を維持しながら、ミラーリングの方向を簡単に反転できます。これにより、電源障害などの災害後にプライマリサイトが復旧したあとに、迅速なフェイルバック機能が提供されます。変更のみをソースに同期化する必要があります。</block>
  <block id="8b8325381cf528eff12c1e678a3112f9" category="list-text">ミラーは簡単に破損し、効率的に再同期することで、ディザスタリカバリ手順のリハーサルを行うことができます。</block>
  <block id="b1f45b7d95bfc815351fb649fa94b671" category="list-text">SnapMirrorはフルブロックレベルのレプリケーションモードで動作し、ボリューム内のデータだけでなくSnapshotもレプリケートします。この機能は、ディザスタリカバリサイトにデータのコピーと完全なバックアップセットの両方を提供します。</block>
  <block id="ffafd9ae31dee51209961eb2453ac806" category="paragraph">SnapMirrorはバージョンに依存しないモードで動作するため、特定のSnapshotをレプリケートでき、プライマリサイトとセカンダリサイトで異なる保持期間を設定できます。</block>
  <block id="974658d7ac018cb945e78365b0a760fb" category="section-title">SnapMirror Synchronous</block>
  <block id="ffbf9d0ce29a631b6eae8b22c41ec95e" category="paragraph">SnapMirror Synchronous（SM-S）は、RPO=0の同期レプリケーションを提供するSnapMirrorの機能拡張です。同期ミラーリングが必要なデータの一部しかないストレージアーキテクチャでよく使用されます。</block>
  <block id="e8a45c4c0391895df78421904703c933" category="paragraph">SM-Sは、SyncとStrictSyncの2つのわずかに異なるモードで動作できます。</block>
  <block id="15a4e16195fb9d30c5df0e11df5c2166" category="paragraph">同期モードでは、確認される前に変更がレプリケートされます。これにより、レプリケーションが稼働しているかぎり、RPOはゼロになります。変更を複製できない場合、SM-Sは同期モードを終了し、操作を続行できます。これにより、通常の状況ではRPO=0になりますが、レプリケーション先が使用できない場合にデータプロセスが完全に停止することはありません。</block>
  <block id="115455025d4664c0dd6deaaf3c1fc93c" category="paragraph">StrictSyncはRPO = 0を保証します。変更のレプリケートに失敗するとI/Oエラーが発生し、通常はアプリケーションがシャットダウンします。</block>
  <block id="1b1ea0d1ad6e5cfb06253a14fcdcfe71" category="inline-link">TR-4733</block>
  <block id="9ccd61d6efc86cc37743fdff385832e8" category="paragraph">SM-Sの詳細については、を参照してください。<block ref="4459b84726c651a8047a6486e87e48fb" category="inline-link-rx"></block> ONTAPの公式ドキュメントを参照してください。ONTAPの新しいバージョンでは、機能が継続的に追加されています。</block>
  <block id="6165c4352e1504dbaeef34d0cc50c187" category="section-title">整合グループ</block>
  <block id="0651e813e385dbd62a9bca9baee23c6c" category="paragraph">ONTAPでは整合グループSnapshotを作成できます。9.13.1以降では、ONTAPでボリュームのグループを整合グループとしてレプリケートできます（ONTAP用語のボリュームはLUNではなく、1つ以上のファイルまたはLUNで構成される管理コンテナです）。</block>
  <block id="80c6d3e933105ad9a2c104ec78444b8c" category="paragraph">SnapMirrorレプリケーションとCG SnapMirror関係の解除では、ボリューム間で整合性が維持され、SnapMirror SynchronousとSnapMirror Business Continuityはどちらもコンスティチュエントボリューム間で整合性が維持されます。</block>
  <block id="455c7758003d6ebd974e8858f5ef1d7d" category="paragraph">その結果、複数ボリュームのデータセットをレプリケートして、すべてのボリュームの整合性を確保できます。特に、アプリケーションやデータベースのリカバリを追加することなく、ミラーを解除してDR処理を実行できます。</block>
  <block id="c44a2da164b7b770fce6338a987670ee" category="section-title">MetroClusterとSyncMirror</block>
  <block id="b1a1cfbf3988d8abdfdedaabc1742ae9" category="paragraph">MetroClusterは、大規模なミッションクリティカルなワークロードを対象とした同期レプリケーション解決策でもあります。レプリケーションはSyncMirrorに基づいています。最も単純なレイヤでは、SyncMirrorは2つの異なる場所にRAID保護データの完全なセットを作成します。データセンター内の隣接する部屋に配置することも、数キロメートル離れた場所に配置することもできます。</block>
  <block id="89b8adf28db7abb0febecafdca5871ad" category="paragraph">SyncMirrorはONTAPと完全に統合されており、RAIDレベルのすぐ上で動作します。そのため、Snapshotコピー、SnapRestore、NetApp FlexCloneなど、ONTAPの通常の機能はすべてシームレスに動作します。これはONTAPであり、同期データミラーリングの追加レイヤが含まれているだけです。</block>
  <block id="75c677fa68f5d15c17efbf6fd1fe1765" category="paragraph">SyncMirrorデータを管理するONTAPコントローラの集まりをNetApp MetroCluster構成と呼びます。MetroClusterの主な目的は、一般的な障害やディザスタリカバリのさまざまな障害シナリオにおいて、同期ミラーリングされたデータへの高可用性アクセスを提供することです。</block>
  <block id="af845652f0234e1f71bc37e241ab63dc" category="paragraph">MetroClusterとSyncMirrorを使用したデータ保護の主な価値は次のとおりです。</block>
  <block id="9ab80c5e33e343c3415c21be433c4447" category="list-text">通常運用時には、SyncMirrorは複数のサイト間の同期ミラーリングを保証します。書き込み処理は、両方のサイトの不揮発性メディアに存在するまで確認応答されません。</block>
  <block id="680ccf94624c9f922ed236c8cc0c1af2" category="list-text">サイト間の接続に障害が発生すると、SyncMirrorは自動的に非同期モードに切り替わり、接続が回復するまでプライマリサイトがデータを提供し続けます。リストア時には、プライマリサイトに蓄積された変更を効率的に更新することで、迅速な再同期を実現します。完全な再初期化は必要ありません。</block>
  <block id="c18ec55908c635b68abe8c6edbf6476e" category="paragraph">SnapMirrorは、SyncMirrorベースのシステムとも完全に互換性があります。たとえば、プライマリデータベースが2つの地理的なサイトに分散したMetroClusterクラスタで実行されているとします。このデータベースは、長期アーカイブやDevOps環境でのクローン作成のために、バックアップを第3のサイトにレプリケートすることもできます。</block>
  <block id="0660b44d1a6d7e0d905c3fe28eef63ab" category="summary">Oracle on ONTAP DR手順（ログ配布あり）</block>
  <block id="54bae719e8fa53582d5b2781b4952c6b" category="doc">ログ再生を使用したディザスタリカバリ</block>
  <block id="3a8111f0b903472ec78531619bf984f6" category="paragraph">Oracleデータベースのレプリケーション手順は、基本的にバックアップ手順と同じです。主な要件は、リカバリ可能なバックアップを構成するSnapshotをリモートストレージシステムにレプリケートする必要があることです。</block>
  <block id="c62b3abab4fdbaf8f0a84e8c3559b5fd" category="paragraph">ローカルデータ保護に関するドキュメントで前述したように、ホットバックアッププロセスを使用するか、Snapshotで最適化されたバックアップを利用して、リカバリ可能なバックアップを作成できます。</block>
  <block id="3d8f8c6a5c90bcd85a22fbd17390a864" category="inline-link-macro">データレイアウト</block>
  <block id="30394da99a39ca8264b8f7c0e6f679e0" category="paragraph">最も重要な要件は、データファイルを1つ以上の専用ボリュームに分離することです。これらのファイルは、他のファイルタイプによって汚染されていない必要があります。これは、データファイルのレプリケーションが、アーカイブログなどの他のデータタイプのレプリケーションから完全に独立していることを確認するためです。ファイルレイアウトの追加情報の場合、およびストレージレイアウトがスナップショットに適していることを確認するための重要な詳細については、を参照してください。  <block ref="5a4fdf6a1fc411e544cf6d70d47a8289" category="inline-link-macro-rx"></block>。</block>
  <block id="f3f227cc5c07a040d61c36679053a58a" category="paragraph">データファイルが専用ボリュームにカプセル化されているとしたら、次の問題はREDOログ、アーカイブログ、制御ファイルをどのように管理するかです。最も簡単なアプローチは、これらすべてのデータタイプを1つのボリュームに配置することです。その利点は、レプリケートされたREDOログ、アーカイブログ、制御ファイルが完全に同期されることです。不完全リカバリやバックアップ制御ファイルを使用する必要はありませんが、他のリカバリシナリオでバックアップ制御ファイルを作成するスクリプトも作成することを推奨します。</block>
  <block id="927992cbeccc8211e382c97e81514ef9" category="section-title">2ボリュームのレイアウト</block>
  <block id="fe1cf96940a710dc95fd30bbb7533b52" category="paragraph">最も単純なレイアウトを次の図に示します。</block>
  <block id="57f1db4bdf2ce49a98f375d8393f02bf" category="paragraph">これが最も一般的なアプローチです。DBAから見ると、Redoログとアーカイブログのすべてのコピーを同じボリュームに配置するのは珍しいことです。ただし、ファイルとLUNがすべて基盤となる同じドライブセットに配置されている場合、分離によって保護が強化されるわけではありません。</block>
  <block id="bc46e4831ef5654d084e456c4c544a42" category="section-title">3ボリュームのレイアウト</block>
  <block id="f6e969769d9d166122489505d676769b" category="paragraph">データ保護に関する懸念や、RedoログのI/Oをコントローラ間で分散する必要があるために、Redoログを分離する必要がある場合があります。その場合、次の図に示す3つのボリュームからなるレイアウトがレプリケーションに使用されますが、不完全リカバリを実行したり、バックアップ制御ファイルに依存したりする必要はありません。</block>
  <block id="4957c2feaa2cb72d80a0ab65228ad43f" category="paragraph">これにより、ソース上の独立したスピンドルとコントローラのセットにまたがるREDOログと制御ファイルのストライピングが可能になります。ただし、アーカイブログ、制御ファイルおよびREDOログのセットは、アーカイブログと同期された状態でレプリケートできます。</block>
  <block id="39128da64bc55500b4b11391aa54a011" category="paragraph">このモデルでは、RedoログBボリュームはレプリケートされません。</block>
  <block id="c0ce858e99375deac8274c96b7e5d0ee" category="section-title">ディザスタリカバリの手順—ホットバックアップ</block>
  <block id="6993729228512b7e23e3ff3ec9099f33" category="paragraph">ホットバックアップを使用してディザスタリカバリを実行するには、次の基本的な手順を使用します。</block>
  <block id="ee68e5b99222bbc29a480fcb0d1d6ee2" category="section-title">前提条件</block>
  <block id="41bde9c586a860264c425700c48bd375" category="list-text">Oracleバイナリはディザスタリカバリサーバにインストールされます。</block>
  <block id="cebf7cec81152da2cadffd580d81937f" category="list-text">データベースインスタンスは、<block ref="2c0b0433aa1c96a2be6f40d9e71bc6af" prefix=" " category="inline-code"></block>。</block>
  <block id="17f8e5eda67237f2ca94c7dcce3e4022" category="list-text">。<block ref="76a2173be6393254e72ffa4d6df1030a" prefix=" " category="inline-code"></block> および<block ref="6b2f852f7f63f2e5d4be597bbca97bb6" prefix=" " category="inline-code"></block> または<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> インスタンスの場合、<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> ディレクトリ。。</block>
  <block id="645a84975202e30700b572b49a5ee29d" category="section-title">ディザスタリカバリ</block>
  <block id="25d18766964d7515e1f5acd893094f6e" category="list-text">データファイルと共通ログボリュームのミラーを解除します。</block>
  <block id="8fc655e4752d521563db3bfa138ba62e" category="list-text">データファイルボリュームを、データファイルの最新のホットバックアップSnapshotにリストアします。</block>
  <block id="68a9c75816a16f6d4f7572fe287961bf" category="list-text">SANを使用する場合は、ボリュームグループをアクティブ化するか、ファイルシステムをマウントします。</block>
  <block id="312007510a0f0dc7878d4ed6a7a01554" category="list-text">アーカイブログを目的のポイントまで再生します。</block>
  <block id="e54b793d8bfa83bbb1bd965992c3474e" category="list-text">完全なリカバリが必要な場合は、現在のREDOログを再生します。</block>
  <block id="72e5734d53581f86093de5c97d8a3a24" category="paragraph">NFSを使用すると、データファイルとログファイル用のNFSファイルシステムをディザスタリカバリサーバにいつでもマウントできるため、手順が大幅に簡易化されます。ミラーが切断されると読み取り/書き込みになります。</block>
  <block id="de4735bc5bbfdcae3d690313c739ad67" category="section-title">ディザスタリカバリの手順—スナップショットに最適化されたバックアップ</block>
  <block id="6b2b8ef11e5ded8a083372ba49d488d2" category="paragraph">スナップショット用に最適化されたバックアップからのリカバリは、ホットバックアップリカバリ手順とほぼ同じですが、次の点が異なります。</block>
  <block id="af1e49e7bc2b25ce36bd93df09433fb4" category="list-text">データファイルボリュームを、現在のログボリュームレプリカの前に作成されたSnapshotにリストアします。</block>
  <block id="5e09669c98226c5d3a748f7e0f0333ad" category="paragraph">これらの違いにより、データベースがホットバックアップモードのときにソースでSnapshotが正しく作成されたことを確認する必要がないため、全体的なリカバリ手順が簡易化されます。ディザスタリカバリ手順は、ディザスタリカバリサイトのSnapshotのタイムスタンプに基づいています。スナップショット作成時のデータベースの状態は重要ではありません。</block>
  <block id="81d6beef7eaf28bbce692d4b59888f3e" category="section-title">ホットバックアップSnapshotによるディザスタリカバリ</block>
  <block id="dc711b77f0d6a9c9ccf88b424509440a" category="paragraph">これは、ホットバックアップSnapshotのレプリケーションに基づくディザスタリカバリ戦略の一例です。また、シンプルで拡張性に優れたローカルバックアップ戦略の一例としても機能します。</block>
  <block id="edaef18e1c956b9284405fd664c4ca4a" category="paragraph">この例のデータベースは、基本的な2ボリュームアーキテクチャに配置されています。<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> データファイル、および<block ref="894db1fc1592356880976f1b92c3e6a2" prefix=" " category="inline-code"></block> は、REDOログ、アーカイブログ、および制御ファイルの組み合わせに使用されます。</block>
  <block id="fc0e7b6cd7cd15929987b1429d1c3a7e" category="paragraph">2つのスケジュールが必要です。1つは夜間のデータファイルバックアップ用、もう1つはログファイルバックアップ用です。これらはそれぞれ深夜と15分と呼ばれます。</block>
  <block id="44c0956347a70c78d2124c1041321049" category="paragraph">これらのスケジュールは、Snapshotポリシー内で使用されます。<block ref="44dc83cda2d6b3ce99cc25803e824061" prefix=" " category="inline-code"></block> および<block ref="9b055600529d69c4ae0d2a9408dc7aa3" prefix=" " category="inline-code"></block>を参照してください。</block>
  <block id="180e86b8e3c5049779c98c2c1006bb15" category="paragraph">最後に、これらのSnapshotポリシーがボリュームに適用されます。</block>
  <block id="2887f2c14c7efbc97d53ac2f914c5657" category="paragraph">ボリュームのバックアップスケジュールを定義します。データファイルのSnapshotは午前0時に作成され、60日間保持されます。ログボリュームには、15分間隔で作成された72個のSnapshotが含まれています。これにより、最大で18時間がカバーされます。</block>
  <block id="e1e5ef0e7100311d950b4ffebe040670" category="paragraph">次に、データファイルのSnapshotの作成時にデータベースがホットバックアップモードになっていることを確認します。そのためには、指定したSIDでバックアップモードを開始および停止するいくつかの基本的な引数を受け入れる小さなスクリプトを使用します。</block>
  <block id="683cdd7abd993faf3ace355cd6870b6f" category="paragraph">この手順では、午前0時のSnapshotを囲む4分間の間に、データベースがホットバックアップモードになります。</block>
  <block id="ccff7eb3ad0059a184886709c87f4889" category="paragraph">ディザスタリカバリサイトへのレプリケーションは次のように設定されます。</block>
  <block id="42d3752a745fb0cdae528f6cc425b569" category="paragraph">ログボリュームのデスティネーションは15分ごとに更新されます。これにより、RPOは約15分になります。正確な更新間隔は、更新中に転送する必要があるデータの合計量によって少し異なります。</block>
  <block id="e272424001d72919ad498e0e9d3c2cc4" category="paragraph">データファイルのボリュームデスティネーションは6時間ごとに更新されます。これはRPOやRTOには影響しません。ディザスタリカバリが必要な場合は、まずデータファイルボリュームをホットバックアップSnapshotにリストアします。更新間隔を短くする目的は、このボリュームの転送速度をスムーズにすることです。更新が1日に1回スケジュールされている場合は、その日に蓄積されたすべての変更を一度に転送する必要があります。更新頻度が高くなると、変更は1日のうちに徐 々 にレプリケートされます。</block>
  <block id="ce176ff569d716c1fa73d0754aba684b" category="paragraph">災害が発生した場合は、最初に両方のボリュームのミラーを解除します。</block>
  <block id="4b9cdb6e2096c0828aeccd2ee5eecf42" category="paragraph">これで'レプリカは読み取り/書き込み可能になります次に、ログボリュームのタイムスタンプを確認します。</block>
  <block id="b4d461e48f5be5d08f677045d11e8200" category="paragraph">ログボリュームの最新のコピーは3月14日13：30：00です。</block>
  <block id="96f75a4b63f4377efdf64d571d71caec" category="paragraph">次に、ログボリュームの状態の直前に作成されたホットバックアップSnapshotを特定します。これは、ログ再生プロセスでは、すべてのアーカイブログがホットバックアップモードで作成される必要があるためです。したがって、ログボリュームレプリカはホットバックアップイメージよりも古いものである必要があります。そうしないと、必要なログが含まれません。</block>
  <block id="d358e4eb10a2f4e0b591e16941d7782c" category="paragraph">最後に作成されたSnapshotは<block ref="c001e27abf0e66d13790bb8a7e00da54" prefix=" " category="inline-code"></block>。データファイルの最新のホットバックアップイメージで、次のようにリストアされます。</block>
  <block id="d2037035a976c9be71cf6f372300c8c3" category="paragraph">この段階で、データベースをリカバリする準備が整いました。SAN環境の場合は、次の手順として、簡単に自動化できるボリュームグループのアクティブ化とファイルシステムのマウントを行います。この例ではNFSを使用しているため、ファイルシステムはすでにマウントされており、読み取り/書き込み可能になっています。ミラーが破損した瞬間にマウントやアクティブ化を行う必要はありません。</block>
  <block id="2edce22eade45b42bc6b2665057fa082" category="paragraph">これで、データベースを任意の時点にリカバリすることも、レプリケートされたREDOログのコピーに基づいてデータベースを完全にリカバリすることもできます。この例は、アーカイブログ、制御ファイル、およびREDOログを組み合わせたボリュームの値を示しています。バックアップ制御ファイルやリセットログファイルに依存する必要がないため、リカバリプロセスが大幅に簡易化されます。</block>
  <block id="51f74a82c7125b3b288755b6668091b1" category="section-title">Snapshotに最適化されたバックアップによるディザスタリカバリ</block>
  <block id="3680a4757ddad43934237ab6a0ca955c" category="paragraph">Snapshotで最適化されたバックアップを使用したディザスタリカバリ手順は、ホットバックアップディザスタリカバリ手順とほぼ同じです。ホットバックアップSnapshot手順と同様に、ディザスタリカバリ用にバックアップをレプリケートするローカルバックアップアーキテクチャの拡張機能でもあります。次の例は、詳細な設定とリカバリ手順を示しています。この例では、ホットバックアップとSnapshotで最適化されたバックアップの主な違いも示しています。</block>
  <block id="330dadae5e2585726f41ed1f90e88f9f" category="paragraph">この例のデータベースは、基本的な2ボリュームアーキテクチャに配置されています。<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> データファイルが格納されています。<block ref="894db1fc1592356880976f1b92c3e6a2" prefix=" " category="inline-code"></block> は、REDOログ、アーカイブログ、および制御ファイルの組み合わせに使用されます。</block>
  <block id="1669f47e046ce7e069e9d143f42e025d" category="paragraph">2つのスケジュールが必要です。1つは夜間のデータファイルバックアップ用、もう1つはログファイルバックアップ用です。これらはそれぞれ深夜と15分と呼ばれます。</block>
  <block id="ef4adcab3e9bd572d0670f9f2073c311" category="paragraph">これにより、ボリュームの最終的なバックアップスケジュールが制御されます。Snapshotは午前0時に作成され、60日間保持されます。ログボリュームには、15分間隔で作成された72個のSnapshotが含まれており、合計で18時間になります。</block>
  <block id="f9d5149b630a43ff5996adc26c6e1f08" category="paragraph">ログボリュームのデスティネーションは15分ごとに更新されます。これにより、RPOは約15分になります。正確な更新間隔は、更新中に転送する必要があるデータの合計量によって多少異なります。</block>
  <block id="992398ebd9e9f825f0aa4415519abdba" category="paragraph">データファイルのボリュームデスティネーションは6時間ごとに更新されます。これはRPOやRTOには影響しません。ディザスタリカバリが必要な場合は、まずデータファイルボリュームをホットバックアップSnapshotにリストアする必要があります。更新間隔を短くする目的は、このボリュームの転送速度をスムーズにすることです。更新が1日に1回スケジュールされている場合は、その日に蓄積されたすべての変更を一度に転送する必要があります。更新頻度が高くなると、変更は1日のうちに徐 々 にレプリケートされます。</block>
  <block id="9e85b8590ac2f9ff5ebc8d1def51ae82" category="paragraph">災害が発生した場合は、最初にすべてのボリュームのミラーを解除します。</block>
  <block id="fd2834dcadb39f00eb897fdcdc07a03d" category="paragraph">ログボリュームの最新のコピーは3月14日13：30です。次に、ログボリュームの状態の直前に作成されたデータファイルのSnapshotを特定します。これは、ログ再生プロセスでは、Snapshotの直前から目的のリカバリポイントまでのすべてのアーカイブログが必要になるためです。</block>
  <block id="810e47566b9cd5aa3b28e6514ec95735" category="paragraph">最後に作成されたSnapshotは<block ref="c001e27abf0e66d13790bb8a7e00da54" prefix=" " category="inline-code"></block>。このSnapshotをリストアします。</block>
  <block id="87d83a0406ac6622efcdf91c42784ecd" category="paragraph">これで、データベースをリカバリする準備が整いました。SAN環境の場合は、ボリュームグループをアクティブ化してファイルシステムをマウントすると、プロセスが簡単に自動化されます。ただし、この例ではNFSを使用しているため、ファイルシステムはすでにマウントされて読み書き可能になり、ミラーが破損した瞬間にマウントやアクティブ化を行う必要はありません。</block>
  <block id="7a2e97f17454be76b7e522ce612ff961" category="paragraph">これで、データベースを任意の時点にリカバリすることも、レプリケートされたREDOログのコピーに基づいてデータベースを完全にリカバリすることもできます。この例は、アーカイブログ、制御ファイル、およびREDOログを組み合わせたボリュームの値を示しています。バックアップ制御ファイルやリセットログファイルに依存する必要がないため、リカバリプロセスが大幅に簡易化されます。</block>
  <block id="d6597945276340ba33115e737eb4b489" category="summary">Oracleデータベースの整合グループレプリケーション</block>
  <block id="fc506ae4ea109f50758acc176bcb5341" category="doc">整合グループのディザスタリカバリ</block>
  <block id="5eda890cc07e4b7cd409730d8af8ddc3" category="paragraph">整合グループのレプリケーションは、SnapMirrorを使用して単一ボリュームのレプリケーションをスケジュール設定するだけで簡単に実行できます。これには、データファイル、制御ファイル、アーカイブログ、REDOログが含まれます。SnapMirrorの更新を行うたびに、デスティネーションサイトにデータベースの新しいコピーが作成され、ミラーを解除することで整合性があり、アクティブ化できる状態になります。</block>
  <block id="89cb1432594ce7c25dadf229401874e7" category="paragraph">データベースが複数のボリュームにまたがっている必要がある場合は、整合性グループSnapshot（cg-snapshot）が必要です。</block>
  <block id="f96b125d1bacc785389957041be148e9" category="paragraph">ブロックレベルのレプリケーションモードでSnapMirrorとともに使用する場合、この戦略のもう1つの利点は、ソースストレージシステム上のすべてのSnapshotの完全なレプリケーションです。ディザスタリカバリコピーに加えて、バックアップ全体がレプリケートされます。</block>
  <block id="77fda44088666155052f9d4224878cbc" category="summary">Oracleアーカイブログの階層化</block>
  <block id="113d9dffdeb8fa14877fc8cf8ca7c9d5" category="doc">Oracleログの階層化</block>
  <block id="8625af69ad0b5f76799d87df777e3c86" category="paragraph">FabricPoolの最も重要な用途は、データベーストランザクションログなどの既知のコールドデータの効率化です。</block>
  <block id="a98d546484d238b37b7e2584ae8d399d" category="summary">Oracleバックアップの階層化</block>
  <block id="9f409a250e4be99904c9e90259cb747d" category="paragraph">従来のアプリケーションバックアップには、Oracle Recovery Managerなどの製品が含まれています。Oracle Recovery Managerは、元のデータベースの場所以外にファイルベースのバックアップを作成します。</block>
  <block id="6cddb309df5eb8791dc990f72ef2deb2" category="summary">Oracleの階層化ポリシー</block>
  <block id="7ba3322dbc0b3c33a66f1963e80b7a2a" category="doc">Oracleデータベースの階層化ポリシー</block>
  <block id="4627801bdbb24a1991e64f30a2d80cb1" category="paragraph">ONTAPでは4つのポリシーを使用して、高パフォーマンス階層にあるOracleデータを大容量階層に再配置する方法を制御できます。</block>
  <block id="47f6817eca23122cc683f7c2759e6ecb" category="summary">[Oracle]タイルの階層化</block>
  <block id="1def0ac22a738b54cce584e969065918" category="doc">Oracleのフルファイル階層化</block>
  <block id="2eea2725f31529888b5e57b36492819f" category="paragraph">FabricPool階層化はブロックレベルで動作しますが、ファイルレベルの階層化に使用できる場合もあります。</block>
  <block id="468853d9ed2134af17ede5fd165a8dff" category="summary">FabricPoolによる部分的なファイル階層化</block>
  <block id="5638b2f30ee966b3ff84bac350092971" category="doc">Oracleの部分ファイル階層化</block>
  <block id="f935a501eae76f9c13d430bc3879cd0d" category="paragraph">FabricPoolはブロックレベルで機能するため、変更の可能性があるファイルは部分的にオブジェクトストレージに階層化し、部分的にパフォーマンス階層に残すことができます。</block>
  <block id="dd22ff2cf158f98efbd92f4522b3064b" category="summary">オブジェクトストアへのアクセス中断時のデータベースアクセス</block>
  <block id="cc4e17c26faf6b70b383529b6215ba0f" category="doc">オブジェクトストアへのアクセスの中断</block>
  <block id="bbb21240a2cc48eb7a229ec824e70cdf" category="summary">FabricPoolを使用するOracleの階層化の概要</block>
  <block id="ec2ffb259f21d115e5481eb0f215aa0d" category="doc">Oracleの階層化の概要</block>
  <block id="ec35a176f3e7c086273baee0c7f374d5" category="paragraph">FabricPoolの階層化がOracleやその他のデータベースに与える影響を理解するには、低レベルのFabricPoolアーキテクチャについて理解しておく必要があります。</block>
  <block id="cd6b77e4d343896571bc445479f24588" category="summary">Pracle階層化読み出しポリシー</block>
  <block id="3bf6f5a455b1889775d79713ad4e19ed" category="doc">読み出しポリシー</block>
  <block id="6edf1821ddc55278229c2156f42905f0" category="paragraph">階層化ポリシーは、どのOracleデータベースブロックをパフォーマンス階層から大容量階層に階層化するかを制御します。読み出しポリシーは、階層化されたブロックが読み取られたときの処理を制御します。</block>
  <block id="95ab96ac5aaeae15f7b499d0fa0313cf" category="summary">Oracleスナップショットの階層化</block>
  <block id="d01cbb2be77343ccdb1d3372c4b9891e" category="summary">OracleデータベースのLUNのサイジングとLUN数のガイドライン</block>
  <block id="b9e88e2eb3d5eef807fc42db706d866a" category="doc">Oracle LUNのサイジングとLUN数</block>
  <block id="51f96d1f8b50084e3a2ddc21ceef8b2f" category="paragraph">Oracleデータベースのパフォーマンスと管理性を最適化するには、最適なLUNサイズと使用するLUNの数を選択することが重要です。</block>
  <block id="3d1bd23e74923cdc48fe992d0687809f" category="summary">OracleデータベースとNFSのリースとロック</block>
  <block id="472f36eb81330c2c27f02245ce8a911e" category="doc">NFSリースとロック- Oracle</block>
  <block id="cec6f8a988408ba212798e1cc32658c7" category="paragraph">NFSv3はステートレスです。つまり、NFSサーバ（ONTAP）は、どのファイルシステムがマウントされているのか、誰がどのロックが実際に有効であるのかを追跡しません。</block>
  <block id="7c96331bd03e63c4eb3505c526b42244" category="paragraph">ONTAPにはマウントの試行を記録する機能がいくつかあります。そのため、どのクライアントがデータにアクセスしている可能性があるかを把握できます。また、アドバイザリロックが存在する可能性がありますが、その情報が100%完了する保証はありません。NFSクライアントの状態の追跡はNFSv3標準には含まれていないため、この処理を完了できません。</block>
  <block id="20733ad7135aa0ede95fd8637fe05cf6" category="section-title">NFSv4のステートフル</block>
  <block id="3f7c11f662fc6e07a91179fdf2322ef5" category="paragraph">一方、NFSv4はステートフルです。NFSv4サーバは、どのクライアントが使用しているファイルシステム、どのファイルが存在するか、どのファイルやファイル領域がロックされているかなどを追跡します。 つまり、状態のデータを最新の状態に保つためには、NFSv4サーバ間で定期的な通信が必要です。</block>
  <block id="6f7e4a1e570f45fa3db0b8a0ed80a38f" category="paragraph">NFSサーバによって管理されている最も重要な状態は、NFSv4ロックとNFSv4リースであり、これらは非常に密接に関連しています。それぞれがそれ自体でどのように機能し、それらが互いにどのように関連しているかを理解する必要があります。</block>
  <block id="0d55fd4062f29237d0fb3b7f666fb8eb" category="section-title">NFSv4ロック</block>
  <block id="bf4139ff42e411ae5483e062387b3f70" category="paragraph">NFSv3では、ロックは推奨されます。NFSクライアントは、「ロックされた」ファイルを変更または削除できます。NFSv3のロックは自動的に期限切れになるわけではなく、削除する必要があります。これは問題を引き起こします。たとえば、クラスタ化されたアプリケーションでNFSv3ロックを作成していて、いずれかのノードで障害が発生した場合は、どうすればよいですか？残りのノードでアプリケーションをコーディングしてロックを解除できますが、それが安全であることをどのようにして確認できますか？「failed」ノードは動作しているが、クラスタの残りのノードと通信していない可能性があります。</block>
  <block id="11d1c33ac6b190a233c00cdbdd6a355b" category="paragraph">NFSv4では、ロックの期間に制限があります。ロックを保持しているクライアントがNFSv4サーバにチェックインし続けるかぎり、他のクライアントはこれらのロックを取得できません。クライアントがNFSv4へのチェックインに失敗すると、最終的にサーバによってロックが取り消され、他のクライアントはロックを要求および取得できます。</block>
  <block id="c17985911e0182dc5e96c4d60aadf139" category="section-title">NFSv4リース</block>
  <block id="596bcfef3aaccfe299bb45a969afcaf0" category="paragraph">NFSv4ロックはNFSv4リースに関連付けられます。NFSv4クライアントがNFSv4サーバとの接続を確立すると、リースを取得します。クライアントがロックを取得した場合（ロックにはさまざまな種類があります）、ロックはリースに関連付けられます。</block>
  <block id="b5248856b1835e14738aa32e053e30e0" category="paragraph">このリースには定義済みのタイムアウトがあります。デフォルトでは、ONTAPはタイムアウト値を30秒に設定します。</block>
  <block id="7e2a66190f452806ac1183721a43eaa1" category="paragraph">つまり、NFSv4クライアントはリースを更新するために、30秒ごとにNFSv4サーバにチェックインする必要があります。</block>
  <block id="809c552ae0a4d377e87f495b4e3ac62b" category="paragraph">リースはすべてのアクティビティによって自動的に更新されるため、クライアントが作業を行っている場合は追加操作を実行する必要はありません。アプリケーションが静かになり、実際の作業を行っていない場合は、代わりに一種のキープアライブ操作(シーケンスと呼ばれる)を実行する必要があります。それは基本的に「私はまだここにいる、私のリースを更新してください」と言っているだけです。</block>
  <block id="70cb78bb7e91dcafab559f9b72e40bb6" category="paragraph">NFSv3はステートレスです。クライアントからの通信を期待していません。NFSv4はステートフルであり、リース期間が経過するとリースが期限切れになり、ロックが取り消され、ロックされたファイルが他のクライアントから利用可能になります。</block>
  <block id="2ee5d81cfa6306ae71ce534ed9b31431" category="paragraph">NFSv3では、ネットワークケーブルを移動したり、ネットワークスイッチをリブートしたり、設定を変更したりすることができ、問題が発生しないように十分に確認することができます。アプリケーションは通常、ネットワーク接続が再び機能するのを辛抱強く待つだけです。</block>
  <block id="8900ff182e4197f8eb2acd7d2b7fd902" category="paragraph">NFSv4では、作業を完了するまでに30秒かかります（ONTAP内でそのパラメータの値を増やした場合を除く）。それを超えると、リースはタイムアウトになります。通常、この結果、アプリケーションがクラッシュします。</block>
  <block id="ffa8c7744b3e2d43b18c67aec0fe7743" category="paragraph">たとえば、Oracleデータベースを使用していて、リースタイムアウトを超えるネットワーク接続（「ネットワークパーティション」と呼ばれることもあります）が失われると、データベースがクラッシュします。</block>
  <block id="33b9897348039594b4b17bf1e1629c74" category="paragraph">これが発生した場合のOracleアラート・ログの出力例を次に示します</block>
  <block id="85608585bf8e790a579c49ba9af705c6" category="paragraph">syslogを確認すると、次のエラーのいくつかが表示されます。</block>
  <block id="e19b338de53dada4cf4da3837aaba76d" category="paragraph">ログメッセージは通常、アプリケーションがフリーズする以外に、問題の最初の兆候です。通常、ネットワークの停止中は何も表示されません。これは、NFSファイルシステムにアクセスしようとするプロセスとOS自体がブロックされるためです。</block>
  <block id="7a3c8c17a9dd10fa565f79e0ebb5bba7" category="paragraph">エラーは、ネットワークが再び動作可能になると表示されます。上記の例では、接続が再確立されると、OSはロックの再取得を試みましたが、遅すぎました。リースが期限切れになり、ロックが削除されました。その結果、エラーがOracleレイヤまで伝播し、アラートログにメッセージが記録されます。これらのパターンは、データベースのバージョンと構成によって異なる場合があります。</block>
  <block id="4bec5e793e34a5819aefb68e4f65db26" category="paragraph">要約すると、NFSv3はネットワークの中断は許容されますが、NFSv4はより機密性が高く、リース期間が定義されます。</block>
  <block id="069de2d717910b2677190b9a9b5ed1cf" category="paragraph">30秒のタイムアウトが許容されない場合はどうなりますか。スイッチが再起動されたり、ケーブルが再配置されたりする動的に変化するネットワークを管理していて、その結果、時 々 ネットワークが中断される場合はどうなりますか。リース期間を延長することもできますが、その場合はNFSv4猶予期間の説明が必要です。</block>
  <block id="4b84416146795544deb5c9de89187f91" category="section-title">NFSv4猶予期間</block>
  <block id="7d98e091c5f7be92cd5fb85b985d8d20" category="paragraph">NFSv3サーバをリブートすると、ほぼ瞬時にIOを処理できるようになります。それはクライアントの状態を維持することではありませんでした。そのため、ONTAPのテイクオーバー処理はほぼ瞬時に実行されることがよくあります。コントローラがデータの提供を開始する準備ができた時点で、ネットワークにARPを送信し、トポロジの変更を通知します。通常、クライアントはこれをほぼ瞬時に検出し、データの流れを再開します。</block>
  <block id="173d4fd05086441236dbee4710639d10" category="paragraph">ただし、NFSv4では一時停止が発生します。これは、NFSv4がどのように機能するかの一部にすぎません。</block>
  <block id="21483115213b27583a07dc2ca994671c" category="paragraph">NFSv4サーバは、リース、ロック、および誰がどのデータを使用しているかを追跡する必要があります。NFSサーバがパニック状態になってリブートされた場合、または一時的に電力が失われた場合、またはメンテナンス作業中に再起動された場合は、リース/ロックなどのクライアント情報が失われます。サーバは、処理を再開する前に、どのクライアントがどのデータを使用しているかを把握する必要があります。ここで猶予期間が入ります。</block>
  <block id="09b6f386094bd895d3c9694f28bfdf65" category="paragraph">NFSv4サーバの電源が突然再投入された場合。再起動すると、IOを再開しようとするクライアントは、基本的に「リース/ロック情報が失われました。ロックを再登録しますか？" これが猶予期間の始まりですONTAPではデフォルトで45秒です。</block>
  <block id="e4f8aa90af36d76254e2f02e56232aed" category="paragraph">その結果、再起動後、すべてのクライアントがリースとロックを再要求する間、コントローラはIOを一時停止します。猶予期間が終了すると、サーバはIO処理を再開します。</block>
  <block id="bb2b26fdcb4e947cda6f8e38724ecfc9" category="section-title">リースタイムアウトと猶予期間</block>
  <block id="563494d7f0f6ebcb6698cac7f9705aaa" category="paragraph">猶予期間とリース期間が接続されます。前述したように、デフォルトのリースタイムアウトは30秒です。つまり、NFSv4クライアントは少なくとも30秒ごとにサーバにチェックインする必要があります。そうしないと、リースとロックが失われます。この猶予期間はNFSサーバがリース/ロックデータを再構築できるようにするためのもので、デフォルトは45秒です。ONTAPでは、猶予期間をリース期間より15秒長くする必要があります。これにより、リースを30秒以上更新するように設計されたNFSクライアント環境では、再起動後にサーバにチェックインできます。猶予期間を45秒に設定することで、少なくとも30秒ごとにリースを更新することを期待するすべてのクライアントが確実に更新する機会を得ることができます。</block>
  <block id="5e6b60906bbbb9a41b140c0749591489" category="paragraph">30秒のタイムアウトが許容されない場合は、リース期間を延長することもできます。60秒のネットワーク停止に耐えるためにリースタイムアウトを60秒に延長する場合は、猶予期間を少なくとも75秒に延長する必要があります。ONTAPでは、リース期間より15秒長くする必要があります。つまり、コントローラフェイルオーバー中にIOが一時停止する時間が長くなります。</block>
  <block id="4611c7c931fc15a6feba513fe72e22de" category="paragraph">これは通常は問題ではありません。一般的なユーザはONTAPコントローラを年に1~2回更新するだけで、ハードウェア障害による計画外フェイルオーバーは非常にまれです。また、ネットワークに60秒のネットワーク停止が発生する可能性があり、リースタイムアウトを60秒にする必要がある場合は、まれにストレージシステムのフェイルオーバーに異議を唱えず、75秒の一時停止も発生する可能性があります。ネットワークが60秒以上頻繁に一時停止していることをすでに認識しています。</block>
  <block id="c4fb6f7d31d205bc07dbff47d0ae4bb3" category="summary">Oracle Direct NFS</block>
  <block id="f58bdad9659176e411f064fdb414233f" category="doc">Oracle directNFS</block>
  <block id="1bd6ec1185ba67395dc6f9cd2b458ec8" category="paragraph">Oracleデータベースでは、NFSを2つの方法で使用できます。</block>
  <block id="96997ca5c577dd19a3ba5f7ff771f27a" category="paragraph">まず、オペレーティングシステムの一部であるネイティブのNFSクライアントを使用してマウントされたファイルシステムを使用できます。これはカーネルNFS（kNFS）と呼ばれることもあります。NFSファイルシステムは、NFSファイルシステムを使用する他のアプリケーションとまったく同じように、Oracleデータベースによってマウントされ、使用されます。</block>
  <block id="95c17c63df7ceea39a175b1d96955bb7" category="paragraph">2つ目の方法はOracle Direct NFS（dNFS）です。これは、OracleデータベースソフトウェアにNFS標準を実装したものです。DBAによるOracleデータベースの設定や管理方法は変更されません。ストレージシステム自体に正しい設定があるかぎり、DBAチームやエンドユーザはdNFSを透過的に使用できなければなりません。</block>
  <block id="43539d2fca21e5b644484efb94614a7b" category="paragraph">dNFS機能を有効にしたデータベースでは、通常のNFSファイルシステムが引き続きマウントされています。データベースが開くと、Oracleデータベースは一連のTCP/IPセッションを開き、NFS操作を直接実行します。</block>
  <block id="26e7ebad3936387b4b3f7c4f5688ef27" category="section-title">Direct NFS</block>
  <block id="6d431a52c8a41a7c2335f98e2ae8c454" category="paragraph">OracleのDirect NFSの主なメリットは'ホストのNFSクライアントをバイパスして'NFSサーバ上で直接NFSファイル操作を実行することですこれを有効にするには、Oracle Disk Manager（ODM）ライブラリを変更する必要があります。このプロセスの手順については、Oracleのマニュアルを参照してください。</block>
  <block id="8401d91735209aeccbe56f33b4e2db73" category="paragraph">dNFSを使用すると、I/Oが最も効率的な方法で実行されるため、I/Oパフォーマンスが大幅に向上し、ホストとストレージシステムの負荷が軽減されます。</block>
  <block id="b0dedecb00787180a9e0c657cfb278c9" category="paragraph">さらに、Oracle dNFSには、ネットワークインターフェイスのマルチパスとフォールトトレランス用の*オプション*が含まれています。たとえば、2つの10Gbインターフェイスをバインドして、20Gbの帯域幅を提供できます。一方のインターフェイスで障害が発生すると、もう一方のインターフェイスでI/Oが再試行されます。全体的な処理はFCマルチパスとほぼ同じです。マルチパスは、1Gbイーサネットが最も一般的な標準であった数年前には一般的でした。ほとんどのOracleワークロードには10Gb NICで十分ですが、必要に応じて10Gb NICをボンディングできます。</block>
  <block id="11e50b3c816105439151db3a3b4fdda3" category="paragraph">dNFSを使用する場合は、Oracleのドキュメント1495104.1に記載されているパッチをすべてインストールしておくことが重要です。パッチをインストールできない場合は、環境を評価して、そのドキュメントに記載されているバグが原因の問題ではないことを確認する必要があります。必要なパッチをインストールできないためにdNFSを使用できない場合があります。</block>
  <block id="8f98002fee392ad6151679875de1a7cc" category="paragraph">dNFSでラウンドロビン方式の名前解決（DNS、DDNS、NISなど）を使用しないでください。これには、ONTAPで使用できるDNSロードバランシング機能も含まれます。dNFSを使用するOracleデータベースがあるホスト名をIPアドレスに解決した場合、以降の検索でもホスト名が変更されないようにする必要があります。その結果、Oracleデータベースがクラッシュし、データが破損する可能性があります。</block>
  <block id="e80ad3efb180dc2d016b27506b7b24ce" category="section-title">Direct NFSとホストファイルシステムへのアクセス</block>
  <block id="4c38a8c0a49e721bf2a378d0b4fb2010" category="paragraph">アプリケーションやユーザのアクティビティが、ホストにマウントされた参照可能なファイルシステムに依存している場合、dNFSを使用すると原因の問題が発生することがあります。これは、dNFSクライアントがホストOSの帯域外でファイルシステムにアクセスするためです。dNFSクライアントは、OSが認識されていなくてもファイルの作成、削除、および変更を行うことができます。</block>
  <block id="c03389fdb295f2acb079603123e6d0e3" category="paragraph">シングルインスタンスデータベースのマウントオプションを使用すると、ファイルおよびディレクトリの属性のキャッシュが有効になり、ディレクトリの内容もキャッシュされます。そのため、dNFSでファイルが作成される可能性があり、OSがディレクトリの内容を再読み取りしてファイルがユーザに表示されるまでに少し時間がかかります。これは通常は問題になりませんが、まれに、SAP BR * Toolsなどのユーティリティで問題が発生することがあります。この場合は、マウントオプションをOracle RACの推奨事項に変更して、問題に対処してください。この変更により、ホストのキャッシュがすべて無効になります。</block>
  <block id="a370a203383b565c3fb746c1c2e1a64b" category="paragraph">マウントオプションを変更するのは、（a）dNFSが使用されていて、（b）問題がファイルが参照可能になるまでの遅延が原因で発生した場合のみにしてください。dNFSを使用していない場合は、シングルインスタンスデータベースでOracle RACマウントオプションを使用すると、パフォーマンスが低下します。</block>
  <block id="b1ced01e4bbcd95ec43a2756131f8f9d" category="admonition">次の注を参照：<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block> インチ <block ref="657185beb26ec14433f7e083717fa98b" category="inline-link-macro-rx"></block> 通常とは異なる結果を生成する可能性があるLinux固有のdNFS問題の場合。</block>
  <block id="22a7a03175addfd9aa5b1fa2c351e833" category="summary">OracleテタヘスヨウノNFSノセツテイ</block>
  <block id="6cb2edd2369a17890dce007723d98a6f" category="paragraph">NetAppは30年以上にわたってエンタープライズクラスのNFSストレージを提供してきましたが、クラウドベースのインフラへの移行が進むにつれ、その使用がますます増えています。その理由は、シンプルさです。</block>
  <block id="95e0ac965f4d3a739263ba13584b6411" category="inline-link-macro">TR-4067『NFS on NetApp ONTAP Best Practices』</block>
  <block id="c46e4d65876bc5d9253e8e293f59b613" category="paragraph">NFSプロトコルには、要件が異なる複数のバージョンが含まれています。ONTAPを使用したNFSの完全な概要構成については、を参照してください。 <block ref="e3fa0577f1d5ea8870d93a30eb76667f" category="inline-link-macro-rx"></block>。次のセクションでは、より重要な要件と一般的なユーザーエラーについて説明します。</block>
  <block id="0f8a941fcc56687ad8e3914162c19a41" category="section-title">NFSハアシヨン</block>
  <block id="d0972be450ccf257fb73d4878bce204e" category="paragraph">オペレーティングシステムNFSクライアントがNetAppでサポートされている必要があります。</block>
  <block id="7722a2ae10cef9bccea115dfdfe78a99" category="list-text">NFSv3は、NFSv3標準に準拠したOSでサポートされます。</block>
  <block id="a3550edc6962850398d217f78cc4ad0d" category="list-text">Oracle dNFSクライアントではNFSv3がサポートされています。</block>
  <block id="89c45ebba54478419aa679a7ece8593d" category="list-text">NFSv4は、NFSv4標準に準拠するすべてのOSでサポートされます。</block>
  <block id="471ff51c89daf6e35e8e2b5111039744" category="inline-link-macro">NetApp IMT</block>
  <block id="8594659e8c4292db778973052a30ab86" category="list-text">NFSv4.1およびNFSv4.2では、特定のOSのサポートが必要です。を参照してください <block ref="d98f827de8e80b3365d5f4160c243cdc" category="inline-link-macro-rx"></block> サポートされているOSの場合。</block>
  <block id="d1eb4c2a4d74705a5aa7945f734eff7c" category="list-text">NFSv4.1でのOracle dNFSのサポートには、Oracle 12.2.0.2以降が必要です。</block>
  <block id="d8bacc1a7a9d6baaeb962e367920593b" category="inline-link-macro">NetAppのサポートマトリックス</block>
  <block id="f16dcce07ca44aa38c7ebe3016b981b2" category="admonition">。 <block ref="f1e4f72fb4419d4270270c5ed1e0d9f6" category="inline-link-macro-rx"></block> NFSv3およびNFSv4の場合、特定のオペレーティングシステムは含まれません。RFCに準拠するすべてのOSが一般的にサポートされています。オンラインのIMTでNFSv3またはNFSv4のサポートを検索する場合は、該当するOSが表示されないため、特定のOSを選択しないでください。すべてのOSは、一般ポリシーで暗黙的にサポートされています。</block>
  <block id="26ed9768d6a659a9768842d903d0025f" category="section-title">Linux NFSv3 TCPスロットテーブル</block>
  <block id="c56ec9836fbbd9c0a426a40fc71c265c" category="paragraph">TCPスロットテーブルは、NFSv3でホストバスアダプタ（HBA）のキュー深度に相当します。一度に未処理となることのできるNFS処理の数を制御します。デフォルト値は通常16ですが、最適なパフォーマンスを得るには小さすぎます。逆に、新しいLinuxカーネルでTCPスロットテーブルの上限をNFSサーバが要求でいっぱいになるレベルに自動的に引き上げることができるため、問題が発生します。</block>
  <block id="5270700baa50d07af667096293a27564" category="paragraph">パフォーマンスを最適化し、パフォーマンスの問題を回避するには、TCPスロットテーブルを制御するカーネルパラメータを調整します。</block>
  <block id="5b29db1d99e19013580fa375a5f87fa5" category="paragraph">を実行します<block ref="1a1e44f7a3390ed4647a7d5b7e8b08ed" prefix=" " category="inline-code"></block> コマンドを実行し、次のパラメータを確認します。</block>
  <block id="8821adf56df4952370cfaa57ccaac68d" category="paragraph">すべてのLinuxシステムに<block ref="c5f48b899461d4c2b9ddc0b24ea87744" prefix=" " category="inline-code"></block>ただし、次のようなものがあります。<block ref="6f72acaebcb9a0de6696aaf3508a6144" prefix=" " category="inline-code"></block>。どちらも128に設定する必要があります。</block>
  <block id="3a954c4e5e8d5ac3af590651efc5a2cb" category="cell">これらのパラメータを設定しないと、パフォーマンスに大きく影響する可能性があります。Linux OSが十分なI/Oを発行していないためにパフォーマンスが制限される場合もあります。一方では、Linux OSが問題で処理できる以上のI/Oを試行すると、I/Oレイテンシが増加します。</block>
  <block id="837f157b2f309f5415420467f7643e3a" category="section-title">ADRとNFS</block>
  <block id="c0e7bb1383be0bf1268d1d70280bef6d" category="paragraph">一部のお客様から、内のデータに対する過剰なI/Oが原因でパフォーマンスの問題が発生すると報告されています。<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 場所。通常、この問題は、大量のパフォーマンスデータが蓄積されるまで発生しません。過剰なI/Oの理由は不明ですが、Oracleプロセスがターゲットディレクトリを繰り返しスキャンして変更を求めたことが原因と考えられます。</block>
  <block id="99be2ae95d50120a7c33c818afda1834" category="paragraph">の取り外し<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> および / または<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> マウントオプションを使用すると、ホストOSのキャッシュを実行してストレージI/Oレベルを削減できます。</block>
  <block id="8950578c587f9503f949dfc6a274b611" category="admonition">* NetApp推奨*配置しないこと<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> フアイルシステムノテエタ<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> または<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> パフォーマンスの問題が発生する可能性があるからです。分離<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> データを別のマウントポイントに格納（必要な場合）</block>
  <block id="cdb92b4a73ae99cde4df55c06e20dd3c" category="section-title">nfs-rootonlyおよびmount-rootonly</block>
  <block id="c1f0a21ee026237bef11139a30b07040" category="paragraph">ONTAPには、という名前のNFSオプションがあります。<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> これにより、サーバが高ポートからのNFSトラフィック接続を受け入れるかどうかが制御されます。セキュリティ対策として、1024未満の送信元ポートを使用してTCP/IP接続を開くことができるのはrootユーザだけです。これは、このようなポートは通常、ユーザプロセスではなくOS用に予約されているためです。この制限により、NFSトラフィックが実際のオペレーティングシステムNFSクライアントからのものであり、NFSクライアントをエミュレートする悪意のあるプロセスではないことを確認できます。Oracle dNFSクライアントはユーザスペースドライバですが、このプロセスはrootとして実行されるため、通常は<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block>。接続は低ポートから行われます。</block>
  <block id="832b4524bcec11d28ca777ef9cdb4084" category="paragraph">。<block ref="eb6c1a5ecd1e17d4cd46fa5c9d415816" prefix=" " category="inline-code"></block> オプションは環境NFSv3のみです。1024より大きいポートからRPCマウント呼び出しを受け入れるかどうかを制御します。dNFSを使用すると、クライアントは再びルートとして実行されるため、1024未満のポートを開くことができます。このパラメータは効果がありません。</block>
  <block id="57c47a1451485bec1ebb060afdf65cb4" category="paragraph">NFSバージョン4.0以降でdNFSを使用して接続を開いているプロセスは、rootとして実行されないため、1024以上のポートが必要です。。<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> dNFSが接続を完了するには、パラメータをdisabledに設定する必要があります。</block>
  <block id="4dd73247734d116e5039cc04c4979f2c" category="paragraph">状況<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> が有効になっている場合、マウントフェーズでdNFS接続を開いているときにハングします。sqlplusの出力は次のようになります。</block>
  <block id="f62d72479920ff0f8dc9a3ca6f301b5d" category="paragraph">パラメータは次のように変更できます。</block>
  <block id="47fc6c6691aed3ba0dbdc66c7896c61b" category="admonition">まれに、nfs-rootonlyとmount-rootonlyの両方をdisabledに変更しなければならないことがあります。サーバが非常に多くのTCP接続を管理している場合、1024未満のポートが使用できない可能性があり、OSはより高いポートを使用するように強制されます。接続を完了するには、これら2つのONTAPパラメータを変更する必要があります。</block>
  <block id="10b4eb170fe7bd035f21e7d863796683" category="section-title">NFSエクスポートポリシー：superuserとsetuid</block>
  <block id="98bfec37486e95443730cc3d462022fb" category="paragraph">OracleバイナリがNFS共有に配置されている場合は、エクスポートポリシーにsuperuser権限とsetuid権限を含める必要があります。</block>
  <block id="3c0699ba2c56cb17c145bbda5580ed67" category="paragraph">ユーザホームディレクトリなどの汎用ファイルサービスに使用される共有NFSエクスポートでは、通常、rootユーザが引き下げられます。これは、ファイルシステムをマウントしたホスト上のrootユーザからの要求が、より低い権限を持つ別のユーザとして再マッピングされることを意味します。これは、特定のサーバ上のrootユーザが共有サーバ上のデータにアクセスできないようにすることで、データを保護するのに役立ちます。setuidビットは、共有環境ではセキュリティリスクになることもあります。setuidビットを使用すると、コマンドを呼び出すユーザとは別のユーザとしてプロセスを実行できます。たとえば、rootがsetuidビットを持つシェルスクリプトはrootとして実行されます。そのシェルスクリプトが他のユーザによって変更される可能性がある場合、root以外のユーザはスクリプトを更新することでrootとしてコマンドを問題できます。</block>
  <block id="e341736b7d51c23cb7ef95615832e502" category="paragraph">Oracleバイナリには、rootが所有するsetuidビットを使用するファイルが含まれます。OracleバイナリがNFS共有にインストールされている場合は、エクスポートポリシーに適切なsuperuser権限とsetuid権限が含まれている必要があります。次の例では、ルールに<block ref="1efaeada4e3307369aca511f5da0498a" prefix=" " category="inline-code"></block> 許可します<block ref="0baea2f0ae20150db78f58cddac442a9" prefix=" " category="inline-code"></block> （root）システム認証を使用したNFSクライアントのアクセス。</block>
  <block id="f1a0fa258c785ac546835a1a75017faf" category="section-title">NFSv4 / 4.1構成</block>
  <block id="52f9ad2e353a42e61d9bf7dd9f59d0cb" category="paragraph">ほとんどのアプリケーションで、NFSv3とNFSv4の違いはほとんどありません。通常、アプリケーションI/Oは非常に単純なI/Oであり、NFSv4の高度な機能の一部からあまりメリットが得られません。上位バージョンのNFSは、データベースストレージから見ると「アップグレード」ではなく、機能を追加したNFSのバージョンとみなすべきです。たとえば、Kerberosプライバシーモード（krb5p）のエンドツーエンドのセキュリティが必要な場合は、NFSv4が必要です。</block>
  <block id="5cee42a6ee353ec8d6538898f8e63d2d" category="inline-link">TR-4067『NFS on NetApp ONTAP』のベストプラクティス</block>
  <block id="1ca271e9db310f8a7fb925b114fd6811" category="paragraph">NFSv4への切り替えは、マウントオプションを単にvers=3からvers=4.1に変更するよりも複雑です。ONTAPを使用したNFSv4設定の詳細（OSの設定に関するガイダンスなど）については、を参照してください。<block ref="2d2395ce3ab8a9852abebca9822b9553" category="inline-link-rx"></block>。このTRの以降のセクションでは、NFSv4を使用するための基本的な要件の一部について説明します。</block>
  <block id="a1dc4350330c061ae52050f5a3400e25" category="section-title">NFSv4ドメイン</block>
  <block id="c30669603c950b31f6093d8beaf8060a" category="paragraph">NFSv4 / 4.1の設定について詳しくは本ドキュメントでは説明していませんが、よく発生する問題の1つとして、ドメインマッピングの不一致があります。sysadminから見ると、NFSファイルシステムは正常に動作しているように見えますが、アプリケーションからは特定のファイルに対する権限やsetuidに関するエラーが報告されます。場合によっては、管理者は、アプリケーションバイナリのアクセス許可が破損していると誤って判断し、実際の問題がドメイン名であったときにchownまたはchmodコマンドを実行しました。</block>
  <block id="f0c6c8a632eeaa954640907ee1da277d" category="paragraph">ONTAP SVMでNFSv4ドメイン名が設定されます。</block>
  <block id="97a98ebe6ac1f4a8eaf69158419dd818" category="paragraph">ホストのNFSv4ドメイン名は、<block ref="60969252b5b8391a3378335ae420d2e8" prefix=" " category="inline-code"></block></block>
  <block id="4ade50e8135e817e75aa3086851eaaa8" category="paragraph">ドメイン名が一致している必要があります。マッピングされていない場合は、次のようなマッピングエラーがに表示されます。<block ref="452905a167cf4509fd08acb964fdb20c" prefix=" " category="inline-code"></block>：</block>
  <block id="c0eb73bb35a4c58d87b330cd00f1986a" category="paragraph">アプリケーションバイナリ（Oracleデータベースバイナリなど）には、rootが所有するsetuidビットのファイルが含まれています。つまり、NFSv4ドメイン名が一致していないとOracleの起動に失敗し、という名前のファイルの所有権または権限に関する警告が表示されます。<block ref="dd440398b298ff16eb1188ba8afca6df" prefix=" " category="inline-code"></block>をクリックします。<block ref="002f94d606ac06f290f33a5fcc67b264" prefix=" " category="inline-code"></block> ディレクトリ。次のように表示されます。</block>
  <block id="21cc6f8790de2a7022b344914915604e" category="paragraph">所有権がnobodyのファイルが表示される場合は、NFSv4ドメインのマッピングに問題がある可能性があります。</block>
  <block id="203f1cdb2421d34e9eb7391e03ffcaf6" category="paragraph">これを修正するには、<block ref="60969252b5b8391a3378335ae420d2e8" prefix=" " category="inline-code"></block> ファイルをONTAPのv4-id-domain設定に対して作成し、整合性を確保します。設定されていない場合は、必要な変更を行い、<block ref="1c7ebfbcaa2681599e41320ed491ca91" prefix=" " category="inline-code"></block>をクリックし、変更が反映されるまでしばらく待ちます。これで、ファイル所有権がrootとして正しく認識されます。ユーザがを実行しようとした場合<block ref="05f0da969f2e0e6ecf3ab445e1e665ad" prefix=" " category="inline-code"></block> NFSドメインの設定が修正される前に、このファイルで次のコマンドを実行する必要があります。<block ref="05f0da969f2e0e6ecf3ab445e1e665ad" prefix=" " category="inline-code"></block> をもう一度クリックします</block>
  <block id="51fb8677d45bb006235a9f8cbe477f6f" category="summary">NFS属性のキャッシュデータベース</block>
  <block id="4da0a3b9c2e8fc0df8844a41ac133401" category="doc">データベースでのNFSキャッシュ</block>
  <block id="748f6387bf49161b9a69b7bfd691dcd2" category="paragraph">次のマウントオプションが存在すると、ホストのキャッシュが無効になります。</block>
  <block id="9f75df502ef11eaef4292c94110cb673" category="paragraph">これらの設定は、ソフトウェアのインストール、パッチ適用、およびバックアップ/リストアの処理速度に重大な悪影響を及ぼす可能性があります。場合によっては、特にクラスタ化されたアプリケーションでは、クラスタ内のすべてのノードにキャッシュの一貫性を提供する必要があるため、これらのオプションが必然的に必要になることがあります。それ以外の場合、顧客はこれらのパラメータを誤って使用し、結果は不要な性能の損傷です。</block>
  <block id="8d23519d53d6611bc42fef8dc4a432df" category="paragraph">多くのお客様は、アプリケーションバイナリのインストール時やパッチ適用時に、これらのマウントオプションを一時的に削除しています。インストールまたはパッチ適用プロセス中にターゲットディレクトリを他のプロセスがアクティブに使用していないことをユーザーが確認した場合は、この削除を安全に実行できます。</block>
  <block id="f73bede4039d47664f70de3c2d1f2b46" category="summary">Oracleデータベース用のLVMストライプ構成</block>
  <block id="7844f2cc495a938f3039da5801958506" category="doc">OracleデータベースでのLVMストライピング</block>
  <block id="1b5681ffc153e25d2a48ae3f3f01b9f5" category="paragraph">LVMストライピングとは、複数のLUNにデータを分散することです。その結果、多くのデータベースのパフォーマンスが大幅に向上します。</block>
  <block id="358b9a846de3e04b423c68bac9bc6d53" category="summary">OracleデータベースとのLUNのアライメント</block>
  <block id="c4cb2c6af5d7b6c38cd7e588d846e8b4" category="doc">Oracle I/OのLUNアライメント</block>
  <block id="3e00e4d28b17eedd6f6c2c38233e06a8" category="paragraph">LUNアライメントとは、基盤となるファイルシステムのレイアウトに合わせてI/Oを最適化することです。</block>
  <block id="a6c7e85d51ae3b98197ceb3eafa3686a" category="inline-link-macro">効率性</block>
  <block id="6e2524d5663b2bdc0c7985fa3e57cc55" category="section-title">ミスアライメントノケイコク</block>
  <block id="79e721357e358d77c4700c25c863fc37" category="inline-link">ONTAP SAN ホスト構成</block>
  <block id="268b1da3f1ff11d32e385d0223101718" category="paragraph">Solaris環境ではアライメントがより複雑になります。を参照してください<block ref="2d33e0364c07dc165b4079892340d4fe" category="inline-link-rx"></block> を参照してください。</block>
  <block id="6d017248f1e4f0ec7e2cd19d967b6bee" category="cell">Solaris x86環境では、ほとんどの構成に複数のパーティションレイヤがあるため、適切なアライメントにさらに注意してください。Solaris x86パーティションスライスは通常、標準のマスターブートレコードパーティションテーブルの上に存在します。</block>
  <block id="b1230060a0220caf9d68d64b9dd85e6f" category="summary">Oracleを使用したNFS転送サイズ</block>
  <block id="fabe34ed4a5e432f4d1c4f6584956d8d" category="doc">OracleデータベースでのNFS転送サイズ</block>
  <block id="1e207db9a7c8127a6c43c771b89254fb" category="paragraph">ONTAPでは、デフォルトでNFS I/Oサイズが64Kに制限されています。</block>
  <block id="72d22e3b9af95e272859e64eb1d82df7" category="paragraph">ほとんどのアプリケーションとデータベースでランダムI/Oを実行すると、ブロックサイズがはるかに小さくなり、最大64Kよりもはるかに小さくなります。ラージブロックI/Oは通常並列処理されるため、最大64Kも最大帯域幅の確保に制限されるわけではありません。</block>
  <block id="ebf61afddb34d070825eb696bea48813" category="paragraph">一部のワークロードでは、最大64Kに制限があります。特に、バックアップ/リカバリ処理やデータベースのフルテーブルスキャンなどのシングルスレッド処理は、実行回数が少なくても大容量のI/Oを実行できるのであれば、より高速かつ効率的に実行できます。ONTAPに最適なI/O処理サイズは256Kです。</block>
  <block id="b0a5b394f3a29e64573049cda19fbacc" category="paragraph">特定のONTAP SVMの最大転送サイズは、次のように変更できます。</block>
  <block id="b070b82d66be7116d5fd6dfd8172351b" category="cell">ONTAPで許容される最大転送サイズを、現在マウントされているNFSファイルシステムのrsize/wsizeの値より小さくしないでください。これにより、一部のオペレーティングシステムでハングしたり、データが破損したりする可能性があります。たとえば、NFSクライアントのrsize / wsizeが65536に設定されている場合は、クライアント自体が制限されているため、ONTAPの最大転送サイズを65536~1048576の間で調整しても効果はありません。最大転送サイズを65536未満に縮小すると、可用性やデータが損傷する可能性があります。</block>
  <block id="a5c97d9c3645b9a26e3febeb4bc95e24" category="summary">ONTAPを使用したASM再生ユーティリティ</block>
  <block id="861a5ecc95a8478c750be41bf2ddd6f5" category="doc">ASM再利用ユーティリティとゼロブロック検出</block>
  <block id="8eb703f2756cafd21dbac4f23c0d6416" category="paragraph">インライン圧縮が有効な場合、ONTAPはファイルまたはLUNに書き込まれた初期化済みブロックを効率的に削除します。Oracle ASM Reclamation Utility（ASRU）などのユーティリティは、未使用のASMエクステントにゼロを書き込むことで機能します。</block>
  <block id="1f65360ea8eb578d0ace3d58c460f3dc" category="paragraph">これにより、ファイルが削除されたあとにDBAがストレージアレイのスペースを再生できるようになります。ONTAPはゼロをインターセプトし、LUNからスペースの割り当てを解除します。ストレージシステム内にデータが書き込まれていないため、再生プロセスは非常に高速です。</block>
  <block id="9de53c14f2bae0c5d4b6e19be495ee94" category="paragraph">データベースに関しては、ASMディスクグループには0が含まれているため、LUNのこれらの領域を読み取ると0のストリームが生成されますが、ONTAPはドライブに0を格納しません。代わりに、メタデータが単純に変更され、LUNの初期化された領域がデータの空として内部的にマークされます。</block>
  <block id="06348c6e795160187e298a91b25a37a3" category="paragraph">同様の理由から、ゼロのブロックは実際にはストレージアレイ内で書き込みとして処理されないため、初期化されたデータを使用したパフォーマンステストは無効です。</block>
  <block id="cee584f1e6223f6dbb73c0d64d599228" category="admonition">ASRUを使用する場合は、Oracleが推奨するすべてのパッチがインストールされていることを確認してください。</block>
  <block id="17ff263bc6eb701aecb8e79f9ef53efd" category="summary">Oracleデータベースを含むLUNおよびLVMのサイズ変更</block>
  <block id="e0327f97ac271a738dd1ac6b182a4369" category="doc">LUNのサイズ変更とLVMベースのサイズ変更</block>
  <block id="ff15e8b125dae74c1231f09380e48886" category="paragraph">SANベースのファイルシステムが容量の上限に達した場合は、次の2つの方法で使用可能なスペースを増やすことができます。</block>
  <block id="827be6b2fb8e678a5bd56af225ba21d1" category="list-text">LUNのサイズを拡張します。</block>
  <block id="1948e4ed4d6efa0efb6adb5ab56bfcb2" category="list-text">既存のボリュームグループにLUNを追加し、それに含まれる論理ボリュームを拡張します。</block>
  <block id="4182200437c090276a01ad8ca54076b0" category="summary">Oracleデータベースを保護するためのNVFAILの設定</block>
  <block id="60e002164f8988e984cf4a95b240f19d" category="doc">OracleとNVFAIL</block>
  <block id="370bdf5dd39278264774ea595054e243" category="paragraph">NVFailは、重大なフェイルオーバーシナリオの際に整合性を確保するONTAPの機能です。</block>
  <block id="80250c1f1d70fc693877be6f22cc134e" category="paragraph">データベースは大規模な内部キャッシュを保持するため、ストレージフェイルオーバー時に破損の影響を受けやすくなります。構成全体の健全性に関係なく、重大なイベントによってONTAPフェイルオーバーの強制またはMetroClusterスイッチオーバーの強制が必要になった場合は、以前に確認された変更が実質的に破棄されることがあります。ストレージアレイの内容が時間を遡るようになり、データベースキャッシュの状態がディスク上のデータの状態を反映しなくなります。この不整合により、データが破損します。</block>
  <block id="68114defc717054e7e3b02df438cdbe1" category="paragraph">キャッシュはアプリケーションレイヤまたはサーバレイヤで実行できます。たとえば、プライマリサイトとリモートサイトの両方でアクティブなサーバを使用するOracle Real Application Cluster（RAC）構成では、Oracle SGA内のデータがキャッシュされます。強制スイッチオーバー処理によってデータが失われると、SGAに格納されているブロックがディスク上のブロックと一致しない可能性があるため、データベースが破損するリスクがあります。</block>
  <block id="162de6d405c04ce8f152f1d246ed9187" category="paragraph">キャッシュの使用は、OSファイルシステムレイヤではあまり明白ではありません。マウントされたNFSファイルシステムのブロックは、OSにキャッシュされる場合があります。または、プライマリサイトにあるLUNに基づくクラスタ化されたファイルシステムをリモートサイトのサーバにマウントして、データをキャッシュすることもできます。このような状況でNVRAMの障害、強制テイクオーバー、強制スイッチオーバーが発生すると、ファイルシステムが破損する可能性があります。</block>
  <block id="04ca8d9ad570a3bdf1d76e23bc108ae5" category="paragraph">ONTAPは、NVFAILとその関連設定を使用して、このシナリオからデータベースとオペレーティングシステムを保護します。</block>
  <block id="45293b650c7dacd88d269bebf219b8ef" category="summary">ONTAPでSnapshotコピーからのOracleデータベースの高速リカバリは、NetApp SnapRestoreテクノロジによって実現されます。</block>
  <block id="82ef718f4ebe0c276814ee3d51e33361" category="doc">SnapRestore</block>
  <block id="863696626734d6591db8be57b41c7eec" category="paragraph">NetApp SnapRestoreテクノロジは、SnapshotからのONTAPでのデータの高速リストアを実現します。</block>
  <block id="9099b669f87419bc03914f11f5779c60" category="paragraph">重要なデータセットが使用できないと、重要なビジネス処理が停止します。テープが破損する可能性があり、ディスク・ベースのバックアップからリストアする場合でも、ネットワーク上での転送に時間がかかることがあります。SnapRestoreでは、データセットをほぼ瞬時にリストアできるため、このような問題を回避できます。ペタバイト規模のデータベースでも、わずか数分で完全にリストアできます。</block>
  <block id="b02fb7dec22d0e276ca01cc60b9efb48" category="paragraph">SnapRestoreには、ファイル/ LUNベースとボリュームベースの2つの形式があります。</block>
  <block id="520e4b70b10aa2755a82b77e438a510f" category="list-text">個 々 のファイルやLUNは、2TBのLUNでも4KBのファイルでも、数秒でリストアできます。</block>
  <block id="45e8a84fe4ac58c8b30a7bdaf17c0b7f" category="list-text">ファイルやLUNのコンテナは、10GBでも100TBのデータでも、数秒でリストアできます。</block>
  <block id="4be4677be8cd434956b9b9af515b971a" category="paragraph">「ファイルまたはLUNのコンテナ」とは、通常はFlexVolボリュームを指します。たとえば、1つのボリューム内に1つのLVMディスクグループを構成する10個のLUNを配置したり、1つのボリュームに1、000ユーザのNFSホームディレクトリを格納したりできます。個 々 のファイルまたはLUNに対してリストア処理を実行する代わりに、ボリューム全体を単一の処理としてリストアできます。このプロセスは、FlexGroupやONTAP整合グループなど、複数のボリュームを含むスケールアウトコンテナとも連携します。</block>
  <block id="a8d6a4d1b7fc6e1f60bb0ab716b4e72f" category="paragraph">SnapRestoreがこれほど迅速かつ効率的に機能するのは、Snapshotコピーの性質によるものです。Snapshotコピーは、本質的には、特定の時点におけるボリュームの内容を読み取り専用で並行して表示する機能です。アクティブブロックは変更可能な実際のブロックですが、Snapshotは、Snapshot作成時のファイルおよびLUNを構成するブロックの状態を読み取り専用で表示します。</block>
  <block id="55abea92d64d6738f9e0ed48799696e7" category="paragraph">ONTAPでは、スナップショットデータへの読み取り専用アクセスのみが許可されますが、SnapRestoreを使用してデータを再アクティブ化できます。スナップショットはデータの読み取り/書き込みビューとして再度有効になり、データは以前の状態に戻ります。SnapRestoreは、ボリュームレベルまたはファイルレベルで動作できます。この技術は基本的に同じで、動作に若干の違いがあります。</block>
  <block id="f10f2af75e2770a8ed3c2fde594e986d" category="section-title">ボリュームSnapRestore</block>
  <block id="ca9846346bc3b03cdec10f9fff456866" category="paragraph">ボリュームベースのSnapRestoreは、データのボリューム全体を以前の状態に戻します。この処理ではデータの移動は必要ありません。つまり、API処理やCLI処理の処理には数秒かかることがありますが、リストアプロセスは基本的に瞬時に完了します。1GBのデータをリストアするのは、1PBのデータをリストアするのと同じくらい複雑で時間のかかる作業ではありません。この機能は、多くの企業のお客様がONTAPストレージシステムに移行する主な理由です。大規模なデータセットでも数秒でRTOを達成できます。</block>
  <block id="627436e77bb011a6a312ae87b12f98ea" category="paragraph">ボリュームベースSnapRestoreの欠点の1つは、ボリューム内の変更が時間の経過とともに累積されることが原因です。したがって、各Snapshotとアクティブなファイルデータは、その時点までの変更に依存します。ボリュームを以前の状態にリバートすると、データに対する以降の変更がすべて破棄されます。ただし、これには以降に作成されたスナップショットが含まれることはあまり明白ではありません。これは必ずしも望ましいとは限りません。</block>
  <block id="5c956f2c1cfc5b9e5bac32ad1acba314" category="paragraph">たとえば、データ保持のSLAで夜間バックアップを30日間指定するとします。ボリュームSnapRestoreを使用して5日前に作成されたSnapshotにデータセットをリストアすると、過去5日間に作成されたSnapshotがすべて破棄され、SLAに違反します。</block>
  <block id="8bf9e697004f47ed6133aef724a8a42c" category="paragraph">この制限に対処するために、いくつかのオプションが用意されています。</block>
  <block id="ad3b75456e625de5fe347fb918f59a22" category="list-text">ボリューム全体のSnapRestoreを実行するのではなく、以前のSnapshotからデータをコピーできます。この方法は、データセットが小さい場合に最も適しています。</block>
  <block id="90541eb74c7c56cadc2f90ec6fb6f0c0" category="list-text">Snapshotはリストアではなくクローニングできます。このアプローチの制限事項は、ソーススナップショットがクローンの依存関係であることです。したがって、クローンも削除されるか、独立したボリュームにスプリットされないかぎり、削除することはできません。</block>
  <block id="ab6045d3463c0f68ce2fa405dce9d554" category="list-text">ファイルベースのSnapRestoreの使用。</block>
  <block id="7f7599a8b92846b691484dc91e090164" category="section-title">File SnapRestore</block>
  <block id="f03eebe4f07d362dbfe4c1d4e76c724d" category="paragraph">ファイルベースのSnapRestoreは、Snapshotベースのより詳細なリストアプロセスです。ボリューム全体の状態をリバートする代わりに、個 々 のファイルまたはLUNの状態がリバートされます。スナップショットを削除する必要はありません。また、この操作によって以前のスナップショットへの依存関係が作成されることもありません。ファイルまたはLUNがアクティブボリュームですぐに使用可能になります。</block>
  <block id="e432fdcc277fc74a1b2b94cfeec8a7d2" category="paragraph">ファイルまたはLUNのSnapRestoreリストア中にデータを移動する必要はありません。ただし、ファイルまたはLUNの基盤となるブロックがSnapshotとアクティブボリュームの両方に存在するようになったことを反映するには、一部の内部メタデータの更新が必要になります。パフォーマンスへの影響はありませんが、この処理が完了するまでSnapshotの作成はブロックされます。処理速度は約5GBps（18TB/時）です。これは、リストアするファイルの合計サイズに基づきます。</block>
  <block id="a68b31b502bf7555cda2514354e553c2" category="summary">ONTAPのデータ保護戦略</block>
  <block id="6bb9a5aec98309d1414b32f7e0751415" category="doc">データ保護計画</block>
  <block id="45c46768a1cb073f0d13245a0dc816f2" category="paragraph">適切なエンタープライズデータ保護アーキテクチャは、さまざまなイベントにおけるデータの保持、リカバリ性、耐障害性に関するビジネス要件に依存します。</block>
  <block id="46e1b2893bdb002c0ede448cbfe1cb14" category="paragraph">たとえば、対象となるアプリケーション、データベース、重要なデータセットの数を考えてみましょう。管理するオブジェクトが少ないため、一般的なSLAへの準拠を保証する単一データセットのバックアップ戦略の構築は非常に簡単です。データセットの数が増えるにつれて監視が複雑になり、バックアップの失敗に対処するために、管理者がますます多くの時間を費やすことになる可能性があります。環境がクラウドに到達し、サービスプロバイダが拡張するにつれて、まったく異なるアプローチが必要になります。</block>
  <block id="b70d233428e03d072b1134a97d853ab2" category="paragraph">データセットのサイズも戦略に影響します。たとえば、データセットが非常に小さいため、100GBのデータベースのバックアップとリカバリには多くのオプションがあります。従来のツールを使用してバックアップメディアからデータをコピーするだけで、リカバリに十分なRTOが得られます。通常、100TBのデータベースでは、RTOによって複数日の停止が許容される場合を除き、まったく異なる戦略が必要になります。その場合は、従来のコピーベースのバックアップおよびリカバリの手順で十分かもしれません。</block>
  <block id="64848fee9c168231f5d0f13322ed0a87" category="paragraph">最後に、バックアップとリカバリのプロセス自体以外にもさまざまな要因があります。たとえば、重要な本番環境のアクティビティをサポートしているデータベースがあり、熟練したDBAだけがリカバリを実行するまれなイベントになっているとしますか。あるいは、データベースは、リカバリが頻繁に発生し、ジェネラリストのITチームが管理する大規模な開発環境に含まれていますか。</block>
  <block id="e26b57887de9a65c0316a87d49bf6c44" category="section-title">Snapshotはバックアップですか？</block>
  <block id="c3fd105ab426caff0a0ade2e93476543" category="paragraph">データ保護戦略としてSnapshotを使用することに対する一般的な反対意見の1つは、「実際の」データとSnapshotデータが同じドライブに配置されていることです。これらのドライブが失われると、プライマリデータとバックアップの両方が失われます。</block>
  <block id="12d1adb01d24027626b2a47660fb5b81" category="paragraph">これは有効な問題です。ローカルSnapshotは、日 々 のバックアップとリカバリのニーズに使用され、その点でSnapshotはバックアップです。NetApp環境のすべてのリカバリシナリオの99%近くが、最も厳しいRTO要件を満たすためにSnapshotを使用しています。</block>
  <block id="fc34c9966c8ecb7307468637d9e79933" category="paragraph">ただし、ローカルSnapshotが唯一のバックアップ戦略であるべきではありません。そのため、NetAppでは、SnapMirrorレプリケーションなどのテクノロジを使用して、独立したドライブセットにSnapshotを迅速かつ効率的にレプリケートできます。スナップショットとスナップショットレプリケーションを使用して適切に設計された解決策では、テープの使用を最小限に抑えて四半期ごとのアーカイブを作成することも、完全に排除することもできます。</block>
  <block id="1ea948130a9dbbc02e3a80648a99ff57" category="section-title">整合グループのバックアップ</block>
  <block id="9b234a126e57777ab83807827d4e7078" category="paragraph">整合グループのバックアップでは、データセット（または複数のデータセット）の状態を単一のアトミックポイントインタイムでキャプチャします。データベースの例では、データファイル、ログファイル、データベースに直接関連付けられているその他のファイルなど、すべてのデータベースコンポーネントが含まれます。Oracle RDBMS、Microsoft SQL Server、SAP HANA、PostgreSQL、 MySQL、MariaDBなどがあります。整合グループのバックアップを使用してVMware構成を保護する場合は、すべてのデータストアとESXブートLUNを1つのアトミックポイントインタイムでキャプチャすることになります。</block>
  <block id="5a1f7038c74e54c08669efa6722f1091" category="paragraph">このような整合性グループSnapshotの作成は、基本的にはクラッシュをシミュレートしたものです。そのため、このようなバックアップは、crash-consistentバックアップと呼ばれることがよくあります。リカバリシナリオのサポートに懸念が生じることがありますが、通常はリカバリ手順は不要であることを理解しておくことが重要です。整合グループのバックアップをリストアしたあとにアプリケーションを起動すると、通常のログリカバリプロセス、ファイルシステムジャーナルの再生、およびその他のタスクが実行され、バックアップ時点で転送中だったI/Oが再生されます。その後、アプリケーションは通常どおり起動します。</block>
  <block id="aebdbddec25f7eba6434244a989fb659" category="paragraph">基本的に、データの破損なしに電源障害やサーバクラッシュに耐えることができるアプリケーションは、この方法で保護できます。この機能は、さまざまなベンダーの同期および非同期ミラーリング製品で保護されている膨大な数のアプリケーションによっても実証できます。プライマリサイトで突然災害が発生した場合、レプリカサイトには、災害が発生した時点の元の環境の整合性のあるイメージが格納されます。繰り返しになりますが、特別なリカバリ手順は必要ありません。</block>
  <block id="e085ffefd89f8fb66260a9720e3fb6f8" category="paragraph">通常、このアプローチのRPOはバックアップの時点までに制限されます。原則として、単一ボリュームのSnapshotの最小RPOは1時間です。たとえば、時間単位のSnapshotを48個に加えて、夜間Snapshotを30日間追加するのが妥当であり、大量のSnapshotを保持する必要はありません。RPOを1時間未満に抑えることは難しくなります。環境、拡張性、データ保護の要件を理解するために、まずNetAppプロフェッショナルサービスに相談しないと、この目標を達成することはできません。</block>
  <block id="1fe119a790b393b7dd7e79b63f15f52b" category="paragraph">通常、RTOは数秒で測定できます。アプリケーションがシャットダウンされ、ボリュームがリストアされ、アプリケーションが再起動されます。</block>
  <block id="444cd304758b7607c8f7a3f627a5bc1f" category="paragraph">最も簡単な方法は、すべてのファイルまたはLUNを1つのボリューム整合性グループに配置することです。これにより、ONTAPで直接Snapshotの作成をスケジュールできます。データセットが複数のボリュームにまたがっている必要がある場合は、整合性グループSnapshot（cg-snapshot）が必要です。これは、System ManagerまたはRESTful API呼び出しを使用して設定できます。また、SnapCenterでは、定義済みのボリュームリストに対してシンプルな整合性グループSnapshotを作成できます。</block>
  <block id="689b0155b42a554594a44cddc736eb67" category="section-title">レプリケーションとディザスタリカバリのアーキテクチャ</block>
  <block id="1749d12df3df2319d3eee218a277ff83" category="inline-link-macro">MetroCluster</block>
  <block id="7b8111b0a2fc76252bbacbbc9de542a4" category="inline-link-macro">SnapMirror によるビジネス継続性</block>
  <block id="96a7c86d5bc52a478876c48dc6dcc9f0" category="paragraph">ここでは、セキュアなオフサイトストレージとディザスタリカバリを目的として、データをリモートサイトにレプリケートするリモートデータ保護について説明します。これらのテーブルは、同期ミラーリングのデータ保護には対応していません。この要件については、次のNetApp MetroClusterのドキュメントを参照してください。 <block ref="5c964f26ec7fbbad5ac67aaa5dcf9269" category="inline-link-macro-rx"></block> および <block ref="30831ec866621e18e7521d6c2750acaa" category="inline-link-macro-rx"></block></block>
  <block id="f443592081a2b3ddc55b94abe49ba128" category="paragraph">DRのRPOは、使用可能なネットワーク帯域幅と保護対象のデータの合計サイズによって制限されます。初回のベースライン転送の作成後は、変更されたデータのみに基づいて更新が行われます。これは通常、例外もありますが、総データ容量に占める割合は低くなります。</block>
  <block id="89e87a831dae60244ba34496d70fd45d" category="paragraph">たとえば、週単位の変更率が10%の10TBデータベースでは、1時間あたりの合計変更量は約6GBです。10Gbの接続では、このデータベースの転送に約6分かかります。変更率はデータベースの変更率の変動に応じて変化しますが、全体的には更新間隔が15分であるため、RPOが15分になるはずです。このようなデータベースが100個ある場合、データの転送に600分かかります。したがって、RPOを1時間にすることはできません。同様に、100TBの単一データベースのレプリカのサイズが週に10%の変更率であれば、1時間で確実に更新することはできません。</block>
  <block id="3c886a803aef21f5ac9f7bcea7408cbb" category="paragraph">レプリケーションのオーバーヘッドや同時レプリケーション処理数の制限など、レプリケーションに影響するその他の要因があります。ただし、単一ボリュームのレプリケーション戦略の全体的な計画は、使用可能な帯域幅に基づいて行うことができ、通常はレプリケーションのRPOを1時間にすることができます。RPOが1時間未満になると達成が難しくなるため、NetAppプロフェッショナルサービスに相談してから実行する必要があります。場合によっては、サイト間のネットワーク接続が非常に良好であれば15分で十分です。ただし、全体的に1時間未満のRPOが必要な場合は、マルチボリュームのログ再生アーキテクチャが適しています。</block>
  <block id="5e2cbdd214e7a73bca1af8ed5cc04626" category="paragraph">ディザスタリカバリシナリオにおける整合グループレプリケーションを使用したRTOは非常に優れており、ストレージの観点から見れば、通常は数秒で測定されます。最も簡単な方法は、単にミラーを解除することであり、データベースを起動する準備ができています。通常、データベースの起動時間は約10秒ですが、大量のトランザクションがログに記録された非常に大規模なデータベースには数分かかることがあります。</block>
  <block id="1c18c939e73ddb1ceee34e8a33079d1a" category="paragraph">RTOを決定するうえで最も重要な要素は、ストレージシステムではなく、ストレージシステムを実行するアプリケーションとホストオペレーティングシステムです。たとえば、レプリケートされたデータを1秒または2秒で使用できるようにすることができますが、これはデータのみを表します。また、データを使用できるアプリケーションバイナリを備えた、適切に構成されたオペレーティングシステムも必要です。</block>
  <block id="6fab898feea25b9d7fd4477911b90b31" category="paragraph">場合によっては、オペレーティングシステムで事前に検出されたストレージを使用して、ディザスタリカバリのインスタンスを事前に準備していることもあります。このような場合、ディザスタリカバリシナリオをアクティブ化するには、ミラーを解除してアプリケーションを起動するだけです。また、OSと関連するアプリケーションをデータベースとともにESX Virtual Machine Disk（VMDK；仮想マシンディスク）としてミラーリングする場合もあります。このような場合のRPOは、お客様がVMDKを迅速にブートしてアプリケーションを起動できるように自動化にどれだけ投資したかによって決まります。</block>
  <block id="c7d5d755b896edf43189fbb020202913" category="paragraph">保持期間の一部はSnapshotの制限によって制御されます。たとえば、ONTAPのボリュームには、Snapshotの数が1024個に制限されています。場合によっては、レプリケーションを多重化して制限を引き上げていることもあります。たとえば、2000日分のバックアップが必要な場合、ソースを2つのボリュームにレプリケートし、別の日に更新を実行できます。そのためには、必要な初期スペースを増やす必要がありますが、フルバックアップを複数回実行する従来のバックアップシステムよりもはるかに効率的なアプローチです。</block>
  <block id="7ec0f114b69016879106b5018cdf10b9" category="section-title">単一ボリュームの整合グループ</block>
  <block id="cd70f3e596e275fe80fbbe5d7858ce1a" category="paragraph">最も簡単な方法は、すべてのファイルまたはLUNを1つのボリューム整合グループに配置することです。これにより、SnapMirrorおよびSnapVaultの更新をストレージシステム上で直接スケジュールできます。外部ソフトウェアは必要ありません。</block>
  <block id="909e8df57072d0b3c6d7d64b11acb571" category="section-title">マルチボリューム整合グループ</block>
  <block id="c7371eded617935ace6c71a33cfbf3fd" category="paragraph">データベースが複数のボリュームにまたがっている必要がある場合は、整合性グループSnapshot（cg-snapshot）が必要です。前述したように、これはSystem ManagerまたはRESTful API呼び出しを使用して設定できます。また、SnapCenterでは、定義済みのボリュームリストに対してシンプルな整合性グループSnapshotを作成できます。</block>
  <block id="9c991b38c054d7bec0632efd6667540c" category="paragraph">また、ディザスタリカバリを目的としたマルチボリュームの整合性のあるSnapshotの使用についても、もう1つ考慮すべき点があります。複数のボリュームの更新を実行すると、転送の進行中に災害が発生する可能性があります。その結果、一連のボリュームが互いに整合性のない状態になります。この場合は、crash-consistentで使用可能なデータベースイメージを提供するために、一部のボリュームを以前のSnapshot状態にリストアする必要があります。</block>
  <block id="fad8a5f46ebd89f74383b461e32dd6b9" category="section-title">ディザスタリカバリ:アクティブ化</block>
  <block id="5ac319591298468b0af89c2c469201f8" category="paragraph">ディザスタリカバリコピーをアクティブ化するプロセスは、ストレージのタイプによって異なります。NFSでは、ファイルシステムをディザスタリカバリサーバに事前にマウントできます。これらは読み取り専用状態であり、ミラーが解除されると読み取り/書き込みになります。これにより、RPOが非常に低くなり、管理するパーツが少ないため、ディザスタリカバリプロセス全体の信頼性が向上します。</block>
  <block id="b829fc11ff11b57af8d4632d38d7d7e8" category="paragraph">ディザスタリカバリ時にSAN構成をアクティブ化することは、より複雑になります。最も簡単なオプションは、通常、ミラーを一時的に解除してSANリソースをマウントすることです。たとえば、LVM構成（Oracle Automatic Storage Management[ASM]などのアプリケーション固有の機能を含む）を検出したり、/etc/fstabにエントリを追加したりします。</block>
  <block id="335a5796fb106a877544d121062534be" category="paragraph">その結果、LUNデバイスパス、ボリュームグループ名、およびその他のデバイスパスがターゲットサーバに認識されます。その後、これらのリソースをシャットダウンし、その後ミラーをリストアできます。その結果、サーバはアプリケーションを迅速にオンラインにできる状態になります。ボリュームグループのアクティブ化、ファイルシステムのマウント、データベースとアプリケーションの起動の手順は簡単に自動化できます。</block>
  <block id="b1a175c5f42da29f6c27f4ea29684b63" category="paragraph">ディザスタリカバリ環境が最新の状態であることを確認する必要があります。たとえば、新しいLUNがソースサーバに追加されることが多いため、ディザスタリカバリプランが想定どおりに機能するように、デスティネーションで新しいLUNを事前に検出しておく必要があります。</block>
  <block id="90426ba53f908049843b3ea392578d04" category="doc">Oracleのディザスタリカバリ</block>
  <block id="ef09e87f183c8862564ee20992a229af" category="paragraph">NetApp MetroClusterは、ミッションクリティカルなOracleワークロードに可用性とデータ損失ゼロの解決策を提供します。</block>
  <block id="d93c585474124fbc2aec0fe5ed4c204a" category="paragraph">さらに、MetroClusterなどの統合ソリューションにより、今日の複雑なスケールアウト型Oracleデータベース、アプリケーション、仮想化インフラが簡素化されます。MetroClusterは、複数の外部データ保護製品や戦略を、1つのシンプルな中央集中型ストレージアレイに置き換えます。単一のクラスタストレージシステム内で、統合されたバックアップ、リカバリ、ディザスタリカバリ、高可用性（HA）を実現します。</block>
  <block id="7fe779a487e8f113f1ffdff0fb80353f" category="summary">ONTAPノOracleノセイコウセイクルウフハツクアツフ</block>
  <block id="773f9afa3df0cf82ed853c988183c73f" category="doc">Oracle整合グループのバックアップ</block>
  <block id="5afd3dc3f8d489d47587e10e6663c512" category="paragraph">バックアップを最もシンプルにするには、Oracleデータベース全体を1つのボリュームに配置します。</block>
  <block id="2a4fa9d9434561574119e3086112023f" category="paragraph">データファイル、アーカイブログ、REDOログ、および制御ファイルを1つのSnapshotで保護することは、有効なバックアップ、リストア、およびレプリケーション方法です。  ただし、RPOはバックアップ自体のポイントに制限されます。1時間以上のRPOに適しています。データベースが複数のボリュームにまたがっている場合は、前述のいずれかのツールを使用してcg-snapshotsが必要です。</block>
  <block id="93310f4cebc752304c164f00d67e0bca" category="paragraph">たとえば、次のSnapshotスケジュールを使用して、データベース全体を1つのボリュームに含めることができます。</block>
  <block id="a33821be4b3522d65daed1ec317299f6" category="list-text">72時間ごとのスナップショット</block>
  <block id="0eea0679ac7bf43c19d603cd78e81de9" category="list-text">30個の夜間Snapshot</block>
  <block id="c4546c401776d279c5577011584577fa" category="list-text">12の月次スナップショット</block>
  <block id="b63db1b650d128c342617b377baf928a" category="paragraph">これにより、過去72時間の間に1時間のRPOが達成され、さらに夜間および月次バックアップが追加されます。複数のデータベースまたはアプリケーションファイルを1つのボリュームまたはcg-snapshotのセットに含めることもでき、大規模な環境全体で一貫したバックアップを実現できます。</block>
  <block id="5eb532bcede5a8d57b8fb4429d5cc7ec" category="summary">Oracle on ONTAPによる可用性の最大化</block>
  <block id="b4343a8438e1b9cc9e9486f85831f2a1" category="doc">ONTAPによるOracleデータの可用性</block>
  <block id="686540783626106489734a1990d4930d" category="paragraph">ONTAPは、Oracleデータベースの可用性を最大限に高めるように設計されています。概要of ONTAPの高可用性機能は、本ドキュメントでは扱いません。ただし、データ保護と同様に、データベースインフラを設計する際には、この機能の基本的な理解が重要です。</block>
  <block id="b049fcbe8198301adc6bf87634a02845" category="section-title">HA ペア</block>
  <block id="1a7c11d1e2d03d3d1b57cff284ebd761" category="paragraph">ハイアベイラビリティの基本単位はHAペアです。各ペアには、NVRAMへのデータのレプリケーションをサポートするための冗長リンクが含まれています。NVRAMは書き込みキャッシュではありません。コントローラ内部のRAMは書き込みキャッシュとして機能します。NVRAMの目的は、予期しないシステム障害から保護するためにデータを一時的にジャーナルすることです。この点では、データベースのREDOログに似ています。</block>
  <block id="cd2e54027dfcfeddd07ddd580db527c0" category="paragraph">NVRAMとデータベースのRedoログはどちらもデータを迅速に格納するために使用されるため、データに対する変更をできるだけ迅速にコミットできます。ドライブ（データファイル）上の永続的データの更新は、ONTAPとほとんどのデータベースプラットフォームの両方でチェックポイントと呼ばれるプロセスが実行されるまで行われません。通常運用時は、NVRAMデータもデータベースのREDOログも読み取られません。</block>
  <block id="4e044ec0c36e513506c77c0a97d53539" category="paragraph">コントローラで突然障害が発生した場合、ドライブにまだ書き込まれていない保留中の変更がNVRAMに保存されている可能性があります。パートナーコントローラが障害を検出してドライブを制御し、NVRAMに保存されている必要な変更を適用します。</block>
  <block id="310e46747ebab6a43d5a15998f6e2b33" category="section-title">テイクオーバーとギブバック</block>
  <block id="1d739263e44469ad28f77fe7329fa78d" category="paragraph">テイクオーバーとギブバックは、HAペアのノード間でストレージリソースの責任を移すプロセスです。テイクオーバーとギブバックには次の2つの側面があります。</block>
  <block id="f2d43d90397aa8140414437eda14febb" category="list-text">ドライブへのアクセスを許可するネットワーク接続の管理</block>
  <block id="6e1c794c81468e3286a23138460bb3fb" category="list-text">ドライブ自体の管理</block>
  <block id="89d3f6c60c53a11e16a6756bde03ca00" category="paragraph">CIFSおよびNFSトラフィックをサポートするネットワークインターフェイスには、ホームロケーションとフェイルオーバーロケーションの両方が設定されます。テイクオーバーでは、ネットワークインターフェイスを元の場所と同じサブネットにある物理インターフェイス上の一時的なホームに移動します。ギブバックでは、ネットワークインターフェイスを元の場所に戻します。必要に応じて、正確な動作を調整できます。</block>
  <block id="108018656caf59cc565f1172047dab38" category="paragraph">iSCSIやFCなどのSANブロックプロトコルをサポートしているネットワークインターフェイスは、テイクオーバーやギブバックの実行時に再配置されません。代わりに、完全なHAペアを含むパスを使用してLUNをプロビジョニングする必要があります。これにより、プライマリパスとセカンダリパスが作成されます。</block>
  <block id="80795d5dd590e432b4f5945aba47caf4" category="admonition">大規模なクラスタ内のノード間でデータを再配置できるように、追加のコントローラへの追加のパスを設定することもできますが、これはHAプロセスの一部ではありません。</block>
  <block id="aae63904d16fd1c522dc5ff53eb695b5" category="paragraph">テイクオーバーとギブバックの2つ目の側面は、ディスク所有権の移行です。具体的なプロセスは、テイクオーバー/ギブバックの理由や実行したコマンドラインオプションなど、複数の要因によって異なります。目標は、できるだけ効率的に操作を実行することです。全体的なプロセスには数分かかるように見えるかもしれませんが、ドライブの所有権がノードからノードに移行される実際の瞬間は、通常数秒で測定できます。</block>
  <block id="61775b9e8f759f26eafd6b03448d1f30" category="section-title">テイクオーバー時間</block>
  <block id="3224b51e62790c4ce988d8c1876fb36e" category="paragraph">テイクオーバー処理やギブバック処理の実行中にホストI/Oが短時間中断されますが、正しく設定された環境ではアプリケーションが停止することはありません。I/Oが遅延する実際の移行プロセスは通常数秒で測定されますが、ホストがデータパスの変更を認識してI/O処理を再送信するために、さらに時間がかかる場合があります。</block>
  <block id="40f291752a9848bfecb7264cfd9aa8ee" category="paragraph">中断の内容はプロトコルによって異なります。</block>
  <block id="cb44db7841f8fb68230a260c4c68bfe0" category="list-text">NFSおよびCIFSトラフィックをサポートするネットワークインターフェイスは、新しい物理的な場所への移行後に、ネットワークに対してAddress Resolution Protocol（ARP；アドレス解決プロトコル）要求を発行します。これにより、ネットワークスイッチはメディアアクセス制御（MAC）アドレステーブルを更新し、I/Oの処理を再開します。計画的なテイクオーバーとギブバックの停止は、通常数秒で測定され、多くの場合は検出されません。ネットワークによっては、ネットワークパスの変更を完全に認識するのに時間がかかる場合があります。また、OSによっては、再試行が必要な大量のI/Oが短時間にキューイングされる場合があります。これにより、I/Oの再開に必要な時間が長くなる可能性があります。</block>
  <block id="6a410522094e0b0f874dab5784e81ab8" category="list-text">SANプロトコルをサポートするネットワークインターフェイスが新しい場所に移行されない。ホストOSが使用中のパスを変更する必要があります。ホストで検出されるI/Oの一時停止は、複数の要因によって異なります。ストレージシステムの観点から見ると、I/Oを処理できない時間はわずか数秒です。ただし、ホストOSによっては、I/Oがタイムアウトしてから再試行されるまでにさらに時間がかかる場合があります。新しいOSではパスの変更をより迅速に認識できますが、古いOSでは通常、変更を認識するのに最大30秒かかります。</block>
  <block id="cabc4f9cda7d4bfb99181166c863a374" category="paragraph">次の表に、ストレージシステムがアプリケーション環境にデータを提供できない場合の想定テイクオーバー時間を示します。どのアプリケーション環境にもエラーは発生しません。テイクオーバーはI/O処理の一時停止として表示されます。</block>
  <block id="c8984126713ed072b9cb0a44a162be4d" category="cell">AFF</block>
  <block id="b7b46ce5d1a547db89c0bc615ff272a5" category="cell">ASA</block>
  <block id="ed3467fac861f6a32cd66093ac415805" category="cell">計画的テイクオーバー</block>
  <block id="57a915dfa0e8469b25c1b8b947f7ee2c" category="cell">15秒</block>
  <block id="cd5dce62294e9a79e9c2165ee0903f5f" category="cell">6～10秒</block>
  <block id="cbfdbb11fd5eab0d9fdd078ae66a1c69" category="cell">2～3秒</block>
  <block id="1a066f0304c1d3a279466c70359c5103" category="cell">計画外のテイクオーバー</block>
  <block id="0f4a6e109a34d3483995e427b6581130" category="cell">30秒</block>
  <block id="a4985782267828ce03a3d13f37392de1" category="summary">チェックサムとOracleデータ保護</block>
  <block id="407941abab873f61b271b481e105eb33" category="doc">チェックサムとOracleデータ整合性</block>
  <block id="b93232347a11497969d0ea20d34cd16e" category="paragraph">NetAppによく寄せられる質問の1つは、Oracleデータベースのデータ整合性を保護する方法です。</block>
  <block id="dbfb054670bc82c6e08a7e101c0f0ef4" category="paragraph">ONTAPでの論理データ保護は、次の3つの重要な要件で構成されます。</block>
  <block id="b6cc6762545d78ab663e39c37d172bd2" category="list-text">データを破損から保護する必要があります。</block>
  <block id="e7c7e14f4b6ca1b3ae32b2279243dba6" category="list-text">データはドライブ障害から保護する必要があります。</block>
  <block id="1168469b387027a850496f6cac9f3529" category="list-text">データへの変更は損失から保護する必要があります。</block>
  <block id="864a6ca5da4b36656beba11c90f4c4e5" category="paragraph">この3つのニーズについては、以降のセクションで説明します。</block>
  <block id="a05b54004946aa523bfe7c1e92a52f52" category="section-title">ネットワークの破損:チェックサム</block>
  <block id="ed95581a613a4f19be367c10cd063cc2" category="paragraph">最も基本的なデータ保護レベルはチェックサムです。チェックサムは、データと一緒に格納される特別なエラー検出コードです。ネットワーク転送中のデータの破損は、チェックサムを使用して検出されます。場合によっては、複数のチェックサムを使用します。</block>
  <block id="c1343e51090396cf011509389bc0adab" category="paragraph">たとえば、FCフレームには巡回冗長検査（CRC）と呼ばれるチェックサム形式が含まれており、転送中にペイロードが破損していないことを確認できます。送信機は、データのデータとCRCの両方を送信します。FCフレームの受信側は、受信したデータのCRCを再計算して、送信されたCRCと一致することを確認します。新しく計算されたCRCがフレームに接続されたCRCと一致しない場合、データは破損し、FCフレームは破棄または拒否されます。iSCSI I/O処理には、TCP/IPおよびイーサネットレイヤでのチェックサムが含まれます。また、保護を強化するために、SCSIレイヤでオプションのCRC保護を含めることもできます。ワイヤ上のビットの破損はTCPレイヤまたはIPレイヤによって検出され、パケットが再送信されます。FCと同様に、SCSI CRCでエラーが発生すると、処理が破棄または拒否されます。</block>
  <block id="1f08639c540e47068c16c3ac48ea7bbe" category="section-title">ドライブの破損：チェックサム</block>
  <block id="c5d50bc8d916a4b26166bbda091cd6d4" category="paragraph">チェックサムは、ドライブに格納されているデータの整合性を検証するためにも使用されます。ドライブに書き込まれたデータブロックは、元のデータに関連付けられた予測不可能な数を生成するチェックサム機能で格納されます。ドライブからデータが読み取られると、チェックサムが再計算され、保存されているチェックサムと比較されます。一致しない場合は、データが破損しているため、RAIDレイヤでリカバリする必要があります。</block>
  <block id="8edc44db01815f20f6508db8b5630cfe" category="section-title">データ破損：失われた書き込み</block>
  <block id="972eab86b2aecd693914feabc5a3b65c" category="paragraph">検出するのが最も困難な種類の破損の1つは、書き込みの紛失または置き忘れです。書き込みが確認応答されたら、正しい場所にあるメディアに書き込む必要があります。インプレースデータの破損は、データとともに保存されたシンプルなチェックサムを使用することで、比較的簡単に検出できます。ただし、書き込みが失われただけの場合は、以前のバージョンのデータが残っている可能性があり、チェックサムが正しいことになります。書き込みが間違った物理的な場所に配置された場合、書き込みによって他のデータが破壊されても、関連するチェックサムは保存データに対して再び有効になります。</block>
  <block id="53830741c46fbc560962b086f582e79a" category="paragraph">この課題に対する解決策は次のとおりです。</block>
  <block id="656d064400822ca2ffb25f52c9fc95db" category="list-text">書き込み処理には、書き込みが予想される場所を示すメタデータが含まれている必要があります。</block>
  <block id="37a60b1c7392a26270880a361f85db55" category="list-text">書き込み処理には、何らかのバージョン識別子が含まれている必要があります。</block>
  <block id="4275b2e68761baa23b112833facf4ca1" category="paragraph">ONTAPがブロックを書き込むときは、そのブロックが属する場所のデータも含まれます。後続の読み取りでブロックが識別されていても、メタデータにブロックが456の場所で見つかったときに123の場所に属していることが示されている場合、書き込みは誤って配置されています。</block>
  <block id="009b13bf07c7db21c1e4769526e60694" category="paragraph">完全に失われた書き込みを検出することは、より困難です。説明は非常に複雑ですが、基本的にONTAPは、書き込み処理によってドライブ上の2つの場所が更新されるようにメタデータを格納します。書き込みが失われると、その後のデータおよび関連するメタデータの読み取りで、2つの異なるバージョンIDが表示されます。これは、ドライブによる書き込みが完了しなかったことを示します。</block>
  <block id="3b04a99c209a31ad69e7865ea94e5c94" category="paragraph">書き込みの破損が失われたり置き忘れられたりすることは非常にまれですが、ドライブが増え続け、データセットがエクサバイト規模になると、リスクが増大します。データベースワークロードをサポートするストレージシステムには、Lost Write検出機能を含める必要があります。</block>
  <block id="e978ccc010ec4d37148d52e2fbf439dd" category="section-title">ドライブ障害：RAID、RAID DP、RAID-TEC</block>
  <block id="a9fffaaf2b1b518afb56ef273736c0c2" category="paragraph">ドライブ上のデータブロックが破損していることが検出された場合、またはドライブ全体で障害が発生して完全に使用できなくなった場合は、データを再構成する必要があります。これは、ONTAPでパリティドライブを使用して行われます。データが複数のデータドライブにストライピングされ、パリティデータが生成されます。これは元のデータとは別に保存されます。</block>
  <block id="54abdf00b7122c16619266482eb09f43" category="paragraph">ONTAPは元 々 RAID 4を使用していました。RAID 4は、データドライブのグループごとにパリティドライブを1本使用します。その結果、グループ内のいずれかのドライブで障害が発生してもデータが失われることはありませんでした。パリティドライブで障害が発生してもデータは破損しておらず、新しいパリティドライブを構築できました。1本のデータドライブで障害が発生した場合は、残りのドライブをパリティドライブと一緒に使用して失われたデータを再生成します。</block>
  <block id="6d1ccb512ce2b25e53d90e6d8d459e18" category="paragraph">ドライブが小さい場合、2本のドライブで同時に障害が発生する可能性はほとんどありませんでした。ドライブ容量の増大に伴い、ドライブ障害発生後のデータの再構築に必要な時間も増加しています。これにより、2つ目のドライブ障害が発生してデータが失われる時間が長くなりました。また、再構築プロセスでは、稼働しているドライブに多くのI/Oが追加で作成されます。ドライブが古くなると、負荷が増えて2つ目のドライブ障害が発生するリスクも高まります。最後に、RAID 4を継続して使用することでデータ損失のリスクが増加しなかったとしても、データ損失の影響はより深刻になります。RAIDグループで障害が発生した場合に失われるデータが多いほど、データのリカバリにかかる時間が長くなり、ビジネスの中断が長くなります。</block>
  <block id="caef9e75bcd55d5a9a4ec855b5a6385c" category="paragraph">これらの問題により、NetAppはRAID 6の一種であるNetApp RAID DP技術を開発した。この解決策にはパリティドライブが2本含まれているため、RAIDグループ内の2本のドライブで障害が発生してもデータが失われることはありません。ドライブのサイズは拡大を続けており、その結果、NetAppは3つ目のパリティドライブを導入するNetApp RAID-TECテクノロジを開発しました。</block>
  <block id="704c2697ee323569003b7b7ea203ae0f" category="paragraph">一部の履歴データベースのベストプラクティスでは、ストライプミラーリングとも呼ばれるRAID-10の使用を推奨しています。2本のディスクで障害が発生するシナリオが複数あるのに対し、RAID DPでは何も発生しないため、RAID DPよりもデータ保護が劣ります。</block>
  <block id="3d0147402d7506d1d3a5227fe447427a" category="paragraph">また、パフォーマンス上の懸念から、RAID-4 / 5 / 6よりもRAID-10が推奨されることを示す履歴データベースのベストプラクティスもいくつかあります。これらの推奨事項は、RAIDペナルティを意味する場合があります。これらの推奨事項は一般的に正しいものですが、ONTAP内でのRAIDの実装には適用されません。パフォーマンスの問題はパリティ再生に関連しています。従来のRAID実装では、データベースによって実行されるルーチンのランダムライトを処理するには、パリティデータを再生成して書き込みを完了するために、複数のディスク読み取りが必要です。ペナルティは、書き込み処理の実行に必要な追加の読み取りIOPSとして定義されます。</block>
  <block id="84ff015d2df40fc0ebb34485173f39e4" category="paragraph">書き込みはメモリでステージングされ、パリティが生成されてから単一のRAIDストライプとしてディスクに書き込まれるため、ONTAPではRAIDペナルティは発生しません。書き込み処理を完了するための読み取りは必要ありません。</block>
  <block id="b7fe11ecbd8b434a231195335b4894ac" category="paragraph">要約すると、RAID DPとRAID-TECは、RAID 10と比較して使用可能な容量がはるかに多く、ドライブ障害に対する保護が強化され、パフォーマンスが低下することはありません。</block>
  <block id="e5e0dc0629a299f8e56ebe7de38f49f9" category="section-title">ハードウェア障害からの保護:NVRAM</block>
  <block id="1db5fde40e489d805029f9d5be6375e7" category="paragraph">データベースワークロードを処理するストレージアレイでは、書き込み処理をできるだけ迅速に処理する必要があります。さらに、電源障害などの予期しないイベントから書き込み処理を損失から保護する必要があります。つまり、書き込み処理は少なくとも2つの場所に安全に格納する必要があります。</block>
  <block id="ff540b857af868ec85f8f53ddc1f1bd1" category="paragraph">AFFシステムとFASシステムは、これらの要件を満たすためにNVRAMを利用しています。書き込みプロセスは次のように機能します。</block>
  <block id="049f2df0de743a6be8d3ec69864f234a" category="list-text">インバウンド書き込みデータはRAMに格納されます。</block>
  <block id="976be2293c2f4499d079224003644acf" category="list-text">ディスク上のデータに加えなければならない変更は、ローカルノードとパートナーノードの両方のNVRAMに記録されます。NVRAMは書き込みキャッシュではなく、データベースのRedoログに似たジャーナルです。通常の条件下では、読み取りは行われません。I/O処理中に電源障害が発生した場合など、リカバリにのみ使用されます。</block>
  <block id="8ae87ed4a421bec56e020cd0e83bd748" category="list-text">その後、書き込みがホストに確認応答されます。</block>
  <block id="3a7682bcbb490353074b5ee69e18f01c" category="paragraph">この段階の書き込みプロセスはアプリケーションの観点からは完了しており、データは2つの異なる場所に格納されるため、損失から保護されます。最終的に変更はディスクに書き込まれますが、書き込みが確認されたあとに実行されるためレイテンシに影響しないため、このプロセスはアプリケーションの観点からはアウトオブバンドです。このプロセスもデータベースロギングに似ています。データベースに対する変更はできるだけ早くREDOログに記録され、変更がコミットされたことが確認されます。データファイルの更新はかなり遅れて行われ、処理速度に直接影響することはありません。</block>
  <block id="c17f09622da5f1e0064f7b6a65cb8b01" category="paragraph">コントローラで障害が発生すると、パートナーコントローラが必要なディスクの所有権を取得し、ログに記録されたデータをNVRAMに再生して、障害発生時に転送中だったI/O処理をリカバリします。</block>
  <block id="24e6592d53b3bd56ed8827d2f51bb1ab" category="section-title">ハードウェア障害からの保護：NVFAIL</block>
  <block id="7965eb54acae120d25d0c77b012b8f90" category="paragraph">前述したように、書き込みの確認応答は、少なくとも1台の他のコントローラでローカルのNVRAMとNVRAMに記録されるまで返されません。このアプローチにより、ハードウェア障害や停電が発生しても、転送中のI/Oが失われることはありません。ローカルのNVRAMに障害が発生したり、HAパートナーへの接続に障害が発生したりすると、この実行中のデータはミラーリングされなくなります。</block>
  <block id="307b6d3e63c12ada7fbcf75cdda0b574" category="paragraph">ローカルNVRAMからエラーが報告されると、ノードはシャットダウンします。このシャットダウンにより、HAパートナーコントローラにフェイルオーバーします。障害が発生したコントローラが書き込み処理を確認していないため、データが失われることはありません。</block>
  <block id="6e0c6c8fe69a50581a4ac18acb2c04dd" category="paragraph">データが同期されていない場合、ONTAPは、強制的にフェイルオーバーを実行しない限り、フェイルオーバーを許可しません。この方法で条件を変更すると、元のコントローラにデータが残っている可能性があり、データ損失が許容されることが確認されます。</block>
  <block id="a3961862ed464a06ef6fa4e23935fef2" category="paragraph">データベースはディスク上のデータの大規模な内部キャッシュを保持しているため、フェイルオーバーが強制された場合、データベースが破損する可能性が特に高くなります。強制的なフェイルオーバーが発生した場合、以前に承認された変更は事実上破棄されます。ストレージアレイの内容は実質的に時間を逆方向に移動し、データベースキャッシュの状態はディスク上のデータの状態を反映しなくなります。</block>
  <block id="b46ce3019d702ee3ece327e5df990be0" category="paragraph">この状況からデータを保護するために、ONTAPでは、NVRAMの障害に対する特別な保護をボリュームに設定できます。この保護メカニズムがトリガーされると、ボリュームがNVFAILという状態になります。この状態では、古いデータを使用しないように原因AアプリケーションをシャットダウンするI/Oエラーが発生します。確認済みの書き込みがストレージアレイに存在する必要があるため、データは失われません。</block>
  <block id="322e1f85910dfc206274f8bd58a54a9d" category="list-text">特定のサイトのドライブセットは、ミラーリングを使用することなく、1つ以上の完全に冗長化されたRAID-DPまたはRAID-TECグループとして自動的に構成されます。これにより、サイトが失われても継続的なデータ保護が実現します。</block>
  <block id="dee2dfce5ab0c47301b3c12970a57aa6" category="paragraph">上の図は、SyncMirror構成の例を示しています。24ドライブのアグリゲートをコントローラに作成しました。このアグリゲートは、サイトAで割り当てられたシェルフの12本のドライブと、サイトBで割り当てられたシェルフの12本のドライブで構成されています。ドライブは2つのミラーRAIDグループにグループ化されました。RAIDグループ0には、サイトAの6ドライブプレックスが含まれており、サイトBの6ドライブプレックスにミラーリングされています。同様に、RAIDグループ1にはサイトAの6ドライブプレックスが含まれており、サイトBの6ドライブプレックスにミラーリングされています。</block>
  <block id="4fbc0abe91c0c1381d0a742f58b4e537" category="paragraph">SyncMirrorは通常、MetroClusterシステムにリモートミラーリングを提供するために使用され、各サイトにデータのコピーが1つずつ配置されます。場合によっては、1つのシステムで追加レベルの冗長性を提供するために使用されます。特に、シェルフレベルの冗長性を提供します。ドライブシェルフにはすでにデュアル電源装置とコントローラが搭載されており、全体的には板金をほとんど使用していませんが、場合によっては追加の保護が保証されることがあります。たとえば、あるNetAppのお客様は、自動車テストで使用するモバイルリアルタイム分析プラットフォームにSyncMirrorを導入しています。システムは、独立したUPSシステムからの独立した電源供給によって供給される2つの物理ラックに分割されました。</block>
  <block id="95a3cc99b05998d49d8e035b994815bc" category="paragraph">==チェックサム</block>
  <block id="0cac56685de94a3ef0e1fd2bfca0c112" category="paragraph">チェックサムのトピックは、Oracle RMANのストリーミングバックアップをSnapshotベースのバックアップに移行することに慣れているDBAにとって特に関心があります。RMANの機能の1つは、バックアップ処理中に整合性チェックを実行することです。この機能には何らかの価値がありますが、その最大のメリットは、データベースが最新のストレージアレイで使用されていないことです。Oracleデータベースに物理ドライブが使用されている場合、ドライブの使用年数が経つと最終的にはほぼ確実に破損します。この問題は、真のストレージアレイではアレイベースのチェックサムによって解決されます。</block>
  <block id="58d7088c13cf2013ef373d85e3c27de7" category="paragraph">実際のストレージアレイでは、複数のレベルでチェックサムを使用してデータの整合性が保護されます。IPベースのネットワークでデータが破損した場合、Transmission Control Protocol（TCP）レイヤはパケットデータを拒否し、再送信を要求します。FCプロトコルには、カプセル化されたSCSIデータと同様にチェックサムが含まれます。アレイに配置されたONTAPは、RAIDとチェックサムによる保護を備えています。破損は発生する可能性がありますが、ほとんどのエンタープライズアレイと同様に検出されて修正されます。通常、ドライブ全体に障害が発生してRAIDのリビルドが要求され、データベースの整合性は影響を受けません。ONTAPがチェックサムエラーを検出することもあります。これは、ドライブ上のデータが破損していることを意味します。ドライブが故障し、RAIDのリビルドが開始されます。繰り返しになりますが、データの整合性には影響はありません。</block>
  <block id="8b7b33533c2b36c157a0a482bdd52a8e" category="paragraph">OracleのデータファイルとRedoログのアーキテクチャも、極度の状況下でも可能な限り最高レベルのデータ整合性を提供するように設計されています。最も基本的なレベルでは、Oracleのブロックにはチェックサムが含まれており、ほぼすべてのI/Oについて基本的な論理チェックが実行されます。Oracleがクラッシュしたり表領域がオフラインになったりしていない場合、データはそのまま維持されます。データ整合性チェックの程度は調整可能で、書き込みを確認するようにOracleを設定することもできます。その結果、クラッシュや障害のほぼすべてのシナリオをリカバリでき、非常にまれにリカバリ不能な状況が発生した場合は、破損がすぐに検出されます。</block>
  <block id="4066c36b811913c85aa86346e30cee4d" category="paragraph">Oracleデータベースを使用しているNetAppのお客様のほとんどは'スナップショット・ベースのバックアップに移行すると'RMANなどのバックアップ製品の使用を中止しますRMANを使用してSnapCenterでブロックレベルのリカバリを実行できるオプションはまだあります。ただし、日常的には、RMAN、NetBackup、およびその他の製品は、月次または四半期ごとのアーカイブコピーの作成にのみ使用されます。</block>
  <block id="d0cf0e689669c61d564607d2ef7deb79" category="paragraph">お客様の中には、<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block> 既存のデータベースの整合性チェックを定期的に実行します。NetAppでは、不必要なI/O負荷が発生するため、この方法は推奨されません。前述したように、データベースに以前に問題が発生していなかった場合、<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block> 問題の検出はほぼゼロです。このユーティリティは、ネットワークおよびストレージシステムに非常に高いシーケンシャルI/O負荷を生成します。Oracleの既知のバグにさらされるなど、破損が存在すると信じる理由がないかぎり、<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block>。</block>
  <block id="db97518eeb3e040b5a78c451efd4b252" category="summary">Snapshotで最適化されたバックアップ</block>
  <block id="431bbcf828b8d3513280cb1207824991" category="doc">Oracle Storage Snapshot Optimizedバックアップ</block>
  <block id="52fb042c0d82d8e7bdf9ae239c387729" category="paragraph">Oracle 12cでは、データベースをホットバックアップモードにする必要がないため、Snapshotベースのバックアップとリカバリがさらに簡単になります。そのため、Snapshotベースのバックアップをストレージシステム上で直接スケジュール設定しても、完全なリカバリやポイントインタイムリカバリを引き続き実行できます。</block>
  <block id="c9447fe684870cf68e9cb4f23f44db43" category="paragraph">データベース管理者にとってはホットバックアップリカバリの手順の方がなじみがありますが、データベースがホットバックアップモードのときに作成されなかったSnapshotを使用することは以前から可能でした。Oracle 10gおよび11gでは、データベースの整合性を維持するために、リカバリ時に手動で追加の手順を実行する必要がありました。Oracle 12cでは、<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> および<block ref="075b7d3bd3bbe7767f7ef62f430bc22b" prefix=" " category="inline-code"></block> ホットバックアップモードではないデータファイルバックアップでアーカイブログを再生するための追加ロジックが含まれています。</block>
  <block id="5c7dba68615d3fa5c4c90a36dab57bcb" category="paragraph">前述したように、スナップショットベースのホットバックアップをリカバリするには、次の2セットのデータが必要です。</block>
  <block id="50a7086972cada154c8164dc1c6b3539" category="list-text">バックアップモードで作成されたデータファイルのSnapshot</block>
  <block id="c72d009669a638aab75c21a28a2101de" category="list-text">データファイルがホットバックアップモードのときに生成されたアーカイブログ</block>
  <block id="b8de4b1201e5595bc3de878f2bf59d9b" category="paragraph">リカバリ中、データベースはデータファイルからメタデータを読み取り、リカバリに必要なアーカイブログを選択します。</block>
  <block id="66ee0a6fd90f3cfab8320e1de1341cbd" category="paragraph">ストレージSnapshotを最適化したリカバリでは、同じ結果を達成するために必要なデータセットがわずかに異なります。</block>
  <block id="6030a1d9761fca3806ef0a0329438071" category="list-text">データファイルのSnapshot、およびSnapshotが作成された時刻を識別する方法</block>
  <block id="4e822d4c19600b654f176d335c158829" category="list-text">最新のデータファイルチェックポイントの時刻からSnapshotの正確な時刻までのログをアーカイブします。</block>
  <block id="604432b50055c69f34df17a8ed5befb5" category="paragraph">リカバリ中、データベースはデータファイルからメタデータを読み取り、必要な最も古いアーカイブログを特定します。フルリカバリまたはポイントインタイムリカバリを実行できます。ポイントインタイムリカバリを実行する場合は、データファイルのSnapshotの時刻を把握することが重要です。指定したリカバリポイントは、Snapshotの作成時刻以降である必要があります。NetAppでは、クロックの変動を考慮して、スナップショット時間に少なくとも数分を追加することを推奨しています。</block>
  <block id="08bfe39c49a2dc07b08bd2ccd77d8281" category="paragraph">詳細については、Oracle 12cの各種ドキュメントで「Recovery Using Storage Snapshot Optimization」のトピックを参照してください。また、Oracleサードパーティ製スナップショットのサポートについては、OracleのドキュメントID Doc ID 604683.1を参照してください。</block>
  <block id="d22a890163762fcf7a4cb7605c29b7e6" category="section-title">データレイアウト</block>
  <block id="6a7fc1f74262f6973420f4fc849ba7f7" category="paragraph">最も簡単なレイアウトは、データファイルを1つ以上の専用ボリュームに分離する方法です。これらのファイルは、他のファイルタイプによって汚染されていない必要があります。これは、重要なREDOログ、制御ファイル、またはアーカイブログを削除することなく、SnapRestore処理でデータファイルボリュームを迅速にリストアできるようにするためです。</block>
  <block id="ff6fb5d2136ab516e182f4b23f45886d" category="paragraph">SANでは、専用ボリューム内でのデータファイルの分離についても同様の要件があります。Microsoft Windowsなどのオペレーティングシステムでは、1つのボリュームに複数のデータファイルLUNが含まれ、それぞれにNTFSファイルシステムが配置される場合があります。他のオペレーティング・システムでは'通常'論理ボリューム・マネージャも使用されますたとえば、Oracle ASMでは、ディスクグループを1つのボリュームに限定し、1つのボリュームとしてバックアップおよびリストアできるようにするのが最も簡単なオプションです。パフォーマンスまたは容量管理のために追加のボリュームが必要な場合は、新しいボリュームに追加のディスクグループを作成すると、管理が容易になります。</block>
  <block id="a06956ba6de69aec2dc2b015074e5821" category="paragraph">これらのガイドラインに従うと、整合性グループSnapshotを実行することなく、ONTAPで直接Snapshotをスケジュールできます。これは、Snapshotで最適化されたバックアップでは、データファイルを同時にバックアップする必要がないためです。</block>
  <block id="9e422c12420f1bd8c73e3c0f63da55e9" category="paragraph">ASMディスクグループが複数のボリュームに分散されている場合は、複雑な問題が発生します。このような場合は、cg-snapshotを実行して、すべてのコンスティチュエントボリュームでASMメタデータの整合性を確保する必要があります。</block>
  <block id="7a7969d6a47ed242c25f6a38f2da0e36" category="paragraph">[注] ASM spfileファイルとpasswdファイルが、データファイルをホストしているディスクグループにないことを確認します。これにより、データファイルのみを選択してリストアすることができなくなります。</block>
  <block id="12eb3ceede91a01c74368e0fab03dbe4" category="section-title">ローカルリカバリ手順—NFS</block>
  <block id="e1a03fcc478ae212f07b5044b11ff369" category="paragraph">この手順は、手動で実行することも、SnapCenterなどのアプリケーションを使用して実行することもできます。基本的な手順は次のとおりです。</block>
  <block id="abb0083d6ab87bbe9d906632fea121ae" category="list-text">目的のリストアポイントの直前に、データファイルボリュームをSnapshotにリカバリします。</block>
  <block id="3450fe1e1eea00fa55cfb5cb835a3d80" category="paragraph">この手順では、目的のアーカイブログがアクティブファイルシステムにまだ存在していることを前提としています。サポートされていない場合は、アーカイブログをリストアする必要があります。または、<block ref="075b7d3bd3bbe7767f7ef62f430bc22b" prefix=" " category="inline-code"></block> または<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> のデータに転送できます。<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> ディレクトリ。</block>
  <block id="e43e33171833b26f6b024d28cb8b1afd" category="paragraph">また、小規模なデータベースの場合は、エンドユーザがデータファイルを<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> SnapRestoreコマンドを実行するための自動化ツールやストレージ管理者の支援がないディレクトリ。</block>
  <block id="097230f6ad5345abbe261eabbf533a68" category="section-title">ローカルリカバリ手順—SAN</block>
  <block id="4e3110543ebf2a771c16b3b2101f1f88" category="list-text">データファイルをホストしているディスクグループを休止します。手順は、選択した論理ボリュームマネージャによって異なります。ASMでは、このプロセスでディスクグループをディスマウントする必要があります。Linuxでは、ファイルシステムをディスマウントし、論理ボリュームとボリュームグループを非アクティブ化する必要があります。目的は、リストア対象のターゲットボリュームグループに対するすべての更新を停止することです。</block>
  <block id="1d0ecd206531f96737f8e8002be4a047" category="list-text">目的のリストアポイントの直前に、データファイルディスクグループをSnapshotにリストアします。</block>
  <block id="946fe41f610ab658e270a1844c992bcc" category="list-text">新しくリストアしたディスクグループを再アクティブ化します。</block>
  <block id="c21d8f41541fc2a0259e7ea5e51edac3" category="paragraph">この手順では、目的のアーカイブログがアクティブファイルシステムにまだ存在していることを前提としています。サポートされていない場合は、アーカイブログLUNをオフラインにしてリストアを実行し、アーカイブログをリストアする必要があります。この例では、アーカイブログを専用ボリュームに分割すると便利です。アーカイブログがRedoログとボリュームグループを共有している場合は、記録された最終的なトランザクションが失われないように、LUNセット全体のリストア前にRedoログを別の場所にコピーする必要があります。</block>
  <block id="3fd5b2a08b3d7c4db29da8590ef6013f" category="section-title">フルリカバリの例</block>
  <block id="31679daa394b7091acfd728d940b7322" category="paragraph">データファイルが破損または破壊されており、完全なリカバリが必要であると仮定します。そのための手順は次のとおりです。</block>
  <block id="aa09ca247daac25fc18c2633124ca9b6" category="section-title">ポイントインタイムリカバリの例</block>
  <block id="935ff627038d1f5001220c8df7f0e1b9" category="paragraph">リカバリ手順全体は1つのコマンドで実行できます。<block ref="3df448f0a5ec82cac76d91ba14c0fa1d" prefix=" " category="inline-code"></block>。</block>
  <block id="dcd27cf8b8ceae2cd84c898d3c1b9fdb" category="paragraph">ポイントインタイムリカバリが必要な場合は、Snapshotのタイムスタンプがわかっている必要があり、次のように特定できます。</block>
  <block id="17108ef3ad2e1e613b844beb5f2c6d29" category="paragraph">Snapshotの作成時間は3月9日と10：10：06と表示されます。安全のために、Snapshotの時刻に1分が追加されます。</block>
  <block id="904b0a17b003c70e398ea85996f0f9ba" category="paragraph">リカバリが開始されました。スナップショット時間は記録された時間の1分後の10：11：00、目標復旧時間は10：44と指定されています。次に、sqlplusは目的のリカバリ時間（10：44）に到達するために必要なアーカイブログを要求します。</block>
  <block id="91f99c5ad04365fb4d00e509963e2a0c" category="admonition">Snapshotを使用してデータベースを完全にリカバリするには、<block ref="3df448f0a5ec82cac76d91ba14c0fa1d" prefix=" " category="inline-code"></block> コマンドには特定のライセンスは不要ですが、を使用してポイントインタイムリカバリを実行できます。<block ref="72104026d9850e8c478c23b2e2e4e8e9" prefix=" " category="inline-code"></block> Oracle Advanced Compressionのライセンスが必要です。</block>
  <block id="87161b635cff9308859c719a20929913" category="summary">OracleとNetAppのバックアップツール</block>
  <block id="9173402b63dc5f55506a692258f185e8" category="doc">SnapCenterおよびその他のツール</block>
  <block id="400937771ac8b3d4e7be82bf39033db5" category="paragraph">アプリケーション環境におけるONTAPの主な価値は、瞬時のSnapshotコピー、シンプルなSnapMirrorレプリケーション、効率的なFlexCloneボリュームの作成など、ONTAPのコアテクノロジにあります。</block>
  <block id="5459c1727c923baa303ff472498dbe97" category="paragraph">これらのコア機能をONTAPに直接簡単に設定して要件を満たす場合もありますが、より複雑なニーズにはオーケストレーションレイヤが必要です。</block>
  <block id="aeeb3212c35c26d321183e81d4926e57" category="paragraph">SnapCenterは、NetAppの主力データ保護製品です。データベースバックアップの実行方法という点ではSnapManager製品に似ていますが、NetAppストレージシステム上のデータ保護管理を単一コンソールで管理できるように一から構築されています。</block>
  <block id="e538db970e1ed1ffe018725fdf223f9e" category="paragraph">SnapCenterには、Snapshotコピーベースのバックアップとリストア、SnapMirrorとSnapVaultのレプリケーション、および大企業の大規模な運用に必要なその他の機能が含まれています。これらの高度な機能には、拡張されたロールベースアクセス制御（RBAC）機能、サードパーティのオーケストレーション製品と統合するためのRESTful API、データベースホスト上のSnapCenterプラグインの無停止での一元管理、クラウド規模環境向けに設計されたユーザインターフェイスなどがあります。</block>
  <block id="50780f47f6839d47d60bc4555ee00c3f" category="section-title">REST</block>
  <block id="a0bac638f30c704da8e03aba136da86d" category="paragraph">ONTAPには、豊富なRESTful APIセットも含まれています。これにより、サードパーティベンダーは、ONTAPとの緊密な統合により、データ保護やその他の管理アプリケーションを作成できます。さらに、独自の自動化ワークフローやユーティリティを作成したいお客様も、RESTful APIを簡単に利用できます。</block>
  <block id="e4cea644160fe9fa4ccd92ab3f079363" category="summary">OracleのSnapshotベースのバックアップとリカバリ</block>
  <block id="9adc36f162691b8ed14a886b6068f368" category="doc">Oracleオンラインバックアップ</block>
  <block id="a3b43ae3d4028e3c7ccac3d5720e9fb0" category="paragraph">バックアップモードでOracleデータベースを保護およびリカバリするには、2セットのデータが必要です。これはOracleの唯一のバックアップ・オプションではなく'最も一般的なバックアップ・オプションであることに注意してください</block>
  <block id="8e523970ff7c41dba74e723511d14717" category="list-text">バックアップモードでのデータファイルのSnapshot</block>
  <block id="deeddf207b1a29c63ae7c1943f90f3d9" category="list-text">データファイルがバックアップモードのときに作成されたアーカイブログ</block>
  <block id="fa1229103a2e02a4ed8790098c98f71f" category="paragraph">コミットされたすべてのトランザクションを含む完全なリカバリが必要な場合は、3つ目の項目が必要です。</block>
  <block id="7c11b244c2549a2cc477c134ec4c5635" category="list-text">最新のREDOログのセット</block>
  <block id="8522faf14bc9d4ab497945bb48adc870" category="paragraph">オンラインバックアップのリカバリを促進する方法はいくつかあります。多くのお客様は、ONTAP CLIを使用してSnapshotをリストアし、次にOracle RMANまたはsqlplusを使用してリカバリを完了します。これは、データベースをリストアする可能性と頻度が非常に低く、すべてのリストア手順が熟練したデータベース管理者によって処理される大規模な本番環境では特に顕著です。完全な自動化を実現するために、NetApp SnapCenterなどのソリューションには、コマンドラインインターフェイスとグラフィカルインターフェイスの両方を備えたOracleプラグインが含まれています。</block>
  <block id="f88f41d4801183a5d53a4b71f383d144" category="paragraph">一部の大規模なお客様では、スケジュールされたSnapshotに備えて特定の時間にデータベースをバックアップモードにするように、ホストで基本的なスクリプトを設定することで、よりシンプルなアプローチを採用しています。たとえば、次のコマンドをスケジュールします。<block ref="56f72994c4cc84b13a4c20dab49fea35" prefix=" " category="inline-code"></block> 23時58分、<block ref="84c8391d82cbfe300a9615844e0a167f" prefix=" " category="inline-code"></block> 00:02に実行し、午前0時にストレージシステム上でSnapshotの直接スケジュールを設定します。その結果、外部のソフトウェアやライセンスを必要としない、シンプルで拡張性に優れたバックアップ戦略が実現します。</block>
  <block id="719fbeb74939b8c065321f175de3d222" category="paragraph">最もシンプルなレイアウトは、データファイルを1つ以上の専用ボリュームに分離する方法です。これらのファイルは、他のファイルタイプによって汚染されていない必要があります。これは、重要なREDOログ、制御ファイル、またはアーカイブログを削除することなく、SnapRestore処理によってデータファイルボリュームを迅速にリストアできるようにするためです。</block>
  <block id="19156bdcbf322e8e3189909bbb7a69e8" category="paragraph">SANでは、専用ボリューム内でのデータファイルの分離についても同様の要件があります。Microsoft Windowsなどのオペレーティングシステムでは、1つのボリュームに複数のデータファイルLUNが含まれ、それぞれにNTFSファイルシステムが配置される場合があります。他のオペレーティング・システムでは'通常'論理ボリューム・マネージャが使用されますたとえば、Oracle ASMでは、ASMディスクグループのLUNを1つのボリュームに限定し、1つのボリュームとしてバックアップおよびリストアできるようにするのが最も簡単なオプションです。パフォーマンスまたは容量管理のために追加のボリュームが必要な場合は、新しいボリュームに追加のディスクグループを作成すると、管理が簡単になります。</block>
  <block id="993afa8643b7200c5c9e527c24c1d8b2" category="paragraph">これらのガイドラインに従うと、整合性グループSnapshotを実行する必要なく、ストレージシステム上で直接Snapshotをスケジュールできます。これは、Oracleのバックアップではデータファイルを同時にバックアップする必要がないためです。オンラインバックアップ手順は、データファイルが数時間にわたってテープにゆっくりとストリーミングされても、継続的に更新されるように設計されています。</block>
  <block id="a2ea5ea024e4a68e4d7f4abeca3441a1" category="paragraph">ASMディスクグループを複数のボリュームに分散して使用すると、複雑な状況が発生します。このような場合は、cg-snapshotを実行して、すべてのコンスティチュエントボリュームでASMメタデータの整合性を確保する必要があります。</block>
  <block id="0a3ecb97c1b7c97e5075bae0daaa45aa" category="paragraph">*注意：* ASMが<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> および<block ref="76a2173be6393254e72ffa4d6df1030a" prefix=" " category="inline-code"></block> データファイルをホストしているディスクグループにファイルがありません。これにより、データファイルのみを選択してリストアすることができなくなります。</block>
  <block id="2f8a5e254c86a42ebcc8b7d3c84cd22e" category="paragraph">この手順では、目的のアーカイブログがアクティブファイルシステムにまだ存在していることを前提としています。サポートされていない場合は、アーカイブログをリストアする必要があります。リストアされていない場合は、RMAN / sqlplusをsnapshotディレクトリ内のデータに転送できます。</block>
  <block id="a67a69f712a877950e94edd27310b40e" category="paragraph">また、小規模なデータベースの場合は、エンドユーザがデータファイルを<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 自動化ツールやストレージ管理者の支援がないディレクトリで、<block ref="a4c0ce4da6fb04943b499690fb3afd6e" prefix=" " category="inline-code"></block> コマンドを実行します</block>
  <block id="6da8ebf3245e4fbe4654e7f92f0330d7" category="list-text">データファイルをホストしているディスクグループを休止します。手順は、選択した論理ボリュームマネージャによって異なります。ASMでは、このプロセスでディスクグループをディスマウントする必要があります。Linuxでは、ファイルシステムをディスマウントし、論理ボリュームとボリュームグループを非アクティブ化する必要があります。目的は、リストア対象のターゲットボリュームグループに対するすべての更新を停止することです。</block>
  <block id="931ab211ac6773d20c03a998f9f921ce" category="list-text">完全なリカバリが必要な場合は、すべてのREDOログを再生します。</block>
  <block id="b6575c3fca5eaaa56eeb8e9ce8867f05" category="paragraph">この手順では、目的のアーカイブログがアクティブファイルシステムにまだ存在していることを前提としています。サポートされていない場合は、アーカイブログLUNをオフラインにしてリストアを実行し、アーカイブログをリストアする必要があります。この例では、アーカイブログを専用ボリュームに分割すると便利です。アーカイブログがRedoログとボリュームグループを共有している場合は、LUNのセット全体をリストアする前にRedoログを他の場所にコピーする必要があります。この手順により、最終的に記録されたトランザクションの損失を防ぐことができます。</block>
  <block id="1536f0d3e3ee227abdec76f432b89cae" category="summary">Oracleのデータ保護のSLA</block>
  <block id="e9c8b7044dfae7a21f1a9c4d08628a66" category="doc">目標復旧時間、目標復旧時点、サービスレベルアグリーメント</block>
  <block id="020e620c60ad38b75f0ff2a2fe4067b0" category="paragraph">データ保護戦略は、ビジネス要件によって定義する必要があります。</block>
  <block id="65fd6f7f97414140b4d6060b743dc645" category="paragraph">これらの要件には、リカバリの速度、許容される最大データ損失、バックアップの保持ニーズなどの要因が含まれます。データ保護計画では、データの保持とリストアに関するさまざまな規制要件も考慮する必要があります。最後に、さまざまなデータリカバリシナリオを検討する必要があります。たとえば、ユーザやアプリケーションのエラーに起因する一般的で予測可能なリカバリから、サイト全体の損失を含むディザスタリカバリのシナリオまで、さまざまなシナリオを検討する必要があります。</block>
  <block id="2bd1d35ff88de136066c33905c0fd677" category="paragraph">データ保護ポリシーとリカバリポリシーのわずかな変更は、ストレージ、バックアップ、リカバリのアーキテクチャ全体に大きな影響を与える可能性があります。データ保護アーキテクチャが複雑にならないように、設計作業を開始する前に標準を定義して文書化することが重要です。不要な機能や保護レベルは、不要なコストや管理オーバーヘッドにつながります。また、最初に見落とされた要件は、プロジェクトを間違った方向に進めたり、直前の設計変更を必要としたりする可能性があります。</block>
  <block id="a60e6b87ede45aef49d8d095435db22b" category="section-title">目標復旧時間</block>
  <block id="3d3b341e14c584d1edcea9fe13619ee1" category="paragraph">Recovery Time Objective（RTO；目標復旧時間）は、サービスのリカバリに許容される最大時間を定義します。たとえば、人事データベースのRTOが24時間になる可能性があります。これは、営業日中にこのデータにアクセスできなくなることは非常に不便ですが、ビジネスを継続できるためです。一方、銀行の総勘定元帳をサポートするデータベースでは、数分または数秒でRTOを測定できます。RTOをゼロにすることはできません。これは、実際のサービス停止と、ネットワークパケットの損失などの日常的なイベントを区別する方法が必要であるためです。ただし、一般的な要件はRTOがほぼゼロです。</block>
  <block id="5a27873285a0397cc06f9f47280c9426" category="section-title">目標復旧時点</block>
  <block id="f3ae061e139f47d793058ee596a5243f" category="paragraph">Recovery Point Objective（RPO；目標復旧時点）は、最大許容データ損失を定義します。多くの場合、RPOはSnapshotまたはSnapMirror更新の頻度によって決まります。</block>
  <block id="2d68fbd3cefeb34bfd64c8f89caba64d" category="paragraph">場合によっては、RPOをより積極的に設定し、特定のデータをより頻繁に選択的に保護することができます。データベースのコンテキストでは、通常、RPOは、特定の状況で失われる可能性のあるログデータの量です。製品のバグやユーザエラーによってデータベースが破損した一般的なリカバリシナリオでは、RPOはゼロ、つまりデータ損失がないはずです。リカバリ手順では、データベースファイルの以前のコピーをリストアし、ログファイルを再生して、データベースを希望する時点の状態にします。この処理に必要なログファイルは元の場所にすでに存在している必要があります。</block>
  <block id="57df8b025934bcd0f7e96bae19cf0688" category="paragraph">通常とは異なる状況では、ログデータが失われる可能性があります。たとえば、偶発的または悪意のある<block ref="4609acba202877f99742342f4195d95e" prefix=" " category="inline-code"></block> データベースファイルのすべてのデータが削除される可能性があります。唯一の方法は、ログファイルを含むバックアップからリストアすることであり、一部のデータは必然的に失われます。従来のバックアップ環境でRPOを向上させる唯一の方法は、ログデータのバックアップを繰り返し実行することです。しかし、データが絶えず移動し、バックアップシステムを継続的に実行されるサービスとして維持することが困難であるため、これには限界があります。高度なストレージシステムのメリットの1つは、偶発的または悪意のあるファイルの破損からデータを保護し、データを移動せずにRPOを向上できることです。</block>
  <block id="3d08c71e26ac92e34925e02570c4bd22" category="paragraph">ディザスタリカバリには、物理的な災害が発生した場合にサービスをリカバリするために必要なITアーキテクチャ、ポリシー、および手順が含まれます。これには、洪水、火災、または悪意または過失の意図を持って行動する人が含まれます。</block>
  <block id="78f4e749ec0c6bb2627abbbc00bce296" category="paragraph">ディザスタリカバリは、単なるリカバリ手順ではありません。これは、さまざまなリスクを特定し、データリカバリとサービス継続性の要件を定義し、適切なアーキテクチャと関連手順を提供する完全なプロセスです。</block>
  <block id="75bcd60b234aba82b5827cd7a5171563" category="paragraph">データ保護の要件を確立するには、一般的なRPOとRTOの要件と、ディザスタリカバリに必要なRPOとRTOの要件を区別することが重要です。一部のアプリケーション環境では、比較的通常のユーザエラーからデータセンターの破壊に至るまで、データ損失の状況に対して、RPOゼロとRTOほぼゼロを達成する必要があります。ただし、これらの高レベルの保護にはコストと管理上の影響があります。</block>
  <block id="756651fea87d05811d7a42451d074b60" category="paragraph">一般に、ディザスタ以外のデータリカバリの要件は、次の2つの理由で厳しいものにする必要があります。まず、データに損害を与えるアプリケーションのバグやユーザエラーは、ほぼ避けられないほど予測可能です。2つ目は、ストレージシステムが破損していないかぎり、RPOをゼロにしてRTOを短縮できるバックアップ戦略を設計することです。容易に修復できる重大なリスクに対処しない理由はありません。そのため、ローカルリカバリのRPOとRTOの目標を積極的に設定する必要があります。</block>
  <block id="cb6faee28dd34d25f06bd0b33abe1c2f" category="paragraph">ディザスタリカバリのRTOとRPOの要件は、災害が発生する可能性や、関連するデータの損失やビジネスの中断がもたらす影響によって大きく異なります。RPOとRTOの要件は、一般的な原則ではなく、実際のビジネスニーズに基づいている必要があります。論理的および物理的な複数の災害シナリオを考慮する必要があります。</block>
  <block id="68f31611fc8a5e6a20793905280a7001" category="section-title">論理的災害</block>
  <block id="07f5727077caaf8dedf895542181d26b" category="paragraph">論理的災害には、ユーザによるデータ破損、アプリケーションやOSのバグ、ソフトウェアの誤動作などがあります。論理的災害には、ウイルスやワームによる外部からの悪意のある攻撃や、アプリケーションの脆弱性を悪用した悪意のある攻撃も含まれます。この場合、物理インフラは破損していませんが、基盤となるデータは無効になります。</block>
  <block id="3cb5ee5f24e42f56ba6dac48b7b046d2" category="paragraph">ランサムウェアと呼ばれる論理災害のタイプはますます一般的になりつつあり、攻撃ベクトルを使用してデータを暗号化します。暗号化はデータを損傷することはありませんが、サードパーティに支払いが行われるまで使用できなくなります。ランサムウェアのハッキングを特に標的にされる企業は、ますます増えています。この脅威に対して、NetAppには改ざん防止スナップショットが用意されており、ストレージ管理者であっても、設定された有効期限までに保護されたデータを変更することはできません。</block>
  <block id="91c87f53ce0a1f416308a67ce119c623" category="section-title">物理的災害</block>
  <block id="79055ca11f54a97d22617a656eab8b9b" category="paragraph">物理的災害には、インフラストラクチャのコンポーネントの障害がその冗長性機能を超え、データの損失やサービスの長期的な損失につながることが含まれます。たとえば、RAID保護ではディスクドライブの冗長性が提供され、HBAを使用することでFCポートとFCケーブルの冗長性が提供されます。このようなコンポーネントのハードウェア障害は予測可能であり、可用性には影響しません。</block>
  <block id="3f7c55fe5f35f94cd2c4bd73b9cbb11b" category="paragraph">エンタープライズ環境では、通常、サイト全体のインフラストラクチャを冗長コンポーネントで保護し、予測可能な唯一の物理的災害シナリオがサイトの完全な損失である時点まで保護することができます。ディザスタリカバリ計画は、サイト間レプリケーションによって異なります。</block>
  <block id="7f3dd7bdd41f7af6853732a383bbd7e2" category="section-title">同期および非同期のデータ保護</block>
  <block id="c5ac17d5693914368f39b40a07af23d4" category="paragraph">理想的な環境では、地理的に分散したサイト間ですべてのデータを同期的にレプリケートできます。このようなレプリケーションは、次のようないくつかの理由により、必ずしも実現可能ではありません。</block>
  <block id="28c59a675d03e1f62a48958bb53ae523" category="list-text">同期レプリケーションでは、アプリケーションやデータベースの処理を続行する前にすべての変更を両方の場所にレプリケートする必要があるため、書き込みレイテンシが避けられません。このようなパフォーマンスへの影響が許容できない場合があり、同期ミラーリングの使用が除外されます。</block>
  <block id="50a05ceeb998c4dac7e8b5d706fe2029" category="list-text">100% SSDストレージの採用が増加しているため、期待されるパフォーマンスには数十万IOPSと1ミリ秒未満のレイテンシが含まれているため、書き込みレイテンシの増加に気付く可能性が高くなります。100% SSDを使用するメリットを最大限に引き出すには、ディザスタリカバリ戦略を見直す必要があります。</block>
  <block id="04d90fe6288ce6cceba54a2b71e55727" category="list-text">データセットはバイト単位で増え続けているため、同期レプリケーションを維持するのに十分な帯域幅を確保するという課題が生じています。</block>
  <block id="d3aaae220bd5b3d68dd4ccec3bf78197" category="list-text">データセットも複雑化し、大規模な同期レプリケーションの管理が困難になっています。</block>
  <block id="c3a841e0bfc640f91b0a00c4af8c6f5c" category="list-text">クラウドベースの戦略では、多くの場合、レプリケーションの距離とレイテンシが長くなり、同期ミラーリングの使用がさらに困難になります。</block>
  <block id="7df1515e247dfa2063c433b9339c2d4a" category="paragraph">NetAppは、最も厳しいデータリカバリ要件に対応する同期レプリケーションと、パフォーマンスと柔軟性の向上を可能にする非同期ソリューションの両方を含むソリューションを提供しています。さらに、NetAppテクノロジは、Oracle DataGuardなどの多くのサードパーティ製レプリケーションソリューションとシームレスに統合されます。</block>
  <block id="4d2c802af835583121763e1a6acc3f9b" category="section-title">保持時間</block>
  <block id="123dbb4c09a5c8fb993a856cf65c9d25" category="paragraph">データ保護戦略の最後の側面は、データの保持期間です。データの保持期間は大きく異なる場合があります。</block>
  <block id="d3a424909a8559a2d076e5d9a28d834f" category="list-text">一般的な要件は、プライマリサイトに夜間バックアップを14日間、セカンダリサイトにバックアップを90日間保存することです。</block>
  <block id="1d7c2d97c3bfd5ca9489e0ffeb06b150" category="list-text">多くのお客様が'異なるメディアに保存された四半期ごとのスタンドアロンアーカイブを作成しています</block>
  <block id="61ae175e4a0c88c4624184a0cb9b04d2" category="list-text">定期的に更新されるデータベースでは、履歴データは不要であり、バックアップは数日間だけ保持する必要があります。</block>
  <block id="8bb85c2149e1e808032e7025b0a27b80" category="list-text">規制要件によっては、任意のトランザクションを365日以内にリカバリできることが求められる場合があります。</block>
  <block id="a83f7a3ea63946cbdc1977d641e8460c" category="summary">ONTAP上のOracleとスナップショットの役割</block>
  <block id="05280349760feacdd6227fb8012e39d7" category="doc">Snapshotベースのバックアップ</block>
  <block id="5e3f0537b2a1927f4a24b28e9157cc0b" category="paragraph">ONTAPでのOracleデータ保護の基盤となるのが、NetAppのSnapshotテクノロジです。</block>
  <block id="a4c2aeedbfeeda21f232cbf45be91693" category="paragraph">主な値は次のとおりです。</block>
  <block id="d06c89cff665ecdde6eded3c9d44cd2b" category="list-text">*簡易性。*スナップショットは、特定の時点におけるデータのコンテナの内容の読み取り専用コピーです。</block>
  <block id="175888ba89c31a851f719bdd271cae9c" category="list-text">*効率性。* Snapshotは作成時にスペースを必要としません。スペースが消費されるのは、データが変更されたときだけです。</block>
  <block id="d853e9e275a6e58b3a9a56fa641cbb9f" category="list-text">*管理性。*スナップショットをベースにしたバックアップ戦略は、ストレージOSに標準で組み込まれているため、構成と管理が容易です。ストレージシステムの電源がオンになっていれば、バックアップを作成できます。</block>
  <block id="b564e5fbab71af776ed54a19d09b268c" category="list-text">*拡張性。*ファイルとLUNの単一コンテナの最大1024個のバックアップを保持できます。複雑なデータセットの場合、データの複数のコンテナを、整合性のある単一のSnapshotセットで保護できます。</block>
  <block id="7159872a568b97a971b9ea182fb23b7c" category="list-text">ボリュームに1024個のSnapshotが含まれているかどうかに関係なく、パフォーマンスに影響はありません。</block>
  <block id="1a54f7e14e6e652bb32b12df22faf387" category="paragraph">多くのストレージベンダーがSnapshotテクノロジを提供していますが、ONTAP内のSnapshotテクノロジは他に類を見ないものであり、エンタープライズアプリケーションやデータベース環境に次のような大きなメリットをもたらします。</block>
  <block id="d77b23e355dc2f65b90fb52ed9a90f9c" category="list-text">Snapshotコピーは、基盤となるWrite-Anywhere File Layout（WAFL）の一部です。アドオンや外部テクノロジではありません。これにより、ストレージシステムがバックアップシステムであるため、管理が簡易化されます。</block>
  <block id="8b888e6a2d883c0111428c101532294a" category="list-text">Snapshotコピーはパフォーマンスには影響しません。ただし、Snapshotに大量のデータが格納され、基盤となるストレージシステムがいっぱいになる場合など、一部のエッジケースを除きます。</block>
  <block id="2283ea50a243a5d1ad551f7d21f39895" category="list-text">「整合グループ」という用語は、整合性のあるデータの集合として管理されるストレージオブジェクトをグループ化したものを指す場合によく使用されます。特定のONTAPボリュームのSnapshotが整合グループのバックアップを構成します。</block>
  <block id="ac72c83a8204d600d567261b41c5488c" category="paragraph">また、ONTAPスナップショットは、競合するテクノロジよりも拡張性に優れています。パフォーマンスに影響を与えることなく、5、50、500個のスナップショットを保存できます。ボリュームに現在許可されているSnapshotの最大数は1024です。Snapshotの保持期間を延長する必要がある場合は、Snapshotを追加のボリュームにカスケードするオプションがあります。</block>
  <block id="3b7ff39ba50f1bc3f56d38c41ba51855" category="paragraph">そのため、ONTAPでホストされているデータセットの保護はシンプルで拡張性に優れています。バックアップはデータの移動を必要としないため、ネットワーク転送速度、多数のテープドライブ、ディスクステージング領域の制限ではなく、ビジネスのニーズに合わせてバックアップ戦略を調整できます。</block>
  <block id="55c5bbb3aad88266600eaa1a526406d4" category="paragraph">データ保護戦略としてSnapshotを使用する場合によく寄せられる質問の1つは、「実際の」データとSnapshotデータが同じドライブに配置されていることです。これらのドライブが失われると、プライマリデータとバックアップの両方が失われます。</block>
  <block id="68870deb35eeb53373325a314030bd11" category="paragraph">ただし、ローカルSnapshotが唯一のバックアップ戦略であるべきではありません。そのため、NetAppは、SnapMirrorやSnapVaultレプリケーションなどのテクノロジを提供し、独立したドライブセットにSnapshotを迅速かつ効率的にレプリケートします。スナップショットとスナップショットレプリケーションを使用して適切に設計された解決策では、テープの使用を最小限に抑えて四半期ごとのアーカイブを作成することも、完全に排除することもできます。</block>
  <block id="73d3fd255835ca3dc926f59d50223f91" category="paragraph">ONTAP Snapshotコピーを使用してデータを保護する方法は多数ありますが、Snapshotは、レプリケーション、ディザスタリカバリ、クローニングなど、ONTAPの他の多くの機能の基盤となります。Snapshotテクノロジの完全な概要については本ドキュメントでは説明しませんが、ここでは概要について説明します。</block>
  <block id="7441577327d1d49b71cc2f6403e17e7b" category="paragraph">データセットのスナップショットを作成するには、主に次の2つの方法があります。</block>
  <block id="b38ba43128207852ef5149e6c578ba89" category="list-text">crash-consistentバックアップ</block>
  <block id="dc64a2f6075820724476e435a1ebd7fa" category="list-text">アプリケーションと整合性のあるバックアップ</block>
  <block id="7733cc553d118547b64c858cb4281f24" category="paragraph">データセットのcrash-consistentバックアップとは、ある時点におけるデータセット構造全体のキャプチャです。データセットが単一のNetApp FlexVolボリュームに格納されている場合は、Snapshotはいつでも作成できるため、このプロセスは簡単です。データセットが複数のボリュームにまたがっている場合は、整合性グループ（CG）Snapshotを作成する必要があります。CG Snapshotを作成するには、NetApp SnapCenterソフトウェア、ONTAPのネイティブ整合グループ機能、ユーザが管理するスクリプトなど、いくつかのオプションがあります。</block>
  <block id="32561979f55bc68c4f028fd26a9975f6" category="paragraph">crash-consistentバックアップは、主にpoint-of-the-backupリカバリで十分な場合に使用します。よりきめ細かなリカバリが必要な場合は、通常、アプリケーションと整合性のあるバックアップが必要です。</block>
  <block id="367735591e5e6e04c17b7930acb29b7d" category="paragraph">「application-consistent」の「consistent」という言葉は、しばしば誤った名義である。たとえば、Oracleデータベースをバックアップモードにすることをアプリケーション整合性バックアップと呼びますが、データの整合性が確保されたり休止されたりすることはありません。バックアップ中もデータは変化し続けます。一方、ほとんどのMySQLおよびMicrosoft SQL Serverのバックアップでは、バックアップを実行する前にデータが休止されます。VMwareは、特定のファイルの整合性を確保する場合としない場合があります。</block>
  <block id="ebf90723e7659cb5381545104b618612" category="paragraph">「コンシステンシグループ」とは、ストレージアレイが複数のストレージリソースを単一のイメージとして管理できることを指します。たとえば、データベースが10個のLUNで構成されているとします。アレイは、これらの10個のLUNを一貫した方法でバックアップ、リストア、およびレプリケートできる必要があります。バックアップ時点でLUNのイメージに一貫性がなかった場合は、リストアを実行できません。これらの10個のLUNをレプリケートするには、すべてのレプリカが相互に完全に同期されている必要があります。</block>
  <block id="3f8a43f1defaa984435092f616876545" category="paragraph">ONTAPのボリュームとアグリゲートのアーキテクチャでは、整合性は常に基本的な機能であるため、ONTAPについて説明する際に「整合グループ」という用語はあまり使用されません。他の多くのストレージアレイは、LUNまたはファイルシステムを個別のユニットとして管理します。その後、データ保護を目的とした「整合グループ」として設定することもできますが、これは追加の設定手順です。</block>
  <block id="74e816c3c784f5c30c79dca4590d7f59" category="paragraph">ONTAPは、常に一貫性のあるローカルイメージとレプリケートされたデータイメージをキャプチャすることができました。ONTAPシステム上のさまざまなボリュームは、通常、正式には整合グループと呼ばれませんが、それが整合グループです。このボリュームのSnapshotは整合グループのイメージであり、そのSnapshotのリストアは整合グループのリストアです。SnapMirrorとSnapVaultはどちらも整合グループのレプリケーションを提供します。</block>
  <block id="15cc4389a08c3f4748e98622e630ad3e" category="section-title">整合性グループのSnapshot</block>
  <block id="d286b747757ef3d8d3abac27bfae65f9" category="paragraph">整合グループSnapshot（cg-snapshots）は、ONTAPの基本的なSnapshotテクノロジを拡張したものです。標準のSnapshot処理では、1つのボリューム内のすべてのデータの整合性のあるイメージが作成されますが、複数のボリューム間、さらには複数のストレージシステム間で整合性のある一連のSnapshotを作成する必要がある場合があります。その結果、1つのボリュームのSnapshotと同じ方法で使用できる一連のSnapshotが作成されます。ローカルデータのリカバリに使用することも、ディザスタリカバリの目的でレプリケートすることも、単一の一貫したユニットとしてクローニングすることもできます。</block>
  <block id="7c199465bc6344e648e2f73c88131605" category="paragraph">cg-snapshotsの最大の用途は、12台のコントローラにまたがる約1PBのデータベース環境です。このシステムで作成されたcg-snapshotは、バックアップ、リカバリ、クローニングに使用されています。</block>
  <block id="e5c199b4a97409f33d5caae984957744" category="paragraph">ほとんどの場合、データセットが複数のボリュームにまたがっており、書き込み順序を維持する必要がある場合、選択した管理ソフトウェアによってcg-snapshotが自動的に使用されます。このような場合、cg-snapshotsの技術的な詳細を理解する必要はありません。ただし、複雑なデータ保護要件によっては、データ保護とレプリケーションのプロセスを詳細に管理しなければならない場合があります。ワークフローの自動化や、cg-snapshot APIの呼び出しにカスタムスクリプトを使用することもできます。最適なオプションとcg-snapshotの役割を理解するには、テクノロジの詳細な説明が必要です。</block>
  <block id="cf3c30ea5c240a8aef02d240f42cdff7" category="paragraph">一連のcg-snapshotsの作成は、次の2つの手順で行います。</block>
  <block id="f30455406a91bd776afbc88e60b9697e" category="list-text">すべてのターゲットボリュームで書き込みフェンシングを確立します。</block>
  <block id="c7afe45d94f2fd172a01e851d7f92a2f" category="list-text">フェンシングされた状態のボリュームのSnapshotを作成します。</block>
  <block id="c464d4671e489eaad9a8cbf0a8086ea9" category="paragraph">書き込みフェンシングは順番に確立されます。つまり、フェンシングプロセスが複数のボリュームにまたがって設定されている間は、最初のボリュームで書き込みI/Oがフリーズされ、以降に表示されるボリュームにコミットされ続けます。これは、最初は書き込み順序を維持するための要件に違反しているように見えるかもしれませんが、環境ホストで非同期的に実行され、他の書き込みには依存しません。</block>
  <block id="688656b1f8644ee299edf7be87a8fc75" category="paragraph">たとえば、データベースでは大量の非同期データファイル更新が問題され、OSがI/Oの順序を変更して、独自のスケジューラ設定に従って完了できる場合があります。アプリケーションとオペレーティングシステムが書き込み順序を保持する要件をすでにリリースしているため、このタイプのI/Oの順序は保証できません。</block>
  <block id="599ce07d1bae0fa6169959e2bdb97ada" category="paragraph">カウンタの例として、ほとんどのデータベースロギングアクティビティは同期です。I/Oが確認応答され、書き込み順序を維持する必要があるまで、データベースはログへの以降の書き込みを続行しません。ログI/Oがフェンシングされたボリュームに到達した場合、そのことは確認されず、アプリケーションはそれ以降の書き込みをブロックします。同様に、ファイルシステムのメタデータI/Oは通常同期です。たとえば、ファイル削除処理が失われることはありません。xfsファイルシステムを使用するオペレーティングシステムがファイルを削除し、xfsファイルシステムのメタデータを更新して、フェンシングされたボリュームにあるファイルへの参照を削除するI/Oを実行すると、ファイルシステムのアクティビティが一時停止します。これにより、cg-snapshot処理中のファイルシステムの整合性が保証されます。</block>
  <block id="0f0c0f05310f9cf257d65bfd936f15c5" category="paragraph">ターゲットボリューム間で書き込みフェンシングを設定すると、それらのボリュームでSnapshotを作成できるようになります。ボリュームの状態は従属書き込みの観点からフリーズされるため、Snapshotを正確に同時に作成する必要はありません。cg-snapshotを作成するアプリケーションの欠陥を防ぐために、初期の書き込みフェンシングには設定可能なタイムアウトが含まれています。このタイムアウトでは、ONTAPが自動的にフェンシングを解除し、定義された秒数後に書き込み処理を再開します。タイムアウト時間の経過前にすべてのSnapshotが作成された場合、作成される一連のSnapshotは有効な整合グループになります。</block>
  <block id="df4925d1c6c3f3258e80ff35ce62b17d" category="section-title">従属書き込み順序</block>
  <block id="6c78ee478b93fbb573157b85fb1114db" category="paragraph">技術的な観点から見ると、整合性グループの鍵となるのは、書き込み順序（特に従属書き込み順序）を維持することです。たとえば、10個のLUNに書き込むデータベースは、すべてのLUNに同時に書き込みます。多くの書き込みは非同期で発行されます。つまり、書き込みが完了する順序は重要ではなく、実際の書き込み順序はオペレーティングシステムやネットワークの動作によって異なります。</block>
  <block id="69d87c00869001f3f06ad4a1494eac21" category="paragraph">データベースが追加の書き込みを続行するには、一部の書き込み処理がディスク上に存在している必要があります。このような重要な書き込み処理は、依存書き込みと呼ばれます。以降の書き込みI/Oは、これらの書き込みがディスクに存在するかどうかに左右されます。これら10個のLUNのスナップショット、リカバリ、またはレプリケーションでは、従属書き込み順序が保証されていることを確認する必要があります。ファイルシステムの更新も、書き込み順序に依存した書き込みの例です。ファイルシステムの変更の順序を維持する必要があります。そうしないと、ファイルシステム全体が破損する可能性があります。</block>
  <block id="74fbae5d0b3c16e1774c5f4dce2c1c36" category="section-title">戦略</block>
  <block id="53e858edb9bd9ff3f9ead52cebf5731d" category="paragraph">Snapshotベースのバックアップには、主に次の2つの方法があります。</block>
  <block id="f87f61f625a005bd32c53f808d235eea" category="list-text">Snapshotで保護されたホットバックアップ</block>
  <block id="c81725eb350a685210d69762bd5d725d" category="paragraph">データベースのcrash-consistentバックアップとは、データファイル、REDOログ、制御ファイルなど、データベース構造全体をある時点でキャプチャすることです。データベースが単一のNetApp FlexVolボリュームに格納されている場合は、Snapshotはいつでも作成できるため、このプロセスは簡単です。データベースが複数のボリュームにまたがっている場合は、整合性グループ（CG）Snapshotを作成する必要があります。CG Snapshotを作成するには、NetApp SnapCenterソフトウェア、ONTAPのネイティブ整合グループ機能、ユーザが管理するスクリプトなど、いくつかのオプションがあります。</block>
  <block id="c32eba270db95747b471fd53e203a47b" category="paragraph">crash-consistent Snapshotバックアップは、主にポイントオブザバックアップリカバリで十分な場合に使用されます。状況によってはアーカイブログを適用できますが、よりきめ細かなポイントインタイムリカバリが必要な場合は、オンラインバックアップを推奨します。</block>
  <block id="82cc23cd5dc667cc9fb78ff6e76ac15b" category="paragraph">Snapshotベースのオンラインバックアップの基本的な手順は次のとおりです。</block>
  <block id="dbaf4855045e45fbcf678fa4cd1ab2db" category="list-text">データベースを<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> モード（Mode）：</block>
  <block id="c3e07fb8aef84ef3d94e3f9d5376c091" category="list-text">データファイルをホストしているすべてのボリュームのSnapshotを作成します。</block>
  <block id="2d0e58ff1a25bd9fd8a85ad8ce6f2665" category="list-text">終了します<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> モード（Mode）：</block>
  <block id="4196c5674aaa9e4317b2b4c54f94a905" category="list-text">コマンドを実行します<block ref="9d2840394bc37850da4e360dbf60c0dc" prefix=" " category="inline-code"></block> ログのアーカイブを強制的に実行します。</block>
  <block id="f2736e795871e2fc2d36addb9436f337" category="list-text">アーカイブログをホストするすべてのボリュームのSnapshotを作成します。</block>
  <block id="f24880a3fe8b242fdd1aba5a2d11196f" category="paragraph">この手順により、バックアップモードのデータファイルと、バックアップモード中に生成された重要なアーカイブログを含む一連のSnapshotが作成されます。データベースのリカバリには、次の2つの要件があります。制御ファイルなどのファイルも便宜上保護する必要がありますが、絶対に必要なのはデータファイルとアーカイブログの保護だけです。</block>
  <block id="0c32649da44277db19fcfa3fe4dac28f" category="paragraph">戦略はお客様によって大きく異なる可能性がありますが、これらの戦略のほとんどは、最終的には以下に概説されているのと同じ原則に基づいています。</block>
  <block id="88f451afed04f47352987f617f805826" category="section-title">Snapshotベースのリカバリ</block>
  <block id="c092a9763068c8382be82f9c77bb9658" category="paragraph">Oracleデータベースのボリュームレイアウトを設計する際には、ボリュームベースNetApp SnapRestore（VBSR）テクノロジを使用するかどうかを最初に決定します。</block>
  <block id="15a0b8dc4d1b340d403bf6515f7e61b8" category="paragraph">ボリュームベースのSnapRestoreを使用すると、ボリュームをある時点の状態にほぼ瞬時にリバートできます。VBSRはボリューム上のすべてのデータがリバートされるため、すべてのユースケースに適しているとは限りません。たとえば、データファイル、Redoログ、アーカイブログを含むデータベース全体が1つのボリュームに格納されている場合、このボリュームをVBSRでリストアすると、新しいアーカイブログとRedoデータが破棄されるためデータが失われます。</block>
  <block id="e63c0ca12b07a654ccadd92527a95c47" category="paragraph">リストアにVBSRは必要ありません。データベースの多くは、ファイルベースのSingle-File SnapRestore（SFSR）を使用するか、Snapshotからアクティブファイルシステムにファイルをコピーして戻すだけでリストアできます。</block>
  <block id="2093e578085fede0f022c4efdb79c336" category="paragraph">VBSRは、データベースが非常に大規模な場合やできるだけ迅速にリカバリする必要がある場合に推奨されます。また、VBSRを使用するにはデータファイルを分離する必要があります。NFS環境では、特定のデータベースのデータファイルを、他の種類のファイルの影響を受けない専用ボリュームに格納する必要があります。SAN環境では、データファイルを専用のFlexVolボリューム上の専用LUNに格納する必要があります。ボリュームマネージャを使用する場合は（Oracle Automatic Storage Management[ASM]を含む）、ディスクグループもデータファイル専用にする必要があります。</block>
  <block id="b38bd603a952c93872eae2ea858cb15f" category="paragraph">この方法でデータファイルを分離すると、他のファイルシステムに影響を与えることなく、データファイルを以前の状態にリバートできます。</block>
  <block id="5755a6275c3ecd99e8159efc58a8ff6c" category="section-title">Snapshot リザーブ</block>
  <block id="957abb72f2db3a20e0b570a5fa3a1dcc" category="paragraph">SAN環境内のOracleデータを含むボリュームごとに、<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> LUN環境でSnapshot用にスペースをリザーブしても役に立たないため、ゼロに設定する必要があります。フラクショナルリザーブを100に設定すると、LUNを含むボリュームのSnapshotでは、すべてのデータの書き替えを100%吸収するために、Snapshotリザーブを除くボリューム内に十分な空きスペースが必要になります。フラクショナルリザーブの値を小さい値に設定すると、それに応じて必要な空きスペースは少なくなりますが、Snapshotリザーブは常に除外されます。これは、LUN環境のスナップショット予約スペースが無駄になることを意味します。</block>
  <block id="d5a06adf11e69f265f3ee3277212764e" category="paragraph">NFS環境には2つのオプションがあります。</block>
  <block id="7631336a8e2e03f6ac500c145445b2d7" category="list-text">を設定します<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 予想されるSnapshotスペース消費量に基づきます。</block>
  <block id="acc4c5d06fc4a9ac93880c9c2d0a6e76" category="list-text">を設定します<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> アクティブなスペース使用量とSnapshotスペース使用量をまとめてゼロにして管理できます。</block>
  <block id="44806986c5abfcd6261803f4f75a7b56" category="paragraph">最初のオプションでは、<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> は、ゼロ以外の値（通常は約20%）に設定されます。このスペースはユーザーには表示されません。ただし、この値によって利用率が制限されるわけではありません。リザーブが20%のデータベースで30%の入れ替えが発生した場合、スナップショット領域は20%リザーブの範囲を超えて拡張され、リザーブされていないスペースを占有する可能性があります。</block>
  <block id="c8910acb0bfa30f82b423ff09a9710ca" category="paragraph">リザーブを20%などの値に設定する主な利点は、一部のスペースが常にスナップショットに使用可能であることを確認することです。たとえば、1TBのボリュームに20%のリザーブが設定されている場合、データベース管理者（DBA）が格納できるのは800GBのデータのみです。この構成では、Snapshot用に少なくとも200GBのスペースが保証されます。</block>
  <block id="be233226a8cb890c0a8bbf041c06ac6b" category="paragraph">いつ<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> がゼロに設定されている場合、ボリューム内のすべてのスペースをエンドユーザが使用できるため、可視性が向上します。データベース管理者は、Snapshotを利用する1TBのボリュームが表示された場合、この1TBのスペースはアクティブデータとSnapshotの書き替えの間で共有されることを理解しておく必要があります。</block>
  <block id="b10efee713968b90d211d08ec8345d20" category="paragraph">エンドユーザ間では、オプション1とオプション2の間に明確な優先順位はありません。</block>
  <block id="8112d08173571f2d01372cadea3ea76d" category="section-title">ONTAPとサードパーティのスナップショット</block>
  <block id="0cc082f7cc7618a904f6cde556295cbd" category="paragraph">Oracle Doc ID 604683.1には、サードパーティ製スナップショットのサポート要件と、バックアップおよびリストア処理に使用できる複数のオプションが説明されています。</block>
  <block id="130a02f8381e6c54b2ea07d2bdaf6f0b" category="paragraph">サードパーティベンダーは、会社のスナップショットが次の要件に準拠していることを保証する必要があります。</block>
  <block id="97eb59a0f249226523b31dd52d557e00" category="list-text">スナップショットは、Oracleが推奨するリストアおよびリカバリ処理と統合する必要があります。</block>
  <block id="083e9332dc2b6bf064139ac2e670eee9" category="list-text">スナップショットは、スナップショットの時点でデータベースクラッシュ整合性がある必要があります。</block>
  <block id="9dae8634b638a6949dab0f7eaf7988bd" category="list-text">スナップショット内のファイルごとに書き込み順序が保持されます。</block>
  <block id="7bc868657652757ca8505ddcd297456f" category="paragraph">ONTAPおよびNetAppのOracle管理製品は、これらの要件に準拠しています。</block>
  <block id="9ec85da221bc7f0822b82657e52f4955" category="summary">Oracleテタホコノカイヨウ</block>
  <block id="9e19caeb431a5e29a1a63e3cee4b36c9" category="doc">ONTAPによるOracleデータ保護</block>
  <block id="6f1383567177df0041e76e845c3629f2" category="paragraph">最もミッションクリティカルなデータはデータベースにあります。</block>
  <block id="848aab87f65bfade12f80d4e864ec046" category="paragraph">企業はデータへのアクセスなしでは業務を遂行できず、場合によってはデータによってビジネスが決まることもあります。このようなデータは保護する必要がありますが、データ保護では、使用可能なバックアップを確保するだけでなく、バックアップを安全に保管するだけでなく、迅速かつ確実に実行することも重要です。</block>
  <block id="28a0304f97f876b27cf541f4ad9a30d7" category="paragraph">データ保護のもう1つの側面は、データリカバリです。データにアクセスできなくなると企業は影響を受け、データがリストアされるまで操作できなくなる可能性があります。このプロセスは高速で信頼性が必要です。最後に、ほとんどのデータベースを災害から保護する必要があります。つまり、データベースのレプリカを維持する必要があります。レプリカは十分に最新である必要があります。また'レプリカを完全に動作可能なデータベースにするには'迅速かつ簡単に行う必要があります</block>
  <block id="3d601b26d05eac41fc6a7eba92fdc8b9" category="admonition">このドキュメントは、以前に公開されていたテクニカルレポート_TR-4591：『Oracle data protection：Backup、recovery、and replication』に代わるものです。_</block>
  <block id="21d28aa03f67eb242b1c95a6a0594ff5" category="section-title">計画</block>
  <block id="0bf5784d6c307e4ee0371d46053937c0" category="summary">Oracleパフォーマンステスト</block>
  <block id="3993fbf2fe01237c798f68ece0b84724" category="doc">Oracleのパフォーマンス最適化とベンチマーク</block>
  <block id="355ba59494fea8b20be391a73cc755eb" category="paragraph">データベースストレージのパフォーマンスを正確にテストすることは、非常に複雑な課題です。次の問題について理解しておく必要があります。</block>
  <block id="b57041cc3b57577b5c21eff44739e3f9" category="list-text">IOPSとスループット</block>
  <block id="236e7fd957ada95e8094e302623980d3" category="list-text">フォアグラウンドI/O処理とバックグラウンドI/O処理の違い</block>
  <block id="902f90cc4ab59808cac5606f767f61c4" category="list-text">データベースへのレイテンシの影響</block>
  <block id="196198dbaa1d1ea17cfc478fbb2f419f" category="list-text">ストレージのパフォーマンスにも影響する多数のOSとネットワーク設定</block>
  <block id="5ff18eadb2ef3fc20e13bed3e5b61d79" category="paragraph">また、ストレージデータベース以外のタスクについても考慮する必要があります。ストレージパフォーマンスがパフォーマンスの制限要因ではなくなったため、ストレージパフォーマンスを最適化しても有益なメリットは得られなくなります。</block>
  <block id="92d509b1796c0ac8e185dc559cb7e294" category="paragraph">現在、データベースユーザの大半がオールフラッシュアレイを選択していることから、新たな考慮事項がいくつか生まれています。たとえば、2ノードのAFF8080システムでパフォーマンスをテストする場合を考えてみましょう。</block>
  <block id="4eb08b8b1c39980bb639a6e5890ec0de" category="list-text">読み取り/書き込みの比率が75対25の場合、2台のAFF8080ノードで30万を超えるランダムデータベースIOPSを、レイテンシ1ミリ秒未満で達成できます。これは、ほとんどのデータベースで現在必要とされているパフォーマンスをはるかに超えているため、予想される改善を予測することは困難です。ストレージがボトルネックになることはほとんどありません。</block>
  <block id="32a993d3f497a6dd4392d3348b05ebc3" category="list-text">ネットワーク帯域幅は、パフォーマンス上の制約の原因としてますます一般的になっています。たとえば、回転式ディスクソリューションはI/Oレイテンシが非常に高いため、データベースパフォーマンスのボトルネックになることがよくあります。オールフラッシュアレイでレイテンシの制限が取り除かれると、多くの場合、その障壁はネットワークに移ります。これは、真のネットワーク接続を可視化することが困難な仮想環境やブレードシステムで特に顕著です。帯域幅の制限のためにストレージシステム自体をフルに活用できない場合、パフォーマンステストが複雑になる可能性があります。</block>
  <block id="8caa382fb0f5f7a8279424d306dd003d" category="list-text">オールフラッシュアレイのレイテンシが劇的に改善されるため、オールフラッシュアレイと回転式ディスクを搭載したアレイのパフォーマンスを比較することは一般的に不可能です。通常、テスト結果は意味がありません。</block>
  <block id="bc2b8b37bdda467f2ce639ab28bf4646" category="list-text">オールフラッシュアレイでピーク時のIOPSパフォーマンスを比較することは、データベースがストレージI/Oの制約を受けないため、あまり有益なテストではありません。たとえば、あるアレイが50万IOPSを維持でき、別のアレイが30万IOPSを維持できるとします。データベースの処理時間の99%がCPU処理に費やされている場合、この違いは現実の世界では無関係です。ワークロードがストレージアレイのすべての機能を利用することはありません。一方、ストレージアレイの能力を最大限に引き出すことが期待される統合プラットフォームでは、ピーク時のIOPS性能が重要になる場合があります。</block>
  <block id="0c2cbb26e6baa58b7d3a3309f95a2786" category="list-text">どのストレージテストでも、レイテンシとIOPSを常に考慮してください。市場に出回っているストレージアレイの多くは、非常に高いIOPSを謳っていますが、このレベルのIOPSはレイテンシによって役に立たなくなります。オールフラッシュアレイの一般的なターゲットは1ミリ秒です。テストの優れた方法は、可能な最大IOPSを測定することではなく、平均レイテンシが1ミリ秒を超える前にストレージアレイが維持できるIOPSを特定することです。</block>
  <block id="e6d8362588e550c19912b0f3f0e1a129" category="section-title">Oracle自動ワークロードリポジトリとベンチマーク</block>
  <block id="d035df494751722dd56d4cf4a8d1f795" category="paragraph">Oracleのパフォーマンス比較のゴールドスタンダードは、Oracle Automatic Workload Repository（AWR）レポートです。</block>
  <block id="95f7e55383674168e90b01b708bc88db" category="paragraph">AWRレポートには複数のタイプがあります。ストレージの観点から見ると、<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> コマンドは、特定のデータベースインスタンスを対象としており、レイテンシに基づいてストレージI/Oイベントを内訳表示する詳細なヒストグラムが含まれているため、最も包括的で価値があります。</block>
  <block id="7b79802e5668e6e5b990081db481505d" category="paragraph">2つのパフォーマンスアレイを比較するには、各アレイで同じワークロードを実行し、ワークロードを正確に対象とするAWRレポートを作成するのが理想的です。非常に長時間のワークロードの場合は、開始時間と停止時間を含む経過時間を含む単一のAWRレポートを使用できますが、AWRデータを複数のレポートとして分割することを推奨します。たとえば、バッチジョブが午前0時から午前6時まで実行された場合は、午前0時から午前1時、午前1時から午前2時などの1時間のAWRレポートを作成します。</block>
  <block id="e39ecb86ad7d25413ba8ad2976fd3e4a" category="paragraph">それ以外の場合は、非常に短いクエリを最適化する必要があります。最適なオプションは、クエリの開始時に作成されたAWRスナップショットと、クエリの終了時に作成された2番目のAWRスナップショットに基づくAWRレポートです。データベースサーバは、分析中のクエリのアクティビティを隠すバックグラウンドアクティビティを最小限に抑えるために、それ以外の場合は静かにしておく必要があります。</block>
  <block id="2fe7152c186ec1b5b0451e13ec8b968b" category="admonition">AWRレポートを使用できない場合は、代わりにOracle Statspackレポートを使用することを推奨します。AWRレポートとほとんど同じI/O統計情報が含まれています。</block>
  <block id="8b8c73ac7e509a897688356d1d283d75" category="section-title">Oracle AWRとトラブルシューティング</block>
  <block id="42a92c79ee82f4343e7d65f2f1cf2dd2" category="paragraph">AWRレポートは、パフォーマンスの問題を分析するための最も重要なツールでもあります。</block>
  <block id="ad5387afbab7c506c781c8b12b0a4b24" category="paragraph">ベンチマークと同様に、パフォーマンスのトラブルシューティングでは、特定のワークロードを正確に測定する必要があります。可能な場合は、パフォーマンスの問題をNetAppサポートセンターに報告するとき、または新しい解決策についてNetAppまたはパートナーアカウントチームと協力するときにAWRデータを提供してください。</block>
  <block id="6471146c0e33e2a8ec8a5c6635c837bc" category="paragraph">AWRデータを提供する場合は、次の要件を考慮してください。</block>
  <block id="5c3ba265890805919f93c246b3f8d2d6" category="list-text">を実行します<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> レポートを生成するコマンド。出力はテキストまたはHTMLのいずれかになります。</block>
  <block id="25db65f9a36910f3e488a8b7407130de" category="list-text">Oracle Real Application Clusters（RAC）を使用する場合は、クラスタ内の各インスタンスについてAWRレポートを生成します。</block>
  <block id="96d55341f8208c60720e68b3155f3aa1" category="list-text">問題が発生した特定の時間をターゲットにします。AWRレポートの最大許容経過時間は、通常1時間です。問題が複数時間続く場合、またはバッチジョブなどの複数時間の操作を伴う場合は、分析対象の期間全体をカバーする複数の1時間のAWRレポートを提供します。</block>
  <block id="4533b15b837909c68a0171d2638494d2" category="list-text">可能であれば、AWRスナップショット間隔を15分に調整します。この設定では、より詳細な分析を実行できます。これには、次の追加の実行も必要です。<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> 15分間隔ごとにレポートを作成します。</block>
  <block id="97eb6d04cc93934c1be4ab95054cd0b0" category="list-text">実行中のクエリが非常に短い場合は、操作の開始時に作成されたAWRスナップショットと、操作の終了時に作成された2つ目のAWRスナップショットに基づいてAWRレポートを提供します。それ以外の場合は、分析中の操作のアクティビティを隠すバックグラウンドアクティビティを最小限に抑えるために、データベースサーバは静かにしておく必要があります。</block>
  <block id="5186f459ce7d75e587a083bcb7c5927a" category="list-text">パフォーマンスの問題が特定の時間に報告され、他の時間には報告されない場合は、比較のために優れたパフォーマンスを示す追加のAWRデータを提供します。</block>
  <block id="108a72dad388aa310cc52ee3bac7d1cc" category="section-title">キャリブレーション_IO</block>
  <block id="f1c07dfccef6a6c47a5ccef938e10e3d" category="paragraph">。<block ref="108a72dad388aa310cc52ee3bac7d1cc" prefix=" " category="inline-code"></block> コマンドは、ストレージシステムのテスト、比較、ベンチマークには使用しないでください。Oracleのドキュメントに記載されているように、この手順はストレージのI/O機能を調整します。</block>
  <block id="872892cce56a2665ad7ceecc44b38166" category="paragraph">キャリブレーションはベンチマークと同じではありません。このコマンドの目的は、問題I/Oを使用して、データベース処理を調整し、ホストに対して実行されるI/Oのレベルを最適化することで効率を向上させることです。これは、によって実行されるI/Oのタイプが<block ref="108a72dad388aa310cc52ee3bac7d1cc" prefix=" " category="inline-code"></block> 処理が実際のデータベースユーザI/Oを表しているわけではありません。結果は予測不可能であり、再現さえできないこともよくあります。</block>
  <block id="e66807fad19acd41db50eedff918a4dd" category="section-title">SLOB2</block>
  <block id="0a6192ff5412539c31db2c7a98f408b3" category="inline-link-macro"><block ref="0a6192ff5412539c31db2c7a98f408b3" category="inline-link-rx"></block></block>
  <block id="d1f6fb23f52090ffd944dc54549735b8" category="paragraph">Silly Little Oracle BenchmarkであるSLOB2は、データベースのパフォーマンス評価に好まれるツールになりました。Kevin Clossonによって開発され、次のサイトで入手できます。 <block ref="3ccce0719b1965cd915da75778e4e706" category="inline-link-macro-rx"></block>。インストールと設定には数分かかり、実際のOracleデータベースを使用してユーザ定義の表領域にI/Oパターンを生成します。オールフラッシュアレイをI/Oで飽和状態にすることができる数少ないテストオプションの1つです。生成されるI/Oのレベルをはるかに低くして、IOPSは低くてもレイテンシの影響を受けやすいストレージワークロードをシミュレートする場合にも役立ちます。</block>
  <block id="baffd8ac40ca7b966340e7b257b4c7b4" category="section-title">スイングベンチ</block>
  <block id="905a59d6f73f4e2aea1dc232a3bcd195" category="paragraph">Swingbenchはデータベースのパフォーマンスをテストするのに役立ちますが、ストレージに負荷がかかるような方法でSwingbenchを使用することは非常に困難です。NetAppでは、Swingbenchによるテストで、AFFアレイに多大な負荷をかけるのに十分なI/Oが生成されたことはありません。一部のケースでは、Order Entry Test（OET）を使用してレイテンシの観点からストレージを評価できます。これは、データベースに特定のクエリに対する既知のレイテンシの依存関係がある場合に役立ちます。オールフラッシュアレイの潜在的なレイテンシを実現できるように、ホストとネットワークを適切に設定する必要があります。</block>
  <block id="e3cf940afa524b20b15c43b20405be77" category="section-title">HammerDB</block>
  <block id="5c9408da71d2ff7554b9fd11add795cf" category="paragraph">HammerDBは、TPC-CやTPC-Hのベンチマークなどをシミュレートするデータベーステストツールです。テストを適切に実行するために十分な大きさのデータセットを構築するには、多くの時間がかかることがありますが、OLTPアプリケーションやデータウェアハウスアプリケーションのパフォーマンスを評価するための効果的なツールになる可能性があります。</block>
  <block id="7e1ad070b7fff621d9d64a71cec87684" category="section-title">オリオン</block>
  <block id="56fedcbec2842fb62a743c5f84311597" category="paragraph">Oracle OrionツールはOracle 9で一般的に使用されていましたが、さまざまなホストオペレーティングシステムの変更に対応するためにメンテナンスが行われていません。OSやストレージ構成との互換性がないため、Oracle 10やOracle 11で使用されることはほとんどありません。</block>
  <block id="38622bf572fa7bec2dc7f3915ebd345f" category="paragraph">Oracleはこのツールを書き直し、Oracle 12cにデフォルトでインストールされます。この製品は改良され、実際のOracleデータベースと同じ呼び出しの多くを使用しますが、コードパスやI/O動作はOracleで使用されているものとまったく同じではありません。たとえば、ほとんどのOracle I/Oは同期的に実行されます。つまり、I/O処理はフォアグラウンドで完了するため、I/Oが完了するまでデータベースは停止します。ストレージシステムをランダムI/Oでフラッディングするだけでは、実際のOracle I/Oが再現されるわけではなく、ストレージアレイを比較したり、構成変更の影響を測定したりする直接的な方法もありません。</block>
  <block id="bb68dfada5ca20e256bbd3ffbbfab9e6" category="paragraph">とはいえ、特定のホスト/ネットワーク/ストレージ構成の最大パフォーマンスの一般的な測定や、ストレージシステムの健全性の測定など、Orionのユースケースもあります。綿密なテストを実施すれば、Orionの使用可能なテストを考案して、ストレージアレイを比較したり、構成変更の影響を評価したりすることができます。ただし、パラメータにIOPS、スループット、レイテンシを考慮し、現実的なワークロードを忠実にレプリケートしようとする必要があります。</block>
  <block id="6b64090d226d30776368e89b08c7c71b" category="summary">Oracleデータベースに対するWAFLのアライメント</block>
  <block id="03a35ba2b6191f8cfbd1cca378eefc91" category="doc">OracleデータベースのWAFLアライメント検証</block>
  <block id="219900dcd21cee2f958254a708ad36f6" category="paragraph">優れたパフォーマンスを実現するには、WAFLを正しくアライメントすることが重要です。ONTAPはブロックを4KB単位で管理しますが、すべての処理がONTAPで4KB単位で実行されるわけではありません。実際、ONTAPはさまざまなサイズのブロック処理に対応しますが、基盤となる計算処理はWAFLによって4KB単位で管理されます。</block>
  <block id="5d3a5c290e14d74acf49b20d15120886" category="paragraph">「アライメント」という用語は、Oracle I/Oがこれらの4KBユニットにどのように対応するかを意味します。パフォーマンスを最適化するには、ドライブ上の2つの4KB WAFL物理ブロックにOracleの8KBブロックが配置されている必要があります。1つのブロックが2KBずれて配置されると、このブロックは1つの4KBブロックの半分、別の4KBブロック全体、3つ目の4KBブロックの半分に配置されます。このように配置すると、パフォーマンスが低下します。</block>
  <block id="0073ce99d632b066d5ac09a4ad0cf7fc" category="paragraph">NASファイルシステムでは、アライメントは問題になりません。Oracleデータファイルは、Oracleブロックのサイズに基づいてファイルの先頭にアライメントされます。したがって、8KB、16KB、32KBのブロックサイズは常にアライメントされます。すべてのブロック処理は、ファイルの先頭から4KB単位でオフセットされます。</block>
  <block id="d7f7edd61ab216efc34578584a7d0e7c" category="paragraph">一方、LUNの開始位置には何らかのドライバヘッダーやファイルシステムのメタデータが含まれているため、オフセットが作成されます。最新のOSでは、アライメントが問題になることはほとんどありません。最新のOSは、標準の4KBセクターを使用する物理ドライブ向けに設計されており、パフォーマンスを最適化するためにI/Oを4KBの境界にアライメントする必要があるためです。</block>
  <block id="38b3d1cd67903560954ad297a92e3de1" category="paragraph">ただし、いくつかの例外があります。4KB I/O用に最適化されていない古いOSからデータベースが移行された場合や、パーティション作成時のユーザエラーによって4KB単位以外のオフセットが発生した場合があります。</block>
  <block id="612eeadd26ceeace7b043d37f8e24b1f" category="paragraph">以下はLinux固有の例ですが、手順はどのOSにも適用できます。</block>
  <block id="1d5b772bea21e5e949413e09eedf17de" category="section-title">アライメント済み</block>
  <block id="594b0fc1af44897ff4b26f2e6b866685" category="paragraph">次の例は、パーティションが1つの単一のLUNでアライメントチェックを示しています。</block>
  <block id="dc2c18402c86861702fc1d94a6495ac3" category="paragraph">まず、ドライブで使用可能なすべてのパーティションを使用するパーティションを作成します。</block>
  <block id="adff8cc6319e96d2685fd082a5aa043c" category="paragraph">アライメントは、次のコマンドを使用して数学的にチェックできます。</block>
  <block id="4bc7aba328a710bb7d0935cf830634aa" category="paragraph">出力は、単位が512バイトで、パーティションの開始が32ユニットであることを示しています。これは32 x 512 = 16、834バイトで、これは4KBのWAFLブロックの倍数です。このパーティションは正しくアライメントされています。</block>
  <block id="dd343941469b5360af52eb1b94fe5de6" category="paragraph">アライメントが正しいことを確認するには、次の手順を実行します。</block>
  <block id="7d84e72acd05d0c93d99e414f5b092b5" category="list-text">LUNのUniversally Unique Identifier（UUID）を特定します。</block>
  <block id="92af2a93f00a6297c490ba0be5fd7a8a" category="list-text">ONTAPコントローラでノードシェルを開始します。</block>
  <block id="5274579d5eff6fe6d1e8ecbf54e84993" category="list-text">最初の手順で特定したターゲットUUIDで統計収集を開始します。</block>
  <block id="52df0a2ea976123bf02330300b2392e3" category="list-text">I/Oを実行します。次のツールを使用することが重要です。<block ref="3c908d68ba53922b92c5595b72fa011c" prefix=" " category="inline-code"></block> I/Oが同期でバッファされていないことを確認する引数。</block>
  <block id="fac8a5b490ea29eca93ec213d79e6ff2" category="admonition">このコマンドには十分注意してください。の反転<block ref="39c8942e1038872a822c0dc75eedbde3" prefix=" " category="inline-code"></block> および<block ref="8bf8854bebe108183caeb845c7676ae4" prefix=" " category="inline-code"></block> 引数はデータを破棄します。</block>
  <block id="4f7dce34a21e3de727f3e3ad05e6e7d8" category="list-text">統計を停止し、アライメントのヒストグラムを表示します。すべてのI/Oが<block ref="c6bd178b372b0ddd17fff48819badc6a" prefix=" " category="inline-code"></block> Bucket。4KBのブロック境界にアライメントされたI/Oを示します。</block>
  <block id="5df81374c01d1b7c20fe8cb3883117eb" category="section-title">ミスアライメント状態です</block>
  <block id="5ff266dadf965b3c304513f516a13c12" category="paragraph">次の例は、ミスアライメントI/Oを示しています。</block>
  <block id="25be03b87e6a5d8170ce85b16ea506ab" category="list-text">4KBの境界にアライメントされないパーティションを作成します。最新のOSでは、これはデフォルトの動作ではありません。</block>
  <block id="9879c10d67b41984cae0992340d157f0" category="list-text">パーティションは、デフォルトの32ではなく33セクターオフセットで作成されています。で説明されている手順を繰り返します。 <block ref="9eef0931337736367767200cf12a7482" category="inline-link-macro-rx"></block>。ヒストグラムは次のように表示されます。</block>
  <block id="4adda0e871000c2b13a4faef6ce4e21b" category="paragraph">ミスアライメントは明らかです。I/Oの大部分は* <block ref="66c8d76cad709856ccec680cab8ab35a" prefix="*" category="inline-code"></block> バケット。想定されるオフセットに一致します。パーティションが作成されたときに、最適化されたデフォルトよりも512バイト先のデバイスに移動されました。これは、ヒストグラムが512バイトオフセットされることを意味します。</block>
  <block id="b53cb977228ac351c16dfacc3c427a99" category="paragraph">また、も参照してください<block ref="20e637b3ddd562732de038fba736c7ee" prefix=" " category="inline-code"></block> 統計がゼロ以外の場合は、実行されたI/Oが4KBブロック全体を一杯にしなかったことを意味します。</block>
  <block id="d3d92f87c5235ad11c8bc69e85fb2fd0" category="section-title">Redoロギング</block>
  <block id="162b54d51a30629d78e153f8da201780" category="paragraph">ここで説明する手順はデータファイルに適用できます。OracleのREDOログとアーカイブログでは、I/Oパターンが異なります。たとえば、Redoロギングでは、単一ファイルを繰り返し上書きします。デフォルトの512バイトのブロックサイズを使用する場合、書き込み統計は次のようになります。</block>
  <block id="d36dbaa617441d3308f5a9b50cb6f5ca" category="paragraph">I/Oはすべてのヒストグラムバケットに分散されますが、これはパフォーマンス上の問題ではありません。ただし、4KBのブロックサイズを使用すると、Redoロギング率が非常に高くなる場合があります。この場合は、RedoロギングLUNが適切にアライメントされていることを確認することを推奨します。ただし、これは優れたパフォーマンスにとってデータファイルのアライメントほど重要ではありません。</block>
  <block id="f64f1c647516f5a47c00be152fdbf488" category="summary">Oracleロックと古いNFSv3ロック</block>
  <block id="91d9710c9fee248ae3e9c4b810ae704f" category="doc">古いNFSv3ロックとOracleデータベース</block>
  <block id="3f9e1e3abd12ad7445baea4b681b9ceb" category="paragraph">Oracleデータベースサーバがクラッシュすると、再起動時に古いNFSロックで問題が発生する可能性があります。この問題は、サーバの名前解決を注意深く設定することで回避できます。</block>
  <block id="288ebefc25180862eb0448b786b1b9fc" category="paragraph">この問題は、ロックの作成とロックの解除で使用される名前解決方法がわずかに異なるために発生します。Network Lock Manager（NLM；ネットワークロックマネージャ）とNFSクライアントの2つのプロセスが関係しています。NLMでは、<block ref="e5caaf154dfeed411b9eec65b903a22a" prefix=" " category="inline-code"></block> ホスト名を確認するには、<block ref="d49331f31f40041ebcee19fca74fd9d4" prefix=" " category="inline-code"></block> プロセスの用途<block ref="330c4316ae6124616389eb1ca9912f7a" prefix=" " category="inline-code"></block>。OSが古いロックを適切に解除するには、これらのホスト名が一致している必要があります。たとえば、ホストで所有されているロックが検索されているとします。<block ref="c7169a6dd344d0f0a38071a1262e4973" prefix=" " category="inline-code"></block>が、ロックはホストによって次のように登録されています。<block ref="0c32c65f5ac66d0bdb4e63bd5fde7f75" prefix=" " category="inline-code"></block>。状況<block ref="330c4316ae6124616389eb1ca9912f7a" prefix=" " category="inline-code"></block> と同じ値を返さない<block ref="5c020b5bb8d1ce1ace51c2a2f4c06fc2" prefix=" " category="inline-code"></block>をクリックすると、ロック解除プロセスが成功しませんでした。</block>
  <block id="19b9a1f540971d74c69042125bab2abc" category="paragraph">次のサンプルスクリプトは、名前解決が完全に一貫しているかどうかを検証します。</block>
  <block id="ee04b3fa3b28391874763596275e09c9" category="paragraph">状況<block ref="b64c6f211add16fd66ac17ef14c2a2b4" prefix=" " category="inline-code"></block> 一致しません<block ref="4040592cec1880aa70936989f05e7c31" prefix=" " category="inline-code"></block>古いロックが使用されている可能性があります。たとえば、次の結果は潜在的な問題を示しています。</block>
  <block id="2b500e5914ea5a219ade17dea0808f51" category="paragraph">解決策は通常、に表示されるホストの順序を変更することによって検出されます。<block ref="ad942c725cd0cae65ca4c63717ec464c" prefix=" " category="inline-code"></block>。たとえば、hostsファイルに次のエントリが含まれているとします。</block>
  <block id="22b58ec1cec48707dfc018e6e216e966" category="paragraph">この問題を解決するには、完全修飾ドメイン名と短いホスト名の表示順序を変更します。</block>
  <block id="e357ccd0745db58f22ea5c0947b613ee" category="paragraph"><block ref="330c4316ae6124616389eb1ca9912f7a" prefix="" category="inline-code"></block> では、shortを返します。<block ref="c7169a6dd344d0f0a38071a1262e4973" prefix=" " category="inline-code"></block> ホスト名（の出力に一致）<block ref="4040592cec1880aa70936989f05e7c31" prefix=" " category="inline-code"></block>。したがって、ロックはサーバクラッシュ後に自動的にクリアされます。</block>
  <block id="547b870352d8464aadbe7bee63d6f3d1" category="summary">データベース仮想化の概要</block>
  <block id="ea4c55be196897a16d86999f5c16d582" category="doc">仮想化</block>
  <block id="4a478889a2e46bee771126a78eda2911" category="paragraph">VMware ESX、Oracle OVM、KVMを使用したデータベースの仮想化は、最もミッションクリティカルなデータベースでさえ仮想化を選択したNetAppのお客様にとって、ますます一般的な選択肢となっています。</block>
  <block id="0f976e587b1e7af0949904e76d91384b" category="paragraph">仮想化のサポートポリシー、特にVMware製品については、多くの誤解が存在します。実際、Oracleが仮想化をサポートしていないという話は珍しくありません。この概念は正しくないため、仮想化の機会を逃してしまいます。Oracle Doc ID 249212.1では、Oracle環境の既知の問題について説明し、RACのサポートも指定しています。</block>
  <block id="02ea3d7754e6bc1c99ff77393e49e373" category="paragraph">Oracleが把握していない問題を抱えているお客様は、物理ハードウェアで問題を再現するように依頼されることがあります。最新バージョンの製品を使用しているOracleのお客様は、新しいバグが発見される可能性があるため、仮想化の使用を望まないかもしれません。ただし、一般提供されている製品バージョンを使用している仮想化環境では、このような状況は実際には問題になりませんでした。</block>
  <block id="9e28dbd7a4f5940eeaf6d3893c5c4b1f" category="section-title">ストレージ提供</block>
  <block id="8fdbc6d55014a06c15b9f130e5bedd12" category="paragraph">データベースの仮想化を検討しているお客様は、ビジネスニーズに基づいてストレージに関する意思決定を行う必要があります。これはすべてのIT意思決定に一般的に当てはまりますが、プロジェクトの規模と範囲が大きく異なるため、仮想化にとって特に重要です。</block>
  <block id="6cf53ad2948792abdf4a8668365b8396" category="paragraph">ストレージプレゼンテーションには、次の4つの基本的なオプションがあります。</block>
  <block id="151ae53a4100e0a6e83bde4d78083f81" category="list-text">iSCSI LUNをハイパーバイザーではなくVMのiSCSIイニシエータで管理</block>
  <block id="73014dc1e7381cfd107ba79742a873e3" category="list-text">NFSファイルシステムを、仮想マシンディスク（VMDK）ではなくVMでマウントする</block>
  <block id="810f0004f0e8e215c676ac0621d5836b" category="list-text">ハイパーバイザーデータストア</block>
  <block id="8e2a0eba3eaebd64066d020ab225dd78" category="paragraph">一般的なルールとして、Oracleファイルにデータストアを使用することは避けてください。この推奨事項には多くの理由があります。</block>
  <block id="98b171e836c6656f9cf88835666c6345" category="list-text">*透過性。* VMが自身のファイルシステムを所有している場合、データベース管理者やシステム管理者は、データのファイルシステムのソースを簡単に特定できます。</block>
  <block id="ec6a3b593d5584a2e15651852e384082" category="list-text">*パフォーマンス。*テストでは、ハイパーバイザーデータストアを介してすべてのI/Oをチャネリングすることでパフォーマンスに影響があることが示されています。</block>
  <block id="47464ddf615c138c6c06d3bfea555b2d" category="list-text">*管理性。* VMが自身のファイルシステムを所有している場合、ハイパーバイザーレイヤを使用するかどうかは管理性に影響します。プロビジョニング、監視、データ保護などの手順は、仮想環境と非仮想環境の両方を含め、資産全体で同じです。</block>
  <block id="3d04d7019fbc0d27880dcc5c0881f87b" category="list-text">*安定性とトラブルシューティング。* VMが自身のファイルシステムを所有している場合、ストレージスタック全体がVM上に存在するため、優れた安定したパフォーマンスが提供され、問題のトラブルシューティングがはるかに簡単になります。ハイパーバイザーの役割は、FCフレームまたはIPフレームを転送することだけです。構成にデータストアが含まれていると、タイムアウト、パラメータ、ログファイル、および潜在的なバグが新たに発生するため、構成が複雑になります。</block>
  <block id="36f9cea3dc0f65698a9fbe15460591c1" category="list-text">*モビリティ。* VMが自身のファイルシステムを所有している場合、Oracle環境を移動するプロセスははるかにシンプルになります。ファイルシステムは、仮想ゲストと非仮想ゲストの間で簡単に移動できます。</block>
  <block id="cb90f9e52412940f028394174f31ec2f" category="list-text">*ベンダーロックイン。*データをデータストアに配置した後は、別のハイパーバイザーを使用したり、仮想環境からデータを取り出すことは完全に非常に困難になります。</block>
  <block id="4308dde96d1bdae6ac436a611c834331" category="list-text">*スナップショットの有効化。*帯域幅が比較的限られているため、場合によっては、仮想環境でのバックアップが問題になることがあります。たとえば、多くの仮想データベースで日 々 必要とされるパフォーマンスを満たすには、4ポートの10GbEトランクで十分な場合があります。ただし、RMANなどのバックアップ製品を使用してバックアップを実行するには、このようなトランクでは不十分であり、データのフルサイズのコピーをストリーミングする必要があります。</block>
  <block id="872c95c8713fd14a0bef21fe92a55ab7" category="paragraph">VM所有のファイルシステムを使用すると、Snapshotベースのバックアップとリストアを簡単に活用できます。VM所有のファイルシステムを使用すると、ストレージシステムにバックアップ処理がオフロードされます。バックアップウィンドウで帯域幅とCPUの要件をサポートするためだけに、ハイパーバイザー構成を過剰に構築する必要はありません。</block>
  <block id="3522f960cdbaf08c375bd70214f8db2f" category="admonition">* NetAppでは、最適なパフォーマンスと管理性を実現するために、Oracleデータをデータストアに配置しないことを推奨しています。ゲスト所有のファイルシステム（ゲストまたはRDMで管理されるNFSまたはiSCSIファイルシステムなど）を使用します。</block>
  <block id="f114856edc6cd8d6a9add5ec3f67656f" category="section-title">準仮想化ドライバ</block>
  <block id="beeb10ceee6c9aabe178fb51edea7d22" category="paragraph">最適なパフォーマンスを実現するには、準仮想化ネットワークドライバを使用することが重要です。データストアを使用する場合は、準仮想化SCSIドライバが必要です。準仮想化デバイスドライバを使用すると、エミュレートされたドライバとは対照的に、ゲストをハイパーバイザーにより深く統合できます。エミュレートされたドライバでは、ハイパーバイザーは物理ハードウェアの動作を模倣するためにより多くのCPU時間を消費します。</block>
  <block id="59b3d62404749c3e899b7e4c9ee10146" category="paragraph">ほとんどのデータベースのパフォーマンスは、ストレージによって制限されます。そのため、ネットワークまたはSCSIドライバによって発生する余分な遅延が特に顕著になります。NetAppカスタマサポートでは、準仮想化ドライバをインストールすることで解決された、パフォーマンスに関する多くの苦情が発生しています。あるお客様のコンセプトの実証（POC）では、同じハードウェアをベアメタルとして実行した場合よりも、ESXを使用した場合の方がデータベースのパフォーマンスが向上しました。テストではI/O負荷が非常に高く、パフォーマンスの違いはESX準仮想化ネットワークドライバを使用したことによるものです。</block>
  <block id="4e27b04a271416c5701a99234f8a23e6" category="admonition">* NetAppでは、常に準仮想化ネットワークドライバとSCSIドライバを使用することを推奨しています。</block>
  <block id="7c5996fc15a24ce96b30160b60ac2b96" category="section-title">RAMのオーバーコミット</block>
  <block id="5bccdd812c4af1cb5b9e36ddce656b60" category="paragraph">RAMのオーバーコミットとは、物理ハードウェア上に存在するよりも多くの仮想RAMをさまざまなホストに設定することを意味します。原因で予期しないパフォーマンスの問題が発生する可能性があります。データベースを仮想化する場合、Oracle SGAの基盤となるブロックがハイパーバイザーによってストレージにスワップアウトされないようにする必要があります。このように設定すると、パフォーマンスが非常に不安定になります。</block>
  <block id="31db92967e891f0a122e0329d819842e" category="admonition">* NetAppでは、Oracle SGAブロックがスワップアウトされるような方法でハイパーバイザーを設定しないことを推奨しています*。</block>
  <block id="be493f1fc0b02ae45602c7c13f7b5dc7" category="summary">TR-4792では、NVIDIAのグラフィック処理ユニット（GPU）と仮想化ソフトウェアを搭載したVMware Horizon環境で、3DグラフィックスワークロードにNetApp HCI 615Cを使用するためのガイダンスを提供しています。</block>
  <block id="ff1d278a485c443dc5d8fc9f10f1a702" category="doc">NetApp HCI for virtual desktop infrastructure with VMware Horizon 7 -パワーユーザを3Dグラフィックスで支援します</block>
  <block id="e3162938e0d7b1bbc74111cc5b5871c5" category="paragraph">TR-4792では、NVIDIAのグラフィック処理ユニット（GPU）と仮想化ソフトウェアを搭載したVMware Horizon環境で、3DグラフィックスワークロードにNetApp H615Cコンピューティングノードを使用する方法について説明しています。また、H615Cに対するSPECviewperf 13の予備テストの結果も記載します。</block>
  <block id="1de37c09602b46db5de57a946efe2768" category="paragraph"><block ref="1de37c09602b46db5de57a946efe2768" category="inline-link-macro-rx"></block></block>
  <block id="5ed492cbbbf7e6d167035a7c10478daa" category="summary">NetApp HCI を使用したVMwareエンドユーザコンピューティングは、仮想デスクトップワークロードをエンタープライズ規模で導入するための、事前検証済みのベストプラクティスデータセンターアーキテクチャです。</block>
  <block id="36f00397200c227ebfe56599e7bafcd5" category="doc">NVA-1129-DESIGN：NetApp HCI とNVIDIA GPUを使用したVMwareエンドユーザコンピューティング</block>
  <block id="52940073ac3f539b3c6d9ac1e41d5f06" category="paragraph">NetApp HCI を使用したVMwareエンドユーザコンピューティングは、仮想デスクトップワークロードをエンタープライズ規模で導入するための、事前検証済みのベストプラクティスデータセンターアーキテクチャです。本ドキュメントでは、信頼性が高くリスクのない方法で本番環境に解決策 を導入するためのアーキテクチャ設計とベストプラクティスについて説明します。</block>
  <block id="8a36e2f35bf4a10959caf61f15d8df63" category="paragraph"><block ref="8a36e2f35bf4a10959caf61f15d8df63" category="inline-link-macro-rx"></block></block>
  <block id="b4a3c2c985fcfc0d0e59c8d9c3259eb0" category="doc">NVA-1129 - deploy：NetApp HCI とNVIDIA GPUを使用したVMwareエンドユーザコンピューティング</block>
  <block id="8b3f1e47da9509d2edf2f21012c6ec7e" category="paragraph">NetApp HCI を使用したVMwareエンドユーザコンピューティングは、仮想デスクトップワークロードをエンタープライズ規模で導入するための、事前に検証されたベストプラクティスのデータセンターアーキテクチャです。このドキュメントでは、信頼性の高いリスクのない方法で、本番環境の規模で解決策 を導入する方法について説明します</block>
  <block id="ba999af3664a8f6c5b43a92bc11de64a" category="paragraph"><block ref="ba999af3664a8f6c5b43a92bc11de64a" category="inline-link-macro-rx"></block></block>
  <block id="85864e2699dfaceb7f8d1f85448939fe" category="doc">NVA-1132-DESIGN：NetApp HCI を使用したVMwareのエンドユーザコンピューティング</block>
  <block id="8c40c45c2332a47a83ae257f42af2331" category="paragraph"><block ref="8c40c45c2332a47a83ae257f42af2331" category="inline-link-macro-rx"></block></block>
  <block id="93b94e62ad8cb02a1d1a7b0944a5445d" category="summary">このドキュメントでは、 VMware vSphere 向け ONTAP ツールの製品セキュリティについて説明します。</block>
  <block id="57a033c33a8be6110be46b2914cc4989" category="doc">ONTAP でVVOLを使用する</block>
  <block id="69556d50c944e0a07ade0bea62f078a3" category="paragraph">VVOLをONTAP で使用するための鍵は、ONTAP Tools for VMware vSphere仮想アプライアンスに含まれているVASA Providerソフトウェアです。</block>
  <block id="5e484430124a3d64541b75bbf3c8f529" category="paragraph">ONTAP ツールには、vCenter UI拡張機能、REST APIサーバ、Storage Replication Adapter for VMware Site Recovery Manager、Monitoring and Host構成ツール、VMware環境の管理に役立つ一連のレポートも含まれています。</block>
  <block id="21247c4392dc3c243f693dbf5b762553" category="section-title">製品およびドキュメント</block>
  <block id="4fc5e15c4dc0d227bc5f8f26e4337083" category="paragraph">ネットアップONTAP でVVOLを使用するために必要な追加製品は、ONTAP FlexCloneライセンス（ONTAP Oneに付属）とONTAP toolsアプライアンスだけです。最近リリースされたONTAP toolsは、ESXi上で動作する単一の統合アプライアンスとして提供され、これまで3種類のアプライアンスとサーバの機能を提供します。VVOLの場合、vSphereのONTAP 機能の一般的な管理ツールおよびユーザインターフェイスとして、ONTAP toolsのvCenter UI拡張機能またはREST APIを、特定のVVOL機能を提供するVASA Providerとともに使用することが重要です。SRAコンポーネントは従来のデータストアに含まれていますが、VMware Site Recovery ManagerはvVolにSRAを使用せず、代わりにvVolレプリケーションにVASAプロバイダを利用する新しいサービスをSRM 8.3以降に実装します。</block>
  <block id="bf03408d75f93f6e28c07c3c2300b98a" category="section-title">iSCSIまたはFCPを使用する場合のONTAP tools VASA Providerのアーキテクチャ</block>
  <block id="94ef809dc16e728151bda996f8b4f8aa" category="inline-image-macro">ONTAP tools VASA Providerのアーキテクチャ、240</block>
  <block id="d78de3410d86d345a548abdf67aff375" category="paragraph"><block ref="d78de3410d86d345a548abdf67aff375" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5e5421e75636200787a4449a2cdaa1f1" category="section-title">製品のインストール</block>
  <block id="3ef3033a2b9a744a1e4e7e93fa01f909" category="paragraph">新規インストールの場合は、仮想アプライアンスをvSphere環境に導入します。現在のリリースのONTAP toolsは自動的にvCenterに登録され、VASA Providerがデフォルトで有効になります。ESXiホストとvCenter Serverの情報に加えて、アプライアンスのIPアドレス設定の詳細も必要です。前述したように、VVOLに使用するすべてのONTAP クラスタには、ONTAP FlexCloneライセンスがあらかじめインストールされている必要があります。アプライアンスには可用性を確保するためのwatchdogが組み込まれています。ベストプラクティスとして、VMwareの高可用性機能とオプションのフォールトトレランス機能を使用して設定する必要があります。詳細については、セクション4.1を参照してください。ONTAP toolsアプライアンスまたはvCenter Serverアプライアンス（vCSA）をvVolストレージにインストールしたり移動したりしないでください。アプライアンスが再起動しない可能性があります。</block>
  <block id="6a5c862f634c8967f7246f42eb9de6e1" category="paragraph">ONTAP ツールのインプレースアップグレードは、NetApp Support Site （NSS）からダウンロードできるアップグレードISOファイルを使用してサポートされます。導入およびセットアップガイドの手順に従って、アプライアンスをアップグレードします。</block>
  <block id="3c07c9b4b562a16890d9fee571f0441e" category="inline-link">『Sizing Guide for ONTAP tools for VMware vSphere』を参照してください</block>
  <block id="e4e51979718d88ce483f9477be981a76" category="paragraph">仮想アプライアンスのサイジングと構成の制限については、次のナレッジベースの記事を参照してください。<block ref="a75738ed95b0811ed0edd1b8ef0d9568" category="inline-link-rx"></block></block>
  <block id="72333dadacbc964761fb14f718f6d411" category="section-title">製品ドキュメント</block>
  <block id="e0644c46fdc2ced2c094f7db15e15a8a" category="paragraph">ONTAP ツールの導入に役立つ次のドキュメントを参照してください。</block>
  <block id="09e308ed60d47b80b6cd16eb233f1bb9" category="inline-link">完全なドキュメントリポジトリについては、次のリンクを参照してください。docs.netapp.com</block>
  <block id="7f21741a70426baea3ee41488da86af4" category="paragraph"><block ref="56b49132b20e341764c8aa067751e8a5" category="inline-link-rx"></block></block>
  <block id="be11c74c1dd7f307bb80183a90dc2067" category="section-title">はじめに</block>
  <block id="7d0ee6fed10d3d4e5c9ee496729ab519" category="inline-link">リリースノート</block>
  <block id="2645deadffb8af180b8a35da3d034ad8" category="list-text"><block ref="2645deadffb8af180b8a35da3d034ad8" category="inline-link-rx"></block></block>
  <block id="b1555cd6358e57b76c72e343dbe31846" category="inline-link">ONTAP Tools for VMware vSphereについて説明します</block>
  <block id="a0aaeda90fe2ef02fba791bc7c35645c" category="list-text"><block ref="a0aaeda90fe2ef02fba791bc7c35645c" category="inline-link-rx"></block></block>
  <block id="e695b432b77d6bddfcb785c76f5e5442" category="inline-link">ONTAP ツールクイックスタート</block>
  <block id="324b0410f22fb210bbf88e1ee7e97428" category="list-text"><block ref="324b0410f22fb210bbf88e1ee7e97428" category="inline-link-rx"></block></block>
  <block id="3d7fe3e43f9f24fffe5ed0d546d12f13" category="inline-link">ONTAP ツールを導入</block>
  <block id="354336d78d1f0a156dcd5221d341dfd0" category="list-text"><block ref="354336d78d1f0a156dcd5221d341dfd0" category="inline-link-rx"></block></block>
  <block id="a2fa58344be7fbd9a2be0320a8df0f77" category="inline-link">ONTAP ツールをアップグレードする</block>
  <block id="33a77e1014f1325d6ba19639a6c95d48" category="list-text"><block ref="33a77e1014f1325d6ba19639a6c95d48" category="inline-link-rx"></block></block>
  <block id="21e2a89d708329706ec6ed3fc989a1f6" category="section-title">ONTAP ツールを使用する</block>
  <block id="91a9cfdbaaa44e0a9ad72e92533f763f" category="inline-link">従来のデータストアをプロビジョニングする</block>
  <block id="f27fe8f858d8a91950e214753b95722c" category="list-text"><block ref="f27fe8f858d8a91950e214753b95722c" category="inline-link-rx"></block></block>
  <block id="fc7d7e475ac8c3868d7426bb41df9b09" category="inline-link">vVol データストアをプロビジョニングする</block>
  <block id="0c2552c3930f472b2d120f30d7aa0415" category="list-text"><block ref="0c2552c3930f472b2d120f30d7aa0415" category="inline-link-rx"></block></block>
  <block id="317bbf73ff27c5f981628c8fb83ebf22" category="inline-link">ロールベースアクセス制御を設定する</block>
  <block id="644ae78061acbb2254be4de3ea454b06" category="list-text"><block ref="644ae78061acbb2254be4de3ea454b06" category="inline-link-rx"></block></block>
  <block id="48bc2d028cb2a507ef974230ca3ba793" category="inline-link">リモート診断を設定します</block>
  <block id="fc0330812838aba14025bd70d41b943d" category="list-text"><block ref="fc0330812838aba14025bd70d41b943d" category="inline-link-rx"></block></block>
  <block id="641e9457539249e880725760f91d5ee2" category="inline-link">ハイアベイラビリティを設定する</block>
  <block id="5027a18a60c68e05df84cd699af74497" category="list-text"><block ref="5027a18a60c68e05df84cd699af74497" category="inline-link-rx"></block></block>
  <block id="04edeb5424c826c14a69edb777edf395" category="section-title">データストアの保護と管理</block>
  <block id="e17534281670c5ea4e8d55420a63c98f" category="inline-link">従来のデータストアを保護</block>
  <block id="c8ac931d575d89c007212a35c8dde74c" category="list-text"><block ref="8f91d2113ff32de18906bad1cd446b0d" category="inline-link-rx"></block> SRMを使用</block>
  <block id="bff05cbbc19cad2bd10b9fe25dc34a1b" category="inline-link">VVOLベースの仮想マシンを保護</block>
  <block id="710b15d782f0c2c0411066b86644a12d" category="list-text"><block ref="7741c74d7508dc983fa4af0dff0bdda1" category="inline-link-rx"></block> SRMを使用</block>
  <block id="5267febc97a2cc385cc5c73995dc64df" category="inline-link">従来のデータストアと仮想マシンを監視する</block>
  <block id="bac3b262bb348a54f9986c2b5dbf6024" category="list-text"><block ref="bac3b262bb348a54f9986c2b5dbf6024" category="inline-link-rx"></block></block>
  <block id="3123ece3c3b36f605758cb0c9a28f904" category="inline-link">VVol データストアと仮想マシンを監視する</block>
  <block id="75c07b623699e1947d011983a7823584" category="list-text"><block ref="75c07b623699e1947d011983a7823584" category="inline-link-rx"></block></block>
  <block id="73751ced5959ea3089346b01d42dde76" category="paragraph">製品ドキュメント以外にも、役立つサポート技術情報アーティクルがあります。</block>
  <block id="23bd7442fd1cd75655289cc3a38dd825" category="inline-link">VASA Providerのディザスタリカバリの実行方法</block>
  <block id="a2dd1381618efc2cd3834a883a0d779d" category="list-text"><block ref="a2dd1381618efc2cd3834a883a0d779d" category="inline-link-rx"></block></block>
  <block id="dd5138e8a4207a5b2fde43b411a4b5e1" category="section-title">VASA Providerダッシュボード</block>
  <block id="6da01a643ea28efe37fa2d6fd06a634b" category="paragraph">VASA Providerには、個 々 のvVol VMのパフォーマンスと容量の情報が表示されたダッシュボードがあります。この情報は、VVOLファイルおよびLUNのONTAP から直接取得されます。上位5つのVMのレイテンシ、IOPS、スループット、アップタイム、上位5つのデータストアのレイテンシとIOPSなどが含まれます。ONTAP 9.7以降を使用している場合はデフォルトで有効になります。初期データが取得されてダッシュボードに表示されるまで、最大で30分かかることがあります。</block>
  <block id="9b78e1fecb2bcc40733f2180691c7507" category="section-title">ONTAP tools vVolダッシュボード</block>
  <block id="4adf016da96258b45a1cf762298729b5" category="inline-image-macro">ONTAP tools vVolダッシュボード、400</block>
  <block id="73c1e14ddf3f32984f869ac3f122b2ca" category="paragraph"><block ref="73c1e14ddf3f32984f869ac3f122b2ca" category="inline-image-macro-rx" type="image"></block></block>
  <block id="cd47dd01745339787e4c7300389401f2" category="section-title">ベストプラクティス</block>
  <block id="72e0ee397942f7233122887584f94b8b" category="paragraph">vSphereでONTAP vVolを使用するのは簡単で、公開されているvSphereのメソッドに従います（使用しているバージョンのESXiに対応するVMwareのドキュメントの「vSphere Storage」の「Working with Virtual Volumes」を参照してください）。ここでは、ONTAP と併せて考慮すべき追加のプラクティスをいくつか紹介します。</block>
  <block id="9ae938622297e9d4b14dd0006a8f0bf4" category="paragraph">*制限*</block>
  <block id="b4f52a4fd0b07c9d904b95fc98a1cd45" category="inline-link">構成の最大値</block>
  <block id="bc8259e306c73b2969e7ac6297000e64" category="paragraph">一般に、ONTAP でサポートされるVVOLの制限は、VMwareで定義されています（公開されているを参照）<block ref="a6efdd9b1a19df6105024b4869e0582b" category="inline-link-rx"></block>）。次の表は、ONTAP 固有のVVOLのサイズと数の制限をまとめたものです。必ずをチェックしてください<block ref="bb9c67b5a4c15a85b5e6aa6c9afd0285" category="inline-link-rx"></block> LUNとファイルの数とサイズの制限を更新</block>
  <block id="9b7ad553354519b31ec860eef39e5f6b" category="paragraph">* ONTAP vVolの制限*</block>
  <block id="130b78bfd6c9b050a912fec77e285e3f" category="cell">容量 / 機能</block>
  <block id="6231ad61105cd983d3f0042762d3233d" category="cell">SAN（SCSIまたはNVMe-oF）</block>
  <block id="75d4e7871261a858356a58d682ab71de" category="cell">vVolの最大サイズ</block>
  <block id="9cfd7100738cee4daf7acd5e01d31e14" category="cell">62TiB *</block>
  <block id="9a728251ad1e90577975ae9395374772" category="cell">FlexVol あたりの最大VVol数</block>
  <block id="021bbc7ee20b71134d53e20206bd6feb" category="cell">一、〇 二四</block>
  <block id="46ba990c143630f55072434a6ea958c0" category="cell">20億です</block>
  <block id="cdbcf58620f0b4b0bbf3291386a99407" category="cell">ONTAP ノードあたりの最大VVol数</block>
  <block id="342264031889898ec1a553b4dd58d98c" category="cell">最大12,288 **</block>
  <block id="659e5faa0bdb08327ba0719230e95be2" category="cell">500億です</block>
  <block id="43b49f27d93c6f55f54a68e8983d5479" category="cell">ONTAP ペアあたりの最大VVol数</block>
  <block id="3941694d19c2d1fc406f055ab62cb9eb" category="cell">最大24,576 **</block>
  <block id="d6b3e65f296fd23975dd6f1a915c4b22" category="cell">ONTAP クラスタあたりの最大VVol数</block>
  <block id="2702ff8627a3990fc940d6f53463925e" category="cell">最大98,304 **</block>
  <block id="4f0c25d6c688cf50460d11fecaa97fa8" category="cell">特定のクラスタ制限はありません</block>
  <block id="855ecc47bb0d239e1fdf6fee84e24c75" category="cell">最大QoSオブジェクト（共有ポリシーグループと個 々 のvVolサービスレベル）</block>
  <block id="26890bd9dcb27c05f1ab5bcc859501b8" category="cell">ONTAP 9.3では12、000、ONTAP 9.4以降では40、000</block>
  <block id="0e38f856cb713ce9eea79fa1c6b7dc32" category="list-text">サイズ制限はASA システム、またはONTAP 9.12.1P2以降を実行するAFF およびFAS システムによって異なります。</block>
  <block id="d27c43bb3cdcbfa3852bb91192ffb849" category="list-text">SAN vVol（NVMeネームスペースまたはLUN）の数はプラットフォームによって異なります。必ずをチェックしてください<block ref="bb9c67b5a4c15a85b5e6aa6c9afd0285" category="inline-link-rx"></block> LUNとファイルの数とサイズの制限を更新</block>
  <block id="83583580d98b69cb8317f9b285f3c8df" category="paragraph">* ONTAP ツールfor VMware vSphereのUI拡張機能またはREST APIを使用して、VVOLデータストア*およびプロトコルエンドポイントをプロビジョニングします。*</block>
  <block id="9507d4f97aceb8d05fc962dd53f082af" category="paragraph">VVOLデータストアは一般的なvSphereインターフェイスを使用して作成することもできますが、ONTAPツールを使用すると、必要に応じてプロトコルエンドポイントが自動的に作成されます。また、ONTAPのベストプラクティスに従って、定義されたストレージ機能プロファイルに準拠したFlexVolボリュームが作成されます。ホスト/クラスタ/データセンターを右クリックし、ONTAP tools_and_Provision datastores_を選択します。ウィザードで目的のvVolオプションを選択するだけです。</block>
  <block id="e8d5f9dc0bff953a9e59755813c7e8bf" category="paragraph">* ONTAP ToolsアプライアンスまたはvCenter Server Appliance（vCSA）は、管理対象のVVOLデータストアには絶対に保存しないでください。*</block>
  <block id="c6ac0465bff03857ee851d98f6bd782b" category="paragraph">その結果、アプライアンスのリブートが必要になった場合、リブート中に自身のVVOLを再バインドできないため、アプライアンスのリブートが必要になることがあります。これらのデータは、別のONTAP ツールとvCenter環境で管理されるvVolデータストアに格納できます。</block>
  <block id="ab8d352870fb5334773c7177d3d5dcd1" category="paragraph">*異なるONTAP リリース間でのVVOL処理は避けてください。*</block>
  <block id="8b2bcef781b7e1f6d64739147d50aae7" category="paragraph">サポートされるストレージ機能（QoS、パーソナリティなど）はVASA Providerのリリースによって変更され、一部はONTAP リリースに依存します。ONTAP クラスタで異なるリリースを使用したり、リリースの異なるクラスタ間でVVolを移動したりすると、予期しない動作やコンプライアンスアラームが発生する可能性があります。</block>
  <block id="b2da0eca57c759eff034e6fe26f153e6" category="paragraph">* VVOLにNVMe/FCまたはFCPを使用する前に、ファイバチャネルファブリックのゾーニングを設定してください。*</block>
  <block id="bd57f4f74ca087a92a48b23d45753729" category="paragraph">ONTAP tools VASAプロバイダは、管理対象のESXiホストで検出されたイニシエータに基づいて、FCPおよびiSCSI igroup、およびONTAP 内のNVMeサブシステムを管理します。ただし、ゾーニングを管理するためにファイバチャネルスイッチと統合することはできません。プロビジョニングを実行する前に、ベストプラクティスに従ってゾーニングを実行する必要があります。次に、4つのONTAPシステムに対する単一イニシエータゾーニングの例を示します。</block>
  <block id="6b14e3f4a37881185acf7a766f8f6272" category="paragraph">単一イニシエータのゾーニング：</block>
  <block id="cd7bf0e1e61341c1aa3fa23401af8a27" category="inline-image-macro">4つのノードを使用した単一イニシエータゾーニング（400</block>
  <block id="17ccf64e30cb518fd7ca87ce752ad738" category="paragraph"><block ref="17ccf64e30cb518fd7ca87ce752ad738" category="inline-image-macro-rx" type="image"></block></block>
  <block id="58b5cd2a94730c2e044c14891f1e0e87" category="paragraph">ベストプラクティスの詳細については、次のドキュメントを参照してください。</block>
  <block id="51591d05b7e084ba8e5ae7f63172177e" category="inline-link">_TR-4080『Best Practices for Modern SAN ONTAP 9』を参照してください</block>
  <block id="fc9e4d789d968936f8ff5ae5a99847e0" category="paragraph"><block ref="fc9e4d789d968936f8ff5ae5a99847e0" category="inline-link-rx"></block></block>
  <block id="c1723e6a0e1d3dd28232b33e0cb6e61d" category="inline-link">_TR-4684『Implementing and Configuring Modern SANs with NVMe-oF』を参照してください</block>
  <block id="d748a2834a7220eef4ec4775a51632f9" category="paragraph"><block ref="d748a2834a7220eef4ec4775a51632f9" category="inline-link-rx"></block></block>
  <block id="9a36c8f0464a7ffce114044f1859c7ff" category="paragraph">*あなたの必要性に応じてあなたのバッキングFlexVolを計画しなさい。*</block>
  <block id="03d2e894fa9a05efefa4e8d6b2008a19" category="paragraph">VVOLデータストアに元のボリュームをいくつか追加して、ONTAP クラスタ全体にワークロードを分散したり、さまざまなポリシーオプションをサポートしたり、許可するLUNやファイルの数を増やしたりすることができます。ただし、最大限のストレージ効率が必要な場合は、すべてのバッキングボリュームを1つのアグリゲートに配置してください。また、クローニングのパフォーマンスを最大限に高める必要がある場合は、単一のFlexVol ボリュームを使用し、テンプレートまたはコンテンツライブラリを同じボリューム内に維持することを検討してください。VASA Providerは、移行、クローニング、Snapshotなど、多くのVVOLストレージ処理をONTAP にオフロードします。単一のFlexVol ボリューム内で実行すると、スペース効率に優れたファイルクローンが使用され、ほぼ瞬時に使用できます。この処理をFlexVol ボリューム間で実行すると、コピーをすぐに使用でき、インラインの重複排除と圧縮が使用されます。ただし、バックグラウンドの重複排除と圧縮を使用するボリュームでバックグラウンドジョブが実行されるまで、最大限のストレージ効率が回復されることはありません。ソースとデスティネーションによっては、一部の効率が低下する場合があります。</block>
  <block id="80b15469535d95a1690f308427545c7e" category="paragraph">*ストレージ機能プロファイル（SCP）はシンプルに。*</block>
  <block id="33e2905cb722c14575a9bff81ba78b39" category="paragraph">必要のない機能は、anyに設定して指定しないでください。これにより、FlexVol ボリュームを選択または作成する際の問題を最小限に抑えることができます。たとえば、VASA Provider 7.1以前では、圧縮がデフォルトのSCP設定の[いいえ]のままになっていると、AFF システムであっても圧縮を無効にしようとします。</block>
  <block id="5a6d5fdddf6fbd82f1952b532b03c9ef" category="paragraph">*デフォルトのSCPをサンプルテンプレートとして使用して、独自のSCPを作成します。*</block>
  <block id="4047245d73abc6e3ae8bf58ec063e52e" category="paragraph">付属のSCPはほとんどの汎用用途に適していますが、要件が異なる場合があります。</block>
  <block id="80dad10df0d1a031764e7c648c46aa23" category="paragraph">*最大IOPSを使用して不明なVMやテストVMを制御することを検討してください。*</block>
  <block id="93e4f73afe8b787b33161ec273ca087f" category="paragraph">最大IOPSを使用すると、不明なワークロードのIOPSを特定のVVolに制限して、他の重要度の高いワークロードへの影響を回避できます。パフォーマンス管理の詳細については、表4を参照してください。</block>
  <block id="bdbd10905a1446f944699405bca52654" category="paragraph">*十分な数のデータLIFがあることを確認してください。*
各HAペアのノードごとに少なくとも2つのLIFを作成します。ワークロードに応じて、さらに多くの処理が必要になる場合があります。</block>
  <block id="ee3cbda1c3c4a14ae024478c7ada6d11" category="paragraph">*すべてのプロトコルのベストプラクティスに従ってください。*</block>
  <block id="4e0d7e0587bf99c9b7a64a84fd42f6bd" category="paragraph">選択したプロトコルに固有のNetAppおよびVMwareのその他のベストプラクティスガイドを参照してください。一般的に、上記以外の変更はありません。</block>
  <block id="97f87e9ab1d660463c63beb8745fd9e5" category="paragraph">* NFS v3経由でVVOLを使用したネットワーク構成の例*</block>
  <block id="6a2c1ac1da51eca0c1a65afffab8dfab" category="inline-image-macro">NFS v3、500経由でVVOLを使用するネットワーク設定</block>
  <block id="c80b3cc8b5013bd4039769fb0f783e60" category="paragraph"><block ref="c80b3cc8b5013bd4039769fb0f783e60" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6cacb3f1edd09835a2ad07d72f488e2a" category="paragraph">NetApp ONTAPソフトウェアは、20年以上にわたって業界をリードするVMware vSphere環境向けストレージ解決策であり、コストを削減しながら管理を簡易化する革新的な機能を継続的に追加しています。</block>
  <block id="918febfed3d070cf1250909e5cdcf31d" category="paragraph">本ドキュメントでは、VMware vSphere Virtual Volumes（VVOL）向けのONTAP 機能について説明します。最新の製品情報やユースケース、導入を合理化してエラーを削減するためのベストプラクティスなどを紹介します。</block>
  <block id="c7448b194ba68bddce48f1d11d5d7db7" category="admonition">このドキュメントは、これまでに公開されていたテクニカルレポート_TR-4400：『VMware vSphere Virtual Volumes（vVol）with NetApp ONTAP _』を差し替えます。</block>
  <block id="d30f04665be7a6d9663004b1b5e61a9a" category="paragraph">ベストプラクティスは、ガイドや互換性リストなどの他のドキュメントを補うものです。ラボテストに基づいて開発されており、ネットアップのエンジニアやお客様は広範な現場経験を積んでいます。効果的またはサポートされている唯一の手法ではないかもしれませんが、一般的には、ほとんどのお客様のニーズを満たす最もシンプルなソリューションです。</block>
  <block id="b010d2e253827dbb44b7ba4e1332e24e" category="admonition">本ドキュメントが更新され、vSphere 8.0 Update 1に搭載された新しいvVol機能がONTAP tools 9.12リリースでサポートされるようになりました。</block>
  <block id="cc713c330b9c4e00d3ed7233bc54a889" category="section-title">Virtual Volumes（VVol）の概要</block>
  <block id="64f0863a7fb5f52a7ac6a911e1ad6862" category="paragraph">ネットアップは2012年にVMwareとの連携を開始し、vSphere APIs for Storage Awareness（VASA）for vSphere 5のサポートを開始しました。この初期のVASA Providerでは、プロファイルにストレージ機能を定義することができました。このプロファイルを使用すると、プロビジョニング時やポリシーへの準拠状況の確認時にデータストアをフィルタリングできます。時間の経過とともに、プロビジョニングの自動化を可能にする新しい機能が追加されたり、仮想ボリューム（VVol）が追加されたりして、個 々 のストレージオブジェクトが仮想マシンファイルと仮想ディスクに使用されたりします。これらのオブジェクトにはLUN、ファイルなどが含まれます。vSphere 8 - NVMe namespaces.NetAppは、2015年にvSphere 6でリリースされたVVOLのリファレンスパートナーとして、またvSphere 8でNVMe over Fabricsを使用したVVOLの設計パートナーとして、VMwareと緊密に連携しています。ネットアップでは、ONTAP の最新機能を活用できるように、VVOLの機能を継続的に強化しています。</block>
  <block id="cbf0aa9daeb855e4eace1a3bdc474ce2" category="paragraph">注意が必要なコンポーネントは次のとおりです。</block>
  <block id="e2f6b83160ea0712fbc59dd84410c4b2" category="cell">* VASA Provider *</block>
  <block id="919601826e1d58bccaaab76d787871d2" category="cell">VMware vSphereとストレージシステムの間の通信を処理するソフトウェアコンポーネントです。ONTAP の場合、VASA ProviderはONTAP Tools for VMware vSphere（ONTAP tools for VMware vSphere）と呼ばれるアプライアンスで実行されます。ONTAP toolsには、vCenterプラグイン、VMware Site Recovery Manager用のStorage Replication Adapter（SRA）、独自の自動化を構築するためのREST APIサーバも含まれています。ONTAP toolsを設定してvCenterに登録すると、ONTAP システムを直接操作する必要はほとんどなくなります。これは、必要なストレージのほぼすべてをvCenter UIから直接、またはREST APIによる自動化を通じて管理できるためです。</block>
  <block id="05ad8543ff165c6b8cd0cc5e976d3245" category="cell">*プロトコルエンドポイント（PE）*</block>
  <block id="3b2cd9018385f55c53c9a8b756df8bb5" category="cell">プロトコルエンドポイントは、ESXiホストとVVOLデータストアの間のI/Oのプロキシです。ONTAP VASA Providerは、VVOLデータストアのFlexVolごとに1つのプロトコルエンドポイントLUN（サイズ4MB）、またはデータストア内のFlexVolボリュームをホストしているストレージノードのNFSインターフェイス（LIF）ごとに1つのNFSマウントポイントを自動的に作成します。ESXiホストでは、これらのプロトコルエンドポイントは、個 々 のVVOL LUNや仮想ディスクファイルではなく直接マウントされます。プロトコルエンドポイントは、必要なインターフェイスグループやエクスポートポリシーとともにVASA Providerによって自動的に作成、マウント、アンマウント、および削除されるため、管理する必要はありません。</block>
  <block id="d3f051e8316cfd36651af1e65be24a75" category="cell">*仮想プロトコルエンドポイント（VPE）*</block>
  <block id="71afca0aa1a505ea2ac3ce5a1a681549" category="paragraph">vSphere 8の新機能では、VVOLでNVMe over Fabrics（NVMe-oF）を使用する場合、プロトコルエンドポイントの概念はONTAP には関係ありません。代わりに、最初のVMの電源がオンになるとすぐに、各ANAグループのESXiホストによって仮想PEが自動的にインスタンス化されます。ONTAP では、データストアで使用されるFlexVol ボリュームごとにANAグループが自動的に作成されます。</block>
  <block id="8202498953d2ebcf9968c37a7e47f4f6" category="paragraph">VVOLにNVMe-oFを使用するもう1つの利点は、VASA Providerでバインド要求が不要であることです。代わりに、VVOLバインド機能はVPEに基づいてESXiホストが内部的に処理します。これにより、VVolのバインドストームがサービスに影響する可能性が低くなります。</block>
  <block id="70532c0374111d897ef1176b34b6396c" category="inline-link">NVMeと仮想ボリューム</block>
  <block id="50ec55042a7f4e8c2c66219ac096cfb3" category="inline-link">VMware.com</block>
  <block id="113c9d4e642d1ba4cc469267fb7fd0de" category="paragraph">詳細については、を参照してください<block ref="f8d477cd77073d731aafe4f52026608a" category="inline-link-rx"></block> オン<block ref="1f1565cca975c4a703345d21e7f273b8" category="inline-link-rx"></block></block>
  <block id="61def0b14af00df4eb90bcd79d858a8b" category="cell">*仮想ボリュームデータストア*</block>
  <block id="b945cda41d7a84e7152e09343a17cbe6" category="cell">仮想ボリュームデータストアは、VASA Providerで作成および管理されるVVolコンテナを表す論理データストアです。コンテナは、VASA Providerで管理されるストレージシステムからプロビジョニングされたストレージ容量のプールを表します。ONTAP toolsでは、1つのvVolデータストアに複数のFlexVol ボリューム（バッキングボリューム）を割り当てることができます。これらのvVolデータストアは、機能の異なるフラッシュシステムとハイブリッドシステムを組み合わせることで、ONTAP クラスタ内の複数のノードにまたがることができます。管理者は、プロビジョニングウィザードまたはREST APIを使用して新しいFlexVol ボリュームを作成できます。また、作成済みのFlexVol ボリュームがある場合は、元のストレージ用に選択できます。</block>
  <block id="c25d2cc7c6540f6ac98af67455eecc39" category="cell">*仮想ボリューム（VVol）*</block>
  <block id="9664cdf7951789389813facac649fec1" category="cell">VVOLは、VVOLデータストアに格納される実際の仮想マシンのファイルとディスクです。VVOL（単一）という用語は、単一の特定のファイル、LUN、またはネームスペースを指します。ONTAP は、データストアが使用するプロトコルに応じて、NVMeネームスペース、LUN、またはファイルを作成します。VVOLにはいくつかの異なるタイプがあり、最も一般的なものは、Config（メタデータファイル）、Data（仮想ディスクまたはVMDK）、Swap（VMの電源投入時に作成）です。VMware VM暗号化で保護されるvVolのタイプはOTHERになります。VMware VMの暗号化とONTAP ボリュームまたはアグリゲートの暗号化を混同しないでください。</block>
  <block id="937251054fa0c1a7b946f8928cc857b9" category="section-title">ポリシーベースの管理</block>
  <block id="34d2b7d8b570ede7a638d070656b7b81" category="paragraph">VMware vSphere APIs for Storage Awareness（VASA）を使用すると、VM管理者は、ストレージチームとやり取りすることなく、VMのプロビジョニングに必要なストレージ機能を簡単に使用できます。VASAがリリースされるまではVM管理者はVMストレージポリシーを定義できましたが、適切なデータストアを特定するためにはストレージ管理者と協力しなければなりませんでした。多くの場合、ドキュメントや命名規則を使用していました。VASAを使用すると、適切な権限を持つvCenter管理者は、vCenterユーザがVMのプロビジョニングに使用できる一連のストレージ機能を定義できます。VMストレージポリシーとデータストアストレージ機能プロファイルのマッピングにより、vCenterで互換性のあるデータストアのリストを表示して選択できるほか、ARIA（旧vRealize）AutomationやTanzu Kubernetes Gridなどの他のテクノロジを有効にして、割り当てられたポリシーからストレージを自動的に選択できます。このアプローチは、ストレージポリシーベースの管理と呼ばれます。ストレージ機能プロファイルとポリシーは従来のデータストアでも使用できますが、ここではVVOLデータストアに焦点を当てます。</block>
  <block id="631bdc7de6608fd57c3fa0b397c3c26f" category="paragraph">次の2つの要素があります。</block>
  <block id="a156a7f38a3727ce705b5466eb11e0bf" category="cell">*ストレージ機能プロファイル（SCP）*</block>
  <block id="43a258e66ca875fa9c5d3e35e06ba2b7" category="cell">ストレージ機能プロファイル（SCP）は、ストレージテンプレートの形式です。これを使用すると、vCenterの管理者は、ONTAP でのそれらの機能の管理方法を実際に理解していなくても、必要なストレージ機能を定義できます。テンプレート形式のアプローチを採用することで、管理者は一貫した予測可能な方法でストレージサービスを簡単に提供できます。SCPで説明される機能には、パフォーマンス、プロトコル、Storage Efficiencyなどがあります。特定の機能はバージョンによって異なります。vCenter UIのONTAP Tools for VMware vSphereメニューを使用して作成します。REST APIを使用してSCPを作成することもできます。個 々 の機能を選択して手動で作成することも、既存の（従来の）データストアから自動的に生成することもできます。</block>
  <block id="8f50a0757d99fe5dd0df8d19478d4921" category="cell">* VMストレージポリシー*</block>
  <block id="f99c5cf9298b040025bd3dfe966cb86e" category="cell">仮想マシンストレージポリシーは、vCenterの[Policies and Profiles]に作成されます。VVOLの場合は、NetApp VVOLストレージタイププロバイダから提供されるルールを使用してルールセットを作成します。ONTAP ツールを使用すると、個別のルールを強制的に指定するのではなく、SCPを選択するだけでシンプルなアプローチが可能になります。</block>
  <block id="5dda8b04866334dc92ee08001b15701a" category="paragraph">前述したように、ポリシーを使用すると、ボリュームのプロビジョニングタスクを合理化できます。適切なポリシーを選択するだけで、そのポリシーをサポートするvVolデータストアがVASA Providerに表示され、準拠している個 々 のFlexVol にvVolが配置されます（図1）。</block>
  <block id="2ce0d6ec59cca7e0b6e0bdc389301e63" category="section-title">ストレージポリシーを使用してVMを導入します</block>
  <block id="e0795f8b847058e171dec5a519757ece" category="image-alt">ストレージポリシーを使用して仮想マシンを導入します</block>
  <block id="f0d0f0a6174a5a9dde27782042e22ccf" category="paragraph">VMのプロビジョニングが完了すると、VASA Providerは準拠状況を継続的にチェックし、元のボリュームがポリシーに準拠しなくなったときにvCenterでアラームを生成してVM管理者に通知します（図2）。</block>
  <block id="941431bc1cecb0ec5e89e78e9a5a96fc" category="section-title">VMストレージポリシーへの準拠</block>
  <block id="bfd6dec22a6a1724ff1b67f1f289cdfc" category="image-alt">仮想マシンストレージポリシーへの準拠</block>
  <block id="e08bc5b354c3e8058003a662e0f7cade" category="section-title">NetApp VVOLのサポート</block>
  <block id="234ad0324c313ec05d0fa6fe8d430967" category="paragraph">NetApp ONTAP は、2012年の初回リリース以降、VASA仕様をサポートしています。他のネットアップストレージシステムがVASAをサポートしている場合もありますが、本ドキュメントでは、現在サポートされているONTAP 9のリリースを中心に説明します。</block>
  <block id="7b02ea300aef2e0bff0d7f6111053284" category="section-title">NetApp ONTAP</block>
  <block id="4d53a8e49ac64213ffccdd970a35171e" category="paragraph">ネットアップは、AFF 、ASA 、FAS システムでのONTAP 9に加えて、ONTAP Select でのVMwareワークロード、VMware Cloud on AWSでのAmazon FSx for NetApp ONTAP 、Azure VMware解決策 でのAzure NetApp Files 、Google Cloud VMware EngineでのCloud Volumes Service 、EquinixでのNetApp Private Storageをサポートしています。 ただし、特定の機能は、サービスプロバイダーおよび使用可能なネットワーク接続によって異なる場合があります。vSphereゲストから、これらの構成に格納されたデータやCloud Volumes ONTAP にアクセスすることもできます。</block>
  <block id="9fe1fd556b933358881222d5c3da127c" category="paragraph">本書の発行時点では、ハイパースケーラ環境は従来のNFS v3データストアに限定されているため、VVOLは、オンプレミスのONTAP システム、または世界中のネットアップパートナーやサービスプロバイダがホストするオンプレミスシステムのすべての機能を提供するクラウド接続システムでのみ使用できます。</block>
  <block id="274bc582ca884fc158ea9ac9f79f9067" category="inline-link">ONTAP 製品ドキュメント</block>
  <block id="5ca60fe92dec435059ba5acefa4ce2c9" category="paragraph">ONTAP の詳細については、を参照してください<block ref="8a9b15dc18a16e0b1acfa438e27f6aa6" category="inline-link-rx"></block>_</block>
  <block id="3dffa984dadf9ff0006ee9cebd3b04b9" category="inline-link">TR-4597</block>
  <block id="9a03bb7ec5329e35d98c7b12b63c4df0" category="paragraph">ONTAP およびVMware vSphereのベストプラクティスの詳細については、を参照してください<block ref="fc9815e7b1405959c49ad47e9a23e3a5" category="inline-link-rx"></block>_</block>
  <block id="d3fb76da5fbbcd6fa32e40910b5b9a47" category="section-title">ONTAPでVVOLを使用するメリット</block>
  <block id="d0f004282063136e91d76d1d43d7c95f" category="paragraph">2015年にVMwareがVASA 2.0でVVOLをサポートするようになったとき、VMwareは「外付けストレージ（SAN / NAS）の新しい運用モデルを提供する統合管理フレームワーク」と表現しました。 この運用モデルには、ONTAP ストレージと組み合わせるメリットがいくつかあります。</block>
  <block id="6a74f7c0a9021e009a9c030e54084978" category="paragraph">セクション1.2で説明したように、ポリシーベースの管理では、事前定義されたポリシーを使用してVMをプロビジョニングし、その後管理できます。これは、次のようなさまざまな方法でITの運用に役立ちます。</block>
  <block id="e0eb51b6d319e14c2fbfc1f628021a26" category="list-text">*高速化。* ONTAP ツールにより、vCenter管理者がストレージプロビジョニング作業のためにストレージチームとチケットをオープンする必要がなくなります。ただし、vCenterとONTAP システムのONTAP tools RBACロールでは、必要に応じて特定の機能へのアクセスを制限することで、独立したチーム（ストレージチームなど）や同じチームによる独立したアクティビティを許可できます。</block>
  <block id="3f4dbd6687bd0d55bf69fe5fdd0137c4" category="list-text">*よりスマートなプロビジョニング。*ストレージシステムの機能をVASA APIを通じて公開できるため、VM管理者がストレージシステムの管理方法を理解しなくても、プロビジョニングワークフローで高度な機能を活用できます。</block>
  <block id="a13fcc9220d042cae454e9ac073636ca" category="list-text">*プロビジョニングの高速化。* 1つのデータストアでさまざまなストレージ機能をサポートし、VMポリシーに基づいてVMに応じて自動的に選択できます。</block>
  <block id="eb4c052226108afebf26e670208b9a55" category="list-text">*間違いを避けてください。*ストレージとVMのポリシーは事前に開発され、必要に応じて適用されます。VMをプロビジョニングするたびにストレージをカスタマイズする必要はありません。コンプライアンスアラームは、定義されたポリシーからストレージ機能が逸脱すると生成されます。前述したように、SCPは初期プロビジョニングを予測可能かつ反復可能にし、SCPに基づいてVMストレージポリシーを設定することで正確な配置を保証します。</block>
  <block id="9c520768a1d84268417335cf19a423b9" category="list-text">*容量管理の向上。* VASAおよびONTAP ツールを使用すると、必要に応じてストレージ容量を業界単位のアグリゲートレベルまで表示し、容量が不足し始めた場合に複数のレイヤからアラートを受け取ることができます。</block>
  <block id="f9878e32fdf258284c007eaae38773cd" category="section-title">最新のSANでVMをきめ細かく管理</block>
  <block id="7e673a7c12cc256f29bcd7b2028d9d5a" category="paragraph">VMwareでは、ファイバチャネルとiSCSIを使用するSANストレージシステムが最初にESX向けにサポートされましたが、ストレージシステムから個 々 のVMファイルとディスクを管理する機能はありませんでした。代わりに、LUNがプロビジョニングされ、VMFSが個 々 のファイルを管理します。そのため、個 々 のVMストレージのパフォーマンス、クローニング、保護をストレージシステムで直接管理することは困難です。VVOLは、ONTAP の堅牢でパフォーマンスに優れたSAN機能により、NFSストレージを使用しているお客様がすでに利用しているストレージをきめ細かく制御します。</block>
  <block id="25a46370807e0eab0dfe3853abfb9b6e" category="paragraph">現在、vSphere 8とONTAP Tools for VMware vSphere 9.12以降では、従来のSCSIベースのプロトコルにVVOLで使用されていたきめ細かな制御機能が、NVMe over Fabricsを使用した最新のファイバチャネルSANで利用できるようになり、大規模環境でのパフォーマンスをさらに向上させることができます。vSphere 8.0 Update 1では、ハイパーバイザーストレージスタックでI/O変換を行うことなく、VVOLを使用して完全なエンドツーエンドのNVMe解決策 を導入できるようになりました。</block>
  <block id="f61f57f748f5f0b52c7f11f1f1bd43f0" category="section-title">優れたストレージオフロード機能</block>
  <block id="911fa02c34dda38cd69be06e524ed9d0" category="inline-link">容量削減保証</block>
  <block id="3170031d77f241bc872afcb490c0a806" category="paragraph">VAAIにはさまざまな処理がストレージにオフロードされますが、VASA Providerで対処できるギャップがいくつかあります。SAN VAAIでは、VMwareが管理するスナップショットをストレージシステムにオフロードできません。NFS VAAIはVM管理スナップショットをオフロードできますが、ストレージネイティブスナップショットを持つVMには制限事項があります。VVOLでは、個 々 のLUN、ネームスペース、または仮想マシンディスク用のファイルが使用されるため、ONTAP ではファイルやLUNのクローンを迅速かつ効率的に作成し、差分ファイルが不要になったVM単位のSnapshotを作成できます。NFS VAAIは、Storage vMotionのホット（電源をオンにした）移行用のクローン処理のオフロードもサポートしていません。従来のNFSデータストアでVAAIを使用する場合は、VMの電源をオフにして移行のオフロードを可能にする必要があります。ONTAP ツールのVASA Providerを使用すると、ストレージ効率に優れたクローンをほぼ瞬時にホットデータとコールドデータの移行に使用できます。また、ほぼ瞬時にコピーを作成してVVOLのボリュームをまたがって移行することもできます。Storage Efficiencyにはこれらの大きなメリットがあるため、でVVOLワークロードを最大限に活用できる場合があります<block ref="9d1af7a9d4f98887e53c1a9bedbce044" category="inline-link-rx"></block> プログラム。同様に、VAAIを使用したボリューム間クローンで要件を満たせない場合は、VVOLでのコピー操作の向上により、ビジネス上の課題を解決できる可能性があります。</block>
  <block id="a8567b4dc683947384ef2e1dd0fc6ac1" category="section-title">VVOLの一般的なユースケース</block>
  <block id="48e535b80538b088fd868fde9372715c" category="paragraph">これらのメリットに加えて、VVOLストレージの一般的なユースケースを次に示します。</block>
  <block id="441f01ec38e91fad1b235a0e7422a178" category="list-text">*仮想マシンのオンデマンドプロビジョニング*</block>
  <block id="bd652a918164d8fa5176b5f9b92c2e61" category="list-text">プライベートクラウドまたはサービスプロバイダのIaaS：</block>
  <block id="fddccd9595370687015a5ab02bcff60f" category="list-text">ARIA（旧称vRealize）スイートやOpenStackなどによる自動化とオーケストレーションを活用できます</block>
  <block id="4fbc1141a40f5259e3ab1545de52b1ea" category="list-text">*ファーストクラスディスク（FCD）*</block>
  <block id="e83f2e4e8676ee8faac4d6af599fd7e7" category="list-text">VMware Tanzu Kubernetes Grid [TKG]の永続ボリューム。</block>
  <block id="b2b81490f2245d3d566e0ccc6a29cfc2" category="list-text">独立したVMDKライフサイクル管理を通じてAmazon EBSに似たサービスを提供</block>
  <block id="2511e4e8cbb72027ae20f24008d4b939" category="list-text">*一時VMのオンデマンドプロビジョニング*</block>
  <block id="eeb1044cc319a5d53503e45dbf762291" category="list-text">テスト/開発ラボ</block>
  <block id="858d314810762abccaa7baf230e3dc18" category="list-text">トレーニング環境</block>
  <block id="ab7bbc294bf0f0354980a3014e8f4219" category="section-title">VVOLの一般的なメリット</block>
  <block id="ccd6ea8c57e93a5401d07aab9c60f371" category="paragraph">VVOLを最大限に活用すると（上記のユースケースなど）、具体的に次のような機能強化が実現します。</block>
  <block id="13491b3af50183642ea0035b2d1f95f9" category="list-text">クローンは、1つのボリューム内またはONTAP クラスタ内の複数のボリューム間ですばやく作成されます。これは、VAAIが有効な従来のクローンと比較して有利です。また、ストレージ効率にも優れています。ボリューム内のクローンには、ONTAPファイルクローンが使用されます。FlexCloneボリュームと同様に、ソースのVVOLファイル/ LUN /ネームスペースからの変更のみが格納されます。本番環境やその他のアプリケーションを目的とした長期的なVMを短時間で作成し、最小限のスペースでVMレベルの保護（VMware vSphere向けNetApp SnapCenter プラグイン、VMware管理スナップショットまたはVADPバックアップを使用）とパフォーマンス管理（ONTAP QoSを使用）を実現できます。</block>
  <block id="1c21847cdc5616af138ba0c03aad7adb" category="list-text">VVOLは、vSphere CSIでTKGを使用する場合に理想的なストレージテクノロジであり、vCenter管理者が管理する個別のストレージクラスと容量を提供します。</block>
  <block id="d5f068caef73978a5483badd927a7e98" category="list-text">Amazon EBSに似たサービスは、FCDを介して提供できます。FCD VMDKは、その名前が示すように、vSphereのファーストクラスの市民であり、ライフサイクルが割り当てられているVMとは別に個別に管理できるためです。</block>
  <block id="7e7040600922b2a78715f856613a3c08" category="doc">VVOLを保護する</block>
  <block id="de92c927f248723e4668aec459709995" category="section-title">VASA Providerの高可用性</block>
  <block id="f4d4cb8868f07cad16bd7de7e36c5201" category="paragraph">NetApp VASA Providerは、vCenterプラグイン、REST APIサーバ（旧Virtual Storage Console[VSC]）、およびStorage Replication Adapterとともに仮想アプライアンスの一部として実行されます。VASA Providerを使用できない場合、VVOLを使用するVMは引き続き実行されます。ただし、新しいvVolデータストアを作成することはできず、vVolをvSphereで作成またはバインドすることもできません。vCenterはスワップVVolの作成を要求できないため、VVolを使用するVMの電源をオンにできません。また、vVolを新しいホストにバインドできないため、実行中のVMでvMotionを使用して別のホストに移行することはできません。</block>
  <block id="3958bf41787d7fcc6a9f8dd9348c947f" category="paragraph">VASA Provider 7.1以降では、必要なときにサービスを利用できるようにするための新しい機能がサポートされています。VASA Providerと統合データベースサービスを監視する新しいwatchdogプロセスが含まれています。障害が検出されると、ログファイルが更新され、サービスが自動的に再起動されます。</block>
  <block id="1acc458c695b0d3dfbf588309801fda2" category="paragraph">vSphere管理者は、他のミッションクリティカルなVMをソフトウェア、ホストハードウェア、およびネットワークの障害から保護するのと同じ可用性機能を使用して、さらに保護を設定する必要があります。これらの機能を使用するために仮想アプライアンスで追加の設定を行う必要はありません。標準のvSphereアプローチを使用して設定するだけです。これらはネットアップによってテストされ、サポートされています。</block>
  <block id="ff43afff832597ff45e5abeab2826ccf" category="inline-link">ONTAP tools for VMware vSphereのドキュメント（ONTAP toolsの高可用性の設定）</block>
  <block id="d516ca4c9c18446a82d9fc9ee85bd955" category="paragraph">vSphere High Availabilityは、障害発生時にホストクラスタ内の別のホストでVMを再起動するように簡単に構成できます。vSphere Fault Toleranceは、継続的にレプリケートされ、任意の時点でテイクオーバーできるセカンダリVMを作成することで、可用性を高めます。これらの機能の追加情報 はで使用できます<block ref="b6d78cbf1d5afb52929c529b32a350ad" category="inline-link-rx"></block>、およびVMware vSphereのドキュメント（「ESXiおよびvCenter ServerのvSphereの可用性」を参照）。</block>
  <block id="97ba24d475ff6fdc7743099992cc301f" category="paragraph">ONTAP tools VASA Providerは、VVOLの設定を管理対象のONTAP システムにリアルタイムで自動的にバックアップします。このシステムでは、VVOL情報がFlexVol ボリュームのメタデータに格納されます。何らかの理由でONTAP toolsアプライアンスが使用できなくなった場合でも、簡単かつ迅速に新しいアプライアンスを導入して設定をインポートできます。VASA Providerのリカバリ手順の詳細については、次の技術情報アーティクルを参照してください。</block>
  <block id="6799b6ec743f9159edf3b43790210a11" category="inline-link">『How to perform a VASA Provider Disaster Recovery - Resolution Guide』</block>
  <block id="9462790a7557a7eb2fe9daad4b875817" category="paragraph"><block ref="9462790a7557a7eb2fe9daad4b875817" category="inline-link-rx"></block></block>
  <block id="029a7740ecd792264454f9dbe194e980" category="section-title">vVolレプリケーション</block>
  <block id="c7b26217fd0c9041b6f779a0f669de5c" category="paragraph">ONTAP をご利用のお客様の多くは、NetApp SnapMirrorを使用して従来のデータストアをセカンダリストレージシステムにレプリケートし、災害発生時にセカンダリシステムを使用して個 々 のVMやサイト全体をリカバリしています。ほとんどの場合、お客様はこの管理にソフトウェアツールを使用します。たとえば、VMware vSphere用NetApp SnapCenterプラグインなどのバックアップソフトウェア製品や、VMwareのSite Recovery Managerなどのディザスタリカバリ解決策（ONTAPツールのStorage Replication Adapterとともに使用）などです。</block>
  <block id="bc6303e4538280b1b01d45a5f7d20039" category="paragraph">このソフトウェアツールの要件は、vVolレプリケーションの管理においてさらに重要になります。一部の機能はネイティブの機能で管理できます（たとえば、VMwareが管理するvVolのSnapshotは、高速で効率的なファイルクローンまたはLUNクローンを使用するONTAP にオフロードされます）が、一般的には、レプリケーションとリカバリを管理するためにオーケストレーションが必要です。VVOLに関するメタデータは、ONTAP とVASA Providerによって保護されますが、セカンダリサイトでメタデータを使用するには追加の処理が必要です。</block>
  <block id="c6a26835eb364bad22b16cb127b74135" category="paragraph">ONTAP tools 9.7.1とVMware Site Recovery Manager（SRM）8.3リリースを併用すると、ディザスタリカバリと移行のワークフローオーケストレーションのサポートが追加され、NetApp SnapMirrorテクノロジのメリットを活用できるようになりました。</block>
  <block id="2803a799fd66056eff404a17ba640c2b" category="paragraph">ONTAP tools 9.7.1を使用したSRMの初期リリースでは、FlexVolを事前に作成し、それらをVVOLデータストアのバッキングボリュームとして使用する前にSnapMirror保護を有効にする必要がありました。ONTAP tools 9.10以降では、このプロセスは不要になりました。既存のバッキングボリュームにSnapMirror保護を追加し、VMのストレージポリシーを更新して、SRMに統合されたディザスタリカバリと移行のオーケストレーション、自動化機能を備えたポリシーベースの管理を活用できるようになりました。</block>
  <block id="8142fcf496d02a58ce02a17558db863e" category="paragraph">現在、ネットアップがサポートするvVol用のディザスタリカバリおよび移行自動化の解決策 はVMware SRMのみです。ONTAP ツールでは、vVolレプリケーションを有効にする前に、vCenterに登録されているSRM 8.3以降のサーバの有無が確認されます。 ONTAP ツールREST APIを活用して独自のサービスを作成することも可能です。</block>
  <block id="7d8e8eced8d8b1a50f20640ffb5d363a" category="section-title">SRMを使用したvVolレプリケーション</block>
  <block id="4d30574e6d5bc9a71718858eeb30774c" category="inline-image-macro">SRMを使用したvVolレプリケーション、300</block>
  <block id="5844b0ec1ad8db5185ec67effeb9a7b7" category="paragraph"><block ref="5844b0ec1ad8db5185ec67effeb9a7b7" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c95aede1de7a41511c9d962deba49054" category="section-title">MetroCluster のサポート</block>
  <block id="3f15bb720adb42bd521a2ce1cb3a2974" category="paragraph">ONTAP toolsではMetroCluster のスイッチオーバーはトリガーされませんが、同じvSphere Metro Storage Cluster（vMSC）構成のVVol用NetApp MetroCluster システムではサポートされます。MetroCluster システムのスイッチオーバーは通常の方法で処理されます。</block>
  <block id="cde16c5ee89c209c821e120caf65bb81" category="paragraph">NetApp SnapMirrorビジネス継続性（SM-BC）はvMSC構成のベースとしても使用できますが、現時点ではVVOLではサポートされていません。</block>
  <block id="c859f5cd725cb2d1b163e4b066bede9a" category="paragraph">NetApp MetroCluster の詳細については、次のガイドを参照してください。</block>
  <block id="e5e0fb3ae5564674a6548ade7c601578" category="inline-link">_TR-4689 MetroCluster IP解決策 のアーキテクチャと設計_</block>
  <block id="e64de4e49a37e62ff7f8c37e859bbeb9" category="paragraph"><block ref="e64de4e49a37e62ff7f8c37e859bbeb9" category="inline-link-rx"></block></block>
  <block id="0229efec9dc9b9a7fdf144b025157176" category="inline-link">_TR-4705 NetApp MetroCluster 解決策 のアーキテクチャと設計_</block>
  <block id="6aee4b78ffdfaf193918978472d660a7" category="paragraph"><block ref="6aee4b78ffdfaf193918978472d660a7" category="inline-link-rx"></block></block>
  <block id="876341bac548f230eb390348e8b075ad" category="inline-link">_VMware KB 2031038 NetApp MetroCluster によるVMware vSphereのサポート_</block>
  <block id="5e68486fffeebad2ed145408dc250367" category="paragraph"><block ref="5e68486fffeebad2ed145408dc250367" category="inline-link-rx"></block></block>
  <block id="50c323f7050912164118ba47eab75888" category="section-title">vVolバックアップの概要</block>
  <block id="6751e706567f4773c4f3138b4de51a0f" category="paragraph">ゲスト内バックアップエージェントの使用、VMデータファイルのバックアッププロキシへの接続、VMware VADPなどの定義済みAPIの使用など、VMを保護する方法はいくつかあります。VVOLは同じメカニズムを使用して保護でき、多くのネットアップパートナーがVVOLを含むVMのバックアップをサポートしています。</block>
  <block id="416d27c872769e934ac8a49ec98ccb53" category="paragraph">前述したように、VMware vCenterで管理されるスナップショットは、スペース効率に優れた高速なONTAP ファイル/ LUNクローンにオフロードされます。これらは迅速な手動バックアップに使用できますが、vCenterでは最大32個のスナップショットに制限されています。vCenterを使用してスナップショットを作成し、必要に応じて元に戻すことができます。</block>
  <block id="8f3d5ae5bd7d8922841975ccd84b8526" category="paragraph">SnapCenter Plugin for VMware vSphere（SCV）4.6以降では、ONTAP tools 9.10以降と組み合わせて使用することで、vVolベースのVMのcrash-consistentバックアップおよびリカバリがサポートされるようになりました。SnapMirrorおよびSnapVault レプリケーションがサポートされたONTAP FlexVol ボリュームSnapshotを活用します。ボリュームあたり最大1023個のSnapshotがサポートされます。また、ミラーバックアップポリシーを使用したSnapMirrorを使用すると、保持期間の長いSnapshotをセカンダリボリュームに格納することもできます。</block>
  <block id="1429a9379faa8e82f8b198e93eebdf61" category="paragraph">vSphere 8.0のサポートは、分離されたローカルプラグインアーキテクチャを使用するSCV 4.7で導入されました。vSphere 8.0U1のサポートがSCV 4.8に追加され、新しいリモートプラグインアーキテクチャに完全に移行しました。</block>
  <block id="de1d77d00dae616276b6ceb6296a18f2" category="section-title">VMware vSphere用のSnapCenter プラグインを使用したVVolバックアップ</block>
  <block id="02f41838319aab980999b60967d7fd53" category="paragraph">NetApp SnapCenterでは、タグやフォルダに基づいてvVolのリソースグループを作成し、vVolベースのVMに対してONTAPのFlexVolベースのSnapshotを自動的に利用できるようになりました。これにより、環境内で動的にプロビジョニングされたVMを自動的に保護するバックアップ/リカバリサービスを定義できます。</block>
  <block id="4549a2943666c4815098331d30a872da" category="paragraph">SnapCenter Plugin for VMware vSphereは、vCenter拡張機能として登録されたスタンドアロンアプライアンスとして導入され、vCenter UIまたはREST APIを使用して管理され、バックアップ/リカバリサービスの自動化が可能です。</block>
  <block id="26e2418d177df1dddb008e455ce28752" category="section-title">SnapCenter アーキテクチャ</block>
  <block id="3b345c0fb5d2f0451ef84d991b21dcac" category="inline-image-macro">SnapCenter アーキテクチャ、300</block>
  <block id="af9bca7d8452705ba7f607cd036dba01" category="paragraph"><block ref="af9bca7d8452705ba7f607cd036dba01" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c32197281aa44f57ae568a9a42c7b3b6" category="paragraph">本ドキュメントの執筆時点では、他のSnapCenterプラグインはまだVVOLをサポートしていないため、本ドキュメントではスタンドアロンの導入モデルについて説明します。</block>
  <block id="6750052f2c0fb06d80a8efd7cb871190" category="paragraph">SnapCenter はONTAP FlexVol スナップショットを使用するため、vSphereへのオーバーヘッドは発生しません。また、vCenterで管理されているスナップショットを使用する従来のVMで発生する可能性のあるパフォーマンスの低下もありません。さらに、SCVの機能はREST APIを介して公開されるため、VMware ARIA Automation、Ansible、Terraformなどのツールや、標準のREST APIを使用できるその他のほぼすべての自動化ツールを使用して、自動化されたワークフローを簡単に作成できます。</block>
  <block id="0c889d77d71512ceb7241bd0f6d6ca23" category="inline-link">REST API の概要</block>
  <block id="35eab4195b135718da016e20979f9031" category="paragraph">SnapCenter REST API については、を参照してください<block ref="33852d6f529e96c0b816da3945bcb1e5" category="inline-link-rx"></block></block>
  <block id="4ee2d383554981f4ea8eff4f35db6832" category="inline-link">SnapCenter Plug-in for VMware vSphere REST API</block>
  <block id="63ae61e98eec102c39264a819a3c522e" category="paragraph">SnapCenter Plug-in for VMware vSphere REST API については、を参照してください<block ref="40a6c7462de67e21480b7a31e406f8f9" category="inline-link-rx"></block></block>
  <block id="bdf03d5c2a7086b6c916dc96d06a0a6c" category="paragraph">SnapCenter 環境を最大限に活用するには、次のベストプラクティスを参考にしてください。</block>
  <block id="60af6a4208b610da54a63a7e3658d5a5" category="list-text">SCVはvCenter Server RBACとONTAP RBACの両方をサポートしており、プラグインの登録時に自動的に作成される事前定義されたvCenterロールが用意されています。サポートされるRBACのタイプの詳細については、こちらを参照してください<block ref="a8ef9d6a500bd8288101245a3828ddb1" category="inline-link-rx"></block></block>
  <block id="0ed0835259b5b8c4b0f0910e7bfe2b17" category="list-text">vCenter UIを使用して、説明されている事前定義されたロールを使用して最小権限のアカウントアクセスを割り当てます<block ref="17b3487f3493b9c198e03f92348bfca0" category="inline-link-rx"></block>。</block>
  <block id="d53326766687d6bc7fa2e28ee177e809" category="list-text">SnapCenter サーバでSCVを使用する場合は、_SnapCenterADMIN_ROLEを割り当てる必要があります。</block>
  <block id="61ba6cb0b6021c205d41ed7f6fc1eb71" category="list-text">ONTAP RBACは、SCVで使用するストレージシステムを追加および管理するために使用するユーザアカウントを指します。ONTAP RBACは、VVOLベースのバックアップには適用されません。ONTAP RBACとSCVの詳細については、こちらをご覧ください<block ref="e4e865178d3962f87ac5cef3d6d68942" category="inline-link-rx"></block>。</block>
  <block id="1c89ba258526186ea0ec98325b61371b" category="list-text">SnapMirrorを使用してバックアップデータセットを別のシステムにレプリケートし、ソースボリュームの完全なレプリカを作成します。前述したように、ソースボリュームのSnapshotの保持設定に関係なく、バックアップデータの長期保持にmirror-vaultポリシーを使用することもできます。どちらのメカニズムもVVOLでサポートされています。</block>
  <block id="9792eeb3b91469abf77746b005d82d77" category="list-text">SCVではVVOL機能にONTAP Tools for VMware vSphereを使用する必要があるため、特定のバージョンの互換性については、必ずNetApp Interoperability Matrix Tool（IMT ）を参照してください</block>
  <block id="71c989bd68059e2ddfa4200c60b736c7" category="list-text">VMware SRMでvVolレプリケーションを使用する場合は、ポリシーのRPOとバックアップスケジュールに注意してください</block>
  <block id="604eb779cbb9af378f7bda71633b5b31" category="list-text">組織で定義された目標復旧時点（RPO）を満たす保持設定を使用してバックアップポリシーを設計</block>
  <block id="067ff91a08d3ff453b59d81993b96182" category="list-text">バックアップの実行時にステータスが通知されるようにリソースグループに通知を設定します（下記の図10を参照）。</block>
  <block id="c3add00693172bbbb4dd864bf0ad9116" category="section-title">リソースグループの通知オプション</block>
  <block id="c728df76dc3609672a7969e320e39e32" category="inline-image-macro">リソースグループ通知オプション、300</block>
  <block id="45281309785094533b5880fe6d0fd1ea" category="paragraph"><block ref="45281309785094533b5880fe6d0fd1ea" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6eae9510711f8df8f55a15e1761875d9" category="section-title">これらのドキュメントを使用して、SCVの使用を開始します</block>
  <block id="235a656535515ab3518937c09836e60d" category="inline-link">SnapCenter Plug-in for VMware vSphere について説明します</block>
  <block id="79eb02d2a96cc634df87bec5bd511bbe" category="paragraph"><block ref="79eb02d2a96cc634df87bec5bd511bbe" category="inline-link-rx"></block></block>
  <block id="04e7bb0411c1c8f56ca4fc8000c62ad8" category="inline-link">SnapCenter Plug-in for VMware vSphere を導入</block>
  <block id="d4ba0aa084ae1145248006481c881d29" category="paragraph"><block ref="d4ba0aa084ae1145248006481c881d29" category="inline-link-rx"></block></block>
  <block id="231cf4c70d866b616c21baddaeed0696" category="doc">トラブルシューティング</block>
  <block id="9d2169c1c2855b78a7aeaa4f42d27dc7" category="section-title">NetApp Support Site</block>
  <block id="ed9018b2e8611a3d2c03bb6a205b9715" category="inline-link">VMware vSphere 用の ONTAP ツール</block>
  <block id="890eb741924c425abbb11e4618560181" category="paragraph">NetApp Support Site には、ネットアップの仮想化製品に関するさまざまな技術情報アーティクルのほかに、の便利なランディングページも用意されています<block ref="6e90053136fd326e5d581844ca21966d" category="inline-link-rx"></block> 製品：このポータルには、ネットアップコミュニティの記事、ダウンロード、テクニカルレポート、VMwareソリューションに関するディスカッションへのリンクが掲載されています。次のURLから入手できます。</block>
  <block id="fff460b039580a1bd42725a397b4c8be" category="inline-link">_ NetApp Support Site _</block>
  <block id="897515b5a8a03f8d5cbed44fd47ef9f3" category="paragraph"><block ref="897515b5a8a03f8d5cbed44fd47ef9f3" category="inline-link-rx"></block></block>
  <block id="4020fd07f5ee2361dd23956e6a334ffd" category="paragraph">その他の解決策 ドキュメントは、次のURLから入手できます。</block>
  <block id="503a41e1e31e362793f7e86af9102c41" category="inline-link">_仮想化向けネットアップソリューション_</block>
  <block id="33d455bce1363bad4500664eb6208860" category="paragraph"><block ref="33d455bce1363bad4500664eb6208860" category="inline-link-rx"></block></block>
  <block id="baf17f6d2396be5fd3676baf863a331f" category="section-title">製品のトラブルシューティング</block>
  <block id="9d6d7fa1a5253698556ac2b0cda2207d" category="paragraph">vCenterプラグイン、VASA Provider、Storage Replication Adapterなど、ONTAP ツールのさまざまなコンポーネントは、いずれもネットアップのドキュメントリポジトリにまとめられています。ただし、それぞれにKnowledge Baseのサブセクションがあり、特定のトラブルシューティング手順が記載されている場合があります。これらは、VASA Providerで発生する可能性のある最も一般的な問題に対処します。</block>
  <block id="ae2a93a809929192ecc7b468f234af84" category="section-title">VASA ProviderのUIの問題</block>
  <block id="92a2b5cb9c6906035c2864fa225e1940" category="inline-link">記事</block>
  <block id="69aecee18a55993c779487758eb051cc" category="paragraph">vCenter vSphere Web ClientでSerenityのコンポーネントに関する問題が発生し、VASA Provider for ONTAP のメニュー項目が表示されないことがあります。導入ガイドまたはこのナレッジベースのVASA Provider登録の問題の解決を参照してください<block ref="c8979f1604396ce5570d07774ba255f0" category="inline-link-rx"></block>。</block>
  <block id="03cc611b90575ea37b55959adaa1c754" category="section-title">vVolデータストアのプロビジョニングが失敗する</block>
  <block id="281b890be0e8280eea1aebb82de90961" category="paragraph">vVolデータストアの作成時にvCenterサービスがタイムアウトすることがあります。修正するには、vmware-spsサービスを再起動し、vCenterのメニュー（[Storage]&gt;[New Datastore]）を使用してvVolデータストアを再マウントします。この問題については、『Administration Guide』のvCenter Server 6.5でvVolデータストアのプロビジョニングが失敗するという項を参照してください。</block>
  <block id="3152add163cd8aaf116a259d85ebf8fb" category="section-title">Unified Applianceをアップグレードすると、ISOのマウントに失敗します</block>
  <block id="ffaa56a3f5a1157f2eb3955773bb41da" category="paragraph">vCenterのバグが原因で、Unified Applianceをあるリリースから次のリリースへアップグレードするために使用されるISOがマウントに失敗する可能性があります。ISOをvCenterのアプライアンスに接続できる場合は、このナレッジベースの手順に従ってください<block ref="9839383ed04f777c0132b57ad0cb14ac" category="inline-link-rx"></block> 解決するために。</block>
  <block id="cacba1b456347ce8f32c7f5ed0d81e64" category="doc">vVolストレージの導入</block>
  <block id="2a5f3dc8d46246216b293c9e41979269" category="paragraph">従来のデータストアにONTAP を使用する既存のvSphere環境では、最初の2つの手順は必要ない場合があります。VMFSまたは従来のNFSベースのストレージの管理、自動化、レポート作成に、すでにONTAPツールを使用している場合があります。これらの手順については、次のセクションで詳しく説明します。</block>
  <block id="841db3655338a0c3dc36cf2761bfdafd" category="list-text">Storage Virtual Machine（SVM）とそのプロトコル設定を作成します。[NVMe/FC]、[NFSv3]、[NFSv4.1]、[iSCSI]、[FCP]、 またはそれらのオプションの組み合わせ。ONTAPのSystem Managerウィザードまたはクラスタシェルコマンドラインを使用できます。</block>
  <block id="10818a8ad4f650a48d78d728278d4cb3" category="list-text">スイッチ/ファブリック接続ごとにノードごとに少なくとも1つのLIFが必要です。FCP、iSCSI、またはNVMeベースのプロトコルを使用する場合は、ノードごとに2つ以上を作成することを推奨します。</block>
  <block id="612705dd95888cdc6345d01c93c84c39" category="list-text">この時点でボリュームを作成することもできますが、_Provision Datastore_wizardで作成する方が簡単です。ただし、VMware Site Recovery ManagerでvVolレプリケーションを使用する場合は例外です。この方法を使用すると、既存のSnapMirror関係が設定された既存のFlexVol を使用した方が簡単です。QoSはSPBMとONTAP ツールで管理するため、VVOLに使用するボリュームでは有効にしないでください。</block>
  <block id="16421df834af873175559b678c2b3cd9" category="list-text">NetApp Support Site からダウンロードしたOVAを使用して、ONTAP Tools for VMware vSphereを導入します。</block>
  <block id="8bdb69b5934ff84bbaafd84585965a90" category="list-text">環境に合わせてONTAP toolsを設定します。</block>
  <block id="dd07accb290c9c1e3900692630a70767" category="list-text">ONTAP toolsの_Storage Systems_にONTAP クラスタを追加します</block>
  <block id="731ce7392ae254e2050191ae92cafb14" category="list-text">ONTAP toolsとSRAはクラスタレベルとSVMレベルの両方のクレデンシャルをサポートしますが、VASA Providerではストレージシステムのクラスタレベルのクレデンシャルのみがサポートされます。これは、VVOLに使用されるAPIの多くがクラスタレベルでしか使用できないためです。そのため、VVOLを使用する場合は、クラスタを対象としたクレデンシャルを使用してONTAPクラスタを追加する必要があります。</block>
  <block id="869ce78032d85111f09ceb58bdb59a36" category="list-text">ONTAP データLIFがVMkernelアダプタとは異なるサブネットにある場合は、ONTAP toolsの設定メニューで、[Selected Subnets]リストにVMkernelアダプタのサブネットを追加する必要があります。デフォルトでは、ONTAP toolsはローカルサブネットへのアクセスのみを許可することでストレージトラフィックを保護します。</block>
  <block id="5a6d084090f063797fc6b863d2817d98" category="list-text">ONTAPツールには、事前定義されたポリシーがいくつか用意されています。これらのポリシーは、 <block ref="434866eb159632a70c4db034544336ef" category="inline-xref-macro-rx"></block> を参照してください。</block>
  <block id="ef51190e4c839596248fc4173ed12a3c" category="list-text">vCenterの_Provision ONTAP tools_menuを使用して、_Provision datastore_wizardを起動します。</block>
  <block id="66edaf6f622057aeadab950977c1f3e8" category="list-text">わかりやすい名前を指定し、目的のプロトコルを選択します。データストアの概要 も指定できます。</block>
  <block id="d22d6de0c8f11375907a1c10d8d0f251" category="list-text">vVolデータストアでサポートするSCPを1つ以上選択します。これにより、プロファイルに一致しないONTAP システムがすべて除外されます。表示されたリストから、目的のクラスタとSVMを選択します。</block>
  <block id="6a016a18a0c20e3b805cd9b8e713fb3e" category="list-text">ウィザードを使用して、指定したSCPごとに新しいFlexVol ボリュームを作成するか、適切なラジオボタンを選択して既存のボリュームを使用します。</block>
  <block id="2527effe721902a77755b8d628fdad93" category="list-text">vCenter UIの_PoliciesとProfiles_menuから、データストアで使用する各SCPのVMポリシーを作成します。</block>
  <block id="642dadaf5095b4c11730dca0ffcb0d27" category="list-text">「NetApp.clustered.Data.ONTAP.VP.vvol」ストレージルールセットを選択します。「NetApp.clustered.Data.ONTAP.VP.VASA10」ストレージルールセットは、vVol以外のデータストアでのSPBMサポート用です</block>
  <block id="c9565e0957e6e02cf12aef618bd30c3f" category="list-text">ストレージ機能プロファイルは、VMストレージポリシーを作成するときに名前で指定します。この手順では、[replication]タブを使用してSnapMirrorポリシーの照合を設定し、[Tags]タブを使用してタグベースの照合を設定することもできます。選択できるようにするには、タグがすでに作成されている必要があります。</block>
  <block id="af70f7acdeed8e2a702372f9bc85d960" category="list-text">[Select storage]でVMストレージポリシーと互換性があるデータストアを選択して、VMを作成します。</block>
  <block id="3db9849d9f30bfc6e05c4e0b36d28848" category="section-title">従来のデータストアからVVOLへのVMの移行</block>
  <block id="7be42b7840cc093ce6d05a247df8e63d" category="paragraph">従来のデータストアからvVolデータストアへのVMの移行は、従来のデータストア間でVMを移動するだけです。VMを選択し、[Actions]リストから[Migrate]を選択し、移行タイプとして[_change storage only_]を選択します。移行コピー処理はvSphere 6.0以降ではSAN VMFSからVVOLへの移行でオフロードされますが、NAS VMDKからVVOLへの移行ではオフロードされません。</block>
  <block id="58f2a764a13ec89d3c5ead5343e75637" category="section-title">ポリシーによるVMの管理</block>
  <block id="4b746813f1085683be4f71c8affea233" category="paragraph">ポリシーベースの管理でストレージプロビジョニングを自動化するには、次のことが必要です。</block>
  <block id="10b68fb9cbee818a044f91644423640c" category="list-text">ストレージ機能プロファイル（SCP）を使用して、ストレージ（ONTAP ノードとFlexVol ボリューム）の機能を定義します。</block>
  <block id="2e415dc7a6f21b4fd03f963858c9f680" category="list-text">定義済みのSCPに対応するVMストレージポリシーを作成します。</block>
  <block id="67c819108c4ef294ac28a51197046dfc" category="paragraph">VASA Provider 7.2以降では、機能とマッピングが簡易化され、以降のバージョンで継続的に改善されています。このセクションでは、この新しいアプローチに焦点を当てます。以前のリリースではサポートされていた機能の数が増え、個 々 にストレージポリシーにマッピングすることができましたが、このアプローチはサポートされなくなりました。</block>
  <block id="0bd86c4955ab0bdce52b49644ce9396d" category="section-title">ストレージ機能プロファイルONTAP toolsリリース別の機能</block>
  <block id="4a6af8a6e216dcc53a63f04143c13222" category="cell">* SCP機能*</block>
  <block id="048424cc97a54b673c837ee7d4c19de0" category="cell">*機能値*</block>
  <block id="098e77f7c5d9e0c2ad5454817edf0767" category="cell">*サポートされているリリース*</block>
  <block id="28f44037af103f0c930309365629f8ef" category="cell">* メモ *</block>
  <block id="d031377688b064b729a0cc60fb7fbbff" category="cell">* 圧縮 *</block>
  <block id="cc6aee5037bdc5b051433a266ec7d4a3" category="cell">はい、いいえ、任意</block>
  <block id="7778bddb1c205e9f74d08bd30be0aca3" category="cell">7.2以降のAFF では必須です。</block>
  <block id="221baf8ad30299306e725e4fb395bf34" category="cell">* 重複排除 *</block>
  <block id="6868f879256c802b106616a006671848" category="cell">7.2以降のAFF では必須です。</block>
  <block id="504897d4a6b59afadffd3cf9e5d3ea85" category="cell">* 暗号化 *</block>
  <block id="95fddd53c531d6efe15e3ac7ace1d9eb" category="cell">7.2以降</block>
  <block id="b3870ec121aeafa2e7ca8cb3894c0e3a" category="cell">暗号化されたFlexVol ボリュームを選択または作成します。ONTAP ライセンスが必要です。</block>
  <block id="e2dcc78cf70dac34550234c95443ac37" category="cell">* 最大 IOPS *</block>
  <block id="b78a981cc40fc4e66208bf5ee6d1a1eb" category="cell">&lt;number&gt;</block>
  <block id="130b32bc15d3fbe6d2e80ecda94135cc" category="cell">7.1以降ですが、違いがあります</block>
  <block id="c0f84018aff4ff4a1cf4012a8b82e509" category="cell">7.2以降のQoSポリシーグループに表示されます。を参照してください <block ref="8fdd8868d80d04eecf1b4189862f536c" category="inline-xref-macro-rx"></block> を参照してください。</block>
  <block id="993c56850c1da5de36e798b0c5a72513" category="cell">*パーソナリティ*</block>
  <block id="8485fa08bf8c556b7b2275349d11eb05" category="cell">略称はFAS</block>
  <block id="c0acd03e8ba6b951b8c6dff3e95b9560" category="cell">FAS には、ONTAP Select など、AFF以外のシステムも含まれます。AFF にはASA が含まれます。</block>
  <block id="dce365633ffb688b7532470dfaf4e118" category="cell">*プロトコル*</block>
  <block id="7cff0b96b4a6467ea880f49dd365a81f" category="cell">NFS、NFS 4.1、iSCSI、FCP、NVMe/FC、 任意</block>
  <block id="be18de5e88c84ba55eeb5bc42cca4c0d" category="cell">7.1以前、9.10以降</block>
  <block id="cfca0bc0c0b481555ba52be1f4e21da6" category="cell">7.2-9.8は実質的に「任意」です。9.10以降では、NFS 4.1とNVMe/FCが元のリストに追加されました。</block>
  <block id="3dd301ae5682df79e8687ead5b6a3ddf" category="cell">*スペースリザベーション（シンプロビジョニング）*</block>
  <block id="03868a080fbf4cdbc006da45e13cfad7" category="cell">Thin（シン）、Thick（シック）、（任意）</block>
  <block id="0a74dc1caf6ce891d5cbd3878cae2221" category="cell">すべて、違いを除いて</block>
  <block id="4b370bcc260aa96e343bbb24d3af2cc5" category="cell">7.1以前ではシンプロビジョニングと呼ばれ、anyの値も使用できました。7.2ではスペースリザベーションと呼ばれていますすべてのリリースのデフォルトはシンです。</block>
  <block id="40e2e283d064264dd51846580adb367d" category="cell">* 階層化ポリシー *</block>
  <block id="06b815f81a7e7aceb1489e3888fb9534" category="cell">[任意]、[なし]、[スナップショット]、[自動]</block>
  <block id="00917abc35f0d57db6562a886997c4e8" category="cell">FabricPoolに使用- ONTAP 9.4以降を搭載したAFFまたはASAが必要です。NetApp StorageGRID のようなオンプレミスのS3解決策 を使用しないかぎり、Snapshotのみが推奨されます。</block>
  <block id="ffb0d092d584c15937dfacd5be3c684a" category="section-title">ストレージ機能プロファイルの作成</block>
  <block id="ad0b6bb809400347fc4806f18385015c" category="paragraph">NetApp VASA Providerには、いくつかのSCPが事前定義されています。新しいSCPは、vCenter UIを使用して手動で作成することも、REST APIを使用した自動化を通じて作成することもできます。新しいプロファイルで機能を指定するか、既存のプロファイルをクローニングするか、既存の従来のデータストアからプロファイルを自動生成します。これは、ONTAP ツールのメニューを使用して行います。ストレージ機能プロファイル_を使用してプロファイルを作成またはクローニングし、ストレージマッピング_を使用してプロファイルを自動生成します。</block>
  <block id="62351556db3b0f6f13da226ca3e2df24" category="section-title">ONTAP tools 9.10以降のストレージ機能</block>
  <block id="14b49e2a6b56b1177a77be03a29dfc83" category="inline-image-macro">『Storage Capabilities for ONTAP tools 9.10 and later』、300</block>
  <block id="2a53cbcd07a15d9f13f0cc630c7cc44d" category="paragraph"><block ref="2a53cbcd07a15d9f13f0cc630c7cc44d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="12bb128f53dfaac0a251798e4b4e6954" category="paragraph"><block ref="12bb128f53dfaac0a251798e4b4e6954" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4e6d46028a015a7f3860fc8fdf214b3c" category="paragraph"><block ref="4e6d46028a015a7f3860fc8fdf214b3c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="64ca5ade59a3a7351134cf0db3a8e06a" category="paragraph"><block ref="64ca5ade59a3a7351134cf0db3a8e06a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2c8f597441425c22b4ae09f872f8bcc4" category="paragraph"><block ref="2c8f597441425c22b4ae09f872f8bcc4" category="inline-image-macro-rx" type="image"></block></block>
  <block id="fd59d4e26c472ef1e14cadb688283604" category="paragraph"><block ref="fd59d4e26c472ef1e14cadb688283604" category="inline-image-macro-rx" type="image"></block></block>
  <block id="049b6d7b78dd8ffebadb5a0be2261637" category="paragraph">* vVolデータストアを作成しています*
必要なSCPを作成したら、そのSCPを使用してVVOLデータストア（および必要に応じてデータストア用のFlexVol ボリューム）を作成できます。ONTAP データストアを作成するホスト、クラスタ、またはデータセンターを右クリックし、_vVol tools&gt;&gt;_Provision Datastore_を選択します。データストアでサポートするSCPを1つ以上選択し、既存のFlexVol ボリュームから選択するか、データストア用に新しいFlexVol ボリュームをプロビジョニングします。最後に、データストアのデフォルトのSCPを指定します。このSCPは、ポリシーで指定されたSCPが設定されていないVMやスワップVVOL（ハイパフォーマンスなストレージは必要ありません）に使用されます。</block>
  <block id="a4332a81dbc3a9888be608dea640cd3d" category="section-title">仮想マシンストレージポリシーを作成しています</block>
  <block id="80f789420db66cc767606f2432667d32" category="paragraph">仮想マシンストレージポリシーは、Storage I/O ControlやvSphere Encryptionなどのオプション機能を管理するためにvSphereで使用されます。また、VVOLでも使用され、特定のストレージ機能をVMに適用します。ポリシーを使用して特定のSCPをVMに適用するには、「NetApp.clustered.Data.ONTAP.VP.vVol」ストレージタイプと「ProfileName」ルールを使用します。ONTAP tools VASA Providerでのこの例については、link：ontap.html #ベストプラクティス[NFS v3経由でVVOLを使用するネットワーク設定例]を参照してください。「NetApp.clustered.Data.ONTAP.VP.VASA10」ストレージのルールは、VVOLベース以外のデータストアで使用します。</block>
  <block id="b4f6f65777757af7630fae901718e51e" category="paragraph">以前のリリースも似ていますが、で説明しているように、 <block ref="68072d20e775e4558feadbec7ba8f768" category="inline-xref-macro-rx"></block>オプションは異なります。</block>
  <block id="136cc0f714cd085d732d263ed60f95b7" category="paragraph">作成したストレージポリシーは、に示すように、新しいVMのプロビジョニング時に使用できます。 <block ref="4ed4bde8f4b7355ad6a00fef761d7ba6" category="inline-link-macro-rx"></block>。VASA Provider 7.2でパフォーマンス管理機能を使用する場合のガイドラインについては、を参照してください。 <block ref="8fdd8868d80d04eecf1b4189862f536c" category="inline-xref-macro-rx"></block>。</block>
  <block id="52896487a6472798e1d6cbc9a95ec51e" category="section-title">ONTAP tools VASA Provider 9.10を使用したVMストレージポリシーの作成</block>
  <block id="c0c5e719ad5439106e5a00588402f206" category="inline-image-macro">「ONTAP tools VASA Provider 9.10を使用したVMストレージポリシーの作成」、300</block>
  <block id="378e30f2a60dc28c4afc9ae4f11a39e1" category="paragraph"><block ref="378e30f2a60dc28c4afc9ae4f11a39e1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="95ac22478e141fde0d2878c71530a13a" category="section-title">ONTAP tools 9.10以降によるパフォーマンス管理</block>
  <block id="c153012a9aa13e8ed8ce3f3e471a70b4" category="list-text">ONTAP tools 9.10では、独自の分散配置アルゴリズムを使用して、vVolデータストア内の最適なFlexVol に新しいvVolが配置されます。指定したSCPと一致するFlexVol ボリュームに基づいて配置されます。これにより、データストアとバッキングストレージが、指定されたパフォーマンス要件を確実に満たすことができます。</block>
  <block id="e65bde48b0a84fcc60d957de90c3a128" category="list-text">最小IOPSや最大IOPSなどのパフォーマンス機能を変更するには、特定の構成に注意する必要があります。</block>
  <block id="c43f1c590aab42b849ee038e863a567d" category="list-text">*最小IOPSと最大IOPS *はSCPで指定し、VMポリシーで使用できます。</block>
  <block id="404e0fefd61512a9f144586382a62641" category="list-text">SCPでIOPSを変更しても、VMポリシーを編集してそれを使用するVMに再適用するまで、VVOLのQoSは変更されません（ <block ref="2358041c73953300d39d98366deee80d" category="inline-xref-macro-rx"></block>）。または、必要なIOPSで新しいSCPを作成し、そのSCPを使用する（VMに再適用する）ようにポリシーを変更します。一般的には、サービス階層ごとに個別のSCPとVMストレージポリシーを定義し、VMのVMストレージポリシーを変更することを推奨します。</block>
  <block id="0e05d638b7a9c7a5c32e6c22679eeb82" category="list-text">AFF とFAS のパーソナリティではIOPS設定が異なります。AFF では、MinとMaxの両方を使用できます。ただし、AFF以外のシステムで使用できるのは最大IOPSの設定のみです。</block>
  <block id="97659fa3c3a5aaf088f6020a38faf086" category="list-text">場合によっては、ポリシーの変更後（手動またはVASA ProviderとONTAP による自動）にVVOLの移行が必要になることがあります。</block>
  <block id="81c975fc79a19102fa04ad9c49f7538b" category="list-text">一部の変更では移行は必要ありません（最大IOPSの変更など、前述のようにVMにすぐに適用できます）。</block>
  <block id="a426b56f86a12c200f3484efb990e81f" category="list-text">VVOLが格納されている現在のFlexVol でポリシーの変更をサポートできない場合（要求された暗号化ポリシーまたは階層化ポリシーがプラットフォームでサポートされていない場合など）は、vCenterでVMを手動で移行する必要があります。</block>
  <block id="7de504873f20af5c8ce6dadd2f79b29a" category="list-text">ONTAP toolsは、現在サポートされているバージョンのONTAP に対して、共有されていないQoSポリシーを個別に作成します。そのため、個 々 のVMDKにはそれぞれ独自のIOPSが割り当てられます。</block>
  <block id="63a33ddbd2c3ccd2daac06020248049f" category="section-title">VMストレージポリシーを再適用しています</block>
  <block id="d0f5986c3378364e5cb0eda0e98fd0fd" category="inline-image-macro">「Reapplying VM Storage Policy」、300</block>
  <block id="2a8c2026166e178134c7e19c2f4a2c15" category="paragraph"><block ref="2a8c2026166e178134c7e19c2f4a2c15" category="inline-image-macro-rx" type="image"></block></block>
  <block id="50b6e1c7f2e81842d993d8ce88acc979" category="summary">ONTAP は、仮想化に使用されるすべての主要なストレージプロトコルをサポートしています。たとえば、 SAN 環境向けの iSCSI 、 Fibre Channel （ FC ）、 Fibre Channel over Ethernet （ FCoE ）、 Non-Volatile Memory Express over Fibre Channel （ NVMe/FC ）、ゲスト接続用の NFS （ v3 および v4.1 ）、 SMB または S3 などです。お客様は、環境に最適なものを自由に選択でき、必要に応じてプロトコルを 1 つのシステムで組み合わせることができます。</block>
  <block id="ee8cc65cae83009c275cd4748f4c58ae" category="doc">ONTAP の仮想化ツール</block>
  <block id="0894f8dfb7dd501a78dc2416b7b90c2a" category="paragraph">ネットアップでは、 ONTAP および vSphere と組み合わせて使用し、仮想環境を管理できるスタンドアロンのソフトウェアツールをいくつか提供しています。</block>
  <block id="236e1a1bf6abf86968baf738af47b78c" category="paragraph">ONTAP ライセンスには、追加コストなしで次のツールが含まれています。vSphere 環境でこれらのツールがどのように連携するかについては、図 1 を参照してください。</block>
  <block id="f364e3337f5237c93d7b5439c82d444b" category="paragraph">VMware vSphere 用の ONTAP ツールは、 vSphere とともに ONTAP ストレージを使用するための一連のツールです。vCenter プラグインは、以前 Virtual Storage Console （ VSC ）と呼ばれていたもので、 SAN と NAS のどちらを使用している場合でも、ストレージ管理と効率化機能の簡易化、可用性の向上、ストレージコストと運用オーバーヘッドの削減を実現します。データストアのプロビジョニングのベストプラクティスを使用して、 NFS 環境およびブロックストレージ環境用の ESXi ホスト設定を最適化します。以上のメリットのために、ネットアップでは、 ONTAP ソフトウェアを実行しているシステムで vSphere を使用する際のベストプラクティスとして、これらの ONTAP ツールを使用することを推奨します。サーバアプライアンス、vCenter、VASA Provider、Storage Replication Adapterのユーザインターフェイス拡張機能が含まれています。ONTAP ツールのほぼすべてを、最新の自動化ツールで利用できるシンプルなREST APIを使用して自動化できます。</block>
  <block id="0b266371a133b176a2ee883ccf72b46c" category="list-text">* vCenter UIの拡張機能* ONTAP ツールのUI拡張機能は、vCenter UIにホストとストレージを管理するための使いやすいコンテキスト依存メニュー、情報ポートレット、およびネイティブアラート機能を直接組み込み、ワークフローを合理化することで、運用チームやvCenter管理者の業務を簡素化します。</block>
  <block id="e08c666b5127e745f8aacbacfce37dcf" category="list-text">* VASA Provider for ONTAP 。* VASA Provider for ONTAP は、VMware vStorage APIs for Storage Awareness（VASA）フレームワークをサポートしています。VMware vSphere 用の ONTAP ツールの一部として提供され、導入を容易にする単一の仮想アプライアンスとして提供されます。VASA Provider では、 VM ストレージのプロビジョニングと監視に役立つように vCenter Server と ONTAP を接続します。VMware Virtual Volumes （ VVol ）のサポート、ストレージ機能プロファイルと個々の VM VVol のパフォーマンスの管理、およびプロファイルの容量と準拠状況の監視用アラームが可能になります。</block>
  <block id="1c7bb8764fc089dda8481678ad1ea0b5" category="list-text">* Storage Replication Adapter. SRAは、VMware Site Recovery Manager（SRM）と併用して、本番サイトと災害復旧サイト間のデータ複製を管理し、DRレプリカを無停止でテストします。検出、リカバリ、再保護のタスクを自動化します。Windows SRM サーバおよび SRM アプライアンス用の SRA サーバアプライアンスと SRA アダプタの両方が含まれています。</block>
  <block id="a1c13ec555198266776a3a7b904810dd" category="paragraph">次の図は、 vSphere 用の ONTAP ツールを示しています。</block>
  <block id="f7e876d450acee7c9ed7b18438440fb2" category="paragraph"><block ref="f7e876d450acee7c9ed7b18438440fb2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="dd55e255500b9ec15305dc69dfa0e15b" category="section-title">NFS Plug-in for VMware VAAI のこと</block>
  <block id="4fbfd4c228f22ff3f2841908e853d895" category="paragraph">NetApp NFS Plug-in for VMware VAAIはESXiホスト向けのプラグインで、ONTAP 上のNFSデータストアでVAAI機能を使用できます。クローン処理、シック仮想ディスクファイルのスペースリザベーション、およびスナップショットオフロードのコピーオフロードをサポートします。コピー処理をストレージにオフロードしても、完了までの時間が必ずしも短縮されるとは限りませんが、ネットワーク帯域幅の要件が軽減され、CPUサイクル、バッファ、キューなどのホストリソースがオフロードされます。VMware vSphere用のONTAP ツールを使用して、ESXiホストまたはサポートされている場合はvSphere Lifecycle Manager（VLCM）にプラグインをインストールできます。</block>
  <block id="00cdd3f66e02711548cf72d579ec0df8" category="summary">SnapCenter では、複数のジョブに適用可能なバックアップポリシーを作成できます。これらのポリシーでは、スケジュール、保持、レプリケーションなどの機能を定義できます。VMwareスナップショットを作成する前にI/Oを休止するハイパーバイザーの機能を活用して、VM整合性スナップショットをオプションで選択できます。</block>
  <block id="f1d1eddd608fe98b6fa2bc3436ce81d0" category="doc">ストレージポリシーベースの管理とVVOL</block>
  <block id="2bdce8d6813e7a3d93783119529cf146" category="paragraph">VMware vSphere APIs for Storage Awareness （ VASA ）を使用すると、ストレージ管理者は、明確に定義された機能を使用してデータストアを簡単に設定でき、 VM 管理者は、相互にやり取りすることなく、いつでも VM をプロビジョニングするためのこれらの機能を使用できます。</block>
  <block id="871db14a81b3510676400538c6f07073" category="paragraph">このアプローチを見て、仮想化ストレージの運用を合理化し、単純な作業の多くを回避する方法を確認することをお勧めします。</block>
  <block id="ad0bd815b4fb6f01acc94f160af3dca7" category="paragraph">VASA が導入される前は、 VM 管理者が VM ストレージポリシーを定義することもできましたが、適切なデータストアを特定するには、多くの場合、ドキュメントや命名規則を使用する必要がありました。VASA を使用すると、ストレージ管理者は、パフォーマンス、階層化、暗号化、レプリケーションなど、さまざまなストレージ機能を定義できます。1 つのボリュームまたはボリュームセットの一連の機能を、ストレージ機能プロファイル（ SCP ）と呼びます。</block>
  <block id="44d75bdf4feecabe2de10427870ae623" category="paragraph">SCPでは、VMのデータVVOLに対して最小または最大のQoSがサポートされます。最小 QoS は AFF システムでのみサポートされます。VMware vSphere 用の ONTAP ツールには、 ONTAP システム上の VVOL の VM の詳細なパフォーマンスと論理容量を表示するダッシュボードがあります。</block>
  <block id="4240fa68f6d9919e6d039c4038175025" category="paragraph">次の図は、 VMware vSphere 9.8 VVol ダッシュボード用の ONTAP ツールを示しています。</block>
  <block id="d3fcb217aa8b45eb8a95f8958c1f7746" category="paragraph"><block ref="d3fcb217aa8b45eb8a95f8958c1f7746" category="inline-image-macro-rx" type="image"></block></block>
  <block id="50e0e66922b3b12510a128829d1fdc70" category="paragraph">ストレージ機能プロファイルを定義したら、そのプロファイルを使用して要件を定義するストレージポリシーを使用して VM をプロビジョニングできます。vCenter では、 VM ストレージポリシーとデータストアストレージ機能プロファイルのマッピングに基づいて、互換性があるデータストアのリストを選択対象として表示できます。このアプローチは、ストレージポリシーベースの管理と呼ばれます。</block>
  <block id="794b6e2fc393d40a552fc58975920cb0" category="paragraph">VASA は、ストレージを照会して一連のストレージ機能を vCenter に返すためのテクノロジを提供します。VASA ベンダープロバイダは、ストレージシステムの API およびコンストラクトと、 vCenter が認識可能な VMware API との間の変換機能を提供します。ネットアップのVASA Provider for ONTAPは、ONTAP Tools for VMware vSphereアプライアンスVMの一部として提供されます。vCenterプラグインは、VVOLデータストアをプロビジョニングおよび管理するためのインターフェイスと、ストレージ機能プロファイル（SCP）を定義する機能を提供します。</block>
  <block id="dad160104969c39365dd2cd4c98dd300" category="inline-link">TR-4400</block>
  <block id="79f0d5feb7ec25a16c407f3f585eabb2" category="paragraph">ONTAP は、 VMFS データストアと NFS データストアの両方をサポートしています。SAN データストアで VVOL を使用すると、 VM レベルのきめ細かさなど、 NFS のメリットの一部を活用できます。ここでは考慮すべきベストプラクティスをいくつか示します。また、追加情報はにあります<block ref="4f23d4db151ca74200684ac8aef53fed" category="inline-link-rx"></block>：</block>
  <block id="bd490c925219bcb312338a370589bf70" category="list-text">VVOL データストアは、複数のクラスタノードにある複数の FlexVol で構成できます。ボリュームごとに機能が異なる場合でも、最もシンプルなアプローチは 1 つのデータストアです。SPBM により、互換性のあるボリュームが VM に使用されています。ただし、すべてのボリュームが 1 つの ONTAP SVM に含まれていて、単一のプロトコルでアクセスできる必要があります。各プロトコルでノードごとに 1 つの LIF で十分です。1 つの VVOL データストアで複数の ONTAP リリースを使用することは避けてください。リリースによってストレージ機能が異なる場合があります。</block>
  <block id="0cc956d6da91fefae9dad9b2c8c9519b" category="list-text">VVol データストアの作成と管理には、 VMware vSphere プラグインの ONTAP ツールを使用します。データストアとそのプロファイルの管理に加え、必要に応じて、 VVOL にアクセスするためのプロトコルエンドポイントが自動的に作成されます。LUN を使用する場合、 LUN PE は 300 以上の LUN ID を使用してマッピングされます。ESXiホストの詳細なシステム設定を確認する<block ref="ce913b4e625461a33f54f9e4ac38c2d7" prefix=" " category="inline-code"></block> 300を超えるLUN ID番号を許可します（デフォルトは1、024）。そのためには、vCenterでESXiホストを選択し、[Configure]タブで<block ref="ce913b4e625461a33f54f9e4ac38c2d7" prefix=" " category="inline-code"></block> をクリックします。</block>
  <block id="fac85f355a1eb47127ef1b94e7603924" category="list-text">VASA Provider 、 vCenter Server （アプライアンスまたは Windows ベース）、または VMware vSphere 用の ONTAP ツールは相互に依存するため、 VVOL データストアにインストールしたり移行したりしないでください。これらのツールは、停電やその他のデータセンターの停止が発生した場合に管理しなくなるためです。</block>
  <block id="dd76252ea7a50def2a98f218cb1505b4" category="inline-link">こちらの技術情報アーティクル</block>
  <block id="15ef75dd3d20b8278c16cd01a708e13e" category="list-text">VASA Provider VM を定期的にバックアップします。VASA Providerが格納された従来のデータストアのSnapshotを少なくとも1時間ごとに作成してください。VASA Provider の保護とリカバリの詳細については、こちらを参照してください<block ref="9d642870dca1748c69f7aa0b6fb95a89" category="inline-link-rx"></block>。</block>
  <block id="2d2d2e356f9ab117b7d2a58d42cc5988" category="paragraph">次の図は、 VVOL のコンポーネントを示しています。</block>
  <block id="6aadcb77504dae1dbfed2e4d1c969158" category="paragraph"><block ref="6aadcb77504dae1dbfed2e4d1c969158" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7be2e69e5d19c282db8d81c60a51c862" category="summary">このページでは、 VMware vSphere 環境に NetApp ONTAP ストレージ解決策を実装するためのベストプラクティスについて説明します。</block>
  <block id="d3ba101543fc97ba1dd9272c87bf65da" category="doc">Virtual Volumes （ VVol ）と Storage Policy Based Management （ SPBM ）</block>
  <block id="25e09c324ad3c89ee3aa01454fce14cd" category="section-title">VVol と SPBM について</block>
  <block id="a42f13867ea459821488608dc4d1b7c4" category="paragraph">ネットアップは、 vSphere Virtual Volumes （ VVol ）の開発において VMware と初期の設計パートナーとして、アーキテクチャに関する情報提供と、 VVol および VMware vSphere APIs for Storage Awareness （ VASA ）のサポートを提供していました。このアプローチにより、VMのきめ細かなストレージ管理がVMFSで実現しただけでなく、Storage Policy Based Management（SPBM）によるストレージプロビジョニングの自動化もサポートされました。</block>
  <block id="ce09fc365ce48a9d89c0fdb5222c3909" category="paragraph">SPBM は、仮想化環境で使用できるストレージサービスと、プロビジョニングされたストレージ要素の間の抽象化レイヤとして機能するフレームワークを、ポリシーを通じて提供します。このアプローチにより、ストレージアーキテクトは、 VM 管理者が簡単に利用できるさまざまな機能を備えたストレージプールを設計できます。仮想マシンのワークロード要件をプロビジョニングされたストレージプールと照合することで、仮想マシンごとまたは仮想ディスクレベルのさまざまな設定をきめ細かく制御できます。</block>
  <block id="2902acda09b9786460c2dd928a2d8f1a" category="paragraph">ONTAP は VVol の規模においてストレージ業界をリードし、 1 つのクラスタで数十万もの VVol をサポートします。一方、エンタープライズアレイや小規模なフラッシュアレイベンダーは、アレイあたり数千の VVol をサポートします。また、 VVOL 3.0 をサポートする機能が追加され、 VM のきめ細かな管理が進化しています。</block>
  <block id="fda9c21a4aefd4a1f42ad0b195e6ef0a" category="inline-link">TR-4400 ：『 VMware vSphere Virtual Volumes with ONTAP 』</block>
  <block id="69173613658292fc2adeb513b12f29ca" category="admonition">VMware vSphere Virtual Volumes 、 SPBM 、および ONTAP の詳細については、を参照してください<block ref="354226c2546b1aed39f1c0c484e6a98a" category="inline-link-rx"></block>。</block>
  <block id="61823c0f572643e0ce2e4edcb74cae51" category="paragraph">Snapshotを使用すると、パフォーマンスに影響を与えずにVMやデータストアのコピーをすばやく作成でき、SnapMirrorを使用してセカンダリシステムに送信することで、オフサイトでの長期的なデータ保護を実現できます。このアプローチでは、変更された情報のみを格納することで、ストレージスペースとネットワーク帯域幅を最小限に抑えます。</block>
  <block id="0aef2da721f0ab14676f8d6ffb9e7e8c" category="inline-link">（推奨）</block>
  <block id="022e604112aa3d1870f0da5e7806f48b" category="paragraph">SnapCenter では、複数のジョブに適用可能なバックアップポリシーを作成できます。これらのポリシーでは、スケジュール、保持、レプリケーションなどの機能を定義できます。VMwareスナップショットを作成する前にI/Oを休止するハイパーバイザーの機能を活用して、VM整合性スナップショットをオプションで選択できます。ただし、 VMware スナップショットはパフォーマンスへの影響があるため、ゲストファイルシステムを休止する必要がないかぎり、一般には推奨されません。代わりに、スナップショットを使用して一般的な保護を行い、SnapCenterプラグインなどのアプリケーションツールを使用してSQL ServerやOracleなどのトランザクションデータを保護します。これらのスナップショットはVMware（整合性）スナップショットとは異なり、長期的な保護に適しています。  VMware スナップショットはのみです<block ref="75f5ad475d959e2ecb55267e1a9a54f1" category="inline-link-rx"></block> パフォーマンスやその他の影響があるため、短期的な使用に適しています。</block>
  <block id="26aae91a7d92b32a60b1fbc86c29ee81" category="paragraph">これらのプラグインは、物理環境と仮想環境の両方でデータベースを保護する拡張機能を提供します。vSphere では、これらのプロトコルを使用して、 RDM LUN 、ゲスト OS に直接接続された iSCSI LUN 、 VMFS または NFS データストア上の VMDK ファイルにデータが格納されている SQL Server または Oracle データベースを保護できます。プラグインでは、さまざまなタイプのデータベースバックアップを指定し、オンラインまたはオフラインのバックアップをサポートし、ログファイルとともにデータベースファイルを保護できます。プラグインは、バックアップとリカバリに加えて、開発やテスト目的でのデータベースのクローニングにも対応しています。</block>
  <block id="1556ba0bf6ea4783cda0ff40e96f0265" category="paragraph">次の図は、 SnapCenter の導入例を示しています。</block>
  <block id="54ee9d8cd5db70a761321f3e7d168445" category="paragraph"><block ref="54ee9d8cd5db70a761321f3e7d168445" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6c1bef29e8dc34a00e17b06c221d5efe" category="paragraph">ディザスタリカバリ機能を強化するには、 ONTAP 用 NetApp SRA と VMware Site Recovery Manager の使用を検討してください。DR サイトへのデータストアのレプリケーションをサポートするだけでなく、レプリケートしたデータストアをクローニングすることで DR 環境を無停止でテストすることもできます。SRA に組み込まれている自動化機能を使用すると、災害からのリカバリや、システム停止が解決したあとの本番環境の再保護も簡単に実行できます。</block>
  <block id="650062685b0df8284f1b87f62fa3f9f3" category="inline-link">TR-4128</block>
  <block id="886a3fd32ec402d87ea2b090f8f701b2" category="paragraph">最後に、最高レベルのデータ保護を実現するために、 NetApp MetroCluster を使用した VMware vSphere Metro Storage Cluster （ vMSC ）設定を検討してください。vMSC は、同期レプリケーションとアレイベースのクラスタリングを組み合わせた VMware 認定の解決策です。高可用性クラスタと同じメリットを提供しますが、複数のサイトに分散してサイト障害から保護します。NetApp MetroCluster は、同期レプリケーション向けの対費用効果の高い構成を提供します。ストレージコンポーネントのあらゆる単一障害から透過的にリカバリでき、サイト障害時にコマンド 1 つでリカバリできます。vMSC の詳細については、を参照してください<block ref="737e6eedc4568d5bb72c6a6cf1fe681a" category="inline-link-rx"></block>。</block>
  <block id="d336a329d910c32fb90337a372f596fc" category="summary">NetApp ONTAP ソフトウェアは、 VMware vSphere 環境向けのストレージ解決策を約 20 年にわたって業界をリードしてきました。また、コストを削減しながら管理を簡易化する革新的な機能を継続的に追加しています。このドキュメントでは、導入の合理化、リスクの軽減、管理の簡易化を実現するために、最新の製品情報とベストプラクティスを含む ONTAP 解決策 for vSphere について説明します。</block>
  <block id="92515b597b8c0784d6000b89ee47c5fd" category="doc">ユニファイドストレージ</block>
  <block id="8b02311a9d2f587eb4c447455c3df68f" category="paragraph">ONTAP ソフトウェアを実行するシステムは、いくつかの重要な方法で統合されます。</block>
  <block id="7242358e2514a48e7044717140cacb4b" category="paragraph">本来、このアプローチは、 1 つのストレージシステムで NAS プロトコルと SAN プロトコルの両方をサポートすることを指していました。 ONTAP は、 NAS における従来の強みと同様に、業界をリードする SAN 向けプラットフォームとして継続されています。</block>
  <block id="4947dc197f31edea82b3fdab9dc68fdc" category="paragraph">Storage Virtual Machine （ SVM ）は、 ONTAP ソフトウェアを実行しているシステムにクライアントからアクセスできるようにする、論理的な構成要素です。SVM は、論理インターフェイス（ LIF ）を介して複数のデータアクセスプロトコルを使用して同時にデータをやり取りできます。SVM は、 CIFS や NFS などの NAS プロトコルでファイルレベルのデータアクセスを提供し、 iSCSI 、 FC / FCoE 、 NVMe などの SAN プロトコルでブロックレベルのデータアクセスを提供します。SVM は、 SAN クライアントと NAS クライアントそれぞれに同時にデータを提供できます。</block>
  <block id="d6154a0901f9ca6bb5d8fb15c113581e" category="paragraph"><block ref="d6154a0901f9ca6bb5d8fb15c113581e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3c46d272642e0999c025f67e9de315c9" category="paragraph">vSphere 環境では、このアプローチは仮想デスクトップインフラ（ VDI ）向けのユニファイドシステムと仮想サーバインフラ（ VSI ）の組み合わせを意味する場合もあります。ONTAP ソフトウェアを実行するシステムは一般に、従来のエンタープライズアレイに比べて VSI の方が安価ですが、同じシステムで VDI を処理するための高度な Storage Efficiency 機能も備えています。また、 ONTAP は、 SSD から SATA までさまざまなストレージメディアを統合し、クラウドへの拡張を容易にします。パフォーマンスのためにフラッシュアレイを1つ、アーカイブ用にSATAアレイを1つ、クラウド用に別 々 のシステムを購入する必要はありません。ONTAP は、これらすべてを 1 つにまとめます。</block>
  <block id="e9e0f5f2c513c7138ea70b4c929d6fef" category="inline-link">ストレージ仮想化</block>
  <block id="54c9439ad8fb4842a5a86c34d2401e36" category="admonition">SVM 、ユニファイドストレージ、クライアントアクセスの詳細については、を参照してください<block ref="2843f934dec816d79f9c394ad0533c28" category="inline-link-rx"></block> ONTAP 9 ドキュメントセンターを参照してください。</block>
  <block id="400cc516a4a40acd605aef2cfd4ba4c0" category="doc">VMware Storage Distributed Resource Scheduler の略</block>
  <block id="6e210af5c49ef2b81c06b57f989ed5c6" category="paragraph">VMware Storage Distributed Resource Scheduler （ SDRS ）は、現在の I/O レイテンシとスペース使用量に基づいて VM をストレージに配置する vSphere の機能です。</block>
  <block id="e7649bfbacc438bf8e20ba3564db4bdd" category="paragraph">その後、 VM や VMDK の配置先として最適なデータストアをデータストアクラスタ内から選択し、システムを停止することなくデータストアクラスタ（ポッドとも呼ばれます）内のデータストア間で VM や VMDK を移動します。データストアクラスタは、類似するデータストアをvSphere管理者から見た単一の消費単位に集約したものです。</block>
  <block id="5735cfd4d72f50fd28717ac30361b503" category="paragraph">SDRS を NetApp ONTAP Tools for VMware vSphere と併用する場合は、まずプラグインを使用してデータストアを作成し、 vCenter を使用してデータストアクラスタを作成し、そこにデータストアを追加する必要があります。データストアクラスタを作成したら、プロビジョニングウィザードの詳細ページからデータストアクラスタにデータストアを直接追加できます。</block>
  <block id="b028cce2007c32457c41f20d2954c0c2" category="paragraph">SDRS に関するその他の ONTAP のベストプラクティスは、次のとおりです。</block>
  <block id="d11eff5be5178b7ba95b06270611ffc8" category="list-text">クラスタ内のすべてのデータストアで同じタイプのストレージ（ SAS 、 SATA 、 SSD など）を使用し、すべて VMFS データストアまたは NFS データストアとし、レプリケーションと保護の設定を同じにします。</block>
  <block id="76db7ce67615bbc16da685df79ed0aa9" category="list-text">デフォルト（手動）モードでは SDRS の使用を検討してください。このアプローチでは、推奨事項を確認し、適用するかどうかを決定できます。VMDK の移行による影響を次に示します。</block>
  <block id="97f4ed95cb52bb29629002a25cb5039f" category="list-text">SDRS がデータストア間で VMDK を移動すると、 ONTAP のクローニングや重複排除によるスペース削減効果は失われます。重複排除機能を再実行すれば、削減効果を取り戻すことができます。</block>
  <block id="38f492286c3edf236c76e993ce0f0bf2" category="list-text">NetAppでは、VMDKを移動したあとに、移動したVMによってスペースがロックされるため、ソースデータストアでSnapshotを再作成することを推奨しています。</block>
  <block id="09a99cbc4fb85d10c7af970e79032a05" category="list-text">同じアグリゲート上のデータストア間で VMDK を移動してもメリットはほとんどなく、 SDRS はアグリゲートを共有する可能性のある他のワークロードを可視化できません。</block>
  <block id="09b616c445ab7efa8240062532e526e4" category="doc">ONTAP を使用した VMware vSphere</block>
  <block id="48e29772cebbf1133d022577e278d5c1" category="admonition">以前に公開されていたテクニカルレポート_TR-4597：『VMware vSphere for ONTAP』をこのドキュメントに差し替えます。</block>
  <block id="bfa7e7fc7c6bf4cc4e4c5c74b09763eb" category="paragraph">ベストプラクティスは、ガイドや互換性リストなどの他のドキュメントを補うものです。ラボテストに基づいて開発されており、ネットアップのエンジニアやお客様は広範な現場経験を積んでいます。すべての環境で機能する唯一のサポート対象となるわけではありませんが、一般に、ほとんどのお客様のニーズを満たす最もシンプルなソリューションです。</block>
  <block id="9ed4a475dd3705157a9fed8811f63ce2" category="inline-link">NetApp Interoperability Matrix Tool で確認できます</block>
  <block id="e08175c6fa64cba68719dea85ebd9d34" category="inline-link">VMware Compatibility Guide</block>
  <block id="c7e9d53e7f1a53451fa25cb6340fbf6f" category="paragraph">本ドキュメントでは、vSphere 7.0以降で実行されるONTAPの最新リリース（9.x）の機能について説明します。を参照してください<block ref="37aa2814221d042697a27bc81e148f64" category="inline-link-rx"></block> および<block ref="e1593898142109fc8cd8025356d3f312" category="inline-link-rx"></block> 特定のリリースに関する詳細については、を参照してください。</block>
  <block id="74587fa4ad90f8713c0446529a3670e0" category="section-title">ONTAP for vSphere を選ぶ理由</block>
  <block id="a110ecc6d4ce7014019c560e5fedf572" category="paragraph">ONTAPをvSphereのストレージ解決策として選択した理由は数多くあります。たとえば、SANとNASの両方のプロトコルをサポートするユニファイドストレージシステム、スペース効率に優れたSnapshotを使用した堅牢なデータ保護機能、アプリケーションデータの管理に役立つ豊富なツールなどです。ハイパーバイザーとは別のストレージシステムを使用すると、さまざまな機能をオフロードして、 vSphere ホストシステムへの投資を最大限に活用できます。このアプローチにより、ホストリソースをアプリケーションワークロードに集中できるだけでなく、ストレージ運用によるアプリケーションのランダムなパフォーマンスへの影響も回避できます。</block>
  <block id="0f50acddbdbb9aa9712a471f2276e655" category="paragraph">vSphere と ONTAP を併用すると、ホストハードウェアと VMware ソフトウェアのコストを削減できます。また、一貫した高パフォーマンスを維持しながら、低コストでデータを保護することもできます。仮想化されたワークロードはモバイル対応であるため、 Storage vMotion を使用して、 VMFS 、 NFS 、または VVOL データストア間で VM を移動するさまざまなアプローチを、すべて同じストレージシステム上で検討できます。</block>
  <block id="90977175b761542615a11f2b96cc4cbd" category="paragraph">お客様が現在重視している主な要因は次のとおりです。</block>
  <block id="442c1f0ac31c3d71b638125e0a8b51da" category="list-text">* ユニファイド・ストレージ。 * ONTAP ソフトウェアを実行するシステムは、いくつかの重要な方法で統合されています。当初、このアプローチは NAS プロトコルと SAN プロトコルの両方を指していましたが、 ONTAP は業界をリードする SAN プラットフォームであり続けており、 NAS における従来の強みもあります。vSphere 環境では、このアプローチは仮想デスクトップインフラ（ VDI ）向けのユニファイドシステムと仮想サーバインフラ（ VSI ）の組み合わせを意味する場合もあります。ONTAP ソフトウェアを実行するシステムは一般に、従来のエンタープライズアレイに比べて VSI の方が安価ですが、同じシステムで VDI を処理するための高度な Storage Efficiency 機能も備えています。また、 ONTAP は、 SSD から SATA までさまざまなストレージメディアを統合し、クラウドへの拡張を容易にします。パフォーマンスのためにフラッシュアレイを1つ、アーカイブ用にSATAアレイを1つ、クラウド用に別 々 のシステムを購入する必要はありません。ONTAP は、これらすべてを 1 つにまとめます。</block>
  <block id="0ce37df1cd9b66a2abde8244f17fc051" category="list-text">*仮想ボリュームとストレージポリシーベースの管理。* NetAppは、vSphere Virtual Volume（VVOL）の開発においてVMwareの初期の設計パートナーであり、アーキテクチャに関する情報を提供し、VVOLとVMware vSphere APIs for Storage Awareness（VASA）を早期にサポートしています。このアプローチにより、VMFSでVMストレージをきめ細かく管理できるだけでなく、ストレージポリシーベースの管理によるストレージプロビジョニングの自動化もサポートされました。このアプローチにより、ストレージアーキテクトは、 VM 管理者が簡単に利用できるさまざまな機能を備えたストレージプールを設計できます。ONTAP は VVOL 規模でストレージ業界をリードし、 1 つのクラスタで数十万もの VVol をサポートします。一方、エンタープライズアレイや小規模なフラッシュアレイベンダーは、アレイあたり数千の VVol をサポートします。ネットアップは、 VVOL 3.0 のサポートに向けて、今後追加される機能で、きめ細かな VM 管理の進化も推進しています。</block>
  <block id="9eeea06a6a7f860f801343c04af5d7d2" category="list-text">*ストレージ効率*。NetAppは本番ワークロードに重複排除機能を初めて提供しましたが、このイノベーションはこの分野の最初のものでも最後のものでもありませんでした。まず、パフォーマンスに影響を与えないスペース効率に優れたデータ保護メカニズムであるSnapshotと、本番環境およびバックアップ用にVMの読み取り/書き込みコピーを瞬時に作成するFlexCloneテクノロジから始まりました。ネットアップは、重複排除、圧縮、ゼロブロック重複排除などのインライン機能を提供し、高価な SSD のストレージを最後まで絞ります。ONTAP は最近、圧縮機能を使用して、より小さな I/O 処理とファイルをディスクブロックに圧縮する機能を追加しました。これらの機能を組み合わせることで、 VSI では最大 5 分の 1 、 VDI では最大 30 分の 1 のコストを削減できました。</block>
  <block id="bb73602f3344c326a7b63c94db24362a" category="list-text">* ハイブリッド・クラウド。 * オンプレミスのプライベート・クラウド、パブリック・クラウド・インフラストラクチャー、または両方の利点を組み合わせたハイブリッド・クラウドのいずれに使用しても、 ONTAP ソリューションはデータ管理を合理化し、最適化するためのデータ・ファブリックの構築を支援します。まずハイパフォーマンスのオールフラッシュシステムを導入し、データ保護とクラウドコンピューティングのためにディスクストレージシステムとクラウドストレージシステムのどちらかと組み合わせます。Azure 、 AWS 、 IBM 、 Google のクラウドから選択して、コストを最適化し、ロックインを回避できます。必要に応じて、 OpenStack とコンテナテクノロジの高度なサポートを活用できます。ネットアップ ONTAP では、クラウドベースのバックアップ（ SnapMirror クラウド、 Cloud Backup Service 、 Cloud Sync ）やストレージ階層化 / アーカイブツール（ FabricPool ）も提供しており、運用コストの削減とクラウドの幅広いリーチの活用を支援します。</block>
  <block id="7a61ec7965eebc0b5486cb78f096c770" category="list-text">* その他。 * NetApp AFF A シリーズアレイの卓越したパフォーマンスを活用して、コストを管理しながら仮想インフラを高速化できます。スケールアウト ONTAP クラスタを使用して、ストレージシステムのメンテナンスからアップグレード、完全な交換まで、完全なノンストップオペレーションを実現します。ネットアップの暗号化機能を追加コストなしで使用して、保存データを保護できます。きめ細かいサービス品質機能により、パフォーマンスがビジネスサービスレベルを満たしていることを確認します。これらはすべて、業界をリードするエンタープライズデータ管理ソフトウェアであるONTAPに付属する幅広い機能の一部です。</block>
  <block id="6104c8ef7be4222a76596ab6a22bb422" category="doc">推奨される ESXi ホストとその他の ONTAP 設定</block>
  <block id="0416d04b345b434b120840c30ddaf0a1" category="paragraph">ネットアップでは、 ONTAP を使用する際に適切に動作する ESXi ホストのマルチパスと HBA タイムアウトの設定を、テスト結果に基づいて作成しました。これらは、 VMware vSphere 用の ONTAP ツールを使用して簡単に設定できます。サマリダッシュボードで、ホストシステムポートレットの設定の編集をクリックするか、 vCenter でホストを右クリックして、 ONTAP ツール &gt; 推奨値の設定を選択します。9.8 リリースで現在推奨されているホスト設定は次のとおりです。</block>
  <block id="678582eb0cbbe0e063e618d230b63223" category="cell">*ホスト設定*</block>
  <block id="dfe49b73bd7e747701b49f9ed21ea2d6" category="cell">*ネットアップが推奨する値*</block>
  <block id="edceae57d92287f4f6200f94d3259cd0" category="cell">*再起動が必要です*</block>
  <block id="dc3a6955a23583876d020db0f6b80d4d" category="cell">* ESXi Advanced Configuration *</block>
  <block id="73663d0d00956f0632e4ae75d811d53f" category="cell">VMFS3.HardwareAcceleratedLocking</block>
  <block id="59b1aceaef0203fdc32e11df232b16e6" category="cell">デフォルトのまま（1）</block>
  <block id="bafd7322c6e97d25b6299b5d6fe8920b" category="cell">いいえ</block>
  <block id="1b50110aedae4d8d2043a4eb9beb20af" category="cell">VMFS3.EnableBlockDelete の 2 つのオプションがあります</block>
  <block id="5d1b81f1885499e392018ebd7124ad37" category="inline-link-macro">VMware KB 2007427</block>
  <block id="3aca64366573d9850e0148ce2a38164c" category="cell">デフォルト（0）のままにしますが、必要に応じて変更できます。
詳細については、を参照してください <block ref="68c2cf0ecb6a1c6abaf6e56c035d5866" category="inline-link-macro-rx"></block></block>
  <block id="316084648bbafe451240702bd19c6ee9" category="cell">VMFS3.EnableVMFS6Unmap</block>
  <block id="befd90cd01403237f6fdf296822efbee" category="inline-link-macro">VMware vSphere API：アレイ統合（VAAI）</block>
  <block id="e385d2442208cc1e23ca841b1f217380" category="cell">デフォルトのまま（1）
詳細については、を参照してください <block ref="d124e203790e5f214a195f69cd068c6d" category="inline-link-macro-rx"></block></block>
  <block id="571cc1d48c6d1ff3cf7e3a54cb035753" category="cell">* NFS設定*</block>
  <block id="c3b49a515dd0046685e06092642aa139" category="cell">Net.TcpipHeapSize の場合</block>
  <block id="875f6b98e20edfecb56f9013d00987f6" category="cell">vSphere 6.0 以降： 32 に設定
他のすべてのNFS設定の場合は、30に設定されます</block>
  <block id="93cba07454f06a4a960172bbd6e2a435" category="cell">はい。</block>
  <block id="504e96cc79e7efe30a8271cea152d9d1" category="cell">Net.TcpipHeapMax</block>
  <block id="a8af33a99dd728969fd947da27a2f69f" category="cell">vSphere 6.Xのほとんどのリリースでは512 MBに設定されています。
6.5U3、6.7U3、7.0以降の場合は、1024MBに設定します。</block>
  <block id="5f1e7b6431061565550e292d05c73588" category="cell">NFS.MaxVolumes の場合</block>
  <block id="e787d5b0d643685421632a1af3914963" category="cell">vSphere 6.0以降：256に設定
他のすべての NFS 構成では、 64 に設定されます。</block>
  <block id="3058676a1cf088aa4a73312ac36f2a58" category="cell">NFS41.MaxVolumes</block>
  <block id="62c07f94c64184ee5d530e4c0917093f" category="cell">vSphere 6.0 以降では、 256 に設定されます。</block>
  <block id="e18600af98c17fae10fdba0dc89979ed" category="cell">NFS.MaxQueueDepth^1 ^</block>
  <block id="be7707fa525d0124489c9fe3072f78de" category="cell">vSphere 6.0以降では、128に設定されます</block>
  <block id="18e1fb6924459470760771b20ab0c379" category="cell">NFS.HeartbeatMaxFailures の略</block>
  <block id="138989cbe5dd3a4997662e0f65c17878" category="cell">すべてのNFS設定について、10に設定されます</block>
  <block id="1aa26eb281359ba3b9a9a4b83a09ed46" category="cell">nfs.HeartbeatFrequency</block>
  <block id="7ea6e8664542e3beb1aea10425efb4db" category="cell">すべてのNFS構成で12に設定</block>
  <block id="eb4182715f8cde98563dc59ea36461d3" category="cell">nfs.HeartbeatTimeout</block>
  <block id="45aa5481fa55802a29a96aefd2f5dab1" category="cell">すべてのNFS構成で5に設定されます。</block>
  <block id="54a08b15243d9078d3b5a47f8242da6f" category="cell">SunRPC.MaxConnPerIP</block>
  <block id="9a9ccbecb3f315797ff8e709d85a0e18" category="cell">vSphere 7.0 以降では 128 に設定されます。</block>
  <block id="c0b3fd5512c2093847f753f398290f30" category="cell">* FC / FCoE 設定 *</block>
  <block id="2e556ad678160413b32dcca55c7d1f5f" category="cell">パス選択ポリシー</block>
  <block id="fb62337a3ef32f4701b639339a4ceb33" category="cell">FC パスの ALUA を使用する場合は、 RR （ラウンドロビン）に設定されます。それ以外の構成では、すべて FIXED に設定されます。
この値を RR に設定すると、最適化されたすべてのアクティブなパスで負荷を分散できます。
FIXED は、 ALUA に対応していない従来の構成用の値で、プロキシ I/O を防止できますつまり、Data ONTAP 7-Modeを実行する環境でハイアベイラビリティ（HA）ペアの他方のノードにI/Oが送られないようにすることができます</block>
  <block id="117704664d6cada78ac3107380f63d23" category="cell">Disk.QFullSampleSize</block>
  <block id="0e82e1f81de2159b0e9bee0b7be00dc9" category="cell">すべての構成で 32 に設定されます。
この値を設定すると、 I/O エラーの防止に役立ちます。</block>
  <block id="f66a3c183f0e736240b77f8b755c880e" category="cell">Disk.qFullThreshold</block>
  <block id="bdd8c1d08eabb5e1923ed8f0c4b10ba4" category="cell">すべての構成で 8 に設定します。
この値を設定すると、 I/O エラーの防止に役立ちます。</block>
  <block id="19c08de7404551288e1274186e039ef4" category="cell">Emulex FC HBA タイムアウト</block>
  <block id="b4dbfc2d52627e923cbb563a31ff756d" category="cell">デフォルト値を使用します。</block>
  <block id="d46cddda4da7ec11f17472d11df95b68" category="cell">QLogic FC HBA タイムアウト</block>
  <block id="19b5aaf3e2cb86809996ca63a2a416b0" category="cell">* iSCSI 設定 *</block>
  <block id="2aa077454308383f1e82025427cd7362" category="cell">すべての iSCSI パスで RR （ラウンドロビン）に設定されます。
この値を RR に設定すると、最適化されたすべてのアクティブなパスで負荷を分散できます。</block>
  <block id="0340eb1bcbfc6cd3c62b8a878d8d643b" category="cell">すべての構成で 32 に設定されます。
この値を設定すると、I/Oエラーの防止に役立ちます</block>
  <block id="891c10448731ad57490b9a932dabfff8" category="inline-link-macro">VMware KB 86331</block>
  <block id="2c572e3c397fe100b075a09359c9cc23" category="admonition">VMware vSphere ESXi 7.0.1およびVMware vSphere ESXi 7.0.2を使用する場合、1-NFSの高度な設定オプションMaxQueueDepthが想定どおりに機能しないことがあります。参照してください <block ref="861055760f3cd527823fd34a49459992" category="inline-link-macro-rx"></block> を参照してください。</block>
  <block id="fb55ee99c04280ac638757869929785d" category="paragraph">ONTAP ツールでは、 ONTAP FlexVol および LUN の作成時に特定のデフォルト設定も指定されます。</block>
  <block id="3f7502a5f109d7a73706aba1c0741a4b" category="cell">* ONTAP ツール*</block>
  <block id="485577e97e8efcd504fc8e8b13e613f1" category="cell">*デフォルト設定*</block>
  <block id="5938fe448c8661febcef3f4e779e3adb" category="cell">Snapshot リザーブ（ -percent-snapshot-space ）</block>
  <block id="cfcd208495d565ef66e7dff9f98764da" category="cell">0</block>
  <block id="7218aec62575561a6de1cae8d5658390" category="cell">フラクショナルリザーブ（ -fractional-reserve ）</block>
  <block id="3a7e09ff0fa38663ffe6d91324ea75d9" category="cell">アクセス時間の更新（ -atime-update ）</block>
  <block id="f8320b26d30ab433c5a54546d21f414c" category="cell">いいえ</block>
  <block id="e93200d5b0d16915bf04236790544b2f" category="cell">最小限の先読み（ -min-readahead ）</block>
  <block id="c877d89702fdd14e51b02028a20c7d07" category="cell">スケジュールされたSnapshot</block>
  <block id="fd18465573ec21a6218982055981f6b1" category="cell">ストレージ効率</block>
  <block id="00d23a76e43b46dae9ec7aa9dcbebb32" category="cell">有効</block>
  <block id="f65fd63b63c9e9f25bf6bc141e83de34" category="cell">ボリュームギャランティ</block>
  <block id="c2410aebdf425dabcc65e546e506b03e" category="cell">なし（シンプロビジョニング）</block>
  <block id="f97c03bf3e9580446d70d479f5aad1e0" category="cell">ボリュームのオートサイズ</block>
  <block id="d89f4f8b1d7c18847b88b46142f61535" category="cell">grow_shrink</block>
  <block id="ace72ec54e17777d27eb8bdb9d57e782" category="cell">LUN のスペースリザベーション</block>
  <block id="b9f5c797ebbf55adccdd8539a65a0241" category="cell">無効</block>
  <block id="514aa7792a71ab4ab677eb2385131aae" category="cell">LUN スペースの割り当て</block>
  <block id="dbe1e98b00264bd496095ed5c95f9350" category="section-title">ハフオマンスノマルチハスセツテイ</block>
  <block id="de9f44b08eec22d6b405acff2c925d56" category="paragraph">現在使用可能なONTAPツールでは設定されていませんが、NetAppでは次の設定オプションを推奨しています。</block>
  <block id="840731ae1cb9e4b23e19f645ab018b6f" category="inline-link">2069356</block>
  <block id="5073fc9da327263a7db04fd449991e6a" category="list-text">ハイパフォーマンスな環境で、または単一の LUN データストアでパフォーマンスをテストする場合は、ラウンドロビン（ VMW_PSP_RR ）パス選択ポリシー（ PSP ）の負荷分散設定をデフォルトの IOPS 設定 1000 から 1 に変更することを検討します。VMware の技術情報を参照<block ref="f3f4762788a6845119bdb5b9c9179bda" category="inline-link-rx"></block> 詳細については、</block>
  <block id="1ea3eb55b985cf75e100607ee8bd935d" category="inline-link">パス選択プラグインとポリシー</block>
  <block id="249afbf456bd04d574e8d362d5bf133c" category="list-text">vSphere 6.7 Update 1 では、 VMware がラウンドロビン PSP 用に新しいレイテンシの負荷分散メカニズムを導入しました。新しいオプションでは、 I/O に最適なパスを選択する際に、 I/O 帯域幅とパスレイテンシが考慮されます1 つのパスに別のパスよりも多くのネットワークホップがある場合や、 NetApp All SAN Array システムを使用している場合など、パス接続に同等でない環境では、この方法を使用するとメリットが得られます。を参照してください<block ref="f5ecc69f2970e2e9c8638ad278ec38f7" category="inline-link-rx"></block> を参照してください。</block>
  <block id="01d954fb2edbf283d121f0651b04de83" category="section-title">その他のドキュメント</block>
  <block id="40db5019ed68654f4eb2cf21ec5021db" category="inline-link">VMware vSphere 7.xとONTAPの併用</block>
  <block id="30d85838b9488ee908d075559c8978cd" category="inline-link">VMware vSphere 8.xとONTAPの併用</block>
  <block id="000c9205416c1ea85f6841a7ca379c17" category="inline-link">NVMe-oFの詳細については、「NVMe-oFホスト構成（ESXi 7.x with ONTAP）」を参照してください。</block>
  <block id="5a27e6dbe6279e323aec51d205b2b455" category="inline-link">NVMe-oFの詳細については、「NVMe-oFホスト構成（ESXi 8.x with ONTAP）」を参照してください。</block>
  <block id="842acd8b4932f6c9329df8e0fefe8b9b" category="paragraph">vSphere 7を使用するFCPおよびiSCSIの詳細については、を参照してください。<block ref="f3eae508de4d3c1748a9c65337197b21" category="inline-link-rx"></block>
vSphere 8を使用するFCPおよびiSCSIの詳細については、を参照してください。<block ref="3f8db75ee0177b85df9cdf31ddb51abe" category="inline-link-rx"></block>
vSphere 7を使用したNVMe-oFの詳細については、を参照してください。<block ref="6c040a6e611e78bb9d0ad92946e613ea" category="inline-link-rx"></block>
vSphere 8を使用したNVMe-oFの詳細については、を参照してください。<block ref="030788e4c7bbe3137759b534ea62d7d9" category="inline-link-rx"></block></block>
  <block id="99a66df20e19a8e18fae37a7f714750a" category="doc">VM とデータストアのクローニング</block>
  <block id="fe12a277656562082ad50b980c227a84" category="paragraph">vSphere では、 VM 、仮想ディスク、 VVOL 、またはデータストアをクローニングできます。クローニングされたオブジェクトは、多くの場合、自動化されたプロセスによってさらにカスタマイズできます。vSphere では、フルコピークローンとリンククローンの両方がサポートされます。リンククローンでは、元のオブジェクトとは別に変更が追跡されます。</block>
  <block id="883a97a36ab0c59ec785b03161a1cc32" category="paragraph">リンククローンはスペースを節約するのに適していますが、 vSphere が VM に対して処理する I/O 量が増えるため、その VM のパフォーマンスや場合によってはホスト全体のパフォーマンスに影響します。そのため、NetAppのお客様は、ストレージシステムベースのクローンを使用して、ストレージの効率的な使用とパフォーマンスの向上という2つのメリットを活用することがよくあります。</block>
  <block id="17e1a153b5d05c5a642c93ba9ce3c6de" category="paragraph">次の図は、 ONTAP クローニングを示しています。</block>
  <block id="8ee3cd3dba25fb32f1bc38cb528ac998" category="paragraph"><block ref="8ee3cd3dba25fb32f1bc38cb528ac998" category="inline-image-macro-rx" type="image"></block></block>
  <block id="76ee7355875ad5e9f56186ff7da961f6" category="paragraph">クローニングは、 ONTAP ソフトウェアを実行するシステムに複数のメカニズムを使用してオフロードできます。通常は、 VM 、 VVol 、データストアのレベルでオフロードします。これには次のものが含まれます。</block>
  <block id="d957242cd67db8ffccec78d93c14449d" category="list-text">NetApp vSphere APIs for Storage Awareness （ VASA ） Provider を使用した VVol のクローニング。  vCenterで管理されるVVol Snapshotをサポートするために、ONTAPクローンを使用します。VVol Snapshotの作成や削除によるI/Oへの影響は最小限で、スペース効率に優れています。  VM のクローニングは vCenter を使用して行うこともでき、 1 つのデータストア / ボリューム内かデータストア / ボリューム間かに関係なく、 ONTAP にオフロードされます。</block>
  <block id="059e5a6b7f963e9876ba0129dc1b667d" category="list-text">vSphere APIs – Array Integration （ VAAI ）を使用した vSphere のクローニングと移行：SAN 環境と NAS 環境の両方で、 VM のクローニング処理を ONTAP にオフロードできます（ネットアップでは、 NFS 用の VAAI を有効にするために ESXi プラグインを提供しています）。  vSphere は、 NAS データストア内のコールド（電源オフ） VM にのみオフロードします。一方、ホット VM （クローニングと Storage vMotion ）の処理も SAN にオフロードされます。ONTAP では、ソース、デスティネーション、インストールされている製品ライセンスに基づいて最も効率的なアプローチを採用しています。この機能は VMware Horizon View でも使用されています。</block>
  <block id="a603c207c7b5801942ff108502676c12" category="list-text">SRA （ VMware Site Recovery Manager で使用）。ここでは、クローンを使用して、 DR レプリカのリカバリを無停止でテストします。</block>
  <block id="bb300d356d258c084dbe5da2ca367e08" category="list-text">SnapCenter などのネットアップのツールを使用したバックアップとリカバリVM クローンは、バックアップ処理の検証や VM バックアップのマウントに使用され、個々のファイルをコピーできるようにします。</block>
  <block id="524b5b8bc03312baeafbea86df667c4b" category="paragraph">ONTAP オフロードクローニングは、 VMware 、ネットアップ、サードパーティのツールから実行できます。ONTAP にオフロードされたクローンには、いくつかのメリットがあります。ほとんどの場合、スペース効率に優れており、オブジェクトの変更にのみ対応するストレージが必要です。読み取りや書き込みのパフォーマンスには影響しません。また、高速キャッシュでブロックを共有することでパフォーマンスが向上する場合もあります。また、 CPU サイクルとネットワーク I/O も ESXi サーバからオフロードされます。FlexVol を使用する従来のデータストア内でのコピーオフロードは、 FlexClone ライセンスを使用すると高速かつ効率的ですが、 FlexVol 間のコピーの方が低速になる可能性があります。VM テンプレートをクローンのソースとして管理する場合は、スペース効率に優れた高速クローンを作成するために、テンプレートをデータストアボリューム内に配置することを検討してください（フォルダやコンテンツライブラリを使用してテンプレートを整理します）。</block>
  <block id="f3968368501d882b3969da59138db6e2" category="paragraph">ONTAP 内で直接ボリュームまたは LUN をクローニングして、データストアをクローニングすることもできます。NFS データストアの場合は、 FlexClone テクノロジでボリューム全体をクローニングし、 ONTAP からクローンをエクスポートして、別のデータストアとして ESXi にマウントできます。VMFS データストアの場合は、ボリューム内の LUN 、または 1 つ以上の LUN を含むボリューム全体を ONTAP でクローニングできます。VMFS を含む LUN を通常のデータストアとしてマウントして使用するためには、 LUN を ESXi igroup にマッピングし、 ESXi から再署名を受ける必要があります。ただし一部の一時的なユースケースでは、クローニングされた VMFS を再署名なしでマウントすることができます。クローニングしたデータストア内の VM は、個別にクローニングした VM と同様に登録、再設定、およびカスタマイズすることができます。</block>
  <block id="2d506b6088a383ccf08479b0f80c0ff4" category="paragraph">バックアップや FlexClone 用の SnapRestore など、追加のライセンス機能を使用してクローニングを強化できる場合があります。これらのライセンスは、追加コストなしでライセンスバンドルに含まれていることがよくあります。FlexCloneライセンスは、VVolのクローニング処理や、VVolの管理対象Snapshot（ハイパーバイザーからONTAPにオフロードされる）をサポートするために必要です。FlexClone をデータストア / ボリューム内で使用すると、特定の VAAI ベースのクローンの品質を向上させることもできます（ブロックコピーではなく、スペース効率に優れたコピーが瞬時に作成されます）。  また、 DR レプリカのリカバリをテストする際に SRA で使用され、クローニング処理用に SnapCenter でバックアップコピーを参照して個々のファイルをリストアする際にも使用されます。</block>
  <block id="5dd57c2a315d3af44c2eb40eefc47111" category="doc">ネットワーク構成：</block>
  <block id="66507f357c74ee12194270cfe053b98d" category="paragraph">考慮すべき点をいくつか挙げます。</block>
  <block id="b3752ab8dec37db2e30f4bf37fbdc112" category="list-text">ストレージネットワークのトラフィックを他のネットワークから分離します。専用の VLAN を使用するか、ストレージ用に別個のスイッチを使用することで、別のネットワークを実現できます。ストレージネットワークがアップリンクなどの物理パスを共有している場合は、十分な帯域幅を確保するために QoS または追加のアップリンクポートが必要になることがあります。ホストをストレージに直接接続しないでください。スイッチを使用して冗長パスを確保し、VMware HAが介入なしで機能できるようにします。</block>
  <block id="7c4904daaa282388097ad83bf382e1a5" category="list-text">ジャンボフレームは、必要に応じてネットワークでサポートされていれば、特に iSCSI を使用している場合に使用できます。使用する場合は、ストレージと ESXi ホストの間のパスにあるすべてのネットワークデバイスや VLAN で設定が同じであることを確認してください。そうしないと、パフォーマンスや接続の問題が発生する可能性があります。MTU は、 ESXi 仮想スイッチ、 VMkernel ポート、および各 ONTAP ノードの物理ポートまたはインターフェイスグループでも同一の設定にする必要があります。</block>
  <block id="8b6e7f43d1d697e8f99164f0aa2ab1b6" category="inline-link">TR-4182</block>
  <block id="3745abd352adaa2cdec42c798060eef6" category="list-text">ネットワークフロー制御は、 ONTAP クラスタ内のクラスタネットワークポートでのみ無効にすることを推奨します。データトラフィックに使用される残りのネットワークポートについては、推奨されるベストプラクティスはありません。必要に応じて有効または無効にしてください。を参照してください<block ref="bdfb81665a0ef86d871a52c0e6ebc591" category="inline-link-rx"></block> を参照してください。</block>
  <block id="730a8287f758961d602b1b050bbe2751" category="list-text">ESXi および ONTAP ストレージアレイをイーサネットストレージネットワークに接続するときは、接続先のイーサネットポートを Rapid Spanning Tree Protocol （ RSTP ；高速スパニングツリープロトコル）のエッジポートとして設定するか、 Cisco の PortFast 機能を使用して設定することを推奨します。ネットアップでは、 Cisco の PortFast 機能を使用していて、 ESXi サーバまたは ONTAP ストレージアレイへの 802.1Q VLAN トランキングが有効になっている環境では、 Spanning-Tree PortFast trunk 機能を有効にすることを推奨します。</block>
  <block id="ac4976538e1fc8726f77afc202561afc" category="list-text">リンクアグリゲーションのベストプラクティスとして次を推奨します。</block>
  <block id="301c77ecc6cdfa6ebde6c8164cffae0c" category="list-text">CiscoのVirtual PortChannel（vPC）などのマルチシャーシリンクアグリゲーショングループアプローチを使用して、2つの別 々 のスイッチシャーシ上のポートのリンクアグリゲーションをサポートするスイッチを使用します。</block>
  <block id="19d137845c7f6687c99b386dfad0aa97" category="list-text">LACPが設定されたdvSwitches 5.1以降を使用していない場合、ESXiに接続されているスイッチポートのLACPを無効にします。</block>
  <block id="30254a2bb3e4b3b958b06d08c724e7db" category="list-text">LACPを使用して、IPハッシュを持つダイナミックマルチモードインターフェイスグループを持つONTAP ストレージシステムのリンクアグリゲートを作成します。</block>
  <block id="d608421cceb8e4c584a2a32d9127879e" category="list-text">ESXiでIPハッシュチーミングポリシーを使用します。</block>
  <block id="2432030fc6183a1a6c52cf5e93f3e9ae" category="paragraph">次の表に、ネットワーク設定項目とその適用先をまとめます。</block>
  <block id="7d74f3b92b19da5e606d737d339a9679" category="cell">項目</block>
  <block id="1aa66ef3a8e34a7a538960a80d2e1e31" category="cell">ESXi</block>
  <block id="bbc155fb2b111bf61c4f5ff892915e6b" category="cell">スイッチ</block>
  <block id="6c3a6944a808a7c0bbb6788dbec54a9f" category="cell">ノード</block>
  <block id="0b7e67b6cdcf0432b624d53588d520fb" category="cell">SVM</block>
  <block id="75ba8d70e3692ba200f0e0df37b4d2ae" category="cell">IP アドレス</block>
  <block id="ee6c0f25c2881cc69947a2ef23be5b8c" category="cell">VMkernel</block>
  <block id="e11f298a5bd5344d2d975b5157c27b69" category="cell">いいえ **</block>
  <block id="d6f0876f76c273b8962b749c36153157" category="cell">リンクアグリゲーション</block>
  <block id="fabd320b3b2249377e53e93099e27657" category="cell">仮想スイッチ</block>
  <block id="b1b40427c8eb8d0a083ddb16e250325b" category="cell">いいえ *</block>
  <block id="9881f82f0dd89588831f9d1682bd5492" category="cell">VLAN</block>
  <block id="5fc0d231160fa9650ea5c877f146bbe6" category="cell">VMkernel と VM ポートグループ</block>
  <block id="39a3e05f380e583ae2887c79c7443f11" category="cell">フロー制御</block>
  <block id="220071ab44b426f80ef21f1c552c363c" category="cell">NIC</block>
  <block id="6f2c08412f489e52a17a30217f50b3c1" category="cell">スパニングツリー</block>
  <block id="4b1c0df98ba3f3d1681c3c3dbdc97746" category="cell">MTU （ジャンボフレーム用）</block>
  <block id="7d6feaf896df4a937157d4ee5b91f4e1" category="cell">仮想スイッチと VMkernel ポート（ 9000 ）</block>
  <block id="0110e50bd8629573701e73a4ba8b056f" category="cell">○（最大に設定）</block>
  <block id="061ff5255adf00e4ae68469f43a7bf55" category="cell">○（ 9000 ）</block>
  <block id="bcc0e5a3e08cd34e80692195d056b06d" category="cell">フェイルオーバーグループ</block>
  <block id="a4d1a66a448e327c12d3e287098a31d5" category="cell">○（作成）</block>
  <block id="465d5674eb6808b997037470f4dace73" category="cell">○（選択）</block>
  <block id="ba78d695573c8d4f1205452c675fa539" category="paragraph">* SVM LIFは、VLANやMTUなどが設定されたポート、インターフェイスグループ、またはVLANインターフェイスに接続します。ただし、設定の管理はSVMレベルではありません。</block>
  <block id="50ecdab93bf5a2f1bfb4cd8f81b9bd3d" category="paragraph">** これらのデバイスには管理用に独自の IP アドレスがありますが、 ESXi ストレージネットワークのコンテキストでは使用されません。</block>
  <block id="efd0bde36323238fec688b9cdf0c75a3" category="section-title">SAN （ FC 、 FCoE 、 NVMe/FC 、 iSCSI ）、 RDM</block>
  <block id="29cdd488736a6111699f7348320bbed7" category="paragraph">vSphere では、ブロックストレージ LUN を 3 通りの方法で使用します。</block>
  <block id="8982d243303f9d1a8c2470b7d55278e6" category="list-text">VMFS データストアを使用する場合</block>
  <block id="9a0098c8c1be287e8d1da1aaf3bd2e59" category="list-text">raw デバイスマッピング（ RDM ）で使用</block>
  <block id="93e209176746ac6f25c618631a02643b" category="list-text">ソフトウェアイニシエータがアクセスおよび制御する LUN として使用 VM ゲスト OS から作成します</block>
  <block id="c25dc676ca39a05ee6067ac9a50dbce0" category="paragraph">VMFS は、共有ストレージプールであるデータストアを提供する、高性能なクラスタファイルシステムです。VMFS データストアは、 NVMe/FC プロトコルによってアクセスされる FC 、 iSCSI 、 FCoE 、または NVMe ネームスペースを使用してアクセスする LUN で構成できます。VMFS を使用すると、クラスタ内の各 ESX サーバから同時に従来型の LUN にアクセスすることができます。ONTAP の最大 LUN サイズは通常 16TB であるため、最大サイズの 64TB （このセクションの最初の表を参照）の VMFS 5 データストアは、 4 つの 16TB LUN を使用して作成されます（すべての SAN アレイシステムが最大 VMFS LUN サイズ 64TB をサポート）。ONTAP LUN アーキテクチャでは個々のキュー深度が小さくないため、 ONTAP の VMFS データストアは、比較的簡単な方法で従来のアレイアーキテクチャよりも大規模に拡張できます。</block>
  <block id="43f67f108e50dab0978a343603cbfec9" category="paragraph">vSphere は、ストレージデバイスへの複数のパスを標準でサポートします。この機能はネイティブマルチパス（ NMP ）と呼ばれます。NMP は、サポートされるストレージシステムのストレージタイプを検出し、使用中のストレージシステムの機能をサポートするように NMP スタックを自動的に設定できます。</block>
  <block id="6bf646772584de04f877d166e564b5ff" category="paragraph">NMP と NetApp ONTAP はどちらも、 Asymmetric Logical Unit Access （ ALUA ；非対称論理ユニットアクセス）による最適パスと非最適パスのネゴシエーションをサポートします。ONTAP では、アクセス対象の LUN をホストするノード上のターゲットポートを使用する直接データパスが、 ALUA の最適パスとなります。ALUA は、 vSphere と ONTAP の両方でデフォルトで有効になっています。NMPはONTAPクラスタをALUAとして認識し、ALUAストレージアレイタイププラグインを使用します。 <block ref="d4f7bd3bf4872a2f8cd0cbe400fb23d0" prefix="(" category="inline-code"></block>）を入力し、ラウンドロビンパス選択プラグインを選択します。 <block ref="4646bb781f9a95f64c182af129e43c7c" prefix="(" category="inline-code"></block>）。</block>
  <block id="b284ee628d89c3e804c4def2a90f0520" category="paragraph">ESXi 6 は、最大 256 個の LUN と、 LUN への最大 1 、 024 個の合計パスをサポートします。これらの制限を超える LUN やパスは、 ESXi で認識されません。最大数の LUN を使用した場合、 LUN あたりのパス数は最大 4 つです。大規模な ONTAP クラスタでは、 LUN 数の上限に達する前にパス数の制限に達する可能性があります。この制限に対処するため、 ONTAP では、リリース 8.3 以降の選択的 LUN マップ（ SLM ）がサポートされています。</block>
  <block id="8466b1e5abb4751e931c5feb1af4e469" category="inline-link">TR-4080</block>
  <block id="e9e7de5d01d51034d9114fd8f16c9144" category="paragraph">SLM は、特定の LUN へのパスをアドバタイズするノードを制限します。ネットアップのベストプラクティスでは、各 SVM のノードごとに少なくとも 1 つの LIF を配置し、 SLM を使用して、 LUN とその HA パートナーをホストするノードへのアドバタイズパスを制限することを推奨しています。他のパスは存在しますが、デフォルトではアドバタイズされません。SLM 内で、レポートノードの追加引数および削除引数を使用して通知されたパスを変更することができます。8.3 より前のリリースで作成された LUN ではすべてのパスがアドバタイズされるため、ホストしている HA ペアへのパスのみがアドバタイズされるように変更する必要があることに注意してください。SLM の詳細については、のセクション 5.9 を参照してください<block ref="c6b12416d518b4689065ffe16afe88db" category="inline-link-rx"></block>。以前のポートセットの方式を使用すると、 LUN の使用可能なパスをさらに削減できます。ポートセットを使用すると、 igroup 内のイニシエータが LUN を認識する際に経由可能なパス数を減らすことができます。</block>
  <block id="4157f0c23fc104508f492dc846f187f3" category="list-text">SLM はデフォルトでは有効になっています。ポートセットを使用しないかぎり、これ以上の設定は必要ありません。</block>
  <block id="597f1433ad810b3b86c7ae0f8f95afa8" category="list-text">Data ONTAP 8.3より前のバージョンで作成したLUNの場合、次のコマンドを実行してSLMを手動で適用します。<block ref="886fd385b633a0746a8a08f8f00c67cd" prefix=" " category="inline-code"></block> LUNレポートノードを削除し、LUNへのアクセスをLUNの所有者ノードとそのHAパートナーに制限するコマンド。</block>
  <block id="43919b4d4d6d446ed498e26bff62db84" category="paragraph">ブロックプロトコル（ iSCSI 、 FC 、 FCoE ）は、一意の名前に加え、 LUN ID とシリアル番号を使用して LUN にアクセスします。FC と FCoE は Worldwide Name （ WWNN および WWPN ）を使用し、 iSCSI は iSCSI Qualified Name （ IQN ）を使用します。ストレージ内での LUN へのパスはブロックプロトコルにとっては意味がないため、どこにも表示されません。したがって、 LUN のみが含まれるボリュームは内部でマウントする必要がなく、データストアで使用される LUN を含むボリュームのジャンクションパスも必要ありません。ONTAP の NVMe サブシステムも同様に機能します。</block>
  <block id="ed0e76ed86e852bd7317a09d856ec4e8" category="paragraph">考慮すべきその他のベストプラクティス：</block>
  <block id="93586ad57931e0f16fff61cdba9d77df" category="list-text">可用性と移動性を最大限に高めるために、 ONTAP クラスタ内の各ノード上の各 SVM に論理インターフェイス（ LIF ）が作成されていることを確認します。ONTAP SAN では、各ファブリックに対して 1 つずつ、ノードごとに 2 つの物理ポートと LIF を使用することを推奨します。ALUA を使用してパスが解析され、アクティブな最適化（直接）パスとアクティブな非最適化パスが特定されます。ALUA は FC 、 FCoE 、および iSCSI に使用されます。</block>
  <block id="b3cebb7381bddbabb1e950a46d264190" category="list-text">iSCSI ネットワークの場合、複数の仮想スイッチがある場合は、 NIC チーミングを使用して、異なるネットワークサブネット上の複数の VMkernel ネットワークインターフェイスを使用します。また、複数の物理スイッチに接続された複数の物理 NIC を使用して、 HA を実現し、スループットを向上させることもできます。次の図に、マルチパス接続の例を示します。ONTAP では、 2 つ以上のスイッチに接続された 2 つ以上のリンクでフェイルオーバーするシングルモードインターフェイスグループを設定するか、 LACP または他のリンクアグリゲーションテクノロジをマルチモードインターフェイスグループと併用して HA を実現し、リンクアグリゲーションのメリットを活かすことができます。</block>
  <block id="2968b9f3c141bf23bc73d0e6e15a174a" category="list-text">ESXiでターゲット認証にチャレンジハンドシェイク認証プロトコル（CHAP）が使用されている場合は、CLIを使用してONTAPでもCHAPを設定する必要があります。 <block ref="199c9b970eacf1c35d84a383b7ceb210" prefix="(" category="inline-code"></block>）またはSystem Managerで（[ストレージ]&gt;[SVM]&gt;[SVM設定]&gt;[プロトコル]&gt;[iSCSI]で[イニシエータセキュリティ]を編集します）。</block>
  <block id="d31f2e075df4ca75ca0874fa08f74b12" category="list-text">LUN と igroup の作成と管理には、 VMware vSphere の ONTAP ツールを使用します。プラグインによってサーバの WWPN が自動的に判別され、適切な igroup が作成されます。また、ベストプラクティスに従って LUN を設定し、正しい igroup にマッピングします。</block>
  <block id="de78559e8aed2cd62fbf852f73dc58c2" category="inline-link">物理互換モードと仮想互換モード</block>
  <block id="905221150fdd103b5241870a0a1f2c42" category="list-text">RDMは管理が困難になる可能性があるため、使用には注意が必要です。また、前述したように制限されているパスも使用します。ONTAP LUN は両方をサポートします<block ref="27e1f8e5a88cfbb2836b083145b004c9" category="inline-link-rx"></block> RDM ：</block>
  <block id="636da39a2033c6179a718983c5ce1222" category="inline-link">ONTAP NVMe/FC Host Configuration Guide</block>
  <block id="81ef6507a13da5635951bc5b533deb59" category="inline-link">TR-4684</block>
  <block id="15483b0826bb9a4b11d1c89af2029c5c" category="list-text">vSphere 7.0 での NVMe/FC の使用については、以下を参照してください<block ref="6b4ed262d14e47ef641cd57b65c32c38" category="inline-link-rx"></block> および<block ref="7a29b2f31035a451d5b068728d2b79a7" category="inline-link-rx"></block>次の図に、 vSphere ホストから ONTAP LUN へのマルチパス接続を示します。</block>
  <block id="f9fd9ea22ea7a2e8ec9e95254a449831" category="paragraph"><block ref="f9fd9ea22ea7a2e8ec9e95254a449831" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f2a693e1f056b96566c4551fcab418f2" category="paragraph">vSphere を使用すると、エンタープライズクラスの NFS アレイを使用して、 ESXi クラスタ内のすべてのノードへのデータストアへの同時アクセスを提供できます。データストアのセクションで説明したように、 vSphere で NFS を使用すると、使いやすさが向上し、ストレージ効率を可視化できるというメリットがあります。</block>
  <block id="743fa5a7bc7d4ba215b096e34779d298" category="paragraph">vSphere で ONTAP NFS を使用する際に推奨されるベストプラクティスは次のとおりです。</block>
  <block id="c05061b6d3055b83136fa96cb38f0f9a" category="list-text">ONTAP クラスタ内の各ノードの各 SVM で、 1 つの論理インターフェイス（ LIF ）を使用します。データストアごとの LIF の過去の推奨事項は不要になりました。直接アクセス（同じノード上のLIFとデータストア）を推奨しますが、一般にパフォーマンスへの影響は最小限（マイクロ秒）であるため、間接アクセスについて心配する必要はありません。</block>
  <block id="7b997b3be9c993d49799dd9d71d8c3f6" category="list-text">VMware は、 VMware Infrastructure 3 以降で NFSv3 をサポートしています。vSphere 6.0 では NFSv4.1 がサポートされるようになり、 Kerberos セキュリティなどの高度な機能が使用できるようになりました。NFSv3 ではクライアント側のロックが使用され、 NFSv4.1 ではサーバ側のロックが使用されます。ONTAP ボリュームは両方のプロトコルでエクスポートできますが、 ESXi は 1 つのプロトコルでしかマウントできません。この単一プロトコルのマウントにより、他の ESXi ホストが同じデータストアを別のバージョンでマウントすることができるわけではありません。すべてのホストが同じバージョン、つまり同じロック形式を使用するように、マウント時に使用するプロトコルバージョンを指定してください。NFS のバージョンをホスト間で混在させないでください。可能であれば、ホストプロファイルを使用して準拠しているかどうかを確認します</block>
  <block id="ae4c5baa79e370d8f601cc7082f8123e" category="list-text">NFSv3 と NFSv4.1 間ではデータストアが自動変換されないため、新しい NFSv4.1 データストアを作成し、 Storage vMotion を使用して新しいデータストアに VM を移行します。</block>
  <block id="8065bff4940ae8d7161f926b0df47ac4" category="inline-link">NetApp Interoperability Matrix Tool で確認できます</block>
  <block id="1479ddf58c038ab7d220ff734c74deaf" category="list-text">に記載されている NFS v4.1 と相互運用性に関する表の注を参照してください<block ref="8813559f5b95abb5411182be29200aff" category="inline-link-rx"></block> をサポートするには、特定の ESXi パッチレベルが必要です。</block>
  <block id="24aaa4a688e881fa13d31656a85d40a9" category="list-text">NFS エクスポートポリシーは、 vSphere ホストによるアクセスの制御に使用されます。複数のボリューム（データストア）で 1 つのポリシーを使用できます。NFSv3 では、 ESXi で sys （ UNIX ）セキュリティ形式が使用され、 VM を実行するためにルートマウントオプションが必要となります。ONTAP では、このオプションはスーパーユーザと呼ばれます。スーパーユーザオプションを使用する場合は、匿名ユーザ ID を指定する必要はありません。の値が異なるエクスポートポリシールールに注意してください<block ref="ea72d12ecaa06afdb0c8a3b15e485e95" prefix=" " category="inline-code"></block> および<block ref="df809a941c1287d18c08bb5927b639dc" prefix=" " category="inline-code"></block> 原因 SVM検出がONTAP ツールで問題を検出できるかどうか。ポリシーの例を次に示します。</block>
  <block id="822366735aef72f1a9429ac86dda7338" category="list-text">Access Protocol ： nfs3</block>
  <block id="69abbd5c7cd9c1b3828b9aa5a894ff47" category="list-text">クライアント一致仕様： 192.168.42.21</block>
  <block id="bd6cc42f9cd65cca72cbd56d2f4bf43d" category="list-text">RO アクセスルール： sys</block>
  <block id="581c470a5099548fc9865a4bab8761f8" category="list-text">RWアクセスルール:sys</block>
  <block id="0bbc71e6a4ea49af70dd616d3807e524" category="list-text">匿名UIDの形式です</block>
  <block id="59d5d8c898df18115bd4ced36c6bc0de" category="list-text">superuser ： sys</block>
  <block id="c184ce6b86d2e6fbf8681d61637c101b" category="list-text">NetApp NFS Plug-in for VMware VAAIを使用する場合は、プロトコルをに設定する必要があります。<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block> エクスポートポリシールールが作成または変更されたとき。VAAIコピーオフロードが機能するためには、次のように指定してNFSv4プロトコルが必要です。<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block> NFSv3とNFSv4の両方のバージョンが自動的に含まれます。</block>
  <block id="6670a317619282ec228a9ef492af0a76" category="list-text">NFS データストアのボリュームは SVM のルートボリュームからジャンクションされるため、 ESXi がデータストアボリュームに移動してマウントするためにはルートボリュームへのアクセス権も必要となります。ルートボリューム、およびデータストアボリュームのジャンクションがネストされているその他のボリュームのエクスポートポリシーには、ESXiサーバに読み取り専用アクセスを許可するルールが含まれている必要があります。VAAIプラグインを使用したルートボリュームのポリシーの例を次に示します。</block>
  <block id="8c93fb3ff528165613797962f5a0ed9c" category="list-text">Access Protocol：nfs（nfs3とnfs4の両方を含む）</block>
  <block id="80e6a4f964e826c69c1c62bd5ea67590" category="list-text">RW Access Rule：never（ルートボリュームに最適なセキュリティ）</block>
  <block id="f96625174b4a06d13267f9b0a5a96d59" category="list-text">superuser：sys（VAAIを使用するルートボリュームの場合も必要）</block>
  <block id="4c571520a8128d1692fc709ffbfb2b1e" category="list-text">VMware vSphere 用の ONTAP ツール（最も重要なベストプラクティス）を使用：</block>
  <block id="b8d278c6184cb65727ca5ae729db92d7" category="list-text">VMware vSphere 用の ONTAP ツールを使用してデータストアをプロビジョニングすると、エクスポートポリシーの自動管理が簡易化されます。</block>
  <block id="23aa7b9aeed3fba2a1ec43e630313af7" category="list-text">プラグインを使用してVMwareクラスタ用のデータストアを作成するときは、単一のESXサーバではなくクラスタを選択します。これにより、データストアがクラスタ内のすべてのホストに自動的にマウントされます。</block>
  <block id="e4e62770daaf9887c7868fbc8e248a4b" category="list-text">プラグインのマウント機能を使用して、既存のデータストアを新しいサーバに適用します。</block>
  <block id="928562eb576ed6ae31cb1a149d3e751a" category="list-text">VMware vSphere 用の ONTAP ツールを使用しない場合は、すべてのサーバ、または追加のアクセス制御が必要なサーバクラスタごとに、 1 つのエクスポートポリシーを使用します。</block>
  <block id="7bccab0fa4c0864835c645c9fde7ebf6" category="list-text">ONTAP にはフレキシブルボリュームのネームスペース構造が用意されており、ジャンクションを使用してボリュームをツリーにまとめることができますが、このアプローチは vSphere には価値がありません。ストレージのネームスペース階層に関係なく、データストアのルートに各 VM 用のディレクトリが作成されます。そのため、単に SVM のルートボリュームに vSphere のボリュームのジャンクションパスをマウントすることがベストプラクティスです。これは、 VMware vSphere 用の ONTAP ツールでデータストアをプロビジョニングする方法です。ジャンクションパスがネストされていないと、ルートボリューム以外のボリュームに依存しているボリュームがないこと、またボリュームをオフラインにするか破棄するかによって意図的に他のボリュームへのパスに影響が及ぶこともありません。</block>
  <block id="ea6fc1288f1d3b21238d29ff28cb867a" category="list-text">NFS データストアの NTFS パーティションのブロックサイズは 4K で十分です。次の図は、 vSphere ホストから ONTAP NFS データストアへの接続を示しています。</block>
  <block id="16c864cb4f3b00c59e1124932e49f342" category="paragraph"><block ref="16c864cb4f3b00c59e1124932e49f342" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e54433644e830ed1503561b778e9ded4" category="paragraph">次の表に、 NFS のバージョンとサポートされる機能を示します。</block>
  <block id="9fb9dac7513c7ef8452aade8a52ad40d" category="cell">vSphere の機能</block>
  <block id="5b12ee0369243579651edca43ff65c85" category="cell">NFSv3</block>
  <block id="de841868c2911da76b8ae2da9fa3166d" category="cell">NFSv4.1</block>
  <block id="64e3cc476958b05086721cd6070004cf" category="cell">vMotion と Storage vMotion</block>
  <block id="05807e454c19f244770adae059b3c330" category="cell">高可用性</block>
  <block id="45a75e44a713fdf94dbf1dbaa0749188" category="cell">フォールトトレランス</block>
  <block id="f1e3446c69e4d87279ff7863482f9dcb" category="cell">DRS</block>
  <block id="6ca09f98e8925b2cb78bbf24eccc0186" category="cell">ホストプロファイル</block>
  <block id="ec8420797e3b089812499cce4047ded8" category="cell">Storage DRS</block>
  <block id="7c19bf1cbe62a87a42857ef0b4fe22ae" category="cell">ストレージ I/O の制御</block>
  <block id="56d43ad1a280ada5e16fd2960ae44b32" category="cell">SRM の場合</block>
  <block id="d595c8f30866b71ea121ced5cde66b1d" category="cell">仮想ボリューム</block>
  <block id="6ad5114acf73f68a85c72f11646920cb" category="cell">ハードウェアアクセラレーション（ VAAI ）</block>
  <block id="ad37ded9046268d8e5ea7cb253bb5dda" category="cell">Kerberos 認証</block>
  <block id="45701e6ef9bc09dca07f8f4abe661dc6" category="cell">○（ vSphere 6.5 以降で拡張して、 AES 、 krb5i ）</block>
  <block id="76969a36155d2f41fc6cc3bd3faff244" category="cell">マルチパスのサポート</block>
  <block id="8a18e0a50dc5755c294477cb16507a6c" category="doc">FlexGroup</block>
  <block id="f9ac230f370c7937167d25093c4ce9b9" category="paragraph">FlexGroup を使用すると、大容量のデータストアを簡単に作成でき、複数のコンスティチュエントボリュームを自動的に作成して、 ONTAP システムのパフォーマンスを最大限に高めることができます。フル機能の ONTAP クラスタを利用して、拡張性に優れた単一の vSphere データストアで FlexGroup を使用できます。</block>
  <block id="6829bc8d3038be0130fd2b409ad5e560" category="paragraph">ONTAP 9.8 では、 vSphere のワークロードを使用した広範なシステムテストに加えて、 FlexGroup データストアのコピーオフロードメカニズムも新たに追加されました。強化されたコピーエンジンを使用して、バックグラウンドのコンスティチュエント間でファイルをコピーすると同時に、ソースとデスティネーションの両方でアクセスを許可します。複数のコピーを使用すると、構成要素内で、スペース効率に優れた使用可能なファイルクローンを、大規模に応じて即座に利用できます。</block>
  <block id="760383437e8e5cbe4a2560753da783fb" category="paragraph">ONTAP 9.8 では、 FlexGroup ファイルの新しいファイルベースのパフォーマンス指標（ IOPS 、スループット、レイテンシ）も追加されました。これらの指標は、 VMware vSphere ダッシュボードや VM レポート用の ONTAP ツールで確認できます。VMware vSphere プラグイン用の ONTAP ツールでは、最大 IOPS と最小 IOPS の組み合わせを使用してサービス品質（ QoS ）ルールを設定することもできます。これらは、データストア内のすべての VM に対して個別に設定することも、特定の VM に対して個別に設定することもできます。</block>
  <block id="50783a97403d748762dff691da2d3723" category="paragraph">ネットアップが新たに開発したベストプラクティスをいくつかご紹介します。</block>
  <block id="d190c5fcdf8146c1dd7aad1140be4e64" category="list-text">FlexGroup プロビジョニングのデフォルトを使用する。VMware vSphere 用の ONTAP ツールは vSphere 内で FlexGroup を作成およびマウントするため推奨されますが、 ONTAP System Manager やコマンドラインを使用すると特別なニーズを満たすことができます。さらに、ノードあたりのコンスティチュエントメンバー数などのデフォルトも使用します。これは、 vSphere でテスト済みの構成メンバー数であるためです。</block>
  <block id="9f3fa65c2cc36eabd2228b984c30c5e1" category="list-text">FlexGroup データストアのサイジングを行う場合、 FlexVol は、より大容量のネームスペースを作成する複数の小さい FlexGroup で構成されることに注意してください。そのため、最大の仮想マシンの 8 倍以上のサイズのデータストアに設定してください。たとえば、使用している環境に 6TB の VM がある場合、 FlexGroup データストアのサイズは 48TB 以上にする必要があります。</block>
  <block id="5fbee6b763967c822bb1e4a31665b11d" category="list-text">FlexGroup によるデータストアスペースの管理を許可します。オートサイズと Elastic サイジングは、 vSphere データストアでテスト済みです。データストアの容量がフルに近くなった場合は、 VMware vSphere 用の ONTAP ツールまたは別のツールを使用して、 FlexGroup ボリュームのサイズを変更します。FlexGroup は、容量と inode をコンスティチュエント間で分散して維持し、容量が許容される場合はフォルダ（ VM ）内のファイルに同じコンスティチュエントへの優先順位を付けます。</block>
  <block id="b48b55db402c8085e1d333cad214232b" category="list-text">VMware とネットアップは、現在、一般的なマルチパスネットワークアプローチをサポートしていません。NFSv4.1 では、ネットアップは pNFS をサポートしていますが、 VMware はセッショントランキングをサポートしています。NFSv3 は、ボリュームへの複数の物理パスをサポートしていません。ONTAP 9.8 を使用した FlexGroup の場合、 VMware vSphere 用の ONTAP ツールを 1 つのマウントにすることを推奨します。これは、間接アクセスによる影響が通常は最小限（マイクロ秒）であるためです。ラウンドロビンDNSを使用して、FlexGroup内の異なるノード上のLIFにESXiホストを分散することは可能ですが、その場合はONTAP tools for VMware vSphereを使用せずにFlexGroupを作成してマウントする必要があります。その場合、パフォーマンス管理機能は使用できません。</block>
  <block id="f5f11bb6aa98d02453eca36d5d1d2e19" category="list-text">FlexGroup vSphere データストアのサポートは、 9.8 リリースで最大 1500 台の VM でテスト済みです。</block>
  <block id="f48591b3ae898f29a551a2995a7dcfe8" category="list-text">コピーオフロードには、 NFS Plug-in for VMware VAAI を使用します。クローニングは FlexGroup データストア内で強化 ONTAP されますが、 FlexVol ボリュームと FlexGroup ボリュームの間で VM をコピーする場合に、 ESXi ホストコピーと比べてパフォーマンス面で大きなメリットはありません。</block>
  <block id="57a0d1deb8da99d321814990d26d21ed" category="list-text">VMware vSphere 9.8 用の ONTAP ツールを使用すると、 ONTAP メトリック（ダッシュボードと VM レポート）を使用して FlexGroup VM のパフォーマンスを監視し、個々の VM の QoS を管理できます。現時点では、これらの指標は ONTAP コマンドや API では使用できません。</block>
  <block id="ad971da24ec0a38449ebf31e4e2c9332" category="list-text">QoS （最大 / 最小 IOPS ）は、個々の VM に対して、またはデータストア内のすべての VM に対して設定できます。すべての VM に QoS を設定すると、 VM ごとに個別に設定する必要がなくなります。今後は、新規または移行された VM には適用されません。新しい VM に QoS を設定するか、データストア内のすべての VM に QoS を再適用してください。</block>
  <block id="3c9d41390700cbdfb2c273f00df0d6fd" category="list-text">SnapCenter Plug-in for VMware vSphere リリース 4.4 では、プライマリストレージシステム上の FlexGroup データストア内の VM のバックアップとリカバリがサポートされています。SnapMirror を手動で使用して FlexGroup をセカンダリシステムにレプリケートできるが、 SCV 4.4 ではセカンダリコピーが管理されない。</block>
  <block id="be0ec3d9251292dd856ea0924ecc6873" category="doc">サービス品質（ QoS ）</block>
  <block id="8fdd6138f63aa45f1c51b48d9a01b19d" category="paragraph">スループット制限は、他のワークロードに影響しないように、導入前に未知のワークロードやテストワークロードを制御するのに役立ちます。また、 Bully ワークロードが特定された場合に、この 2 つを使用して抑制することもできます。ONTAP 9.2 では SAN オブジェクトに、 ONTAP 9.3 では NAS オブジェクトに一貫したパフォーマンスを提供するために、 IOPS に基づく最小サービスレベルもサポートされています。</block>
  <block id="3e4a2dc31acddb628ba286d25b1bd36e" category="paragraph">NFS データストアの場合は、 QoS ポリシーを FlexVol 全体またはボリューム内の個々の VMDK ファイルに適用できます。ONTAP LUN を使用する VMFS データストアでは、 LUN を含む FlexVol ボリュームには QoS ポリシーを適用できますが、 ONTAP が VMFS ファイルシステムを認識しないため、個々の VMDK ファイルには適用できません。VVol を使用する場合は、ストレージ機能プロファイルと VM ストレージポリシーを使用して、個々の VM に最小 QoS と最大 QoS を設定できます。</block>
  <block id="534ecd446aac2f9c809eef9064f44aab" category="paragraph">オブジェクトに対する QoS の最大スループット制限は、 MBps と IOPS のいずれかまたは両方で設定できます。両方を使用する場合は、最初に到達した制限が ONTAP によって適用されます。ワークロードには複数のオブジェクトを含めることができ、 QoS ポリシーは 1 つ以上のワークロードに適用できます。ポリシーを複数のワークロードに適用した場合は、ポリシーの制限はワークロード全体に適用されます。ネストされたオブジェクトはサポートされません（たとえば、ボリューム内のファイルには個別のポリシーを設定することはできません）。QoS の最小値は IOPS 単位でのみ設定できます。</block>
  <block id="040f184b126879657b253b6d258661d9" category="paragraph">ONTAP QoS ポリシーの管理とオブジェクトへの適用に現在使用できるツールは次のとおりです。</block>
  <block id="de134183bea5df515a6756a539ce6f18" category="list-text">ONTAP CLI</block>
  <block id="6ad5e0a20f49ad6a370454bb3afc9a9e" category="list-text">ONTAP システムマネージャ</block>
  <block id="8e23e05fc0865e950d6a3581e0dd8ce9" category="list-text">OnCommand Workflow Automation のサポートを利用できます</block>
  <block id="5ecb6b24c169667ff1a176768115659e" category="list-text">Active IQ Unified Manager</block>
  <block id="8cc4e713850f67a131e9dbf8b997f61e" category="list-text">NetApp PowerShell Toolkit for ONTAP</block>
  <block id="fcdb48d0d22627e4910a8352c80bd87a" category="list-text">VMware vSphere VASA Provider 用の ONTAP ツール</block>
  <block id="e6defd03e0f49585b6d47614713e97f7" category="paragraph">NFS 上の VMDK に QoS ポリシーを割り当てる場合は、次のガイドラインに注意してください。</block>
  <block id="10509998e8d4c4d7be30fc1d0b6b2a1e" category="list-text">ポリシーは、<block ref="a1bb63c284b58c32f1afb554a12e3e9a" prefix=" " category="inline-code"></block> ではなく、実際の仮想ディスクイメージが含まれています。<block ref="aa26c73336ecfd98ed727b3e249c7f90" prefix=" " category="inline-code"></block> （仮想ディスク記述ファイル）または<block ref="092eb4dd2ca488962f4c22b3e8cc4ca0" prefix=" " category="inline-code"></block> （VM記述ファイル）。</block>
  <block id="2175e0e29bc4b213fa8b9c7afd591b6b" category="list-text">仮想スワップファイルなど、他のVMファイルにポリシーを適用しない <block ref="aa33c3c1850a3f99cec7426e2c411d08" prefix="(" category="inline-code"></block>）。</block>
  <block id="8230e9b5c1e9862fedb2c69f7cc5d3d1" category="list-text">vSphere Web Clientを使用してファイルパスを検索する場合（[Datastore]&gt;[Files]）は、<block ref="f149d7424e10a266ec998ca5b32b81bb" prefix=" " category="inline-code"></block> および<block ref="4a78be158c13cd6b2dc2100a80bb7070" prefix=" " category="inline-code"></block> 1つのファイルが表示されます。このファイルには、<block ref="4a78be158c13cd6b2dc2100a80bb7070" prefix=" " category="inline-code"></block> しかしその大きさは<block ref="f149d7424e10a266ec998ca5b32b81bb" prefix=" " category="inline-code"></block>。追加（ Add ）<block ref="4fc4e556dbb9dcede037ccd80fabd784" prefix=" " category="inline-code"></block> ファイル名に入力して、正しいパスを取得します。</block>
  <block id="1d4614aca13104c98d5d8cc2d415b941" category="paragraph">VMFS と RDM 、 ONTAP SVM （ SVM として表示）、 LUN パス、シリアル番号などの LUN に QoS ポリシーを割り当てるには、 ONTAP Tools for VMware vSphere のホームページのストレージシステムメニューから QoS ポリシーを取得します。ストレージシステム（SVM）を選択し、[Related Objects]&gt;[SAN]を選択します。  この方法は、いずれかの ONTAP ツールを使用して QoS を指定する場合に使用します。</block>
  <block id="cc97a1a52adc0bd6f188de1545eea887" category="paragraph">VVol ベースの VM には、 VMware vSphere または Virtual Storage Console 7.1 以降の ONTAP ツールを使用して、最大 QoS と最小 QoS を簡単に割り当てることができます。VVolコンテナのストレージ機能プロファイルを作成するときは、パフォーマンス機能で最大IOPSと最小IOPSの値を指定し、このSCPをVMのストレージポリシーで参照します。このポリシーは VM を作成するときに使用するか、ポリシーを既存の VM に適用します。</block>
  <block id="421c9efa4ff1b039a5378be7bc1e2e49" category="paragraph">FlexGroup データストアでは、 ONTAP ツールを VMware vSphere 9.8 以降で使用する場合に、 QoS 機能が強化されています。QoS は、データストア内のすべての VM 、または特定の VM に簡単に設定できます。詳細については、本レポートの「 FlexGroup 」セクションを参照してください。</block>
  <block id="77bb2ba950959bd3f1c55da523ace0be" category="section-title">ONTAP の QoS と VMware の SIOC</block>
  <block id="b2e21dac6070ea83831ff6521a66a447" category="paragraph">ONTAP の QoS と VMware vSphere の Storage I/O Control （ SIOC ）は、 vSphere 管理者とストレージ管理者が組み合わせて、 ONTAP ソフトウェアを実行するシステムでホストされる vSphere VM のパフォーマンスを管理できる、相互に補完するテクノロジです。各ツールには、次の表に示すようにそれぞれの長所があります。VMware vCenter と ONTAP ではスコープが異なるため、一部のオブジェクトは一方のシステムで認識および管理でき、もう一方のシステムではできません。</block>
  <block id="5ad234cb2cde4266195252a23ca7d84e" category="cell">プロパティ（ Property ）</block>
  <block id="b8b8d1ba8fa345f03438a90f29af5784" category="cell">ONTAP QoS</block>
  <block id="c2a4cb962db2a4a6782b69864f0e411c" category="cell">VMware SIOC</block>
  <block id="aa628d5a66888444926b4dc042458200" category="cell">アクティブになっている場合</block>
  <block id="688b10fcfff927dee65634e3b3636064" category="cell">ポリシーは常にアクティブです</block>
  <block id="a981c4aa67c29ff2d36fc614d8b28808" category="cell">競合が発生している（データストアのレイテンシがしきい値を超えている）場合</block>
  <block id="f46e64a82c96db56f3d6657d4fb53f00" category="cell">単位のタイプ</block>
  <block id="878b4223bb85b95d8caf0429d9406cd5" category="cell">IOPS 、 MBps</block>
  <block id="3e189a34f422a141311dad231f9ad5b5" category="cell">IOPS 、共有数</block>
  <block id="7367a0ec46339213625cbc77d56a9572" category="cell">対象となる vCenter またはアプリケーション</block>
  <block id="1faff19290bb64ce8ff6bc1220496881" category="cell">複数の vCenter 環境、その他のハイパーバイザーとアプリケーションがあります</block>
  <block id="1e664a3cc0ab109fcabcc81b488cebb1" category="cell">単一の vCenter サーバ</block>
  <block id="ebccc9f5c939841d86e5382988dfcc47" category="cell">VM に QoS を設定？</block>
  <block id="cddd0980ce99890d2ea90288f6b03117" category="cell">NFS 上の VMDK のみ</block>
  <block id="928629d8a2a889f5274cad9940a06da0" category="cell">NFS 上または VMFS 上の VMDK です</block>
  <block id="305e85b992089534091855224f60cf75" category="cell">LUN （ RDM ）で QoS を設定？</block>
  <block id="e798014243cf5682e7fb3aaf4ee7cecf" category="cell">LUN （ VMFS ）への QoS の設定</block>
  <block id="9cd021ea9d3c88de723fe9a2e50a2380" category="cell">ボリューム（ NFS データストア）への QoS の設定</block>
  <block id="c352b53c32380efcf4436926da6d0414" category="cell">SVM （テナント）に QoS を設定？</block>
  <block id="5dad340ee8f9e8fa9b65bf86a9fd5341" category="cell">ポリシーベースのアプローチ</block>
  <block id="b31c76176f26196c6379a9bcce212d99" category="cell">はい。ポリシー内のすべてのワークロードで共有することも、ポリシー内の各ワークロードにフルに適用することもできます。</block>
  <block id="1ff33557bad923d68973872cacf2e43a" category="cell">はい。 vSphere 6.5 以降が必要です。</block>
  <block id="d5f1465492190ee9d30a09b36f64f4b7" category="cell">ライセンスが必要です</block>
  <block id="4cec76d82991abd453484c23f7e3788a" category="cell">ONTAP に付属しています</block>
  <block id="6bb36803f4670824ff9ebdf665654829" category="cell">Enterprise Plus</block>
  <block id="d4d4b5b65bebf236590d70c702a6ba6b" category="paragraph">VMware Storage Distributed Resource Scheduler （ SDRS ）は、現在の I/O レイテンシとスペース使用量に基づいて VM をストレージに配置する vSphere の機能です。その後、 VM や VMDK の配置先として最適なデータストアをデータストアクラスタ内から選択し、システムを停止することなくデータストアクラスタ（ポッドとも呼ばれます）内のデータストア間で VM や VMDK を移動します。データストアクラスタは、類似するデータストアをvSphere管理者から見た単一の消費単位に集約したものです。</block>
  <block id="01e838e1c124042f75adb374a81f72a6" category="paragraph">VMware vSphere APIs for Storage Awareness （ VASA ）を使用すると、ストレージ管理者は、明確に定義された機能を使用してデータストアを簡単に設定でき、 VM 管理者は、相互にやり取りすることなく、いつでも VM をプロビジョニングするためのこれらの機能を使用できます。このアプローチを見て、仮想化ストレージの運用を合理化し、単純な作業の多くを回避する方法を確認することをお勧めします。</block>
  <block id="0ce8b0e3e0d7dc7f39c62fb74a28b3bf" category="section-title">クラウドへの移行とバックアップ</block>
  <block id="4fe11b4a91ff38ec9933009a15dd5b0b" category="paragraph">ONTAP のもう 1 つの強みは、ハイブリッドクラウドを幅広くサポートすることで、オンプレミスのプライベートクラウドのシステムとパブリッククラウドの機能を統合できることです。vSphere と組み合わせて使用できるネットアップのクラウドソリューションには、次のものがあります。</block>
  <block id="e18ab5f123ad4ce169202479f07f3f0f" category="list-text">* Cloud Volumes。* NetApp Cloud Volumes Service for Amazon Web ServicesまたはGoogle Cloud PlatformとAzure NetApp Files for ANFは、主要なパブリッククラウド環境でハイパフォーマンスなマルチプロトコルマネージドストレージサービスを提供します。VMware Cloud VM ゲストで直接使用できます。</block>
  <block id="9625e7e8b7b951b4ac75beee0139b407" category="list-text">* Cloud Volumes ONTAP 。 * NetApp Cloud Volumes ONTAP データ管理ソフトウェアは、お客様が選択したクラウド上のデータを管理、保護、柔軟性、効率性で保護します。Cloud Volumes ONTAP は、 NetApp ONTAP ストレージソフトウェアを基盤としたクラウドネイティブのデータ管理ソフトウェアです。Cloud Volumes ONTAP インスタンスをオンプレミスの ONTAP システムと一緒に導入、管理する際には、 Cloud Manager と組み合わせて使用できます。NASおよびiSCSI SANの高度な機能と、スナップショットやSnapMirrorレプリケーションなどの統合データ管理機能を活用できます。</block>
  <block id="2a11701c0c01affc0ce96eb0d0c16ed9" category="list-text">* Cloud Backup Service * 。クラウドサービスまたは SnapMirror クラウドを使用して、パブリッククラウドストレージを使用してオンプレミスシステムからデータを保護します。Cloud Sync を使用すると、 NAS 、オブジェクトストア、 Cloud Volumes Service ストレージ間でデータを移行し、同期を維持できます。</block>
  <block id="99c6c4d349151c1f4a6694e424aef741" category="inline-link">VMのより多くのスナップショットを保存</block>
  <block id="01fa297dbdab5aceb83a45a98161efe0" category="list-text">* ONTAP * FabricPool は、 FabricPool データの階層化を迅速かつ容易にします。コールドブロックは、パブリッククラウドまたはStorageGRIDのプライベートオブジェクトストアにあるオブジェクトストアに移行でき、ONTAPデータが再度アクセスされると自動的にリコールされます。または、 SnapVault ですでに管理されているデータの第 3 レベルの保護としてオブジェクト階層を使用することもできます。この方法を使用すると、を実行できます<block ref="60d027dbb3c3f076cbb70c6b246eb433" category="inline-link-rx"></block> プライマリおよびセカンダリ ONTAP ストレージシステム。</block>
  <block id="1a7072854c9dd945a98f4314b3f77408" category="list-text">* ONTAP Select * 。ネットアップの Software-Defined Storage を使用して、インターネット経由でプライベートクラウドをリモートの施設やオフィスに拡張できます。 ONTAP Select を使用すれば、ブロックサービスやファイルサービスのほか、エンタープライズデータセンターと同じ vSphere データ管理機能をサポートできます。</block>
  <block id="79aec220098057ef8c0e46281a45d6c2" category="paragraph">VM ベースのアプリケーションを設計する際は、将来のクラウドのモビリティを考慮してください。たとえば、アプリケーションファイルとデータファイルを一緒に配置するのではなく、データ用に別の LUN または NFS エクスポートを使用します。これにより、 VM とデータを別々にクラウドサービスに移行できます。</block>
  <block id="af63597853dc0983258c8f86a12aae0b" category="section-title">vSphere データの暗号化</block>
  <block id="63a07ab9352c9297cea3894d6cd41c3f" category="paragraph">現在、保管データを暗号化で保護する必要性はますます高まっています。当初は財務情報や医療情報に重点が置かれていましたが'ファイル'データベース'その他のデータタイプに保存されているかどうかにかかわらず'すべての情報を保護することへの関心が高まっています</block>
  <block id="f131c8f285a9ebc44140235877aecbe5" category="paragraph">ONTAP ソフトウェアを実行するシステムでは、保存データの暗号化を使用してあらゆるデータを簡単に保護できます。NetApp Storage Encryption （ NSE ）は、 ONTAP を備えた自己暗号化ディスクドライブを使用して、 SAN と NAS のデータを保護します。また、 NetApp Volume Encryption と NetApp Aggregate Encryption も、シンプルなソフトウェアベースの手法として、ディスクドライブ上のボリュームを暗号化します。このソフトウェア暗号化では、特別なディスクドライブや外部キー管理ツールは必要ありません。ONTAPのお客様は追加料金なしで利用できます。クライアントやアプリケーションを停止することなくアップグレードして使用を開始でき、オンボードキーマネージャなどの FIPS 140-2 レベル 1 標準で検証されます。</block>
  <block id="937a352e0f824ff55e4cd50c8e3b051e" category="paragraph">VMware vSphere 上で実行される仮想アプリケーションのデータを保護する方法はいくつかあります。1 つは、 VM 内のソフトウェアをゲスト OS レベルで使用してデータを保護する方法です。別の方法として、 vSphere 6.5 などの新しいハイパーバイザーでは VM レベルの暗号化がサポートされるようになりました。ただし、ネットアップのソフトウェア暗号化はシンプルで使いやすく、次のようなメリットがあります。</block>
  <block id="6eda79cc710edc32583cf567b00e7672" category="list-text">* 仮想サーバの CPU には影響しません。 * 仮想サーバ環境によっては、アプリケーションに使用可能なすべての CPU サイクルが必要ですが、ハイパーバイザーレベルの暗号化では最大 5 倍の CPU リソースが必要です。暗号化ソフトウェアがインテルのAES-NI命令セットをサポートして暗号化ワークロードをオフロードしていても（NetAppソフトウェア暗号化がサポートしているように）、古いサーバーと互換性のない新しいCPUが必要なため、このアプローチは実現できない可能性があります。</block>
  <block id="6abee98aea26f85e6f0fe8d4db70f998" category="list-text">* オンボードキーマネージャを含む。 * ネットアップのソフトウェア暗号化機能には、追加料金なしでオンボードキーマネージャが含まれているため、購入や使用が複雑な高可用性キー管理サーバなしで簡単に利用を開始できます。</block>
  <block id="c216121021de8554d33503ef6616b256" category="list-text">* ストレージ効率への影響はありません。 * 重複排除や圧縮などの Storage Efficiency テクノロジは現在広く使用されており、フラッシュディスクメディアをコスト効率よく使用する上で鍵となります。ただし、一般に、暗号化されたデータは重複排除も圧縮もできません。ネットアップのハードウェアとストレージの暗号化は下位レベルで動作し、他のアプローチとは異なり、業界をリードするネットアップの Storage Efficiency 機能を最大限に活用できます。</block>
  <block id="5f9aa8333f218d1c21e67c8608a48672" category="list-text">* データストアのきめ細かい暗号化が容易。 * NetApp Volume Encryption を使用すると、各ボリュームに専用の AES 256 ビットキーが設定されます。変更が必要な場合は、 1 つのコマンドで変更できます。このアプローチは、テナントが複数ある場合や、さまざまな部門やアプリケーションに対して個別に暗号化を証明する必要がある場合に適しています。この暗号化はデータストアレベルで管理されるため、個々の VM の管理よりもはるかに簡単です。</block>
  <block id="de2b3baa1cd4980c36e8bbf7c827ae0c" category="paragraph">ソフトウェア暗号化を開始するのは簡単です。ライセンスのインストールが完了したら、パスフレーズを指定してオンボードキーマネージャを設定し、新しいボリュームを作成するかストレージ側のボリューム移動を実行して暗号化を有効にします。ネットアップでは、 VMware ツールの今後のリリースで、暗号化機能のサポートをさらに統合する予定です。</block>
  <block id="c95fa5b56a01e5c1a80c540c1ab1a750" category="paragraph">Active IQ Unified Manager を使用すると、仮想インフラ内の VM を可視化し、仮想環境内のストレージやパフォーマンスの問題を監視してトラブルシューティングすることができます。</block>
  <block id="be75250c2f30870dc1e359b4ade2a767" category="paragraph">ONTAP の一般的な仮想インフラ環境には、さまざまなコンポーネントがコンピューティングレイヤ、ネットワークレイヤ、ストレージレイヤに分散して配置されています。VM アプリケーションのパフォーマンス低下は、各レイヤのさまざまなコンポーネントでレイテンシが生じていることが原因である可能性があります。</block>
  <block id="d1734f6f2e65a1488896f74695db5254" category="paragraph">次のスクリーンショットは、 Active IQ Unified Manager の仮想マシンビューを示しています。</block>
  <block id="8aa017c9f67ad32dd7301ecf52b61d72" category="paragraph"><block ref="8aa017c9f67ad32dd7301ecf52b61d72" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2118336fa447fcc0f213cb8c40c516af" category="paragraph">Unified Manager のトポロジビューには、仮想環境の基盤となるサブシステムが表示され、コンピューティングノード、ネットワーク、またはストレージでレイテンシ問題が発生したかどうかが確認されます。また、修復手順を実行して基盤となる問題に対応するために、パフォーマンス低下の原因となっているオブジェクトが強調表示されます。</block>
  <block id="d8a78b994fcd4e04901203a2e7bc6414" category="paragraph">次のスクリーンショットは、 AIQUM の拡張トポロジを示しています。</block>
  <block id="e9659be2b7d3d69eccdb443ed2acec75" category="paragraph"><block ref="e9659be2b7d3d69eccdb443ed2acec75" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f02207fb26160d7e47cf5ea35d07df03" category="doc">データストアおよびプロトコル</block>
  <block id="af8dcb8c7a1e8b7e614e570806d8dcee" category="paragraph">VMware vSphereとONTAP ソフトウェアを実行しているシステム上のデータストアの接続には、次の7つのプロトコルが使用されます。</block>
  <block id="a7c815fafe60ae637d38216fa6300395" category="list-text">FCP</block>
  <block id="14eae6ee278098bfad4f8a10fd6c1195" category="list-text">FCoE</block>
  <block id="26bcb9f1cb6f391f4b2c18e676bb458d" category="list-text">NVMe/FC</block>
  <block id="8b7c42123642e2e4ea7dd426aeb2de58" category="list-text">NVMe/FC</block>
  <block id="e4e1c13bb0b14f6cb7608cbecea948ef" category="list-text">iSCSI</block>
  <block id="f7d773fd2896401c143676940bc001fc" category="list-text">NFS v3</block>
  <block id="0b99b245267ef194ca3b9f6e694b0983" category="list-text">NFS v4.1</block>
  <block id="cfa070ed8af17c3125cfd1530fbd387a" category="paragraph">FCP、FCoE、NVMe/FC、NVMe/FC、NVMe/FC、NVMe/FC、およびiSCSIはブロックプロトコルで、vSphere Virtual Machine File System（VMFS）を使用して、ONTAP FlexVol ボリュームに含まれるONTAP LUNまたはNVMeネームスペースにVMを格納します。vSphere 7.0 以降では、 VMware は本番環境でのソフトウェア FCoE をサポートしなくなりました。NFS はファイルプロトコルで、 VM をデータストア（ ONTAP ボリューム）に配置し、 VMFS を必要としません。SMB（CIFS）、iSCSI、NVMe/FC、NFSもゲストOSからONTAP に直接使用できます。</block>
  <block id="2b19cb432f68f1ba3dc7b0f175a14778" category="inline-link">VMwareコウセイノサイダイスウ</block>
  <block id="f8ca1b19553d4c965e40e9eeb1eb5aca" category="paragraph">次の表に、vSphereがサポートするONTAPの従来のデータストア機能を示します。この情報はVVOLデータストアには該当しませんが、通常は、サポートされているONTAP リリースを使用する環境 vSphere 6.x以降のリリースで使用されます。を参照することもできます<block ref="61b579b455015dfa2bbf16bf62f07f93" category="inline-link-rx"></block> 個々の vSphere リリースに固有の制限を確認するため。</block>
  <block id="9da73946f1bc3be4a41898d06c9d2e8b" category="cell">機能 / 特徴</block>
  <block id="c982f804d02e2d7e937f125d2cac1024" category="cell">FC / FCoE</block>
  <block id="6151632541dcd80356c6c76b34d69d0c" category="cell">NVMe-oF</block>
  <block id="520d0db389f362bf79ef56ca0af3dcab" category="cell">の形式で入力し</block>
  <block id="99a3142584ca8ad0a3afadeaa6f2ef69" category="cell">VMFS または raw デバイスマッピング（ RDM ）</block>
  <block id="26aae26f61844ac20ab7b04ba6f5c515" category="cell">VMFS または RDM</block>
  <block id="18263a30df8afc60a733e59c60676ac0" category="cell">VMFS</block>
  <block id="382b0f5185773fa0f67a8ed8056c7759" category="cell">該当なし</block>
  <block id="8dc6d0c66219ddb809322c0d248e55e6" category="cell">データストアまたは LUN の最大数</block>
  <block id="aa23f9914ce1939ea7a4d479edfdc915" category="cell">ホストあたり1、024個のLUN</block>
  <block id="1af3b27207afc48a363629a315d76b59" category="cell">サーバあたり1、024個のLUN</block>
  <block id="0705fd627c25b5fba17cd9a022ed7d72" category="cell">サーバごとに256名を指定します</block>
  <block id="2774ddb6f193789c5d9a480b9e53a38d" category="cell">256マウント
デフォルトのNFS。MaxVolumes は 8 です。VMware vSphere 用の ONTAP ツールを使用して 256 まで増やす。</block>
  <block id="51c0dc217976e27de06e262947947a62" category="cell">データストアの最大サイズ</block>
  <block id="856c997f909830b8249756c07dc9452b" category="cell">64TB</block>
  <block id="8e5d3a4b085389c59a1a7af7c4067a9b" category="cell">100TB 以上の FlexVol ボリュームと FlexGroup ボリューム</block>
  <block id="b4fb1d41fedaec79072964cbb4d16e3d" category="cell">データストアの最大ファイルサイズ</block>
  <block id="d10549beb2f7bd1e91e5ef8965edd84a" category="cell">62TB</block>
  <block id="18301e675ce7d51c23071d7b135edbdc" category="cell">62TB（ONTAP 9.12.1P2以降使用時）</block>
  <block id="9aa56a79640231adaec83bc53e59c929" category="cell">LUN またはファイルシステムごとのキューの深さの最適値</block>
  <block id="c7dfde106afbb4e1d55096403af252e0" category="cell">64 ~ 256</block>
  <block id="ca6e77250a239af7b4aed9a1ac058825" category="cell">自動ネゴシエーション</block>
  <block id="bad19bc2587cd465cab5cec5a13aa306" category="cell">のNFS.MaxQueueDepthを参照してください<block ref="0391a4aaf03ed2bf80fb4efb215797d0" category="inline-link-rx"></block>。</block>
  <block id="edc5121cb9b42a76b718b8ece9d67437" category="paragraph">次の表に、サポートされる VMware ストレージ関連機能を示します。</block>
  <block id="6c1a84b789b54fd42511ce582be94d21" category="cell">vMotion</block>
  <block id="e95b58d02782c970bb339c6cc587ff39" category="cell">Storage vMotion の機能です</block>
  <block id="0486e0e3dc3e86859f43b6d8e32b8071" category="cell">VMware HA</block>
  <block id="8be6bd7f20474cbefdd496cb9fd495ca" category="cell">ストレージ分散リソーススケジューラ（ SDRS ）</block>
  <block id="4244919a64848265426dfd82a14f8248" category="cell">VMware vStorage APIs for Data Protection （ VADP ）対応のバックアップソフトウェア</block>
  <block id="28c2f8ab9cdbf296aa4261bc3c58ba0d" category="cell">VM 内の Microsoft Cluster Service （ MSCS ）またはフェイルオーバークラスタリング</block>
  <block id="01a9a3b8d0fcae3055dc91935e8ec6c6" category="cell">はい *</block>
  <block id="aa7f77e663b832d5b0e544c5511e680c" category="cell">サポート対象外</block>
  <block id="aa18abedec09bd4f85e612c307e2eaa6" category="cell">フォールトトレランス</block>
  <block id="bfd52522de4ac6efd6f680e0e754eeb5" category="cell">Site Recovery Manager の略</block>
  <block id="d6407966cf588d8d78d4f7e65f1ea6fd" category="cell">v3のみ**</block>
  <block id="17d495427086fa21259b9df40b27e00a" category="cell">シンプロビジョニングされた VM （仮想ディスク）</block>
  <block id="4ee7af004efef335d6a14c60ee758f5e" category="cell">はい。
VAAIを使用しない場合、NFS上のすべてのVMに対してこの設定がデフォルトになります。</block>
  <block id="13bc264ff420559de4156ec40980a4b9" category="cell">VMware 標準マルチパス</block>
  <block id="50ed43e1a7a22335069a344bc706b600" category="cell">はい、新しい高性能プラグイン（HPP）を使用して</block>
  <block id="a06819d91a165d0491c5816c54b41234" category="paragraph">次の表に、サポートされる ONTAP ストレージ管理機能を示します。</block>
  <block id="f8d61013f1a3bbf1342f4ced3279c7cf" category="cell">データ重複排除</block>
  <block id="72167540968147afed9deb59f0e9fe00" category="cell">アレイ内での容量削減</block>
  <block id="9a5473a6abaea16b736f096913a749be" category="cell">データストア内での容量削減</block>
  <block id="6cd880eabbec3488232c6cba3fbcf998" category="cell">シンプロビジョニング</block>
  <block id="5caeb11c4ed379b808d7f7cdca7cfbf0" category="cell">データストアまたは RDM</block>
  <block id="8a5227cc82d14862956938caffc1acf2" category="cell">データストア</block>
  <block id="b71ba22dcd42deceac87150206f7bd12" category="cell">データストアのサイズを変更</block>
  <block id="c6b792bfd7aac8067d36337e67d11545" category="cell">拡張のみ</block>
  <block id="29e23534878bb63341e0b689426b7fb0" category="cell">拡張、自動拡張、縮小</block>
  <block id="76021405cc62a4b8c542e7f65e3d24ed" category="cell">Windows 、 Linux アプリケーション用の SnapCenter プラグイン（ゲスト内）</block>
  <block id="c0b3c629432c82a9e8500242abb35eaf" category="cell">VMware vSphere 用の ONTAP ツールを使用した監視とホストの設定</block>
  <block id="5a915a8215e9a66bcff0f034e8adff18" category="cell">VMware vSphere 用の ONTAP ツールを使用したプロビジョニング</block>
  <block id="6495c7cda42bf1b80bc1c2af6166ef58" category="paragraph">次の表に、サポートされるバックアップ機能を示します。</block>
  <block id="ad336d1fccea3e918d07055edac855a3" category="cell">ONTAPスナップショット</block>
  <block id="bf22a1b5bc2b72a75825094826a942de" category="cell">複製バックアップでサポートされる SRM</block>
  <block id="60d3f7d9f265eb34e826da352cb545be" category="cell">Volume SnapMirror の略</block>
  <block id="fabf31a57c142c986c5d88cb089b3d7b" category="cell">VMDK イメージアクセス</block>
  <block id="40b655e79545b3922b8095be28d59428" category="cell">VADP 対応のバックアップソフトウェア</block>
  <block id="8215e73d220182794dfbd75ad494c727" category="cell">VADP 対応のバックアップソフトウェア、 vSphere Client 、 vSphere Web Client データストアブラウザ</block>
  <block id="d7605580ecad0fcb4528789d74cdcad5" category="cell">VMDK のファイルレベルアクセス</block>
  <block id="906ece32da286d6c4b323bc0d6443b7c" category="cell">VADP 対応のバックアップソフトウェア、 Windows のみ</block>
  <block id="d17e2fa63a62622f88bf170612132383" category="cell">VADP 対応のバックアップソフトウェアとサードパーティ製アプリケーション</block>
  <block id="4e3d259d82a536e12c5c9c948b62e26a" category="cell">NDMP の単位</block>
  <block id="90d45e02e50c81603c36a4e4ad3649d9" category="cell">データストアまたはVM</block>
  <block id="8339c514e73f5cced3b83d504d60441b" category="inline-link">Windows Server フェールオーバークラスタリングのセットアップ</block>
  <block id="45f7e6f7f6f0f4093754d7d48810e17f" category="paragraph">* VMFSデータストア内でマルチライター対応のVMDKを使用するのではなく、Microsoftクラスタにゲスト内iSCSIを使用することを推奨します。このアプローチは Microsoft と VMware によって完全にサポートされており、 ONTAP （オンプレミスまたはクラウドの ONTAP システムへの SnapMirror ）を使用した優れた柔軟性、設定と自動化が容易で、 SnapCenter で保護できます。vSphere 7 で、新しいクラスタ化された VMDK オプションが追加されました。これは、マルチライター対応のVMDKとは異なります。マルチライター対応のVMDKを使用するには、クラスタ化されたVMDKをサポートするFCプロトコルを介して提供されるデータストアが必要です。その他の制限が適用されます。VMwareの詳細<block ref="b158594c147457b5b6417413cb30f800" category="inline-link-rx"></block> 設定ガイドラインについては、ドキュメントを参照してください</block>
  <block id="e2bd40041a6472b580305ce9017b0b2e" category="paragraph">** NVMe-oFとNFS v4.1を使用するデータストアには、vSphereレプリケーションが必要です。アレイベースのレプリケーションはSRMではサポートされていません。</block>
  <block id="54b3e11ce37eaaa9884f4086e72dd2be" category="section-title">ストレージプロトコルを選択</block>
  <block id="4bbd62e7748dbf2416c644698342b5f9" category="paragraph">ONTAP ソフトウェアを実行するシステムは、主要なストレージプロトコルをすべてサポートしているため、既存および計画されているネットワークインフラやスタッフのスキルに応じて、お客様は環境に最適なものを選択できます。ネットアップのテストでは、一般に、ほぼ同じ速度の回線で実行されているプロトコル間の違いはほとんど見られませんでした。そのため、物理プロトコルのパフォーマンスよりもネットワークインフラとスタッフの能力に重点を置くことを推奨します。</block>
  <block id="0212b4e8bc965dcd8a7ff771dd96bf21" category="paragraph">プロトコルの選択を検討する際には、次の要素が役立ちます。</block>
  <block id="0425ddb6dbbe7f13280e19e1f925b0a8" category="list-text">* 現在のお客様の環境。 * 一般に、 IT チームはイーサネット IP インフラの管理のスキルを持っていますが、すべてのチームが FC SAN ファブリックの管理のスキルを持っているわけではありません。ただし、ストレージトラフィック用に設計されていない汎用IPネットワークを使用すると、うまく機能しない場合があります。現在利用しているネットワークインフラストラクチャ、計画的な改善点、およびそれらを管理するためのスタッフのスキルと可用性を考慮します。</block>
  <block id="774f1348caf3e145710073eb634c4fa1" category="list-text">* セットアップの容易さ * FC ファブリックの初期構成（追加のスイッチとケーブル配線、ゾーニング、 HBA とファームウェアの相互運用性の検証）に加えて、ブロックプロトコルを使用するには、 LUN の作成とマッピング、ゲスト OS による検出とフォーマットも必要です。作成およびエクスポートされた NFS ボリュームは、 ESXi ホストによってマウントされ、使用可能な状態になります。NFS では、ハードウェアの認定や管理に関する特別なファームウェアはありません。</block>
  <block id="bf5169ce5bb544313eaf17435f756da2" category="list-text">* 管理の容易さ。 * SAN プロトコルでは、より多くのスペースが必要な場合、 LUN の拡張、新しいサイズの検出のための再スキャン、ファイルシステムの拡張など、いくつかの手順が必要です。LUN の拡張は可能ですが、 LUN のサイズを縮小することはできず、未使用スペースのリカバリには追加の作業が必要になる場合があります。NFS を使用すると、簡単なサイジングが可能です。このサイズ変更は、ストレージシステムで自動化できます。SAN では、ゲスト OS のトリム / マッピング解除コマンドを使用してスペース再生が可能で、削除されたファイルのスペースをアレイに戻すことができます。NFS データストアでは、このようなスペース再生がより困難になります。</block>
  <block id="530c759326761c6ac026b313985b255f" category="list-text">* ストレージスペースの透過性。 * シンプロビジョニングによって削減効果が即座に現れるため、 NFS 環境では一般にストレージ利用率が見やすくなります。同様に、重複排除とクローニングによる削減効果は、同じデータストア内の他の VM や他のストレージシステムボリュームで即座に利用できます。一般に、 VM の密度は NFS データストア内でも高くなります。管理するデータストアが少ないため、重複排除による削減効果が向上すると同時に管理コストも削減されます。</block>
  <block id="16ee928b12bc598bf52b0f312879ec95" category="section-title">データストアのレイアウト</block>
  <block id="b9890b64f7b9790ea1e078227efacfa2" category="paragraph">ONTAP ストレージシステムは、 VM および仮想ディスク用のデータストアを柔軟に作成できます。を使用する場合、 ONTAP の多くのベストプラクティスが適用されますが vSphere 用のデータストアをプロビジョニングする VSC （を参照） <block ref="ef37ab860d90e747aecd96bae9ce8d8d" category="inline-link-macro-rx"></block>) 、考慮すべきその他のガイドラインを次に示します。</block>
  <block id="b8c499c7b537f5bd4e51b0a6d6a1e9d0" category="list-text">ONTAP NFS データストアを使用して vSphere を導入することで、高性能でありながら管理が容易な実装を実現でき、ブロックベースのストレージプロトコルでは達成できない VM / データストア比率が提供されます。このアーキテクチャでは、データストア密度を 10 倍に増やすことも可能で、それに伴いデータストアの数は減少します。データストアのサイズを大きくするとストレージ効率が向上し、運用上のメリットが得られますが、ハードウェアリソースのパフォーマンスを最大限に引き出すためには、少なくとも 4 つのデータストア（ FlexVol ボリューム）を使用して 1 つの ONTAP コントローラに VM を格納することを検討してください。また、異なるリカバリポリシーを使用してデータストアを確立することもできます。ビジネスニーズに基づいて、他のバックアップや複製の頻度を高められるものもあります。FlexGroup ボリュームは設計上拡張できるため、複数のデータストアを使用する必要はありません。</block>
  <block id="e15ed0ec7af4278259b7618024b3e7ce" category="list-text">NetAppでは、ほとんどのNFSデータストアにFlexVolボリュームを使用することを推奨しています。ONTAP 9.8以降でFlexGroupは、データストアとしての使用もサポートされており、特定のユースケースでの使用が一般的に推奨されます。qtreeなどのその他のONTAPストレージコンテナは、現在ONTAP Tools for VMware vSphereまたはNetApp SnapCenter Plugin for VMware vSphereでサポートされていないため、一般に推奨されません。とはいえ、1つのボリューム内の複数のqtreeとしてデータストアを導入することは、データストアレベルのクォータやVMファイルクローンのメリットが得られる高度に自動化された環境に役立つ可能性があります。</block>
  <block id="dc4d78be836807b32c7ef7f42028b1ef" category="list-text">FlexVol ボリュームデータストアの適切なサイズは 4~8TB です。このサイズは、パフォーマンス、管理のしやすさ、データ保護のバランスが取れた適切なサイズです。小規模構成から開始して（ 4TB など）、必要に応じてデータストアを拡張します（最大 100TB まで）。小規模なデータストアは、バックアップや災害からのリカバリにかかる時間が短く、クラスタ間で迅速に移動できます。使用済みスペースの変化に応じてボリュームを自動的に拡張または縮小するには、 ONTAP のオートサイズを使用することを検討してください。VMware vSphere データストアプロビジョニングウィザードの ONTAP ツールでは、新しいデータストアに対してデフォルトでオートサイズが使用されます。拡張および縮小のしきい値と最大および最小サイズは、 System Manager またはコマンドラインを使用して追加でカスタマイズできます。</block>
  <block id="964a81e46088ae1cc6306072464a9d73" category="list-text">または、 VMFS データストアを、 FC 、 iSCSI または FCoE でアクセスする LUN で構成することもできます。VMFS を使用すると、クラスタ内の各 ESX サーバから同時に従来型の LUN にアクセスすることができます。VMFS データストアは、最大 64TB まで拡張でき、最大 32 個の 2TB LUN （ VMFS 3 ）または単一の 64TB LUN （ VMFS 5 ）で構成できます。ONTAP の最大LUNサイズは、ほとんどのシステムで16TBで、オールSANアレイシステムでは128TBです。したがって、ほとんどの ONTAP システムでは、最大サイズの VMFS 5 データストアを、 4 つの 16TB LUN を使用して作成できます。複数のLUN（ハイエンドのFAS またはAFF システムを使用）を使用する高I/Oワークロードではパフォーマンス上のメリットを得られますが、データストアLUNの作成、管理、保護の複雑さが増し、可用性のリスクが増大することで、このメリットを相殺することができます。ネットアップでは、通常、各データストアに 1 つの大きな LUN を使用し、 16TB を超えるデータストアを追加する必要がある場合にのみスパンすることを推奨しています。NFS と同様に、複数のデータストア（ボリューム）を使用することで、 1 台の ONTAP コントローラのパフォーマンスを最大化することを検討してください。</block>
  <block id="c74cab014e402128efd8102b941c0b0c" category="list-text">古いゲストオペレーティングシステム（ OS ）では、パフォーマンスとストレージ効率を最大化するために、ストレージシステムとのアライメントが必要でした。しかし、 Microsoft や Linux ディストリビュータ（ Red Hat など）が提供する、ベンダーがサポートする最新の OS では、ファイルシステムのパーティションを仮想環境の基盤となるストレージシステムのブロックにアライメントするように調整する必要はありません。アライメントが必要な古い OS を使用している場合は、ネットアップサポートの技術情報で「 VM のアライメント」に関する記事を検索するか、ネットアップの営業担当者またはパートナー担当者に TR-3747 のコピーを請求してください。</block>
  <block id="8c761039ef4dd69451490b849ace1f82" category="list-text">デフラグユーティリティはゲストOS内では使用しないでください。パフォーマンス上のメリットはなく、ストレージ効率とスナップショット容量の使用にも影響します。また、仮想デスクトップのゲスト OS で検索インデックスを無効にすることを検討してください。</block>
  <block id="14abb814748566a24367c4459a54840b" category="list-text">ONTAP は、革新的な Storage Efficiency 機能で業界をリードし、使用可能なディスクスペースを最大限に活用できるようにしています。AFF システムでは、デフォルトのインライン重複排除機能と圧縮機能により、この効率性がさらに向上しています。データはアグリゲート内のすべてのボリュームにわたって重複排除されるため、類似するオペレーティングシステムやアプリケーションを 1 つのデータストア内にまとめて、最大限の削減効果を得る必要はありません。</block>
  <block id="446548f2b1301893641e29657fc7fe53" category="inline-link-macro">ONTAP を基盤にした Oracle データベース</block>
  <block id="9016fa494b85853dca561abb922d08d1" category="list-text">場合によっては、データストアが不要なこともあります。パフォーマンスと管理性を最大限に高めるためには、データベースや一部のアプリケーションなどの高 I/O アプリケーションにはデータストアを使用しないでください。代わりに、ゲストが管理する NFS や iSCSI ファイルシステムなど、ゲスト所有のファイルシステムや RDM を使用することを検討してください。アプリケーションに関する具体的なガイダンスについては、ご使用のアプリケーションに関するネットアップのテクニカルレポートを参照してください。例： <block ref="30827df672931d7ec1b01fc09c87df4e" category="inline-link-macro-rx"></block> 仮想化に関するセクションと役立つ詳細情報が記載されています。</block>
  <block id="6cda576d2fd323c1a728b7ac67d6034f" category="list-text">第 1 クラスのディスク（または強化された仮想ディスク）を使用すると、 vSphere 6.5 以降を搭載した VM に関係なく、 vCenter で管理されるディスクを使用できます。主に API で管理されますが、 VVol では特に OpenStack ツールや Kubernetes ツールで管理する場合に便利です。ONTAP および VMware vSphere 用の ONTAP ツールでサポートされています。</block>
  <block id="71318121439b39fdf872bb0bd57494f2" category="section-title">データストアと VM 移行</block>
  <block id="e8824ce2062c6d1fc536163f7b8940bd" category="paragraph">別のストレージシステム上の既存のデータストアから ONTAP に VM を移行する際は、いくつか注意しておくべきプラクティスがあります。</block>
  <block id="73b729fbc964c7d78dd90b64aaaeb785" category="list-text">Storage vMotion を使用して、仮想マシンの大部分を ONTAP に移動します。このアプローチでは、実行中の VM を停止する必要がなくなるだけでなく、インラインの重複排除や圧縮などの ONTAP の Storage Efficiency 機能を使用して、移行時にデータを処理できます。vCenter 機能を使用してインベントリリストから複数の VM を選択し、適切なタイミングで移行をスケジュール（ Ctrl キーを押しながら [ アクション ] をクリック）することを検討します。</block>
  <block id="e512c890754c686d8deccac97d84a290" category="list-text">適切なデスティネーションデータストアへの移行を慎重に計画することもできますが、多くの場合、一括で移行して必要に応じてあとから整理する方が簡単です。Snapshotスケジュールの変更など、データ保護に関する特定のニーズがある場合は、このアプローチを使用して別のデータストアに移行できます。</block>
  <block id="616b2180a0659911fed5aa758dba722c" category="list-text">ほとんどの VM とそのストレージは、実行中（ホット）に移行できますが、 ISO 、 LUN 、 NFS ボリュームなどの接続されたストレージ（データストア内にない）を別のストレージシステムから移行する場合は、コールドマイグレーションが必要になることがあります。</block>
  <block id="fbb88da5639930a05f510729e473a216" category="inline-link">TR-4534</block>
  <block id="096f2185af16e07c387a7fbe50df957a" category="list-text">より慎重な移行が必要な仮想マシンには、接続されたストレージを使用するデータベースやアプリケーションなどがあります。一般的に、移行を管理するためにアプリケーションのツールを使用することを検討してください。Oracle の場合は、 RMAN や ASM などの Oracle ツールを使用してデータベース・ファイルを移行することを検討してください。を参照してください<block ref="6b3f565e7a7ce633fa62f4114c295216" category="inline-link-rx"></block> を参照してください。同様に、 SQL Server の場合は、 SQL Server Management Studio を使用するか、 SnapManager for SQL Server や SnapCenter などのネットアップのツールを使用することを検討します。</block>
  <block id="09485b54473eee31422696bf0217d714" category="paragraph">ONTAP ソフトウェアを実行しているシステムで vSphere を使用する際に最も重要なベストプラクティスは、 VMware vSphere プラグイン（旧 Virtual Storage Console ）用の ONTAP ツールをインストールして使用することです。この vCenter プラグインは、 SAN と NAS のどちらを使用している場合でも、ストレージ管理を簡易化し、可用性を向上させ、ストレージコストと運用オーバーヘッドを削減します。データストアのプロビジョニングのベストプラクティスを使用して、マルチパスと HBA タイムアウト（これらは付録 B で説明）用の ESXi ホスト設定を最適化します。vCenterプラグインであるため、vCenterサーバに接続するすべてのvSphere Web Clientで使用できます。</block>
  <block id="9fb2cc2ced88ce872ef16c37d8284360" category="paragraph">このプラグインは、 vSphere 環境で他の ONTAP ツールを使用する場合にも役立ちます。NFS Plug-in for VMware VAAIをインストールできます。これにより、VMのクローニング処理、シック仮想ディスクファイルのスペースリザベーション、ONTAPスナップショットのオフロードのために、ONTAPへのコピーオフロードが可能になります。</block>
  <block id="2e0fa230911ceec131e12fe7c87fc01e" category="paragraph">このプラグインは、VASA Provider for ONTAPの多くの機能の管理インターフェイスでもあり、VVOLを使用したストレージポリシーベースの管理をサポートします。VMware vSphere 用の ONTAP ツールを登録したら、ストレージ機能プロファイルを作成してストレージにマッピングし、データストアがプロファイルに一定期間にわたって準拠していることを確認します。VASA Provider には、 VVol データストアの作成と管理を行うためのインターフェイスも用意されています。</block>
  <block id="9baea886f208a41896164d4ade5b3fde" category="paragraph">一般に、 vCenter 内で VMware vSphere インターフェイス用の ONTAP ツールを使用して、従来のデータストアと VVol データストアをプロビジョニングし、ベストプラクティスに従っていることを確認することを推奨します。</block>
  <block id="6161d374e9022f89382fd63b4be15aa1" category="section-title">一般的なネットワーク</block>
  <block id="f0cd6847f2a7a0773ad0b58d0f9dc67d" category="paragraph">ONTAP ソフトウェアを実行しているシステムで vSphere を使用する場合のネットワーク設定の構成は簡単で、他のネットワーク構成と同様です。考慮すべき点をいくつか挙げます。</block>
  <block id="c7949782ad094d3ffc126bee722642a3" category="list-text">CiscoのVirtual PortChannel（vPC）などのマルチシャーシリンクアグリゲーショングループアプローチを使用して、2つの別 々 のスイッチシャーシ上のポートのリンクアグリゲーションをサポートするスイッチを使用します。</block>
  <block id="9dc1904e0c3ace141704b477cd9b345d" category="inline-link">Network Management の略</block>
  <block id="68ecdb0d7a96e68318a53d12e9fab5b5" category="list-text">LACPを使用して、ポートハッシュまたはIPハッシュを使用したダイナミックマルチモードインターフェイスグループを使用するONTAPストレージシステムのリンクアグリゲートを作成します。を参照してください<block ref="b87480ad0ff34784c4be1445a72a3aaf" category="inline-link-rx"></block> を参照してください。</block>
  <block id="3b407fe7c9654197902b1dd26af6dc81" category="list-text">ESXiで静的リンクアグリゲーション（EtherChannelなど）と標準vSwitchを使用する場合、またはvSphere Distributed Switchを使用するLACPベースのリンクアグリゲーションを使用する場合は、IPハッシュチーミングポリシーを使用します。リンクアグリゲーションを使用しない場合は、代わりに[Route based on the originating virtual port ID]を使用します。</block>
  <block id="ee1ef6cf0f3971b44eb2abcac958fb8d" category="section-title">FlexGroup ボリューム</block>
  <block id="bf985cdd1506d49ea0773c8997e0b723" category="paragraph">ONTAP 9.8では、vSphereでのFlexGroupボリュームデータストアのサポートに加え、ONTAP Tools for VMware vSphereおよびSnapCenter Plugin for VMware vSphereがサポートされるようになりました。FlexGroup を使用すると、大容量のデータストアを簡単に作成でき、複数のコンスティチュエントボリュームを自動的に作成して、 ONTAP システムのパフォーマンスを最大限に高めることができます。ONTAPクラスタ全体の機能を備えた拡張性に優れた単一のvSphereデータストアが必要な場合や、非常に大規模なクローニングワークロードがあり、新しいFlexGroupクローニングメカニズムのメリットが得られる場合は、vSphereでFlexGroupを使用します。</block>
  <block id="83bcea036e70c0f011b083b2325b7a4b" category="paragraph">ONTAP 9.8 では、 vSphere のワークロードを使用した広範なシステムテストに加えて、 FlexGroup データストアのコピーオフロードメカニズムも新たに追加されました。更新されたコピーエンジンが使用され、最初の数個のクローンを使用して各コンスティチュエントボリュームにローカルキャッシュが格納されます。このローカルキャッシュを使用して、VMクローンをオンデマンドで迅速にインスタンス化します。</block>
  <block id="dd9bd4a686bdeb1c7f11dc3cd0cda75f" category="paragraph">次のシナリオを考えてみましょう。</block>
  <block id="6b277580cb59b13790b36344e827e22f" category="list-text">8つのコンスティチュエントで新しいFlexGroupを作成しました</block>
  <block id="32efd8b10cc3b73c344f4c7e6c4b741e" category="list-text">新しいFlexGroupのキャッシュタイムアウトが160分に設定されている</block>
  <block id="879f959734466d50681eae9b95e7e591" category="paragraph">このシナリオでは、ローカルファイルクローンではなく、最初に完了する8つのクローンがフルコピーになります。160秒のタイムアウトが経過する前にそのVMをクローニングすると、各コンスティチュエント内のファイルクローンエンジンがラウンドロビン方式で使用され、コンスティチュエントボリューム間でほぼ瞬時に均等に分散されたコピーが作成されます。</block>
  <block id="b368b4dbd46dd778776d405dc46d2033" category="paragraph">ボリュームが新しいクローンジョブを受信するたびに、タイムアウトがリセットされます。この例のFlexGroup内のコンスティチュエントボリュームがタイムアウトまでにクローン要求を受信しなかった場合、そのVMのキャッシュはクリアされ、ボリュームに再度データを入力する必要があります。また、元のクローンのソースが変更された場合（テンプレートを更新した場合など）、競合を防ぐために各構成要素のローカルキャッシュが無効になります。キャッシュは調整可能で、環境のニーズに合わせて設定できます。</block>
  <block id="0f98175ace2dd0d56e47961b22b2544b" category="paragraph">FlexGroupキャッシュを十分に活用できないものの、ボリューム間での高速クローニングが必要な環境では、VVOLの使用を検討してください。VVolを使用したボリューム間クローニングは、従来のデータストアよりもはるかに高速で、キャッシュに依存しません。</block>
  <block id="189aae773e13462525f07e99fcd9e90f" category="inline-link">VAAI：FlexGroupボリュームでのキャッシュの仕組みを教えてください。</block>
  <block id="718103d957da7fb9e8210a49a85aedab" category="paragraph">VAAIでFlexGroupを使用する方法の詳細については、次の技術情報アーティクルを参照してください。<block ref="23db52497ce446299e31ecc0b7572649" category="inline-link-rx"></block></block>
  <block id="eafcbe529f542610c50d02e4a2fffcd6" category="paragraph">ONTAP 9.8では、FlexGroupボリュームファイル用のファイルベースのパフォーマンス指標（IOPS、スループット、レイテンシ）も新たに追加されており、これらの指標はONTAP tools for VMware vSphereのダッシュボードとVMレポートで確認できます。VMware vSphere プラグイン用の ONTAP ツールでは、最大 IOPS と最小 IOPS の組み合わせを使用してサービス品質（ QoS ）ルールを設定することもできます。これらは、データストア内のすべての VM に対して個別に設定することも、特定の VM に対して個別に設定することもできます。</block>
  <block id="b8c631b88d7be5f1105be2f8c7ff3213" category="list-text">FlexGroupボリュームプロビジョニングのデフォルト設定を使用します。VMware vSphere 用の ONTAP ツールは vSphere 内で FlexGroup を作成およびマウントするため推奨されますが、 ONTAP System Manager やコマンドラインを使用すると特別なニーズを満たすことができます。その場合も、ノードあたりのコンスティチュエントメンバー数などのデフォルト値を使用してください。これはvSphereで最も徹底的にテストされているためです。ただし、コンスティチュエントの数や配置の変更など、デフォルト以外の設定も引き続き完全にサポートされます。</block>
  <block id="301593c45668093a7eb242d138c597a3" category="list-text">FlexGroupベースのデータストアをサイジングする場合は、FlexGroupが複数の小規模なFlexVolで構成され、より大きなネームスペースが作成されることに注意してください。そのため、8つのコンスティチュエントでFlexGroupを使用する場合は、データストアのサイズを最大の仮想マシンの8倍以上にする必要があります。たとえば、使用している環境に 6TB の VM がある場合、 FlexGroup データストアのサイズは 48TB 以上にする必要があります。</block>
  <block id="6d9993f47e7802210a05453f494513bf" category="list-text">VMware とネットアップは、現在、一般的なマルチパスネットワークアプローチをサポートしていません。NFSv4.1 では、ネットアップは pNFS をサポートしていますが、 VMware はセッショントランキングをサポートしています。NFSv3 は、ボリュームへの複数の物理パスをサポートしていません。ONTAP 9.8を搭載したでは、ONTAP tools for VMware vSphereでFlexGroupを作成することを推奨しますが、クラスタ全体に負荷を分散するためには、そのFlexGroupをアンマウントし、ラウンドロビンDNSを使用して再マウントすることを推奨します。ONTAP toolsでデータストアのマウント時に使用されるLIFは1つだけです。データストアを再マウントしたら、ONTAPツールを使用してデータストアを監視および管理できます。</block>
  <block id="04cc9e0b9478cc704d42735886027630" category="list-text">コピーオフロードには、 NFS Plug-in for VMware VAAI を使用します。前述したように、クローニングはFlexGroupデータストア内で強化されますが、FlexVolボリュームとFlexGroupボリュームの間でVMをコピーする場合、ONTAPはESXiホストのコピーに比べてパフォーマンス上の大きなメリットはありません。そのため、VAAIとFlexGroupのどちらを使用するかを決定する際は、ワークロードのクローニングを検討してください。コンスティチュエントボリュームの数の変更は、FlexGroupベースのクローニングを最適化する1つの方法です。キャッシュタイムアウトの調整も同様です。</block>
  <block id="b9e0a0134c0815e50bb71d8dd7e367b6" category="list-text">QoS （最大 / 最小 IOPS ）は、個々の VM に対して、またはデータストア内のすべての VM に対して設定できます。すべての VM に QoS を設定すると、 VM ごとに個別に設定する必要がなくなります。今後は、新規または移行された VM には適用されません。新しい VM に QoS を設定するか、データストア内のすべての VM に QoS を再適用してください。また、別のデータストアに移行されたVMには、FlexGroup QoSポリシーも適用されません。これに対し、VVOLでは、別のデータストアに移行してもQoSポリシーの設定を維持できます。</block>
  <block id="1133ff8355478000111c8b1969e32770" category="list-text">SnapCenter Plug-in for VMware vSphereリリース4.4以降では、プライマリストレージシステム上のFlexGroupデータストアのVMのバックアップとリカバリがサポートされます。SCV 4.6では、FlexGroupベースのデータストアに対するSnapMirrorのサポートが追加されています。</block>
  <block id="ce4df831657d2621e80bbef9271c33cd" category="summary">従来の仮想アプライアンスからの移行に対応した ONTAP ツールには、豊富な新機能と上限があり、 VVOL が新たにサポートされるようになりました。</block>
  <block id="45b1565c472fff4046d0f7ddbe1342f2" category="doc">SRM および ONTAP ツールの新機能</block>
  <block id="116d20fc387d73c8e4a86e7998913947" category="section-title">vSphere および Site Recovery Manager の最新バージョン</block>
  <block id="57359b8d2b77ce83f2e854fdd323377f" category="paragraph">SRM 8.7以降および9.12以降のONTAP toolsでは、VMware vSphere 8 Update 1で実行されているVMを保護できるようになりました。</block>
  <block id="96ca6fcc2ffdab3c06d0875be8d4fe29" category="paragraph">ネットアップは、約 20 年にわたり VMware との緊密なパートナーシップを共有し、できるだけ早く最新リリースのサポートを提供するよう努めています。ソフトウェアの最新の組み合わせについては、必ず NetApp Interoperability Matrix Tool （ IMT ）で確認してください。</block>
  <block id="4ada3eb5b908caaedb757052562dfcf5" category="inline-link-macro"><block ref="4ada3eb5b908caaedb757052562dfcf5" category="inline-link-rx"></block></block>
  <block id="0a0a2a299629bed81a283fcd3b7833e9" category="paragraph">NetApp IMTは、 <block ref="83e08b5e992bc41d59feec38bb24f26d" category="inline-link-macro-rx"></block>。</block>
  <block id="9d6e1631f68d52fd0f82222bf276cdc4" category="section-title">VVOLのサポート（SRMでもStorage Policy Based Management（SPBM）が重要である理由）</block>
  <block id="b0b7bc3c901f340c708b7560d1f2b7e1" category="paragraph">8.3リリース以降、SRMでは、vVolを活用したレプリケーションのStorage Policy Based Management（SPBM；ストレージポリシーベース管理）と、iSCSI、FCP、NFS v3を使用するデータストアのアレイベースのレプリケーションがサポートされるようになりました。これを実現するために、SRMサーバが更新され、新しいSRM VVOLプロバイダサービスが追加されました。このサービスは、VASA関連タスク用にvCenterサーバのSMSサービスと通信します。</block>
  <block id="4567f5576b4577c63b126cac3f6aa5fa" category="paragraph">このアーキテクチャのメリットの 1 つは、すべての処理に VASA を使用するため、 SRA が不要になったことです。</block>
  <block id="e04031e1cecdb6732f91d44b204dbcf3" category="paragraph">SPBM は vSphere ツールボックスの強力なツールで、プライベートクラウド環境とハイブリッドクラウド環境の自動化フレームワークによって、シンプルで予測可能な一貫したストレージサービスを利用できます。SPBM では、多様な顧客層のニーズを満たすサービスクラスを定義できます。SRM では、堅牢な業界標準のディザスタリカバリオーケストレーションと自動化を必要とする重要なワークロードに対して、レプリケーション機能をお客様に提供できるようになりました。</block>
  <block id="1b6204fa76bd422416757c4e2d6187bd" category="paragraph">FCPまたはiSCSIを使用したVVOLアーキテクチャの例：</block>
  <block id="6f1ad7cac2af0e3b92a3936efc393a0e" category="paragraph"><block ref="6f1ad7cac2af0e3b92a3936efc393a0e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9abbd7aed7e9791d9c52e8e17f34a756" category="section-title">アプライアンスベースのSRMサーバのサポート</block>
  <block id="925c477f139cce0692e13946a7f75eac" category="paragraph">従来の Windows ベースのプラットフォームに加え、光子 OS ベースの SRM サーバもサポートされるようになりました。</block>
  <block id="62c2c4203aebe081ddbc6cdd489f8ad7" category="paragraph">SRA アダプタを、希望する SRM サーバタイプに関係なくインストールできるようになりました。</block>
  <block id="7cb1700928c008eb817bc79250cc9002" category="section-title">IPv6 のサポート</block>
  <block id="ea9aacd1495949730de8eeab11e66459" category="paragraph">IPv6 が次の制限付きでサポートされるようになりました。</block>
  <block id="d6d7f3d43de975c07655ebba1936867a" category="list-text">vCenter 6.7 以降</block>
  <block id="eb26ee1a20fe3dbde98204ec8b3ab838" category="list-text">SRM 8.2 （ 8.1 、 8.3 、および 8 ）ではサポートされていません。4 がサポートされています）</block>
  <block id="918d32b75f0ab883abba3a8dc0c3ae8d" category="inline-link">Interoperability Matrix Tool で確認してください</block>
  <block id="02e7e71042609d3158020ab7befe45c6" category="list-text">を確認します<block ref="218f4ad7153f69cdc5467065434cd2f0" category="inline-link-rx"></block> 最新の認定バージョンについては、を参照してください。</block>
  <block id="e887aed8f9c3dbecd37e8896d96b6637" category="section-title">パフォーマンスの向上</block>
  <block id="2a71574e89a69c8218fbac3f604b5728" category="paragraph">SRM タスクを実行するには、運用パフォーマンスが重要な要件です。最新のRTOとRPOの要件を満たすために、ONTAPツールを備えたSRAでは、新たに3つの機能強化が追加されました。</block>
  <block id="bd403c539a0c414afacd7477bf3d311f" category="list-text">* 同時再保護処理のサポート。 * この機能を有効にすると、最初に SRA 9.7.1 で導入された、 2 つ以上のリカバリプランに対して再保護を同時に実行できるため、フェイルオーバーまたは移行後のデータストアの再保護に要する時間を短縮し、 RTO と RPO のパラメータ内に抑えることができます。</block>
  <block id="f63b947f655a5aee2cf69d4f30d7f96b" category="list-text">* ONTAP ツール 9.8 では、 NAS 専用に最適化された新しいモードが追加されました。 * SVM を対象としたアカウントを使用して、 NFS ベースのデータストアのみで ONTAP クラスタに接続している場合は、サポートされている環境でピークパフォーマンスが得られるように NAS 専用に最適化モードを有効</block>
  <block id="c82379d922d9cdc55fa21affe9f9b8bf" category="list-text">* ONTAP Tools 9.12では、ONTAPのSnapMirrorクイック再同期機能がサポートされるようになりました。*これにより、ストレージ効率の削減をポストプロセスで再計算しなくても、ミラーを迅速に再同期できます。この機能はデフォルトでは使用されませんが、従来の再同期に時間がかかりすぎる、またはタイムアウトになる大規模な環境で有効にすることができます。</block>
  <block id="4a4842d7448ef71eb69b013e560b18bb" category="section-title">拡張性の向上</block>
  <block id="26738e8d40ae8035805f13bdbf185c30" category="paragraph">SRM 8.3 以降で使用する ONTAP ツールでは、 SRA で最大 500 個の保護グループ（ PG ）がサポートされるようになりました。</block>
  <block id="96cb4d41ca97bd9d3d446984d3170a57" category="paragraph">待望の新機能として、 ONTAP 9.5 以降を搭載した SnapMirror Synchronous （ SM-S ）があります。この機能は、ミッションクリティカルなアプリケーションに対して、ボリュームレベルで RPO ゼロのデータレプリケーション解決策を提供します。SM-S には、 ONTAP ツール 9.8 以降が必要です。</block>
  <block id="b9832b10a87d0c3793ed3b413ee1d839" category="section-title">REST API をサポート</block>
  <block id="0065ce57adc813187a8e9c640ba6223a" category="paragraph">SRA サーバの設定を REST API で管理できるようになりました。自動化ワークフローの構築を支援するSwagger UIが追加されました。このUIは、ONTAP toolsアプライアンスの<block ref="579ce3ee0a7c1521f3dce6a507ea64a0" prefix=" " category="inline-code"></block>。</block>
  <block id="dcaf091737df278b1b4bdd2e37c10a75" category="summary">NetApp ONTAP は、 2002 年に最新のデータセンターに導入されて以来、 VMware vSphere 環境向けストレージ解決策として業界をリードしてきました。また、コストを削減しながら管理を簡易化する革新的な機能を継続的に追加しています。</block>
  <block id="0a0e655ee9ba6467857ebf014a268f29" category="doc">VMware Site Recovery ManagerとNetApp ONTAP</block>
  <block id="5bdb12cbb14efa98a61e7c5e3b4de108" category="admonition">このドキュメントは、以前に公開されていたテクニカルレポート「TR-4900：VMware Site Recovery Manager」をONTAPに置き換えます。</block>
  <block id="7659430738ccf1c5b8c8084a4003c709" category="paragraph">NetApp ONTAP は、 2002 年に最新のデータセンターに導入されて以来、 VMware vSphere 環境向けストレージ解決策として業界をリードしてきました。また、コストを削減しながら管理を簡易化する革新的な機能を継続的に追加しています。このドキュメントでは、業界をリードするVMwareのディザスタリカバリ（DR）ソフトウェアであるONTAP 解決策for VMware Site Recovery Manager（SRM）について説明します。最新の製品情報とベストプラクティスを紹介し、導入の合理化、リスクの軽減、継続的な管理の簡素化を実現します。</block>
  <block id="e3445c3aa798f5ad98665e33d34dd952" category="paragraph">ベストプラクティスは、ガイドや互換性ツールなどの他のドキュメントを補うものです。ラボテストに基づいて開発されており、ネットアップのエンジニアやお客様は広範な現場経験を積んでいます。推奨されるベストプラクティスがお客様の環境に適していない場合もありますが、一般に最もシンプルなソリューションであり、ほとんどのお客様のニーズに対応できます。</block>
  <block id="10b8f80c23f8a44dfa6b10ae56d7dbe9" category="paragraph">本ドキュメントでは、ONTAP Tools for VMware vSphere 9.12（NetApp Storage Replication Adapter[SRA]およびVASA Provider[VP]を含む）およびVMware Site Recovery Manager 8.7と組み合わせて使用した場合の、ONTAP 9の最近のリリースの機能を中心に説明します。</block>
  <block id="c40f8c2af56356193284f6b46865d954" category="section-title">SRM で ONTAP を使用する理由</block>
  <block id="36c28121fc6c9b02a38c0b6c92654e9a" category="paragraph">ONTAP ソフトウェアを基盤とするネットアップのデータ管理プラットフォームは、 SRM に最も広く採用されているストレージソリューションの一部です。理由はそれだけではありません。セキュアでハイパフォーマンスなユニファイドプロトコル（NASとSANを併用）データ管理プラットフォームで、業界を定義するストレージ効率、マルチテナンシー、サービス品質管理、スペース効率に優れたSnapshotによるデータ保護、SnapMirrorによるレプリケーションを実現します。VMware ワークロードを保護するためにネイティブのハイブリッドマルチクラウド統合を活用し、多数の自動化ツールやオーケストレーションツールを簡単に利用できます。</block>
  <block id="2242b80f4627736a48c4c9a36b7428f6" category="paragraph">SnapMirrorをアレイベースのレプリケーションに使用すると、実績のある成熟したONTAPのテクノロジを活用できます。SnapMirror を使用すると、 VM やデータストア全体ではなく、変更されたファイルシステムブロックのみをコピーして、データを安全かつ効率的に転送できます。重複排除、圧縮、コンパクションなどのスペース削減効果を活用できます。最新の ONTAP システムで、バージョンに依存しない SnapMirror が使用されるようになり、ソースとデスティネーションのクラスタを柔軟に選択できるようになりました。SnapMirror は、災害復旧のための最も強力なツールの 1 つとなりました。</block>
  <block id="36b04390d6103d8075862e4b825a485e" category="paragraph">従来の NFS 、 iSCSI 、ファイバチャネル接続データストア（現在は VVOL データストアをサポート）のいずれを使用している場合でも、 SRM は、ディザスタリカバリやデータセンター移行の計画とオーケストレーションに ONTAP の機能のメリットを活用する堅牢なファーストパーティ製品を提供します。</block>
  <block id="5d111e8a6885460b43ecf1f7abb6377e" category="section-title">SRM での ONTAP 9 の活用方法</block>
  <block id="16d4ec242c9f020f3a1fade311c776ed" category="paragraph">SRM は、 ONTAP システムの高度なデータ管理テクノロジを活用して、 3 つの主要コンポーネントで構成される仮想アプライアンスである VMware vSphere 用 ONTAP ツールと統合します。</block>
  <block id="d54038ba1f2a04a5b5f26c96627ae3e7" category="list-text">vCenter プラグイン（旧 Virtual Storage Console （ VSC ））は、 SAN と NAS のどちらを使用している場合でも、ストレージ管理と効率化機能の簡易化、可用性の向上、ストレージコストと運用オーバーヘッドの削減を実現します。データストアのプロビジョニングのベストプラクティスを使用して、 NFS 環境およびブロックストレージ環境用の ESXi ホスト設定を最適化します。以上のメリットのために、 ONTAP ソフトウェアを実行するシステムで vSphere を使用する場合はこのプラグインを推奨します。</block>
  <block id="a106bb15d6dc2b11535ed4fefc81fbf4" category="list-text">VASA Provider for ONTAP は、 VMware vStorage APIs for Storage Awareness （ VASA ）フレームワークをサポートしています。VASA Provider では、 VM ストレージのプロビジョニングと監視に役立つように vCenter Server と ONTAP を接続します。VMware Virtual Volumes （ VVol ）のサポートと、ストレージ機能プロファイル（ VVol レプリケーション機能を含む）の管理、および個々の VM VVol のパフォーマンスの管理が可能になります。また、容量の監視やプロファイルへの準拠に関するアラームも生成されます。SRM と一緒に使用すると、 VASA Provider for ONTAP で VVOL ベースの仮想マシンをサポートできます。 SRM サーバに SRA アダプタをインストールする必要はありません。</block>
  <block id="f2007951062862f5f0d593acbb23bcb4" category="list-text">SRA は SRM と一緒に使用され、従来の VMFS データストアと NFS データストアの本番サイトとディザスタリカバリサイト間での VM データのレプリケーションを管理します。また、 DR レプリカの無停止テストにも使用できます。検出、リカバリ、再保護のタスクを自動化します。Windows SRM サーバおよび SRM アプライアンス用の SRA サーバアプライアンスと SRA アダプタの両方が含まれています。</block>
  <block id="8ccaa60ee78ecc93c4870b3b2ad15284" category="paragraph">SRM サーバに SRA アダプタをインストールして設定し、 VASA Provider で VVol 以外のデータストアを保護したり VVOL のレプリケーションを有効にしたりしたあとで、ディザスタリカバリ用に vSphere 環境を設定する作業を開始できます。</block>
  <block id="0a1e25166326359cd5f50d0ab83e6a37" category="paragraph">SRA と VASA Provider には、 SRM サーバ用のコマンド / 制御インターフェイスが用意されており、 VMware 仮想マシン（ VM ）を含む ONTAP FlexVol や、 SRA を保護する SnapMirror レプリケーションを管理できます。</block>
  <block id="38db855935949f86c5db7bfe7d49873e" category="paragraph">SRM 8.3 以降では、 SRM サーバへの新しい SRM VVol Provider 制御パスが導入され、 SRA を使用せずに vCenter サーバおよびその経由で VASA Provider に通信できるようになりました。これにより、 SRM サーバは緊密に統合するための完全な API を提供するため、以前よりもはるかに ONTAP クラスタの制御を活用できました。</block>
  <block id="1c27364cc3705aff403c6ef131c347ff" category="paragraph">SRMでは、ネットアップ独自のFlexCloneテクノロジを使用して、システムを停止することなくDR計画をテストし、保護されたデータストアのクローンをDRサイトにほぼ瞬時に作成できます。SRM はサンドボックスを作成して安全にテストし、真の災害が発生した場合に組織とお客様を保護します。そのため、組織は災害時にフェイルオーバーを実行できます。</block>
  <block id="04a8f82007ed4bec45053912a49b6f85" category="paragraph">実際に災害が発生した場合や、計画的な移行の場合でも、 SRM では、最終的な SnapMirror 更新（必要な場合）を使用して、データセットに最新の変更を送信できます。その後、ミラーを解除し、 DR ホストにデータストアをマウントします。この時点で、計画済みの戦略に基づいて、 VM の電源を任意の順序で自動的にオンにすることができます。</block>
  <block id="b2560426a08ae6ceb167dad2bfb5e8ae" category="section-title">SRM と ONTAP などのユースケース：ハイブリッドクラウドと移行</block>
  <block id="ed4c730bd8636c27d3eaa876c63b3d45" category="inline-link">Equinix 内の NetApp Private Storage</block>
  <block id="b422e05bc5c6f52208b66ff51d718b9d" category="paragraph">SRM 環境に ONTAP の高度なデータ管理機能を統合することで、ローカルストレージオプションに比べて、拡張性とパフォーマンスが大幅に向上します。それだけではありませんが、ハイブリッドクラウドの柔軟性を備えています。ハイブリッドクラウドを使用すると、 FabricPool を使用して、未使用のデータブロックをハイパフォーマンスアレイから希望するハイパースケーラに階層化してコストを削減できます。これは、 NetApp StorageGRID などのオンプレミスの S3 ストアである可能性があります。また、 ONTAP Select （ CVO ）やを使用して、ソフトウェアで定義される Cloud Volumes ONTAP やクラウドベースの DR でエッジベースのシステムに SnapMirror を使用することもできます<block ref="37a666d3a37f1c4a8c4c8dba379664a4" category="inline-link-rx"></block> Amazon Web Services （ AWS ）、 Microsoft Azure 、 Google Cloud Platform （ GCP ）で、クラウド内に完全に統合されたストレージ、ネットワーク、コンピューティングサービスのスタックを構築できます。</block>
  <block id="87a7b114355b836acefe833c497611bb" category="paragraph">その後、FlexCloneを使用すれば、ストレージの設置面積をほぼゼロに抑えながら、クラウドサービスプロバイダのデータセンター内でテストフェイルオーバーを実行できます。組織を保護することで、かつてないほどコストを削減できます。</block>
  <block id="12d0cbcf61df7df30bf9b020f6fbb051" category="paragraph">SRM は、 SnapMirror を使用して、計画的な移行を実行することもできます。これにより、 VM を 1 つのデータセンターから別のデータセンターに効率的に転送したり、独自のデータセンターや、任意の数のネットアップパートナーサービスプロバイダを介して VM を転送したりできます。</block>
  <block id="160f88ca0bed5b24e94c809f4e22f1e7" category="summary">ONTAP 9 では、クラスタの物理コンポーネントはクラスタ管理者には見えますが、クラスタを使用しているアプリケーションやホストからは直接見えません。</block>
  <block id="89fafdb11a7e8cd8abebb1d4df053dad" category="doc">レプリケーショントポロジ</block>
  <block id="be01acd2f018d38f9446f06b99ee4a2a" category="paragraph">ONTAP 9 では、クラスタの物理コンポーネントはクラスタ管理者には見えますが、クラスタを使用しているアプリケーションやホストからは直接見えません。物理コンポーネントは共有リソースのプールを提供し、このリソースプールから論理クラスタリソースが構築されます。アプリケーションとホストは、ボリュームと LIF を含む SVM 経由でのみデータにアクセスします。</block>
  <block id="7758fc02779ee5917b0a09ee22b52221" category="paragraph">VMware vCenter Site Recovery Manager では、各 NetApp SVM がアレイとして扱われます。SRM は、特定のアレイ間（または SVM から SVM ）のレプリケーションレイアウトをサポートしています。</block>
  <block id="58c0b55a67f4331cc49b073a7183e06c" category="paragraph">1 つの VM が、次の理由から、複数の SRM アレイ上で仮想マシンディスク（ VMDK ）または RDM を所有することはできません。</block>
  <block id="880aeda0b58c0b30120b6319ae5f3beb" category="list-text">SRM は SVM のみを認識し、個々の物理コントローラは認識しません。</block>
  <block id="6f55124e085dbeb640e4cb8ad2c97905" category="list-text">SVM は、クラスタ内の複数のノードにまたがる LUN とボリュームを制御できます。</block>
  <block id="39d9903201320a83d45d3b36d512f051" category="cell">ベストプラクティス</block>
  <block id="d86019fe4ba86b184ac71cf24a22f0c6" category="cell">サポートされるかどうかを判断するには、このルールに注意してください。 SRM と NetApp SRA を使用して VM を保護するには、 VM のすべての部分が 1 つの SVM 上にのみ存在する必要があります。このルールは、保護対象サイトとリカバリサイトの両方に適用されます。</block>
  <block id="2e4472d35f80aa8b7eca52ae3dd43dc6" category="section-title">サポートされる SnapMirror レイアウト</block>
  <block id="d070ad9d8397892aa7f317cbb9046661" category="paragraph">次の図は、 SRM と SRA でサポートされる SnapMirror 関係のレイアウトシナリオを示しています。レプリケートされたボリューム内の各 VM は、各サイトの 1 つの SRM アレイ（ SVM ）上のデータのみを所有します。</block>
  <block id="39d3085abe6ccb914d8535de8a5f3e37" category="paragraph"><block ref="39d3085abe6ccb914d8535de8a5f3e37" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1ae7670cf947a397bdf6a882fbcc912a" category="paragraph"><block ref="1ae7670cf947a397bdf6a882fbcc912a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="111d3212464dba203cbd675a0338dcbc" category="paragraph"><block ref="111d3212464dba203cbd675a0338dcbc" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c5dc3a606b05b41db22793ed3c1a72db" category="paragraph"><block ref="c5dc3a606b05b41db22793ed3c1a72db" category="inline-image-macro-rx" type="image"></block></block>
  <block id="86cf5bd2bdb1b1d67f8f907f41099509" category="section-title">サポートされている Array Manager レイアウト</block>
  <block id="aacc8f18d659f75715d91a983e872233" category="paragraph">次のスクリーンショットに示すように、 SRM でアレイベースレプリケーション（ ABR ）を使用すると、保護グループは単一のアレイペアに分離されます。このシナリオでは、<block ref="129864522ed0e4ac80f306ecfa130ef7" prefix=" " category="inline-code"></block> および<block ref="ec87aa7f4c8e70a139fd988f87b6549f" prefix=" " category="inline-code"></block> ピア関係を設定する<block ref="387d04b65848414d4697f145a3782f90" prefix=" " category="inline-code"></block> および<block ref="58bdbfcb72c2dd3d883a7ca754443a4c" prefix=" " category="inline-code"></block> リカバリサイトで。ただし、保護グループを作成するときに選択できるアレイペアは 2 つのうちの 1 つだけです。</block>
  <block id="68a1b289711a591ed50627014cd01ce9" category="paragraph"><block ref="68a1b289711a591ed50627014cd01ce9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1ceb46f3e1c6c7995de4ec5f05601227" category="section-title">サポートされないレイアウトです</block>
  <block id="611b9b35ac984f20e6594baec9181dbf" category="paragraph">サポート対象外の構成では、個々の VM が所有する複数の SVM にデータ（ VMDK または RDM ）があります。次の図に示す例では、<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block> SRMで保護を設定できません。理由：<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block> 2つのSVM上のデータがあります。</block>
  <block id="5c251a65e8394fbeaf104ba1a1cad2e1" category="paragraph"><block ref="5c251a65e8394fbeaf104ba1a1cad2e1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f5f5fe64e0e9d0ae7ce2a0777d0ccf62" category="paragraph"><block ref="f5f5fe64e0e9d0ae7ce2a0777d0ccf62" category="inline-image-macro-rx" type="image"></block></block>
  <block id="69851ac8c2fa81b32799efc8522798d5" category="paragraph">1 つのネットアップボリュームを 1 つのソース SVM から同じ SVM または異なる SVM の複数のデスティネーションにレプリケートするレプリケーション関係は、 SnapMirror ファンアウトと呼ばれます。SRM ではファンアウトはサポートされていません。次の図の例では、<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block> SnapMirrorを使用して2つの異なる場所にレプリケートされるため、SRMで保護を設定できません。</block>
  <block id="688890bdbdfd2d73a05a09883f3c4b40" category="paragraph"><block ref="688890bdbdfd2d73a05a09883f3c4b40" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3f88384b0d5cdcdc25895c644126c1b0" category="section-title">SnapMirror カスケード</block>
  <block id="7ebde774ad43c45667d5544308a6d688" category="paragraph">SnapMirror でソースボリュームをデスティネーションボリュームにレプリケートし、そのデスティネーションボリュームを SnapMirror で別のデスティネーションボリュームにレプリケートする SnapMirror 関係のカスケードを、 SRM ではサポートしていません。次の図に示すシナリオでは、 SRM を使用してサイト間のフェイルオーバーを実行することはできません。</block>
  <block id="2990fc44e9ba827a397e96e1c278a02a" category="paragraph"><block ref="2990fc44e9ba827a397e96e1c278a02a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8bd15e818d377a0a5cf6ebc429555f79" category="section-title">SnapMirror と SnapVault</block>
  <block id="d440734d1f5d9c6e59aa97f7cbbcd525" category="paragraph">NetApp SnapVault ソフトウェアを使用すると、ネットアップストレージシステム間でエンタープライズデータをディスクベースでバックアップできます。SnapVault と SnapMirror は同じ環境内に共存できますが、 SRM でサポートされているのは、 SnapMirror 関係のフェイルオーバーだけです。</block>
  <block id="7878dfbf4b6ad3bc60d095cf89d79202" category="admonition">NetApp SRAは、<block ref="e7d3e049f94ce3ff8a47f209f012173d" prefix=" " category="inline-code"></block> ポリシータイプ。</block>
  <block id="883e69a285ae2d5fd23c80cd29285804" category="paragraph">SnapVault は ONTAP 8.2 で一から再構築されました。以前の Data ONTAP 7-Mode で使用されていたユーザは共通点に注意する必要がありましたが、このバージョンの SnapVault では主に拡張機能が追加されています。大きな進歩の 1 つは、 SnapVault 転送時にプライマリデータの Storage Efficiency を維持できることです。</block>
  <block id="9bc21373e0e299579a7ac86dcd4f513d" category="paragraph">アーキテクチャの重要な変更点は、 7-Mode SnapVault の場合と同様に、 ONTAP 9 の SnapVault でも qtree レベルではなくボリュームレベルでレプリケートされる点です。つまり、 SnapVault 関係のソースはボリュームでなければならず、そのボリュームは SnapVault セカンダリシステム上の独自のボリュームにレプリケートされる必要があります。</block>
  <block id="d447048519c85a2fb3bea0790cd109fb" category="paragraph">SnapVaultを使用する環境では、プライマリストレージシステム上に特別な名前のスナップショットが作成されます。実装されている構成に応じて、SnapVaultスケジュールまたはNetApp Active IQ Unified Managerなどのアプリケーションを使用して、名前付きSnapshotをプライマリシステムに作成できます。プライマリシステムで作成された名前付きSnapshotがSnapMirrorデスティネーションにレプリケートされ、そこからSnapVaultデスティネーションに保存されます。</block>
  <block id="5dd37b7cd36f7d38ba2e6a63c603be4c" category="paragraph">ソースボリュームは、ボリュームが DR サイトの SnapMirror デスティネーションにレプリケートされるカスケード構成で作成でき、そこから SnapVault デスティネーションに保存されます。ファンアウト関係では、一方のデスティネーションが SnapMirror デスティネーション、もう一方が SnapVault デスティネーションであるソースボリュームも作成できます。ただし、 SRM フェイルオーバーまたはレプリケーションの反転時に、 SRA は、 SnapMirror デスティネーションボリュームを SnapVault のソースとして使用するように SnapVault 関係を自動では再設定しません。</block>
  <block id="5bc66b9c84b3f7cc0b375e729376b68d" category="inline-link">TR-4015 ：『 SnapMirror Configuration Best Practice Guide for ONTAP 9 』</block>
  <block id="0d510e96259254d285c6aaeb8458f45d" category="paragraph">SnapMirror および SnapVault for ONTAP 9 の最新情報については、を参照してください<block ref="32e7c991f675bf983c547a2a174c2caf" category="inline-link-rx"></block></block>
  <block id="75f8a2d99eea9f336120aec69d8c1010" category="cell">SnapVault と SRM を同じ環境で使用する場合、通常は DR サイトの SnapMirror デスティネーションから SnapVault バックアップを実行する、 SnapMirror から SnapVault へのカスケード構成を使用することを推奨します。災害が発生すると、この構成によってプライマリサイトにアクセスできなくなります。リカバリサイトに SnapVault デスティネーションを配置すると、フェイルオーバー後に SnapVault バックアップを再設定して、リカバリサイトで SnapVault バックアップを継続できるようになります。</block>
  <block id="e082a67e3ddd7f4f92096536440cbb34" category="paragraph">VMware 環境では、各データストアに Universal Unique Identifier （ UUID ）が割り当てられ、各 VM には一意の Managed Object ID （ MOID ）が割り当てられます。SRM は、フェイルオーバーやフェイルバックの実行時にこれらの ID を維持しません。SRM はフェイルオーバーでデータストア UUID と VM MOID を維持しないため、これらの ID に依存するアプリケーションは SRM フェイルオーバーのあとに再設定する必要があります。たとえば、 SnapVault レプリケーションを vSphere 環境と調整する NetApp Active IQ Unified Manager などがあります。</block>
  <block id="657a41cce55646ab17754ac1427970af" category="paragraph">次の図に、 SnapMirror から SnapVault へのカスケード構成を示します。SnapVault デスティネーションがプライマリサイトの停止の影響を受けない DR サイトまたは第 3 のサイトにある場合、フェイルオーバー後にバックアップを続行できるように環境を再設定できます。</block>
  <block id="b56afb9a43332c671116b9fa3d597867" category="paragraph"><block ref="b56afb9a43332c671116b9fa3d597867" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e068178460f103498576eac8ddb7fb82" category="paragraph">次の図は、 SRM を使用して SnapMirror レプリケーションをプライマリサイトに反転したあとの構成を示しています。SnapMirror ソースから SnapVault バックアップが実行されるように環境が再設定されている。このセットアップは、 SnapMirror SnapVault のファンアウト構成です。</block>
  <block id="0ffa07ffd89b136d0ed8f2ac5ebcabb8" category="paragraph"><block ref="0ffa07ffd89b136d0ed8f2ac5ebcabb8" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b4607a4ee7e1830ab6ba0007df206956" category="paragraph">SRM でフェイルバックを実行し、 SnapMirror 関係が再度反転されると、本番環境のデータはプライマリサイトに戻ります。SnapMirror と SnapVault のバックアップにより、 DR サイトへのフェイルオーバー前と同じ方法でこのデータを保護できるようになりました。</block>
  <block id="63fd1f18d5d53fa97fd05a7fd96090b4" category="section-title">Site Recovery Manager 環境での qtree の使用</block>
  <block id="2d88570ceb2de0d8699a068b0140454b" category="paragraph">qtree は、 NAS のファイルシステムクォータを適用可能な特殊なディレクトリです。ONTAP 9 では qtree を作成でき、 SnapMirror でレプリケートされたボリュームに配置できます。ただし、 SnapMirror では、個々の qtree のレプリケーションまたは qtree レベルのレプリケーションは実行できません。すべての SnapMirror レプリケーションは、ボリュームレベルで実行されます。このため、 SRM で qtree を使用することは推奨されません。</block>
  <block id="345cb3f040f9f7f3f1a4261ed260aa79" category="section-title">FC と iSCSI の混在環境</block>
  <block id="a60b166c2b69b4fdfbb733dc2193668a" category="paragraph">サポート対象の SAN プロトコル（ FC 、 FCoE 、 iSCSI ）の場合、 ONTAP 9 は LUN サービスを提供します。 LUN サービスの提供とは、 LUN を作成して、接続されているホストにマッピングする機能です。クラスタは複数のコントローラで構成されるため、個々の LUN へのマルチパス I/O で管理される論理パスが複数あります。ホスト上で Asymmetric Logical Unit Access （ ALUA ；非対称論理ユニットアクセス）が使用されるため、 LUN への最適なパスが選択され、データ転送用にアクティブになります。LUN への最適パスが変わった場合（格納先ボリュームが移動された場合など）、 ONTAP 9 は自動的にこの変更を認識し、システムを停止することなく調整します。最適パスが利用できなくなった場合、 ONTAP は無停止で他の利用可能なパスに切り替えることができます。</block>
  <block id="b9921ac732e72656bc2836f83bb09522" category="paragraph">VMware SRM と NetApp SRA の環境では、一方のサイトで FC プロトコルを使用し、もう一方のサイトで iSCSI プロトコルを使用できます。ただし、 FC 接続のデータストアと iSCSI 接続のデータストアを同じ ESXi ホストで混在させたり、同じクラスタ内の別のホストで使用したりすることはできません。この構成は SRM ではサポートされていません。 SRM フェイルオーバーまたはテストフェイルオーバーの実行中、 SRM は要求に応じて ESXi ホストのすべての FC イニシエータと iSCSI イニシエータを含めます。</block>
  <block id="fccd44a96243e459128798803dca70aa" category="cell">SRM と SRA では、保護サイトとリカバリサイト間での FC プロトコルと iSCSI プロトコルの混在をサポートしています。ただし、各サイトで FC または iSCSI のどちらかのプロトコルを 1 つだけ使用し、同じサイトで両方のプロトコルを使用することはできません。1 つのサイトに FC プロトコルと iSCSI プロトコル両方を設定する必要がある場合、一部のホストで iSCSI を使用し、他のホストで FC を使用することを推奨します。また、 VM がどちらか一方のホストグループまたは他方のホストグループにフェイルオーバーするように設定されるように、 SRM リソースマッピングを設定することも推奨します。</block>
  <block id="963739e9818c0bf4d8959b5cdf6a7956" category="summary">SRM で VVOL レプリケーションを使用する場合、 SRA と従来のデータストアで使用するワークフローは大きく異なります。</block>
  <block id="56687c1a324f03f5d1429500efea710e" category="doc">VVol レプリケーションを使用する場合の SRM のトラブルシューティング</block>
  <block id="14acf40cbe69d8682b4c844ac7fbf7f6" category="paragraph">SRM で VVOL レプリケーションを使用する場合、 SRA と従来のデータストアで使用するワークフローは大きく異なります。たとえば、アレイマネージャの概念はありません。そのため、<block ref="0ec64480a9620a1430c0ae1b6603ea01" prefix=" " category="inline-code"></block> および<block ref="ba6c59072f543cb828e47d5bac560371" prefix=" " category="inline-code"></block> コマンドは表示されません。</block>
  <block id="ef74d715544e3b067a6bec3218ac5044" category="paragraph">トラブルシューティングを行う場合は、以下に示す新しいワークフローについて理解しておくと役立ちます。</block>
  <block id="47f0942d341ee10381b2eff35089d75d" category="list-text">queryReplicationPeer ： 2 つのフォールトドメイン間のレプリケーション契約を検出します。</block>
  <block id="136a299aae29998a147852cb0cba5b4a" category="list-text">queryFaultDomain ：障害ドメインの階層を検出します。</block>
  <block id="c071098c5df923c31f6245e4db2f3861" category="list-text">queryReplicationGroup ：ソースドメインまたはターゲットドメインに存在するレプリケーショングループを検出します。</block>
  <block id="792cfe9ad3a3dc8528080a262e92989a" category="list-text">syncReplicationGroup ：ソースとターゲット間でデータを同期します。</block>
  <block id="39afb1e1e3b180a6230e07bb8571667e" category="list-text">queryPointInTimeReplica ：ターゲット上のポイントインタイムレプリカを検出します。</block>
  <block id="9fb25fe2ff084dc9ccfb99eaccba7212" category="list-text">testFailoverReplicationGroupStart ：テストフェイルオーバーを開始します。</block>
  <block id="bd4e1dacaca4c37a53b5286b6ae0239d" category="list-text">testFailoverReplicationGroupStop ：テストフェイルオーバーを終了します。</block>
  <block id="887f376a43cf9de1d6e14a8d69e588f6" category="list-text">promoteReplicationGroup ：テスト中のグループを本番環境に昇格します。</block>
  <block id="17ab16c5c0786ff381e6a085318bad9b" category="list-text">prepareFailoverReplicationGroup ：災害復旧の準備をします。</block>
  <block id="665dd64ebcc4016bda94e0e8020d8c8e" category="list-text">FailoverReplicationGroup ：ディザスタリカバリを実行します。</block>
  <block id="6936cf00e30b7cd4421225113a023c3e" category="list-text">revertReplicateGroup ：逆方向のレプリケーションを開始します。</block>
  <block id="61ac8950a043e6998b458d4f8171154c" category="list-text">queryMatchingContainer: 指定されたポリシーを使用したプロビジョニング要求を満たす可能性のあるコンテナを（ホストまたはレプリケーショングループとともに）検索します。</block>
  <block id="05c9efdc056d2af4640bc441ab61b53a" category="list-text">queryResourceMetadata ： VASA Provider からすべてのリソースのメタデータを検出し、リソース利用率を回答として queryMatchingContainer 関数に返すことができます。</block>
  <block id="01fa56986f885c588b1be8c206623de8" category="paragraph">VVOL レプリケーションの設定時に表示される最も一般的なエラーは、 SnapMirror 関係を検出できないエラーです。これは、ボリュームおよび SnapMirror 関係が ONTAP ツールを対象としたものではないためです。そのため、 SnapMirror 関係が常に完全に初期化されていることを確認し、レプリケートされた VVOL データストアを作成する前に両方のサイトの ONTAP ツールで再検出を実行することを推奨します。</block>
  <block id="3e4627f6667f830baceaaf35890b575a" category="summary">このドキュメントに記載されている情報の詳細については、以下のドキュメントや Web サイトを参照してください。</block>
  <block id="092bf78f9c97ba171b8232ddff585392" category="doc">追加情報</block>
  <block id="7d5b957cd473f6eaf5ad335a9c63c4ff" category="paragraph">このドキュメントに記載されている情報の詳細については、以下のドキュメントや Web サイトを参照してください。</block>
  <block id="ccc4b678df8ad6453b7f71661f118ae1" category="inline-link"><block ref="ccc4b678df8ad6453b7f71661f118ae1" category="inline-link-rx"></block></block>
  <block id="b17e2a7e5f42c90b40de5971850339ae" category="list-text">TR-4597 ：『 VMware vSphere for ONTAP 』
<block ref="5938ff9651f6c5e53544676ba8504afc" category="inline-link-rx"></block></block>
  <block id="7d9ee37e3155d571b441d63bcbc54709" category="inline-link"><block ref="7d9ee37e3155d571b441d63bcbc54709" category="inline-link-rx"></block></block>
  <block id="52c629361849219069b336f56f1556d0" category="list-text">TR-4400 ：『 VMware vSphere Virtual Volumes with ONTAP 』
<block ref="b7bf139d6051615d8c8e01b6b63dacc3" category="inline-link-rx"></block></block>
  <block id="18df8e05a5400abd9d0980b1c5bc9ef3" category="list-text">TR-4015 ：『 SnapMirror Configuration Best Practice Guide for ONTAP 9 』
<block ref="e361bd9d6f7b20da762bc23fcb3d09c2" category="inline-link-rx"></block></block>
  <block id="cbe2f6eb2a73f4a2c871a06264f10dc7" category="inline-link"><block ref="cbe2f6eb2a73f4a2c871a06264f10dc7" category="inline-link-rx"></block></block>
  <block id="249b98331fa56dc46bf6ba51dc6c39d5" category="list-text">RBAC User Creator for ONTAP の略
<block ref="6b15b91279acfce2bbee060bdb17db43" category="inline-link-rx"></block></block>
  <block id="c88037eb28ae3cceb0e32c2cd3c322d7" category="inline-link"><block ref="c88037eb28ae3cceb0e32c2cd3c322d7" category="inline-link-rx"></block></block>
  <block id="1a57e0f74e725c1a5e2d53b4d4b4460d" category="list-text">VMware vSphere リソース用の ONTAP ツール
<block ref="80c496cd9ab75e5683007d8f66ca6fbf" category="inline-link-rx"></block></block>
  <block id="9aa6e8f8fac5c131e5924ee033660d29" category="inline-link"><block ref="9aa6e8f8fac5c131e5924ee033660d29" category="inline-link-rx"></block></block>
  <block id="91a48e1708df22b7464bced79c745ad2" category="list-text">VMware Site Recovery Manager のドキュメント
<block ref="92ad802ced4838839b492be6d0bf427d" category="inline-link-rx"></block></block>
  <block id="c9dd6bad4c7d561872f2e2d498a990bf" category="inline-link">Interoperability Matrix Tool （ IMT ）</block>
  <block id="97cd1357ea4a16b44bd9e360127a1a9d" category="paragraph">を参照してください<block ref="99cfde592e1d7fa7832b186d73ee4002" category="inline-link-rx"></block> NetApp Support Siteで、本ドキュメントに記載されている製品や機能のバージョンがお客様の環境でサポートされるかどうかを確認してください。NetApp IMT には、ネットアップがサポートする構成を構築するために使用できる製品コンポーネントやバージョンが定義されています。サポートの可否は、お客様の実際のインストール環境が公表されている仕様に従っているかどうかによって異なります。</block>
  <block id="1f82b18dcba5f32a085bc502cdd0c6b7" category="summary">ONTAP では、 Storage Virtual Machine （ SVM ）の概念を採用して、セキュアなマルチテナント環境で厳密にセグメント化します。</block>
  <block id="7520e12a140ccf3de279fe2fd48889e4" category="doc">導入のベストプラクティス</block>
  <block id="1b4574c516231b685bb37b013b789b06" category="section-title">SMT の SVM のレイアウトとセグメント化</block>
  <block id="446e04546ec0567eeeeef8e07368ab40" category="paragraph">ONTAP では、 Storage Virtual Machine （ SVM ）の概念を採用して、セキュアなマルチテナント環境で厳密にセグメント化します。ある SVM の SVM ユーザは、別の SVM のリソースにアクセスしたりリソースを管理したりすることはできませんこれにより、 ONTAP テクノロジを活用できます。ビジネスユニットごとに別々の SVM を作成して、同じクラスタ上で独自の SRM ワークフローを管理することで、全体的なストレージ効率を高めることができます。</block>
  <block id="f98c1d223f34b2fdaf90eab1a3bc6a25" category="paragraph">SVM を対象としたアカウントと SVM 管理 LIF を使用して ONTAP を管理することを検討し、セキュリティ制御を強化するだけでなく、パフォーマンスも向上させます。SRA は、物理リソースを含むクラスタ全体のすべてのリソースを処理する必要がないため、 SVM を対象とした接続を使用する場合は本質的にパフォーマンスが向上します。その代わり、特定の SVM に抽象化された論理資産だけを認識する必要があります。</block>
  <block id="849d4d5e8a5d5b2747d8375d2ec03b29" category="paragraph">NAS プロトコルのみを使用する（ SAN アクセスなし）場合は、次のパラメータを設定することで、 NAS 向けに最適化された新しいモードを利用することもできます（ SRA と VASA は、アプライアンスで同じバックエンドサービスを使用するため）。</block>
  <block id="05f551a655f40911851a53ba0c721997" category="list-text">コントロールパネルにログインします。<block ref="501a3478972ee5e3d6f109bdc0514bdc" prefix=" " category="inline-code"></block> [Web based CLI interface]をクリックします。</block>
  <block id="b0cc185c73ca964d1429a601551c68f5" category="list-text">コマンドを実行します<block ref="4f35e9b3adeccfaf0287d002b134221c" prefix=" " category="inline-code"></block>。</block>
  <block id="5f7e35f90689bef91afe9f01257c61ac" category="list-text">コマンドを実行します<block ref="aa610e3ab4e5162f432950793f30a387" prefix=" " category="inline-code"></block>。</block>
  <block id="ba2a1e4d95dc56709260e82cca20a789" category="list-text">コマンドを実行します<block ref="6d83e9fce5e947159c3c34b9f499e80e" prefix=" " category="inline-code"></block>。</block>
  <block id="2d14ca751c8ce5a724606e4f75f02c50" category="section-title">VVOL に ONTAP ツールを導入する際の考慮事項について説明します</block>
  <block id="fa3a193f1892cf0f45f4a95a35aa3c4b" category="paragraph">SRM で VVol を使用する場合は、クラスタを対象としたクレデンシャルとクラスタ管理 LIF を使用してストレージを管理する必要があります。これは、 VM ストレージポリシーに必要なポリシーを満たすためには、 VASA Provider で基盤となる物理アーキテクチャを理解しておく必要があるためです。たとえば、オールフラッシュストレージを必要とするポリシーが設定されている場合、 VASA Provider では、どのシステムがオールフラッシュであるかを認識できる必要があります。</block>
  <block id="31d279d1cc3bc5a4281567ba697f678d" category="paragraph">ONTAP Tools アプライアンスを管理している VVOL データストアに格納しないことを推奨します。その結果、アプライアンスがオフラインのためにアプライアンスのスワップ VVOL を作成できず、 VASA Provider の電源をオンにできなくなることがあります。</block>
  <block id="97399fb37deca0d463aa5c7dc8d064a6" category="section-title">ONTAP 9 システムの管理に関するベストプラクティス</block>
  <block id="18f8b81b7fb7ea92f333e127583df17c" category="paragraph">前述したように、クラスタまたは SVM を対象としたクレデンシャルと管理 LIF を使用して ONTAP クラスタを管理できます。パフォーマンスを最適化するには、VVOLを使用しないときは常にSVMを対象としたクレデンシャルの使用を検討してください。ただし、その場合は、いくつかの要件について確認しておく必要があります。また、機能の一部は失われます。</block>
  <block id="fec05e53ca7d96aaf3e4c1a1b2502bea" category="list-text">デフォルトの vsadmin SVM アカウントには、 ONTAP ツールのタスクを実行するために必要なアクセスレベルがありません。そのため、新しい SVM アカウントを作成する必要があります。</block>
  <block id="d508cbe8ee8a3aa0f975b96403baf33c" category="list-text">ONTAP 9.8以降を使用している場合はNetApp、ONTAP System Managerの[Users]メニューとONTAP toolsアプライアンスにあるjsonファイルを使用して、RBACの最小権限を持つユーザアカウントを作成することを推奨します。<block ref="137f8d4bb89dcc34c3bfe48f2a61c95e" prefix=" " category="inline-code"></block>。管理者パスワードを使用して JSON ファイルをダウンロードしてください。これは SVM またはクラスタを対象としたアカウントに使用できます。</block>
  <block id="a7a83b5e4f375c0585588b9c7ff92219" category="inline-link">NetApp Support Siteの Toolchest</block>
  <block id="fdfe9ba9104df6a32fff0f859291ea3c" category="paragraph">ONTAP 9.6 以前を使用している場合は、で使用可能な RBAC User Creator （ RUC ）ツールを使用する必要があります<block ref="bdbf96c18cf8ac76d01fba7057b81b87" category="inline-link-rx"></block>。</block>
  <block id="ea7a3d08d55dc3e8ecf89d2a5d5e302d" category="list-text">vCenter UI プラグイン、 VASA Provider 、 SRA サーバはすべて完全に統合されたサービスであるため、 vCenter UI で ONTAP ツール用のストレージを追加する場合と同じ方法で、 SRM で SRA アダプタにストレージを追加する必要があります。そうしないと、 SRA サーバが SRA アダプタ経由で SRM から送信された要求を認識しない可能性があります。</block>
  <block id="b473de4177eeaa79a66448798a446db3" category="list-text">SVM を対象としたクレデンシャルを使用している場合、 NFS パスのチェックは実行されませんこれは、物理的な場所が SVM から論理的に抽象化されているためです。ただしこれは原因の問題ではありません。最新の ONTAP システムで間接パスを使用してもパフォーマンスが著しく低下することはなくなりました。</block>
  <block id="6e62430b92a7c5a0b8512436b163a10d" category="list-text">Storage Efficiency によるアグリゲートのスペース削減量が報告されないことがあります。</block>
  <block id="93d86aa51e0909549d1b1210f887aef3" category="list-text">サポートされている場合、負荷共有ミラーを更新することはできません。</block>
  <block id="647d380b52e259fe7ed2e2582bc54b27" category="list-text">SVM を対象としたクレデンシャルで管理されている ONTAP システムでは、 EMS ロギングが実行されない場合があり</block>
  <block id="c5cd657df037c277c37216b73efb0b08" category="summary">可能であれば、必ず ONTAP ツールを使用してデータストアとボリュームをプロビジョニングしてください。ボリューム、ジャンクションパス、 LUN 、 igroup 、エクスポートポリシーが その他の設定は互換性のある方法で構成されます。</block>
  <block id="d3b26e9021e83573a3d2a9050400a33a" category="doc">運用上のベストプラクティス</block>
  <block id="4d15db58f26b374b36c283df6b5a5fc1" category="paragraph">SRM では、 ONTAP 9 で iSCSI 、ファイバチャネル、および NFS バージョン 3 をサポートしているのは、 SRA 経由のアレイベースのレプリケーションを使用している場合です。SRM は、従来のデータストアまたは VVOL データストアでの NFS バージョン 4.1 のアレイベースのレプリケーションをサポートしていません。</block>
  <block id="61f54ceeb0338787a2ee2d801cbc62cd" category="paragraph">接続を確認するために、 DR サイトの新しいテスト用データストアをデスティネーション ONTAP クラスタからマウントしてアンマウントできることを必ず確認してください。データストアの接続に使用する各プロトコルをテストします。テスト用データストアは SRM の指示に従ってすべてのデータストアの自動化を実行するため、 ONTAP ツールを使用して作成することを推奨します。</block>
  <block id="0ac3e8abbf45a28af68d22b0f59a973e" category="paragraph">SAN プロトコルは各サイトで同機種にする必要があります。NFS と SAN を混在させることはできますが、 SAN プロトコルを 1 つのサイト内に混在させないでください。たとえば、サイト A では FCP を、サイト B では iSCSI を使用できますサイト A では、 FCP と iSCSI の両方を使用しないでくださいその理由は、 SRA がリカバリサイトに混在する igroup を作成しないため、 SRM が SRA に指定されたイニシエータリストをフィルタリングしないためです。</block>
  <block id="150f8d9d5018ff00285d9aa158451d7b" category="paragraph">以前のガイドでは、 LIF を作成してデータの局所性を確保することを推奨つまり、必ず、ボリュームを物理的に所有するノード上の LIF を使用してデータストアをマウントします。これは、 ONTAP 9 の最新バージョンでは必須ではなくなりました。可能 ONTAP であれば、クラスタを対象とした特定のクレデンシャルがあれば、データに対してローカルな LIF 間での負荷分散は引き続き行われますが、高可用性やパフォーマンスの要件ではありません。</block>
  <block id="62a631034cae40cfcee909c69c12c5b3" category="paragraph">NetApp ONTAP 9では、オートサイズが緊急時に十分な容量を提供できない場合に、スペース不足が発生したときにSnapshotを自動的に削除してアップタイムを維持するように設定できます。この機能のデフォルト設定では、SnapMirrorで作成されたSnapshotは自動的に削除されません。SnapMirror Snapshotが削除されると、NetApp SRAは影響を受けたボリュームのレプリケーションを反転および再同期できません。ONTAPがSnapMirror Snapshotを削除しないようにするには、Snapshotの自動削除機能をtryに設定します。</block>
  <block id="63b6c8d5e17ef7185a34c4ddd86f9d19" category="inline-link-macro">ボリュームを自動的に拡張または縮小するための設定</block>
  <block id="a1874a28c8389c5c687d10167e80dc1f" category="paragraph">ボリュームのオートサイズの設定：<block ref="4d200fce73a8e1cc965cfc2c43343824" prefix=" " category="inline-code"></block> SANデータストアヲフクムボリューム<block ref="d89f4f8b1d7c18847b88b46142f61535" prefix=" " category="inline-code"></block> （NFSデータストアの場合）。の詳細を確認してください <block ref="ebd664f1c7cf128a3758282775d35e72" category="inline-link-macro-rx"></block>。</block>
  <block id="e401bd7c98141814eaf5528ddb318da6" category="section-title">Storage Policy Based Management（SPBM；ストレージポリシーベースの管理）とVVOL</block>
  <block id="3077a08ffed60acebf18d37874130d44" category="paragraph">SRM 8.3 以降では、 VVol データストアを使用した VM の保護がサポートされています。SnapMirror スケジュールは、次のスクリーンショットに示すように、 ONTAP のツール設定メニューで VVOL のレプリケーションが有効になっている場合、 VASA Provider によって VM ストレージポリシーに公開されます。</block>
  <block id="399c1894baf71c0529aa0fba66ea18fb" category="paragraph">次の例は、 VVol レプリケーションを有効にする方法を示しています。</block>
  <block id="b180e7f35111dca8acd6c56cdbcabb3e" category="paragraph"><block ref="b180e7f35111dca8acd6c56cdbcabb3e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="be41c3baf700984021c43e2e6b661b0a" category="paragraph">次のスクリーンショットは、 VM ストレージポリシーの作成ウィザードに表示される SnapMirror スケジュールの例を示しています。</block>
  <block id="43c130b36e9e2b3d61409aa974f89fc7" category="paragraph"><block ref="43c130b36e9e2b3d61409aa974f89fc7" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f6292d9eb6ea467a3c3560a65b7f63b5" category="paragraph">ONTAP VASA プロバイダでは、異なるストレージへのフェイルオーバーがサポートされます。たとえば、システムは、エッジの場所にある ONTAP Select からコアデータセンターの AFF システムにフェイルオーバーできます。ストレージの類似性に関係なく、レプリケーションが有効な VM ストレージポリシーのストレージポリシーマッピングとリバースマッピングを常に設定して、リカバリサイトで提供されるサービスが期待される要件を満たしていることを確認する必要があります。次のスクリーンショットは、ポリシーマッピングの例を示しています。</block>
  <block id="783a951245ce43eb84161804072a38c6" category="paragraph"><block ref="783a951245ce43eb84161804072a38c6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1eb90dc8f7adfd00c74af3b815e2ac15" category="section-title">VVOL データストア用にレプリケートされたボリュームを作成します</block>
  <block id="18231879821321e0aed7de84fe876766" category="paragraph">以前の VVOL データストアとは異なり、レプリケートされた VVOL データストアはレプリケーションを有効にして最初から作成する必要があります。また、 SnapMirror 関係を持つ ONTAP システムで事前に作成されたボリュームを使用する必要があります。そのためには、クラスタピアリングや SVM ピアリングなどの設定を事前に行う必要があります。これらの作業は ONTAP 管理者が行う必要があります。複数のサイトにわたって ONTAP システムを管理する担当者と、主に vSphere の運用を担当する担当者を厳密に分離できるためです。</block>
  <block id="0a8c8293003bf411817ef3cedf18a2a9" category="paragraph">これは、 vSphere 管理者の代わりに新たな要件となります。ボリュームは ONTAP ツールの範囲外に作成されるため、定期的な再検出スケジュール期間が設定されるまで ONTAP 管理者が行った変更を認識することはありません。そのため、 VVOL で使用するボリュームまたは SnapMirror 関係を作成したときは常に再検出を実行することを推奨します。次のスクリーンショットに示すように、ホストまたはクラスタを右クリックし、 NetApp ONTAP tools &gt; Update Host and Storage Data を選択します。</block>
  <block id="dd5e006520a09e3975e52f6fb8991fd2" category="paragraph"><block ref="dd5e006520a09e3975e52f6fb8991fd2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="550d51e15336d4a33bcbb0f26a6810f7" category="paragraph">VVOL と SRM については、 1 つ注意が必要です。保護された VM と保護されていない VM を同じ VVOL データストアに混在させないでください。これは、 SRM を使用して DR サイトにフェイルオーバーする場合、保護グループに属する VM のみが DR でオンラインになるためです。そのため、再保護（ SnapMirror を DR から本番環境に戻して再保護）する際に、フェイルオーバーされなかった VM が上書きされて、貴重なデータが含まれる可能性があります。</block>
  <block id="6d717f70d89096b731dfc63d7a1379e1" category="section-title">アレイペアについて</block>
  <block id="6dd3f3008fe81f402905b00c8dca007c" category="paragraph">アレイペアごとにアレイマネージャが作成されます。SRM ツールと ONTAP ツールでは、クラスタクレデンシャルを使用している場合でも、各アレイペアリングを SVM の範囲で実行します。これにより、管理対象に割り当てられている SVM を基に、各テナント間で DR ワークフローを分割できます。特定のクラスタに対して複数のアレイマネージャを作成でき、非対称にすることができます。異なる ONTAP 9 クラスタ間でファンアウトまたはファンインを実行できます。たとえば、クラスタ 1 の SVM A と SVM B をクラスタ 2 の SVM C に、クラスタ 3 の SVM D に、またはその逆にレプリケートできます。</block>
  <block id="2219228418c053eb593ce0a1f318da47" category="paragraph">SRM でアレイペアを設定する場合は、 ONTAP ツールに追加するのと同じ方法でアレイペアを SRM に追加する必要があります。つまり、アレイペアは同じユーザ名、パスワード、および管理 LIF を使用する必要があります。これは、 SRA がアレイと正しく通信するための要件です。次のスクリーンショットは、 ONTAP ツールでのクラスタの表示方法と、アレイマネージャへのクラスタの追加方法を示しています。</block>
  <block id="7ec48584a43ed8a9b1dda55398d97cf4" category="paragraph"><block ref="7ec48584a43ed8a9b1dda55398d97cf4" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3b34135c8c4d2b14ceb7ebf595f00193" category="section-title">複製グループについて</block>
  <block id="6be59afd3c8bb91501f55a7e77ebe794" category="paragraph">レプリケーショングループには、同時にリカバリされる仮想マシンの論理集合が含まれます。レプリケーショングループは、 ONTAP ツール VASA Provider で自動的に作成されます。ONTAP の SnapMirror レプリケーションはボリュームレベルで実行されるため、ボリューム内のすべての VM が同じレプリケーショングループに属します。</block>
  <block id="94a20f06626561800313d9472f9d9769" category="paragraph">レプリケーショングループについて考慮する必要がある要素と、 FlexVol ボリュームに VM を分散する方法にはいくつかの要素があります。同様の VM を同じボリュームにグループ化すると、アグリゲートレベルの重複排除が行われていない古い ONTAP システムでもストレージ効率が向上しますが、グループ化することでボリュームのサイズが増大し、ボリュームの I/O 同時実行が減少します。最新の ONTAP システムでパフォーマンスとストレージ効率の最適なバランスを実現するには、同じアグリゲート内の FlexVol ボリュームに VM を分散します。その結果、アグリゲートレベルの重複排除を利用して、複数のボリューム間で I/O の並列化を促進します。保護グループ（以下で説明）には複数のレプリケーショングループを含めることができるため、ボリューム内の VM を 1 つにまとめてリカバリできます。このレイアウトの欠点は、Volume SnapMirrorではアグリゲートの重複排除が考慮されないため、ブロックがネットワーク経由で複数回送信される可能性があることです。</block>
  <block id="c727c1020d3128dd7495a6e3e6f23736" category="paragraph">レプリケーショングループの最後の考慮事項の 1 つは、各グループがその性質によって論理整合グループになることです（ SRM 整合グループと混同しないようにしてください）。これは、ボリューム内のすべての VM が同じ Snapshot を使用して同時に転送されるためです。したがって、相互に整合性が必要な VM がある場合は、同じ FlexVol に格納することを検討してください。</block>
  <block id="9f8a350a2113ea4be6b4e5e5112514a3" category="section-title">保護グループについて</block>
  <block id="df77671ab2743af7f1d1457c200eb12c" category="paragraph">保護グループでは、 VM とデータストアをグループ単位で定義し、グループをまとめて保護サイトからリカバリします。保護対象サイトとは、通常の安定状態での運用中、保護グループで構成された VM が存在する場所です。SRM には保護グループの複数のアレイマネージャが表示される場合がありますが、保護グループは複数のアレイマネージャにまたがることはできません。このため、異なる SVM 上の複数のデータストアに VM ファイルをまたがって配置することはできません。</block>
  <block id="b148467d645c3613c1c7a2607764c515" category="section-title">リカバリ・プランについて</block>
  <block id="fd28cd9834ad3aa213c4fec2881064b5" category="paragraph">リカバリプランでは、同じプロセスでリカバリする保護グループを定義します。同じリカバリプランに複数の保護グループを設定できます。また、リカバリプランの実行オプションを増やすには、 1 つの保護グループを複数のリカバリプランに含めることもできます。</block>
  <block id="77aa84394124509e5e4006dcfd18789f" category="paragraph">リカバリプランを使用すると、 SRM 管理者は、 VM を優先グループ 1 （最大）から 5 （最小）に割り当てて、リカバリワークフローを定義できます。デフォルトは 3 （中）です。優先度グループ内で、 VM に依存関係を設定できます。</block>
  <block id="6d72567442b1f361e3c0e89cbc7dfd6a" category="paragraph">たとえば、会社のデータベースに Microsoft SQL Server を使用するティア 1 ビジネスクリティカルなアプリケーションを使用しているとします。したがって、優先度グループ 1 に VM を配置することにします。優先度グループ 1 では、サービスの提供順序の計画を開始します。Microsoft Windows ドメイン・コントローラを起動してから Microsoft SQL Server を起動してください。アプリケーション・サーバの前にオンラインになっている必要があります。依存関係は特定の優先グループ内でのみ適用されるため、これらのすべての VM を優先グループに追加してから、依存関係を設定します。</block>
  <block id="030d749269f8866de516a551b0286001" category="paragraph">アプリケーションチームと連携してフェイルオーバーシナリオに必要な処理の順序を把握し、それに応じてリカバリ計画を作成することを強く推奨します。</block>
  <block id="cebb1167d3e78885137c837f0abf8026" category="section-title">テストフェイルオーバー</block>
  <block id="2772828493452c4a2ff21f8b2b66a1a7" category="paragraph">ベストプラクティスとして、保護対象の VM ストレージの構成を変更する場合は、必ずテストフェイルオーバーを実行してください。これにより、災害発生時に、 Site Recovery Manager が想定される RTO ターゲット内でサービスをリストアできるかどうかを信頼できます。</block>
  <block id="6ae8acfc86f5df3426d525fb95767506" category="paragraph">特に VM ストレージの再設定後にゲストアプリケーションの機能を確認することを推奨します。</block>
  <block id="bd47371bcd8b3d08d6b4b15481b08d93" category="paragraph">テストリカバリ処理を実行すると、 VM 用の ESXi ホストにプライベートテスト用のバブルネットワークが作成されます。ただし、このネットワークは物理ネットワークアダプタに自動的には接続されないため、 ESXi ホスト間の接続は提供されません。DR テスト時に異なる ESXi ホストで実行されている VM 間の通信を可能にするために、 DR サイトの ESXi ホスト間に物理プライベートネットワークを作成します。テスト用ネットワークがプライベートであることを確認するために、テスト用のバブルネットワークを物理的に分離するか、 VLAN や VLAN タギングを使用して分離します。このネットワークは本番用ネットワークから分離する必要があります。 VM がリカバリされると、実際の本番用システムと競合する可能性のある IP アドレスを持つ本番用ネットワークに配置することはできなくなります。SRM でリカバリプランを作成する際、テスト中に VM を接続するためのプライベートネットワークとして、作成したテストネットワークを選択できます。</block>
  <block id="2be58fc410ddf2ba9c350135a617944a" category="paragraph">テストが検証されて不要になったら、クリーンアップ処理を実行します。クリーンアップを実行すると、保護されている VM が初期状態に戻り、リカバリプランが Ready 状態にリセットされます。</block>
  <block id="6f07b53963ee80903f0f13654de2cc3a" category="section-title">フェイルオーバーに関する考慮事項</block>
  <block id="9d33d94019b4a595a1ea232926a4da1b" category="paragraph">サイトのフェイルオーバーに関しては、このガイドに記載されている処理の順序に加えて、その他にもいくつかの考慮事項があります。</block>
  <block id="74abdd5cb502cd65bcf1d7ca484ab0c2" category="paragraph">競合する問題の 1 つに、サイト間のネットワークの違いがあります。環境によっては、プライマリサイトと DR サイトで同じネットワーク IP アドレスを使用できる場合があります。この機能は、拡張仮想 LAN （ VLAN ）または拡張ネットワークセットアップと呼ばれます。それ以外の環境では、プライマリサイトと DR サイトで別々のネットワーク IP アドレス（異なる VLAN など）を使用する必要があります。</block>
  <block id="9b8890fe5b1ab29543118b12a7bd0a07" category="inline-link-macro">SRMでのNSX-Tオプション</block>
  <block id="25154023650451d6cc971fc54bff8898" category="paragraph">VMware では、この問題を解決する方法をいくつか提供しています。1 つは、 VMware NSX -T Data Center のようなネットワーク仮想化テクノロジーです。ネットワークスタック全体を運用環境からレイヤ 2 ～ 7 に抽象化し、より移植性の高いソリューションを実現します。の詳細を確認してください <block ref="3e6a2bd8e1acf69d423b7944c6543271" category="inline-link-macro-rx"></block>。</block>
  <block id="2ef005587879f8a16a4d999c1dd71630" category="paragraph">SRM では、リカバリ時に VM のネットワーク設定を変更することもできます。IP アドレス、ゲートウェイアドレス、 DNS サーバなどの設定が再設定されます。リカバリ時に個 々 のVMに適用されるさまざまなネットワーク設定は、リカバリプランのVMのプロパティ設定で指定できます。</block>
  <block id="b56336aa967325217297d8725b64eb0b" category="inline-link-macro">VMwareのドキュメント</block>
  <block id="d32598436410006707b2ad1d79395f02" category="paragraph">VMware の dr-ip-customizer というツールを使用すると、リカバリプランで複数の VM のプロパティを個別に編集しなくても、 SRM で VM ごとに異なるネットワーク設定を適用できます。このユーティリティの使用方法については、を参照してください。 <block ref="837c7339284b78d4fd5550c5d0fb1a68" category="inline-link-macro-rx"></block>。</block>
  <block id="3c8c527afa8ce5009c8f707f7fd4fabf" category="section-title">再保護</block>
  <block id="3b496038cb575fc404f8b0783e570f7a" category="paragraph">リカバリ後、リカバリサイトが新しい本番用サイトになります。リカバリ処理によって SnapMirror レプリケーションが解除されたため、新しい本番用サイトは今後の災害から保護されません。新しい本番用サイトは、リカバリ後すぐに別のサイトで保護することを推奨します。元の本番サイトが運用されている場合、 VMware 管理者は、元の本番サイトを新しいリカバリサイトとして使用して新しい本番サイトを保護できるため、保護の方向を実質的に変えることができます。再保護は、致命的でない障害でのみ使用できます。そのため、元の vCenter Server 、 ESXi サーバ、 SRM サーバ、および対応するデータベースを最終的にリカバリ可能な状態にする必要があります。使用できない場合は、新しい保護グループと新しいリカバリプランを作成する必要があります。</block>
  <block id="2bf236f8aceaaff2b305848df524c42e" category="paragraph">フェイルバック処理は、基本的に以前とは異なる方向のフェイルオーバーです。ベストプラクティスとして、フェイルバックを実行する前に、元のサイトが許容可能なレベルの機能に戻っていること、つまり元のサイトにフェイルオーバーしていることを確認することを推奨します。元のサイトが侵害されたままの場合は、障害が十分に修正されるまでフェイルバックを遅らせる必要があります。</block>
  <block id="cb03753531bad31391d7156433b98ae6" category="paragraph">フェイルバックのもう 1 つのベストプラクティスとして、再保護の完了後、および最終フェイルバックの実行前に、常にテストフェイルオーバーを実行することがあります。これにより、元のサイトに配置されたシステムで処理が完了できるかどうかを確認できます。</block>
  <block id="900a3b65ea54b6dcff72ed0d6ac66fdf" category="section-title">元のサイトを再保護する</block>
  <block id="2a0c13d7b927063987bf931a141f2662" category="paragraph">フェイルバックの完了後、再保護を再度実行する前に、サービスが正常に戻っていることをすべての利害関係者に確認する必要があります。</block>
  <block id="12d059a2c7519f2e3497b30a71121503" category="paragraph">フェイルバック後の再保護を実行すると、基本的に環境は最初の状態に戻り、 SnapMirror レプリケーションが本番用サイトからリカバリサイトに再度実行されます。</block>
  <block id="7ab9df3e4e38ca227c1b48b0f6740675" category="section-title">安全な開発活動</block>
  <block id="1a79eb278bc02ebdbd2ab32925e316f6" category="paragraph">NetApp ONTAP Tools for VMware vSphere のソフトウェアエンジニアリングでは、次の安全な開発作業を実施します。</block>
  <block id="39e5fc9eb192f011ab14dae6c2974c4e" category="list-text">* 脅威モデリング。 * 脅威モデリングの目的は、ソフトウェア開発ライフサイクルの早い段階で、機能、コンポーネント、または製品のセキュリティ上の欠陥を発見することです。脅威モデルとは、アプリケーションのセキュリティに影響するすべての情報を構造化したものです。本質的に、これはセキュリティの観点から見たアプリケーションとその環境です。</block>
  <block id="9f16ab3a50bca32d19c4729319035c8d" category="list-text">* Dynamic Application Security Testing （ DAST ）。 * このテクノロジーは、実行中のアプリケーションで脆弱な状態を検出するように設計されています。DAST は、 Web 対応アプリケーションの公開 HTTP および HTML インターフェイスをテストします。</block>
  <block id="267bed0525e4dab477e4c24ca5a1794e" category="list-text">* サードパーティーのコード通貨。 * オープンソース・ソフトウェア（ OSS ）を使用したソフトウェア開発の一環として、製品に組み込まれた OSS に関連するセキュリティ上の脆弱性に対処する必要があります。これは継続的な取り組みです。新しい OSS バージョンには、いつでも新たに検出された脆弱性が報告される可能性があります。</block>
  <block id="db7bc87c89c1ee76d313865a32fc0e06" category="list-text">* 脆弱性スキャン。 * 脆弱性スキャンは、お客様にリリースされる前にネットアップ製品の一般的なセキュリティの脆弱性と既知のセキュリティの脆弱性を検出するためのものです。</block>
  <block id="1a4c104571630526efc77b84e82380fe" category="list-text">* ペネトレーションテスト。 * ペネトレーションテストは、システム、 Web アプリケーション、またはネットワークを評価して、攻撃者によって悪用される可能性のあるセキュリティの脆弱性を検出するプロセスです。ネットアップでのペネトレーションテスト（ペンテスト）は、承認された信頼できる第三者企業のグループが実施します。テスト範囲には、高度な攻撃方法やツールを使用した悪意のある侵入者やハッカーと同様のアプリケーションまたはソフトウェアに対する攻撃の開始が含まれます。</block>
  <block id="7e98fc3ea1ec077cfd1727a58e9c9020" category="section-title">製品のセキュリティ機能</block>
  <block id="85d61648687f15050da0b86741b90358" category="paragraph">NetApp ONTAP Tools for VMware vSphere には、各リリースに次のセキュリティ機能が含まれています。</block>
  <block id="dff88c2ef0b49b09246ffd6f9ec55195" category="list-text">* ログインバナー。 * SSH はデフォルトでは無効になっており、 VM コンソールから有効になっている場合は 1 回限りのログインしか許可されません。ユーザがログインプロンプトでユーザ名を入力すると、次のログインバナーが表示されます。</block>
  <block id="399875025e8e96cc13102a4dd72f2434" category="paragraph">* 警告： * このシステムへの不正アクセスは禁止されており、法律で訴追されます。このシステムにアクセスすることで、不正な使用が疑われる場合に、ユーザーのアクションが監視される可能性があることに同意したものとみなされます。</block>
  <block id="2d8330ed99c80a842ffbd1362e038e5e" category="paragraph">ユーザがSSHチャネルを介したログインを完了すると、次のテキストが表示されます。</block>
  <block id="677528ad13d460c058ac50e8a62092cf" category="list-text">* ロールベースアクセス制御 (RBAC) 。 * ONTAP ツールには、次の 2 種類の RBAC 制御が関連付けられています。</block>
  <block id="ac38773d017495a97d5b88f242578cb8" category="list-text">vCenter Server 標準の権限</block>
  <block id="c2e2fce3a995f59900d7afbbe58683f5" category="inline-link">リンクをクリックしてください</block>
  <block id="31cedac82fef311cb790a12f96897223" category="list-text">vCenter プラグインに固有の権限。詳細については、を参照してください<block ref="e5f6920797dbff91ef59367270a82669" category="inline-link-rx"></block>。</block>
  <block id="5d32469f8a65b884a8f70abf95fe485a" category="list-text">* 暗号化された通信チャネル。 * すべての外部通信は、バージョン 1.2 の TLS を使用して HTTPS 経由で行われます。</block>
  <block id="600d4f98483fae8e58054f976d7e0c0e" category="list-text">* 最小限のポート露出。 * 必要なポートのみがファイアウォールで開かれています。</block>
  <block id="0406f8902379502d1eba01f043c232b7" category="paragraph">次の表に、オープンポートの詳細を示します。</block>
  <block id="69fc9fe9cbb7709e97a433352aecf77d" category="cell">TCP v4 / V6 ポート番号</block>
  <block id="02674a4ef33e11c879283629996c8ff8" category="cell">方向（ Direction ）</block>
  <block id="86408593c34af77fdd90df932f8b5261" category="cell">機能</block>
  <block id="0c95054981de037de06e544a52eb3613" category="cell">8143</block>
  <block id="a8e6fe5b9e68f30a146cefebaa7edcc3" category="cell">インバウンド</block>
  <block id="d16c4afdc5f340936b747baf91efc843" category="cell">REST API 用の HTTPS 接続</block>
  <block id="5bd529d5b07b647a8863cf71e98d651a" category="cell">8043</block>
  <block id="1f4deeb2f64336d4ff65ea3d2b4ffe2f" category="cell">HTTPS 接続</block>
  <block id="cb4b69eb9bd10da82c15dca2f86a1385" category="cell">9060</block>
  <block id="5852f8019b572f4cdef5bab783fa799f" category="cell">HTTPS 接続
SOAP over https 接続に使用されます
クライアントがONTAP tools APIサーバに接続できるようにするには、このポートを開く必要があります。</block>
  <block id="b6d767d2f8ed5d21a44b0e5886680cb9" category="cell">22</block>
  <block id="f4e339608b243f9b57b78ffaf061b498" category="cell">SSH （デフォルトでは無効）</block>
  <block id="d82d678e9583c1f5f283ec56fbf1abb7" category="cell">9080</block>
  <block id="ef34781e03f49b5db5dd8fa267c4c41b" category="cell">HTTPS 接続 - VP および SRA - ループバックからの内部接続のみ</block>
  <block id="a44ba9086b2b83ccf2baf7c678723449" category="cell">9083年だ</block>
  <block id="fe01ac95967cd8cb5f5b5669b685277a" category="cell">HTTPS 接続 - VP および SRA
SOAP over https 接続に使用されます</block>
  <block id="abea47ba24142ed16b7d8fbf2c740e0d" category="cell">一一六二</block>
  <block id="4a0724da5c6f4e4817663ae822550800" category="cell">VP SNMP トラップパケット</block>
  <block id="5cce8dede893813f879b873962fb669f" category="cell">1527年</block>
  <block id="91c15b8eb529bf2100c10383d1010a1e" category="cell">内部のみ</block>
  <block id="60135f95267c6e0711bf5a2858dfff2f" category="cell">Derby データベースポート。このコンピュータとそれ自体の間のみ、外部接続は許可されません -- 内部接続のみ</block>
  <block id="13f3cf8c531952d72e5847c4183e6910" category="cell">443</block>
  <block id="1ef2b5426b0824e93e33753fa87ddbf5" category="cell">双方向</block>
  <block id="e4b8a8d8761aab7733e317b585d5d606" category="cell">ONTAP クラスタへの接続に使用します</block>
  <block id="bf6184406d1e18fffc86ecf770fbb391" category="inline-link">こちらの技術情報アーティクル</block>
  <block id="fedac49792829de4ff38fcf7a3846faa" category="list-text">* 認証局（ CA ）署名証明書のサポート。 * VMware vSphere 用の ONTAP ツールは CA 署名証明書をサポートしています。を参照してください<block ref="0903a062b2072644a9b744a7fece4216" category="inline-link-rx"></block> を参照してください。</block>
  <block id="9fca19988370da2a459b24505e9d23d5" category="list-text">* 監査ログ。 * サポートバンドルはダウンロード可能で、非常に詳細です。ONTAP ツールは、すべてのユーザログインおよびログアウトアクティビティを個別のログファイルに記録します。VASA API 呼び出しは、専用の VASA 監査ログ（ローカルの cxf.log ）に記録されます。</block>
  <block id="7d60a2806aedd934b75cce55d6693689" category="list-text">* パスワードポリシー。 * 次のパスワードポリシーが適用されます。</block>
  <block id="f82f7513742f08b9d2784923213bdc75" category="list-text">パスワードはどのログファイルにも記録されません。</block>
  <block id="83040c348e071499488a8128db207545" category="list-text">パスワードはプレーンテキストで伝達されません。</block>
  <block id="bc319862df3312f423a50fece7730db9" category="list-text">パスワードは、インストールプロセスで設定します。</block>
  <block id="853c2ea85b86882d0ea73b606a9800a4" category="list-text">パスワード履歴は設定可能なパラメータです。</block>
  <block id="b3d3877bc96752ae50a409c72597d47a" category="list-text">パスワードの最小有効期間は 24 時間に設定されます。</block>
  <block id="fb0bdec50022a37424a405b53da7c9c8" category="list-text">パスワードフィールドの自動入力は無効です。</block>
  <block id="3a04f054be8ad983ea82fd5079519810" category="list-text">ONTAP ツールは、保存されているすべてのクレデンシャル情報を SHA256 ハッシュで暗号化し</block>
  <block id="46e61d6e7c848d43ddcede8efd36c3d8" category="doc">SnapCenterプラグインVMware vSphere</block>
  <block id="ae9e79ac4b60eba67cf1c7508417b42c" category="paragraph">NetApp SnapCenter Plug-in for VMware vSphereのソフトウェアエンジニアリングでは、次のような安全な開発作業を行います。</block>
  <block id="b25a1098aff7d0c5ee590f1e1a114bb9" category="list-text">*動的アプリケーションセキュリティテスト(DAST)。*実行中のアプリケーションの脆弱な状態を検出するように設計されたテクノロジ。DAST は、 Web 対応アプリケーションの公開 HTTP および HTML インターフェイスをテストします。</block>
  <block id="6cc1fee6b4fc48755d78e93170bbed93" category="list-text">*サードパーティのコード通貨。*ソフトウェアの開発およびオープンソースソフトウェア（OSS）の使用の一環として、製品に組み込まれているOSSに関連するセキュリティの脆弱性に対処することが重要です。これは、OSSコンポーネントのバージョンに、いつでも新たに検出された脆弱性が報告される可能性があるため、継続的な取り組みです。</block>
  <block id="87bd0fb9b4198f33535e0e1888a809f5" category="list-text">*ペネトレーションテスト。*ペネトレーションテストは、システム、Webアプリケーション、またはネットワークを評価して、攻撃者によって悪用される可能性のあるセキュリティの脆弱性を検出するプロセスです。ネットアップでのペネトレーションテスト（ペンテスト）は、承認された信頼できる第三者企業のグループが実施します。このテスト範囲には、高度な攻撃方法やツールを使用した悪意のある侵入者やハッカーなどのアプリケーションやソフトウェアに対する攻撃の開始が含まれます。</block>
  <block id="e3a3be4b4b04c5e0b6a5f1b5ea388380" category="list-text">*製品セキュリティインシデント対応活動。*セキュリティの脆弱性は、社内外で発見され、タイムリーに対処しないと、ネットアップの評判に深刻なリスクをもたらす可能性があります。このプロセスを容易にするために、Product Security Incident Response Team（PSIRT）は脆弱性を報告して追跡します。</block>
  <block id="e91db3b3278f7bd95cc704d74c5c9597" category="paragraph">NetApp SnapCenter Plug-in for VMware vSphereの各リリースには、次のセキュリティ機能が含まれています。</block>
  <block id="4abd7d1d5d223683d3346671efb7e89c" category="list-text">*制限付きシェルアクセス。* SSHはデフォルトで無効になっており、1回限りのログインはVMコンソールから有効にした場合にのみ許可されます。</block>
  <block id="8c264fa5ca2c588d960d98bd30cbc897" category="list-text">*ログインバナーのアクセス警告*ログインプロンプトにユーザ名を入力すると、次のログインバナーが表示されます。</block>
  <block id="0d6633ada3a9803e206b2359d859e892" category="paragraph">ユーザがSSHチャネルを介したログインを完了すると、次の出力が表示されます。</block>
  <block id="83e463bb73b12d9ca6e419327073c8a4" category="list-text">*ロールベースアクセス制御（RBAC）。*ネットアップのONTAP ツールには、次の2種類のRBAC制御が関連付けられています。</block>
  <block id="b883bf79639dfce77e395b8458ee69e4" category="list-text">vCenter Server標準の権限。</block>
  <block id="721796b1cb3468f0daf819180184d460" category="inline-link">ロールベースアクセス制御（ RBAC ）</block>
  <block id="1d08c46b7567a29be0690a92b9722a58" category="list-text">VMware vCenterプラグインに固有の権限。詳細については、を参照してください<block ref="f351263ad3706bd0a472039400dece78" category="inline-link-rx"></block>。</block>
  <block id="acab4c655c4a7b4db67fc07e22b86222" category="list-text">*暗号化された通信チャネル。*すべての外部通信は、TLSを使用してHTTPS経由で行われます。</block>
  <block id="47a37e2d5fc8b7c936ad9b2b7a569a08" category="paragraph">次の表に、オープンポートの詳細を示します。</block>
  <block id="10bd16a816f831080065e807daa36a9a" category="cell">TCP v4 / V6ポート番号</block>
  <block id="edf0320adc8658b25ca26be5351b6c4a" category="cell">8144</block>
  <block id="d4a973e303ec37692cc8923e3148eef7" category="cell">8080 です</block>
  <block id="2c25c3d66f80eeaa8d6e5a144c6f942e" category="cell">OVA GUIでのHTTPS接続</block>
  <block id="14b3e670eec63cc0cc456fd904bbfbd9" category="cell">SSH（デフォルトでは無効）</block>
  <block id="16fc18d787294ad5171100e33d05d4e2" category="cell">3306</block>
  <block id="4cbf9c234f6b34c242a110cb993252bd" category="cell">mysql（内部接続のみ。外部接続はデフォルトで無効）</block>
  <block id="29ab4efbdb7c727c81ee1382593bc5e2" category="cell">nginx（データ保護サービス）</block>
  <block id="89f152cad33314315b4995ed1ca71535" category="inline-link">SnapCenter Plug-in for VMware vSphere（SCV）にSSL証明書を作成/インポートする方法</block>
  <block id="450adc59e39f23172756ac9369494a2d" category="list-text">*認証局（CA）署名証明書のサポート。* SnapCenter Plug-in for VMware vSphereは、CA署名証明書の機能をサポートしています。を参照してください<block ref="9f83d87d5d9f604d96288df21d450fac" category="inline-link-rx"></block>。</block>
  <block id="05a1aa8021df4579874c4eeb8788e5c9" category="list-text">*パスワードポリシー。*次のパスワードポリシーが有効です。</block>
  <block id="2c87609dbbc3630573c64e271de8207d" category="list-text">クレデンシャル情報はすべてSHA256ハッシュを使用して保存されます。</block>
  <block id="0f1a6fa0a65f9d5c3c4a16b070104d7a" category="list-text">*基本オペレーティングシステムイメージ。*この製品は、アクセス制限とシェルアクセスが無効になったOVA用のDebianベースOSに同梱されています。これにより、攻撃のフットプリントが削減されます。すべてのSnapCenter リリースベースのオペレーティングシステムには、最大限のセキュリティを適用できる最新のセキュリティパッチが適用されています。</block>
  <block id="83cd5867ba912e517fa1100299fd1cf3" category="paragraph">ネットアップでは、SnapCenter Plug-in for VMware vSphereアプライアンスに関連するソフトウェア機能およびセキュリティパッチを開発し、その後、バンドルソフトウェアプラットフォームとしてお客様にリリースします。ネットアップでは、これらのアプライアンスにはLinuxのサブシステムに固有の依存関係と独自のソフトウェアが含まれているため、サブオペレーティングシステムを変更しないことを推奨します。これは、ネットアップアプライアンスに影響を及ぼす可能性が高いためです。これは、ネットアップがアプライアンスをサポートできるかどうかに影響します。アプライアンスはセキュリティ関連の問題にパッチを適用するためにリリースされているため、最新のコードバージョンをテストして導入することを推奨します。</block>
  <block id="c7eca250a9863785d63364853c46c00d" category="doc">FabricPoolを使用したMySQLの階層化</block>
  <block id="1bc6cee680286aae1b12889369b7f18a" category="summary">ONTAPでのMySQLの運用</block>
  <block id="dac8ea4fbfd87a535663c227b91f50e3" category="doc">I/Oスケジューラ</block>
  <block id="215dca219378b291ae287eb076489fdd" category="paragraph">Linuxカーネルでは、ブロックデバイスへのI/Oのスケジュール方法を低レベルで制御できます。</block>
  <block id="dc36d23ef487690f1698c69d9e49cee2" category="paragraph">Linuxのさまざまなディストリビューションでのデフォルト設定は大きく異なります。MySQLでは、<block ref="722d122e81cbbe543bd5520bb8678c0e" prefix=" " category="inline-code"></block> または<block ref="30e482a8ab57cfc19075dece53b0a56b" prefix=" " category="inline-code"></block> Linuxでネイティブの非同期I/O（AIO）を使用するI/Oスケジューラ。一般に、NetAppのお客様や社内テストでは、NoOpsの方が効果的です。</block>
  <block id="6def78482bd1915cb81f0f5c19ee8fe6" category="paragraph">MySQLのInnoDBストレージエンジンは、Linux上の非同期I/Oサブシステム（ネイティブAIO）を使用して、データファイルページの先読み要求と書き込み要求を実行します。この動作は、<block ref="2c03186a22d036ce7dad84be5de2f2ce" prefix=" " category="inline-code"></block> 設定オプション。デフォルトで有効になっています。ネイティブの一体型I/Oでは、I/OスケジューラのタイプがI/Oパフォーマンスに大きく影響します。ベンチマークを実施して、ワークロードと環境に最適な結果を提供するI/Oスケジューラを特定します。</block>
  <block id="e7b09beaf26efc7d8bee91786cf794b5" category="paragraph">I/Oスケジューラの設定手順については、該当するLinuxおよびMySQLのドキュメントを参照してください。</block>
  <block id="6e8775bd755a8835ce86806d669677ea" category="doc">ストレージ構成</block>
  <block id="2f09ac000b4a1808cb795b7bdbb20ecc" category="doc">innodb_log_file_size</block>
  <block id="b8674b2897b288ca55b74328df4780b3" category="paragraph">InnoDBログファイルのサイズに適したサイズを選択することは、書き込み処理およびサーバクラッシュ後の適切なリカバリ時間を確保するために重要です。</block>
  <block id="b61bad6f7bf48bf9abda0c86c9beed79" category="paragraph">ファイルに記録されるトランザクションの数が非常に多いため、書き込み処理ではログファイルのサイズが重要になります。レコードが変更されても、変更はすぐにはテーブルスペースに書き込まれません。代わりに、変更はログファイルの最後に記録され、ページはダーティとしてマークされます。InnoDBはログを使用してランダムI/OをシーケンシャルI/Oに変換します。</block>
  <block id="e87d83a3c0af4df83efb4784b5182f8f" category="paragraph">ログがいっぱいになると、ダーティページが順番にテーブルスペースに書き込まれ、ログファイルのスペースが解放されます。たとえば、トランザクションの途中でサーバがクラッシュし、書き込み処理のみがログファイルに記録されるとします。サーバを再び稼働させるには、ログファイルに記録された変更が再生されるリカバリフェーズを実行する必要があります。ログファイル内のエントリ数が多いほど、サーバのリカバリにかかる時間が長くなります。</block>
  <block id="8321756b7fedf72543a1b0917bf92613" category="paragraph">この例では、ログファイルのサイズがリカバリ時間と書き込みパフォーマンスの両方に影響します。ログファイルのサイズに適切な数を選択する場合は、リカバリ時間と書き込みパフォーマンスのバランスを取ります。通常、128Mから512Mの間の値は良い値です。</block>
  <block id="d4ae77cd65c244ceb4277b27553d6931" category="doc">ONTAPノMySQLテタヘス</block>
  <block id="598132a821e8cc696fbbae934047d991" category="paragraph">MariaDBやPercona MySQLを含むMySQLとその変種は、世界で最も人気のあるデータベースです。</block>
  <block id="478f00c3805e92ad9e8a7cd4f335a020" category="admonition">ONTAPとMySQLデータベースに関するこのドキュメントは、以前に公開されていた_TR-4722：『MySQL database on NetApp ONTAP best practices』に代わるものです。_</block>
  <block id="9793e07572d1520fdffd0e4db62df588" category="paragraph">MySQLには次のような機能があります。</block>
  <block id="04b90043b7bbdc843dd2b77f2014f14f" category="list-text">* TCOの削減* MySQLは、強力で無料のオープンソースのデータベース管理システムで、数年前から提供されています。非常に安定しています。コミュニティサポートがあり、新機能の保守、デバッグ、追加に役立ちます。Webアプリケーションに複数のデータベースが必要な場合や、ロードバランシングやシャーディングが必要な場合は、インスタンスごとに単一のライセンスを必要とする商用データベースではなく、ハードウェアコストのみでデータベースインスタンスを簡単にセットアップできます。</block>
  <block id="ae129f31dc6bc29ee6e28e9dbd8bd904" category="list-text">*信頼性、パフォーマンス、使いやすさ。* MySQLの特徴の1つは、優れたパフォーマンスとスケーラビリティです。そのため、多くのWebベースの企業がそれを使用しています。MySQLは、高速なパフォーマンスを実現するためにいくつかの主要な強みを活用競争は常にマウスクリック(またはスクリーンタッチ)で行われるため、顧客からの問い合わせや活動への迅速な対応が最も重要です。Webベースのアプリケーションを処理するデータベースは、読み取り（単純なクエリと複雑なクエリ）処理と書き込み処理の両方で、卓越したパフォーマンスを提供する必要があります。</block>
  <block id="ce921a1775ad78848c0ef06b4c2aaff3" category="list-text">*データベースの開発、設計、および管理。* MySQL Workbenchは、開発、設計、および管理を統合した環境を提供し、開発者およびDBAの生産性を高めます。異なる開発者がデータベースで異なる機能を探していますが、MySQLはさまざまな機能を提供しています。ラップトップとデスクトップの両方で適切に実行できます。既存のWebサーバやアプリケーションと衝突しないように、環境に簡単に適応できます。</block>
  <block id="26ab39333494c60fdfe1fbf67fcb9c4a" category="list-text">*包括的なトランザクション・サポート。* MySQLは、利用可能な最も堅牢なトランザクション・データベース・エンジンの1つです。完全なデータ整合性を実現する解決策であり、完全なアトミック、一貫性、分離、永続性トランザクションのサポート、マルチバージョントランザクションのサポートなどの機能を提供します。 および無制限のローレベルロック。サーバーによって強制された参照整合性により、即時デッドロック識別が可能になります。</block>
  <block id="f9ab99873ba8416ec0975ef4f4fb655a" category="list-text">*データセキュリティ。* MySQLは、WordPress、Drupal、Joomla、Facebook、Google、 そしてtwitter。MySQLの最新バージョンに付随するデータセキュリティとトランザクション処理のサポートは、あらゆるビジネス、特に頻繁な送金を伴うEコマースビジネスに利益をもたらす可能性があります。</block>
  <block id="2cb5bda4a8945e058ff550f4991ba8b6" category="list-text">*プラガブル・アーキテクチャー。* MySQLプラガブル・ストレージ・エンジン・アーキテクチャーにより、データベースの専門家は、アプリケーションのコーディング要件を管理することなく、特定のアプリケーションのニーズに特化したストレージ・エンジンを選択できます。MySQLサーバアーキテクチャは、アプリケーションプログラマとDBAを、ストレージレベルでの低レベルの実装の詳細から分離し、一貫性のある簡単なアプリケーションモデルとAPIを提供します。さまざまなストレージエンジンにはさまざまな機能がありますが、アプリケーションはこれらの違いから保護されています。</block>
  <block id="e0780e103bd4ebcb0ee7f25b644eca40" category="paragraph">MySQLの効率的でモジュール化されたアーキテクチャは、1つのストレージエンジンから独立したインターフェイスとサービスを使用しながら、データウェアハウス、トランザクション処理、HA状況など、特定のアプリケーションのニーズに対応したい場合に大きなメリットをもたらします。</block>
  <block id="35701e1bcd40c8e1a520fc33d0e14842" category="doc">innodb_flush_method</block>
  <block id="138738e11d5fda5c496edaa92e32e158" category="paragraph">innodb_flush_methodパラメータは、InnoDBがログファイルとデータファイルを開いてフラッシュする方法を指定します。</block>
  <block id="c262c8cd82b96f69fbbc058d7a35683b" category="section-title">最適化</block>
  <block id="d1e67ebe6122765789852eb430c42c75" category="paragraph">InnoDB最適化では、このパラメータを設定すると、必要に応じてデータベースのパフォーマンスが調整されます。</block>
  <block id="51ca63a7fb332d4d18e7139ea5787c50" category="paragraph">次のオプションは、InnoDBを使用してファイルをフラッシュするためのものです。</block>
  <block id="a9b8d4c72b58a9554274cba7904d47e2" category="list-text"><block ref="e590322920bebc1156ab585bd6597d76" prefix="" category="inline-code"></block>。InnoDBでは、<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> データファイルとログファイルの両方をフラッシュするシステムコール。このオプションはデフォルト設定です。</block>
  <block id="8198b1fd4bf2fafa4f4e8ffb4a8ac900" category="list-text"><block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix="" category="inline-code"></block>。InnoDBでは、<block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix=" " category="inline-code"></block> ログファイルを開いてフラッシュし、データファイルをフラッシュするにはfsync()を使用します。InnoDBが使用しない<block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix=" " category="inline-code"></block> 直接、なぜなら、多くの種類のUNIXで問題があったからです。</block>
  <block id="f89f9147df5dde99a7944d2028b59e7e" category="list-text"><block ref="6a334fd488ef92b18584207148410cc4" prefix="" category="inline-code"></block>。InnoDBでは、<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> オプション（または<block ref="42d27f470f62deaad644fef8618b59bb" prefix=" " category="inline-code"></block> （Solarisの場合）データファイルを開くには、次のコマンドを使用します。<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> データファイルとログファイルの両方をフラッシュします。このオプションは、一部のGNU/Linuxバージョン、FreeBSD、Solarisで利用できます。</block>
  <block id="5e90100e134d805a66f8cda2e73f5298" category="list-text"><block ref="d66655d6d13113f23421f282ed1eaeb7" prefix="" category="inline-code"></block>。InnoDBでは、<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> オプションはI/Oのフラッシュ時に使用されますが、<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 後でシステムコール。このオプションは、一部のタイプのファイルシステム（XFSなど）には適していません。ファイルシステムに<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> システムコール（たとえば、すべてのファイルメタデータを保持する場合）は、<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 代わりにオプション。</block>
  <block id="c680d437163cc6bab4f9bdb35c3073d0" category="section-title">観察</block>
  <block id="907dee0040812e8e7d1fd00b870b5063" category="paragraph">NetAppラボテストでは、<block ref="e590322920bebc1156ab585bd6597d76" prefix=" " category="inline-code"></block> NFSとSANではdefaultオプションが使用されており、<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block>。flushメソッドを使用している場合<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> ONTAPでは、クライアントが4096ブロックの境界で大量のシングルバイト書き込みをシリアル方式で書き込みました。この書き込みにより、ネットワーク経由のレイテンシが増加し、パフォーマンスが低下します。</block>
  <block id="2f0b9319cf6d59e07ea4b1ef65a12be1" category="doc">open_file_limits</block>
  <block id="11e52b21a9795b7dcf947027b0ec5d01" category="paragraph">。<block ref="2f0b9319cf6d59e07ea4b1ef65a12be1" prefix=" " category="inline-code"></block> パラメータは、オペレーティングシステムがmysqldを開くことを許可するファイルの数を決定します。</block>
  <block id="e0732f22b2900006e8fcb6367fd162f7" category="paragraph">実行時のこのパラメータの値は、システムで許可されている実際の値であり、サーバの起動時に指定した値とは異なる場合があります。MySQLが開いているファイルの数を変更できないシステムでは、値は0です。効果的な<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 値は、システムの起動時に指定された値（存在する場合）と<block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix=" " category="inline-code"></block> および<block ref="023a3b50ddf424c9a1d51984190a0c92" prefix=" " category="inline-code"></block> 次の式を使用します。</block>
  <block id="6b840ff0a7667f4642a0844269657fc4" category="list-text">10以上<block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix=" " category="inline-code"></block> [+] <block ref="023a3b50ddf424c9a1d51984190a0c92" prefix="(" category="inline-code"></block> ×2）</block>
  <block id="d3de183489c20b8efa2947eeff3028d7" category="list-text"><block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix="" category="inline-code"></block> X 5</block>
  <block id="2c08922fbaba089e7c2982df43fd352a" category="list-text">オペレーティングシステムの制限（正の場合）</block>
  <block id="8ca153937fcbdf56497ad779a91f31d1" category="list-text">オペレーティングシステムの制限が無限大の場合：<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 起動時に値が指定されます。指定されていない場合は5,000</block>
  <block id="98038bb4026a70f5ee4041522c6eebe4" category="paragraph">サーバは、これら4つの値の最大値を使用してファイル記述子の数を取得しようとします。これだけ多くのディスクリプタを取得できない場合、サーバはシステムが許可する数だけのディスクリプタを取得しようとします。</block>
  <block id="3ee58d04a0dc9b2551698643e0421005" category="doc">innodb_lru_scan_depth</block>
  <block id="29d0f4f8b383d39e73abd11ac73ca28a" category="paragraph">。<block ref="3ee58d04a0dc9b2551698643e0421005" prefix=" " category="inline-code"></block> パラメータは、InnoDBバッファプールのフラッシュ操作のアルゴリズムとヒューリスティックに影響を与えます。</block>
  <block id="eeb16232629bd788f0d29c104105bba2" category="paragraph">このパラメータは、I/O負荷の高いワークロードを調整するパフォーマンスのエキスパートが主に関心を持っています。このパラメータは、バッファプールインスタンスごとに、Least Recently Used（LRU）ページリスト内でページクリーナースレッドがスキャンを続行し、フラッシュするダーティページを探す距離を指定します。このバックグラウンド処理は1秒に1回実行されます。</block>
  <block id="39359bf2914e4e1cf84a9dea580fd20a" category="paragraph">値を上下に調整して、空きページ数を最小限に抑えることができます。必要以上の値を設定しないでください。スキャンを実行すると、パフォーマンスが大幅に低下する可能性があります。また、バッファプールインスタンスの数を変更する場合は、このパラメータを調整することを検討してください。<block ref="f2c8312d381c16c6c95a727c3f61a4c7" prefix=" " category="inline-code"></block> ページクリーナースレッドが毎秒実行する作業量を定義します。</block>
  <block id="513a275422fae2456617321a2f3fc0af" category="paragraph">デフォルトよりも小さい設定は、ほとんどのワークロードに適しています。一般的なワークロードでスペアのI/O容量がある場合にのみ、値を増やすことを検討してください。逆に、大量の書き込みが発生するワークロードでI/O容量が飽和状態になった場合は、特にバッファプールが大きい場合は値を小さくしてください。</block>
  <block id="62812b938ba1113b81bd7f612ad0e6f8" category="doc">innodb_buffer_pool_size</block>
  <block id="d7a8b502d05f5e477158eb80c1fb8dae" category="paragraph">InnoDBバッファプールは、チューニングアクティビティの中で最も重要な部分です。</block>
  <block id="5cb6c45d18482180f34ae727b53379fb" category="paragraph">InnoDBは、インデックスのキャッシュとデータのローイング、アダプティブハッシュインデックス、挿入バッファ、および内部で使用される他の多くのデータ構造をバッファプールに大きく依存しています。また、データへの変更もバッファに格納されるため、書き込み処理をストレージに対してすぐに実行する必要はありません。これにより、パフォーマンスが向上します。バッファプールはInnoDBの不可欠な部分であり、それに応じてサイズを調整する必要があります。バッファプールサイズを設定するときは、次の点を考慮してください。</block>
  <block id="03f07291794c3b9cb00d04cb9f30be81" category="list-text">専用のInnoDB専用マシンの場合は、バッファプールサイズを使用可能なRAMの80%以上に設定します。</block>
  <block id="7b0119b7fa59f87d23d5c65da456b226" category="list-text">MySQL専用サーバーでない場合は、サイズをRAMの50%に設定します。</block>
  <block id="a6a9695e1464f5554c0006c55facfadf" category="doc">ファイル記述子</block>
  <block id="5ef6471f819ed2d47303473cc87d9305" category="paragraph">実行するには、MySQLサーバにファイル記述子が必要です。</block>
  <block id="8e222c68dd214db9f8a1b5b572ee6267" category="paragraph">これらを使用して、新しい接続を開いたり、テーブルをキャッシュに格納したり、複雑なクエリを解決するための一時テーブルを作成したり、永続的なテーブルにアクセスしたりします。mysqldが必要なときに新しいファイルを開くことができない場合、正常に機能しなくなる可能性があります。この問題の一般的な現象は、エラー24「開いているファイルが多すぎます」です。 mysqldが同時に開くことができるファイル記述子の数は、<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 構成ファイルに設定されたオプション <block ref="86d0d007043d911697753b35e2c18f35" prefix="(" category="inline-code"></block>）。でも...。<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> オペレーティングシステムの制限によっても異なります。この依存関係により、変数の設定がより複雑になります。</block>
  <block id="07561a91f81dfe3c8e4364aac8bdbea4" category="paragraph">MySQLカセツテイテキナイ<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> オプションがで指定されている値よりも大きい<block ref="dd1c6d8164dfd1cee0afa39b177e843b" prefix=" " category="inline-code"></block>。したがって、必要に応じてMySQLがファイルを開くことができるように、これらの制限をオペレーティングシステムレベルで明示的に設定する必要があります。Linuxでファイル制限を確認するには、次の2つの方法があります。</block>
  <block id="84e705ac120a887df441f4161dc29409" category="list-text">。<block ref="2eabb4efed7dffb32ea1170eab71b798" prefix=" " category="inline-code"></block> コマンドを実行すると、許可またはロックされているパラメータの詳細な概要がすばやく表示されます。このコマンドを実行して行った変更は永続的ではなく、システムのリブート後に消去されます。</block>
  <block id="a4c404dc92855948bc4c007a86091dbe" category="list-text">に対する変更<block ref="b803f460349bd101b1de260021ef0e60" prefix=" " category="inline-code"></block> ファイルは永続的であり、システムの再起動の影響を受けません。</block>
  <block id="cbcab8220d4ffddbdc44f9936125d83d" category="paragraph">ユーザmysqlのハードリミットとソフトリミットの両方を変更してください。構成からの抜粋を次に示します。</block>
  <block id="97dc47f90c600a96fac6642560ffaceb" category="paragraph">並行して、<block ref="90f16be5b82ca0aa94088c89fe00b3dd" prefix=" " category="inline-code"></block> 開いているファイル制限を完全に使用するには。</block>
  <block id="395ec860c9530814e94538b7121a8319" category="doc">innodb_flush_log_at_trx_commit</block>
  <block id="2f2c7742844f13de59d435b9099c78cc" category="paragraph">データに変更があっても、変更はすぐにはストレージに書き込まれません。</block>
  <block id="0b36b8f791a48c7b4692e7df069dabc8" category="paragraph">代わりに、データはログバッファに記録されます。これは、InnoDBがログファイルに記録されるバッファ変更に割り当てるメモリの一部です。InnoDBは、トランザクションがコミットされたとき、バッファがいっぱいになったとき、または1秒に1回のイベントが発生したときに、バッファをログファイルにフラッシュします。このプロセスを制御する構成変数は、Innodb_flush_log_at_trx_commitです。値オプションには次のものがあります。</block>
  <block id="280a38864b81c14ba3db52801e087ed0" category="list-text">設定時<block ref="cab9a35054c49f0ba619a6e6943f461b" prefix=" " category="inline-code"></block>では、（InnoDBバッファプール内の）変更されたデータがログファイル（ib_logfile）に書き込まれ、ログファイルが1秒ごとにフラッシュされます（ストレージへの書き込み）。ただし、トランザクションがコミットされても何も実行されません。停電またはシステムクラッシュが発生した場合、フラッシュされていないデータはログファイルまたはドライブに書き込まれないため、リカバリできません。</block>
  <block id="5967bb5566cb7cd8bdb0b372ceb21565" category="list-text">設定時<block ref="1ab7a7611b59147e84a38b6f3e7d9d09" prefix=" " category="inline-code"></block>InnoDBはログバッファをトランザクションログに書き込み、トランザクションごとに永続的なストレージにフラッシュします。たとえば、すべてのトランザクションコミットについて、InnoDBはログに書き込み、その後ストレージに書き込みます。ストレージの速度が遅いと、パフォーマンスが低下します。たとえば、1秒あたりのInnoDBトランザクション数が減少します。</block>
  <block id="9e9b3a43cb7a1b13c5ee3f6519d7f60e" category="list-text">設定時<block ref="44d4dfee9b1c95f8768bec989cd3baf5" prefix=" " category="inline-code"></block>InnoDBはコミットのたびにログバッファをログファイルに書き込みますが、ストレージにデータを書き込むことはありません。InnoDBは、1秒に1回データをフラッシュします。停電やシステムクラッシュが発生した場合でも、オプション2のデータはログファイルに保存され、リカバリ可能です。</block>
  <block id="14f3e0328e25aa02b37bd6817a442a58" category="paragraph">パフォーマンスが主な目標である場合は、値を2に設定します。InnoDBは、トランザクションコミットごとではなく、1秒に1回ドライブに書き込みを行うため、パフォーマンスが大幅に向上します。停電やクラッシュが発生した場合は、トランザクションログからデータをリカバリできます。</block>
  <block id="4a34cbb1957909093a2e216fc1cd0962" category="paragraph">データの安全性が主な目的である場合は、トランザクションコミットごとにInnoDBがドライブにフラッシュされるように、値を1に設定します。ただし、パフォーマンスに影響する可能性があります。</block>
  <block id="53be3047aa6f8a62c640cc8b4d6089c6" category="admonition">* NetAppでは、パフォーマンスを向上させるために、innodb_flush_log_trx_commit値を2に設定することを推奨しています。</block>
  <block id="2199371f8380c97ad11a03fba3b501c9" category="doc">innodb_io_capacity</block>
  <block id="ac165f23bb7435219b226ed6e76c5fa4" category="paragraph">InnoDBプラグインでは、MySQL 5.7からInnoDB_io_capacityという新しいパラメータが追加されました。</block>
  <block id="b4f38c42ef968074288f239b42e92b7f" category="paragraph">InnoDBが実行する最大IOPS（ダーティページのフラッシュレートと挿入バッファ[ibuf]バッチサイズを含む）を制御します。innodb_io_capacityパラメータは、バッファプールからのページのフラッシュや変更バッファからのデータのマージなど、InnoDBバックグラウンドタスクによるIOPSの上限を設定します。</block>
  <block id="9679a08c293f29d9546c42207b09d418" category="paragraph">innodb_io_capacityパラメータに、システムが1秒あたりに実行できるI/O処理のおおよその数を設定します。理想的には、設定をできるだけ低くしてくださいが、バックグラウンドアクティビティが遅くなるように低くしないでください。この設定が高すぎると、データがバッファプールから削除され、キャッシュするにはバッファの挿入が早すぎて大きなメリットが得られません。</block>
  <block id="668b6acc98c3469094062ed50b43e43a" category="admonition">* NetAppでは*この設定をNFSで使用する場合は、IOPSのテスト結果（SysBench / Fio）を分析し、それに応じてパラメータを設定することを推奨します。InnoDBバッファプールで必要以上に変更されたページやダーティなページが表示されない場合は、フラッシュとパージにできるだけ小さい値を使用してください。</block>
  <block id="038b11d42ee14bd77b6370c575c63b16" category="admonition">ワークロードに対して低い値では不十分であることを証明した場合を除き、20、000以上などの極端な値は使用しないでください。</block>
  <block id="62385f5ceb285bca676cb0561555d719" category="paragraph">innodb_io_capacityパラメータは、フラッシュ速度と関連するI/Oを調整します。</block>
  <block id="c957ef06af970a7526a73e741b47fef1" category="admonition">このパラメータまたはinnodb_io_capacity_maxパラメータを設定すると、パフォーマンスに深刻な影響を与える可能性があります。このパラメータが高すぎて、早期フラッシュでI/O処理が無駄になります。</block>
  <block id="d32067c550345cae14e678b4def6aa22" category="doc">SAN経由のMySQL</block>
  <block id="b238d5dd75fe5ed855c5b3047e074050" category="paragraph">通常の2ボリュームモデルを使用してSANでMySQLを構成するには、2つのオプションがあります。</block>
  <block id="58d94bb6e53e154e2f4b16efa09f4c0d" category="paragraph">I/Oと容量の要件が単一のLUNファイルシステムの制限内であれば、小規模なデータベースを標準LUNのペアに配置できます。たとえば、約2、000 IOPSのランダムIOPSを必要とするデータベースを、1つのLUN上の単一のファイルシステムでホストできます。同様に、サイズが100GBしかないデータベースでも、1つのLUNに収まります。管理上の問題は発生しません。</block>
  <block id="c33bcb4f520265bb106616e844397ffb" category="paragraph">大規模なデータベースには複数のLUNが必要です。たとえば、10万IOPSを必要とするデータベースには、少なくとも8つのLUNが必要です。ドライブへのSCSIチャネルの数が不十分なため、1つのLUNがボトルネックになります。同じように、10TBのデータベースを1つの10TB LUNで管理するのは困難です。論理ボリュームマネージャは、複数のLUNのパフォーマンス機能と容量機能を結合して、パフォーマンスと管理性を向上させるように設計されています。</block>
  <block id="428e88a1415b00f5eb396829b4bd9a2c" category="paragraph">どちらの場合も、ONTAPボリュームのペアで十分です。単純な設定では、ログLUNと同様に、データファイルLUNも専用ボリュームに配置されます。論理ボリュームマネージャ構成の場合、データファイルボリュームグループ内のすべてのLUNは専用ボリュームに配置され、ログボリュームグループのLUNは2つ目の専用ボリュームに配置されます。</block>
  <block id="e8c31916b755be39cb0a66804a1d8f8b" category="paragraph">* NetAppでは* SANへのMySQL導入には2つのファイルシステムを使用することを推奨しています。</block>
  <block id="fe9d8ca2c46747e16ed31f64638e66e6" category="list-text">最初のファイルシステムには、表領域、データ、インデックスを含むすべてのMySQLデータが格納されます。</block>
  <block id="04d82ed32fa1eeaa6df117c178062441" category="list-text">2番目のファイルシステムには、すべてのログ（バイナリログ、低速ログ、トランザクションログ）が格納されます。</block>
  <block id="15bcb76b7e8b441c0d2a6e723f70c20c" category="paragraph">この方法でデータを分離する理由には、次のようなものがあります。</block>
  <block id="02774797d31a8f1c6d805860038c32a3" category="list-text">データファイルとログファイルのI/Oパターンは異なります。これらを分離すると、QoS制御でより多くのオプションを使用できるようになります。</block>
  <block id="6cab2c793e807e2d0c57f5b0d96505c1" category="list-text">Snapshotテクノロジを最適に使用するには、データファイルを個別にリストアできる必要があります。データファイルとログファイルを混在させると、データファイルのリストアが妨げられます。</block>
  <block id="553ad1f7b6f5cfee021e5cf56e56a289" category="list-text">NetApp SnapMirrorテクノロジを使用すると、シンプルでRPOの低いディザスタリカバリ機能をデータベースに提供できますが、データファイルとログには異なるレプリケーションスケジュールが必要です。</block>
  <block id="ff5f52a69a35dd41da3e3c4b810e4f94" category="admonition">ONTAPのすべての機能を必要に応じて使用解決策できるように、この基本的な2ボリュームレイアウトを使用して、将来のニーズにも対応します。</block>
  <block id="7b755794e9de5716b2d6305bd10bee1b" category="paragraph">* NetAppでは、次の機能により、ドライブをext4ファイルシステムでフォーマットすることを推奨しています。</block>
  <block id="fa92f58d5035dec5e24a787f76504783" category="list-text">JFS（ジャーナルファイルシステム）で使用されるブロック管理機能の拡張アプローチと、XFS（拡張ファイルシステム）の遅延割り当て機能。</block>
  <block id="a72d73cde02c10703b72dcae6bc7c812" category="list-text">ext4は、最大1エクスビバイト（2^60バイト）のファイルシステムと最大16テビバイト（16*2^40バイト）のファイルシステムを許可します。一方、ext3ファイルシステムでサポートされる最大ファイルシステムサイズは16TB、最大ファイルサイズは2TBです。</block>
  <block id="56b4168424fa999bc383d24daf2da4eb" category="list-text">ext4ファイルシステムでは、複数ブロック割り当て(mballoc)は、ext3のようにファイルを1つずつ割り当てるのではなく、1回の操作で複数のブロックを割り当てます。この構成により、ブロックアロケータを数回呼び出すオーバーヘッドが削減され、メモリの割り当てが最適化されます。</block>
  <block id="632635d22b347f0140fb15d0eb0ed09e" category="list-text">XFSは多くのLinuxディストリビューションではデフォルトですが、メタデータの管理方法が異なり、一部のMySQL構成には適していません。</block>
  <block id="aff8b2ed0a4719f014e5baeb861ea7d4" category="paragraph">* NetAppでは、mkfsユーティリティで4kブロックサイズオプションを使用して、既存のブロックLUNサイズに合わせることを推奨*しています。</block>
  <block id="0a24d0336b7b0b29a9daa97f88499884" category="paragraph"><block ref="018d13c1d8b9abcae080b8abbc7c2d8b" prefix="" category="inline-code"></block></block>
  <block id="86fc8cb3bf2cae621315896a94b35f67" category="paragraph">NetApp LUNは4KBの物理ブロックにデータを格納するため、512バイトの論理ブロックが8個生成されます。</block>
  <block id="5f441ceabc94de2a9cced94d9f53a2d0" category="paragraph">同じブロックサイズを設定しないと、I/Oは物理ブロックと正しくアライメントされず、RAIDグループ内の2つの異なるドライブに書き込みが行われてレイテンシが発生する可能性があります。</block>
  <block id="236ac851d05b8822524001920948f23d" category="admonition">スムーズな読み取り/書き込み処理を実現するためには、I/Oのアライメントが重要です。ただし、物理ブロックの先頭以外の論理ブロックからI/Oが開始されると、I/Oはミスアライメントされます。I/O処理がアライメントされるのは、I/O処理が論理ブロック（物理ブロック内の最初の論理ブロック）で開始されたときだけです。</block>
  <block id="e6cf2549be4da18bf404cacc6100516a" category="summary">MySQL構成</block>
  <block id="282155126a94a0702cfd80daf38d4362" category="doc">設定の概要</block>
  <block id="13b506e9cda8a01b4cd60e08f3f1faf6" category="paragraph">NetAppでは、最適なパフォーマンスを得るために、いくつかの重要なMySQL構成パラメータ（表1を参照）を推奨しています。</block>
  <block id="3225a10b07f1580f10dee4abc3779e6c" category="cell">パラメータ</block>
  <block id="c82a6100dace2b41087ba6cf99a5976a" category="cell">値</block>
  <block id="b10db909b8fda84e70bf9b308d0938d9" category="cell">2億5、600万</block>
  <block id="c81e728d9d4c2f636f067f89cc14862c" category="cell">2.</block>
  <block id="7ccc31934ae8244d8263d3c09bcee186" category="cell">innodb_doublewrite</block>
  <block id="e590322920bebc1156ab585bd6597d76" category="cell">fsync</block>
  <block id="adb0c1ec32461889a5093441599260eb" category="cell">11g</block>
  <block id="774412967f19ea61d448977ad9749078" category="cell">8、192です</block>
  <block id="311887a53ec7390fc383fa2ad813f012" category="cell">innodb_buffer_pool_instances</block>
  <block id="c9f0f895fb98ab9159f51fd0297e236d" category="cell">8</block>
  <block id="1006f82d8df7d2325439b28ea691737c" category="cell">open_file_limit</block>
  <block id="3c9b5f1cd6a030bcb7bed9eac80589fb" category="cell">65535</block>
  <block id="c9f5a4d3ede4d084dda0a788ed06783c" category="paragraph">このセクションで説明するパラメータを設定するには、MySQL構成ファイル（my.cnf）でパラメータを変更する必要があります。NetAppのベストプラクティスは、社内で実施したテストの結果です。</block>
  <block id="5382aaf8b3d2fdeb6717f9805b0dd511" category="doc">コンテナ</block>
  <block id="6a554ff1dc93539a626e576bf0d28a02" category="paragraph">MySQLデータベースのコンテナ化はますます普及しています。</block>
  <block id="bcc002a9f2e2ade112438f50a6630498" category="paragraph">低レベルのコンテナ管理は、ほとんどの場合Dockerを使用して実行されます。OpenShiftやKubernetesなどのコンテナ管理プラットフォームを使用すると、大規模なコンテナ環境の管理がさらに簡単になります。コンテナ化のメリットとしては、ハイパーバイザーのライセンスが不要なため、コストの削減が挙げられます。また、コンテナを使用すると、基盤となる同じカーネルとオペレーティングシステムを共有しながら、複数のデータベースを互いに分離して実行できます。コンテナはマイクロ秒単位でプロビジョニングできます。</block>
  <block id="14d9b10c6196045941347a9e85704b50" category="inline-link-macro">Astra Trident のドキュメント</block>
  <block id="d4f640fe6950a1baff001f5601c7fbd7" category="paragraph">NetAppは、ストレージの高度な管理機能を提供するAstra Tridentを提供しています。たとえば、Astra Tridentを使用すると、Kubernetesで作成されたコンテナは、適切な階層にストレージを自動的にプロビジョニングしたり、エクスポートポリシーを適用したり、NetApp Snapshotコピーポリシーを設定したり、コンテナ間でクローンを作成したりできます。追加情報の場合は、を参照してください <block ref="2b8a155fc083396b96b18cee0ba5eab0" category="inline-link-macro-rx"></block>。</block>
  <block id="b8c3891a902a70c4f7f774363652f4b4" category="summary">MySQLフアイルノコウソウ</block>
  <block id="5713a921d815fd7d19875846450f8ea8" category="doc">ファイル構造</block>
  <block id="4955922857da5499a2f1be602a96b0ff" category="paragraph">InnoDBはストレージとMySQLサーバの中間層として機能し、データをドライブに格納します。</block>
  <block id="8a6fab0b8bb36427eda4071adfd7780b" category="inline-image-macro">エラー：グラフィックイメージが見つかりません</block>
  <block id="5d416cf65dd1e2c908bf430f957c89f8" category="paragraph">MySQL I/Oは次の2つのタイプに分類されます。</block>
  <block id="e8a320970c929abda9ae744b0b9e8f5f" category="list-text">ランダムファイルI/O</block>
  <block id="85430c0aa096ec282f2a14156baa312e" category="list-text">シーケンシャルファイルI/O</block>
  <block id="b7b9a4c6983139a2673988826094a3cf" category="paragraph">データファイルはランダムに読み取りおよび上書きされるため、IOPSが高くなります。そのため、SSDストレージを推奨します。</block>
  <block id="322f79fd77365edecd173807cb429ca2" category="paragraph">REDOログファイルとバイナリログファイルはトランザクションログです。それらはシーケンシャルに書き込まれるので、書き込みキャッシュを備えたHDDで優れたパフォーマンスを得ることができます。リカバリ時にシーケンシャルリードが発生しますが、ログファイルのサイズは通常データファイルより小さく、シーケンシャルリードはランダムリード（データファイルで発生）よりも高速であるため、パフォーマンスの問題が発生することはほとんどありません。</block>
  <block id="a898d206a27508975fea2e241af2f04e" category="paragraph">ダブル書き込みバッファはInnoDBの特別な機能です。InnoDBは、最初にフラッシュされたページをダブルライトバッファに書き込み、次にページをデータファイル上の正しい位置に書き込みます。このプロセスにより、ページの破損が防止されます。二重書き込みバッファがない場合、ドライブへの書き込みプロセス中に電源障害が発生すると、ページが破損する可能性があります。ダブル書き込みバッファへの書き込みはシーケンシャルであるため、HDD向けに高度に最適化されています。リカバリ時にシーケンシャルリードが発生します。</block>
  <block id="363512900e45bc17bdd6edfa50582862" category="paragraph">ONTAP NVRAMはすでに書き込み保護を提供しているため、ダブル書き込みバッファは必要ありません。MySQLにはパラメータがあります。<block ref="02d3c518a4019ea00e34e16491d826b4" prefix=" " category="inline-code"></block>、ダブルライトバッファをディセーブルにします。この機能により、パフォーマンスが大幅に向上します。</block>
  <block id="49a7df723922bddb4df4002b51087a1c" category="paragraph">挿入バッファはInnoDBの特別な機能でもあります。一意でないセカンダリインデックスブロックがメモリ内にない場合、InnoDBはエントリを挿入バッファに挿入して、ランダムなI/O操作を回避します。定期的に、挿入バッファはデータベース内のセカンダリインデックスツリーにマージされます。挿入バッファは、I/O要求を同じブロックにマージすることでI/O処理数を削減します。ランダムI/O処理はシーケンシャルです。また、インサートバッファはHDD用に高度に最適化されています。シーケンシャルライトと読み取りは、どちらも通常運用時に発生します。</block>
  <block id="6a0190340f27f29279bbfd319800289d" category="paragraph">元に戻すセグメントは、ランダムI/Oです。Multi-Version Concurrency（MVCC）を保証するために、InnoDBは元に戻すセグメントに古いイメージを登録する必要があります。元に戻すセグメントから以前の画像を読み取るには、ランダムな読み取りが必要です。繰り返し実行可能な読み取りで長時間のトランザクション（mysqldump—単一トランザクションなど）を実行したり、長時間のクエリを実行したりすると、ランダムリードが発生する可能性があります。したがって、この場合、元に戻すセグメントをSSDに保存する方が適しています。短いトランザクションまたはクエリのみを実行する場合、ランダムリードは問題ではありません。</block>
  <block id="a27e0d4b650aa6db30fdd95b54c94b27" category="paragraph">* NetAppでは、InnoDBのI/O特性を考慮して、以下のストレージ設計レイアウトを推奨しています。</block>
  <block id="defc1bfda928f419df5e4af79c98343e" category="list-text">MySQLのランダムI/OおよびシーケンシャルI/O指向ファイルを1つのボリュームに格納</block>
  <block id="7fd750411093ebd1faa0d99dd2608514" category="list-text">純粋にシーケンシャルなI/O指向のMySQLファイルを格納するための別のボリューム</block>
  <block id="0561a3b014eef0e5125fa63e1626cf57" category="paragraph">このレイアウトは、データ保護のポリシーと戦略の設計にも役立ちます。</block>
  <block id="a53db665fd1a9734a7a0e119671a0cd0" category="paragraph">LinuxでのNFSパフォーマンスは、というパラメータによって異なります。<block ref="453f2cc2326f82af1053f4aa4b75400b" prefix=" " category="inline-code"></block>。</block>
  <block id="9166d970028a28a614af39e6286371b7" category="paragraph">このパラメータは、次のコマンドで無効にできます。<block ref="8cafbd8d9096941261e87f4f9152ab92" prefix=" " category="inline-code"></block> ベンチマークの場合や、データの整合性や障害の可能性よりも最高のパフォーマンスに関心がある場合。InnoDBでは、ダブルライトと呼ばれるファイルフラッシュ技術が使用されています。InnoDBは、ページをデータファイルに書き込む前に、ダブル書き込みバッファと呼ばれる連続領域にページを書き込みます。書き込みとダブル書き込みバッファへのフラッシュが完了すると、InnoDBはページをデータファイル内の適切な位置に書き込みます。ページの書き込み中にオペレーティングシステムまたはmysqldプロセスがクラッシュした場合、InnoDBは後でクラッシュリカバリ中にダブルライトバッファからページの適切なコピーを見つけることができます。</block>
  <block id="3dfd4b9a526f8a8cf17021e34638b375" category="admonition">* NetAppでは、ダブル書き込みバッファを無効にすることを推奨しています。ONTAP NVRAMは同じ機能を果たします。ダブルバッファリングは不必要にパフォーマンスを低下させます。</block>
  <block id="dd5a2a602f713562e0f9f0fd8385660e" category="doc">NFS経由のMySQL</block>
  <block id="0e5e83102103fcdd25af430bf7327034" category="paragraph">MySQLのドキュメントでは、NAS環境にはNFSv4を使用することを推奨しています。</block>
  <block id="ca0d9fdc80b88e73b548638af421788f" category="section-title">ONTAP NFS転送サイズ</block>
  <block id="efcd0ba3fcbee9896a25804677e70b4b" category="paragraph">ONTAPでは、デフォルトでNFS IOサイズが64Kに制限されます。MySQLデータベースでランダムIOを使用する場合、ブロックサイズは64Kの最大値よりもはるかに小さくなります。ラージブロックIOは通常並列化されるため、64Kの最大値も制限ではありません。</block>
  <block id="4655f686de75b23f16d530ed7351c447" category="paragraph">一部のワークロードでは、最大64Kに制限があります。特に、フルテーブルスキャンバックアップ処理などのシングルスレッド処理は、データベースで実行するI/Oが少なくても大容量であれば、より高速かつ効率的に実行されます。データベースワークロードを使用するONTAPに最適なIO処理サイズは256Kです。以下のオペレーティングシステムのNFSマウントオプションは、それに応じて64Kから256Kに更新されています。</block>
  <block id="3ab93db30f3dded2c8d71859afbb53f6" category="admonition">ONTAPで許容される最大転送サイズを、現在マウントされているNFSファイルシステムのrsize/wsizeの値より小さくしないでください。これにより、一部のオペレーティングシステムでハングしたり、データが破損したりする可能性があります。たとえば、NFSクライアントのrsize / wsizeが65536に設定されている場合は、クライアント自体が制限されているため、ONTAPの最大転送サイズを65536~1048576の間で調整しても効果はありません。最大転送サイズを65536未満に縮小すると、可用性やデータが損傷する可能性があります。</block>
  <block id="5ea0bb5d4dab46d7971fef94ccde9369" category="paragraph">* NetAppの推奨事項*</block>
  <block id="09c6aa928c90ba68a4e03deadfeaa644" category="paragraph">次のNFSv4 fstab（/etc/fstab）設定を設定します。</block>
  <block id="0ae3c9648bc2d8c33fa57415604da370" category="paragraph"><block ref="a63a3dc825ff52908de7c9dfcb29ffa5" prefix="" category="inline-code"></block></block>
  <block id="3e0b2c100b093560f63ad57c6849bc8a" category="admonition">NFSv3を使用する一般的な問題は、停電後にロックされたInnoDBログファイルでした。時間または切り替えログファイルを使用して、この問題を解決しました。ただし、NFSv4にはロック処理があり、開いているファイルや委譲が追跡されます。</block>
  <block id="62e4eb800d20b46085ccb975da78bafe" category="sidebar">ONTAPは、多くのエンタープライズアプリケーションやデータベーステクノロジのデータ管理とデータ保護の基盤です。以降のページでは、ONTAPとエンタープライズアプリケーションおよびインフラのベストプラクティスと実装手順について説明します。</block>
  <block id="78898e52fcbdc5337204a384f2456d4f" category="sidebar">Microsoft SQL Server の場合</block>
  <block id="4f60acc41a8bf3fa75e7f74768637787" category="sidebar">Microsoft SQL Serverのデータ保護</block>
  <block id="b8529ff730dcf8dd2178d72de271dc4d" category="sidebar">オープンソースデータベース</block>
  <block id="bb9a5a6fadabab849d2e87f0898d7601" category="sidebar">ONTAP上のMariaDBとMySQL</block>
  <block id="5ad2a11eceac3ebd7cbf3b534ebdb1db" category="sidebar">ONTAP上のPostgreSQL</block>
  <block id="c30dd1a85cf86d95b11c1a08f70130ce" category="sidebar">Oracle データベース</block>
  <block id="4948dede9f4e7c3dfe48c38f7902f6e5" category="sidebar">ONTAP上のOracle</block>
  <block id="d71074394b511143c8d1108e74a81abb" category="sidebar">Oracleのデータ保護</block>
  <block id="f4d8825927d11df25770df5e00d6a52e" category="sidebar">Oracleへの移行</block>
  <block id="86083f3ea21c2385b4f013aae3c57858" category="sidebar">SAP HANA のサポート</block>
  <block id="677f2e7e550075f7bbbdac91e0918f2f" category="sidebar">SAP ソリューション</block>
  <block id="1b83f2b1c0b7fb3af048c2a59624fe3b" category="sidebar">SAP HANAとAFFおよびFC</block>
  <block id="6ab3c3f05076d213f0b1feff267607c6" category="sidebar">AFFとNFSを使用したSAP HANA</block>
  <block id="56079badd056a19303cc26e6a4fcc7e0" category="sidebar">VMware</block>
  <block id="f07084a11252c9bca97503ea9a627c89" category="sidebar">ONTAPを備えた仮想ボリューム（VVOL）</block>
  <block id="2d90ac09cbf108bddad31dd341f8614e" category="sidebar">VMware Site Recovery ManagerとONTAP</block>
  <block id="b0dae11b82e63781abdc8f893c41b3c0" category="sidebar">エンタープライズアプリケーション</block>
  <block id="999bc6b18351bbe817d26f559ba408ae" category="sidebar">SAP</block>
  <block id="2d2eef88dbdd0c34bde24e2632d9944f" category="sidebar">SAP HANAとAnyDB</block>
  <block id="399bd1ee587245ecac6f39beaa99886f" category="sidebar">PostgreSQL</block>
  <block id="f4f70727dc34561dfde1a3c529b6205c" category="sidebar">設定</block>
  <block id="3dd7c32443d5846be0a8fd75cb08b70e" category="sidebar">ファイルシステム構成</block>
  <block id="c476a4701643b158f9f5d57bcc91951d" category="sidebar">Snapshotテクノロジ</block>
  <block id="35084d885dea7b061e6894c1cf3036d9" category="sidebar">ワークロード</block>
  <block id="7d219314ccabde6609510141bb175a6c" category="sidebar">共有インスタンスと専用インスタンス</block>
  <block id="d5363ae19ecaede49e2ced297df7737a" category="sidebar">メモリ構成</block>
  <block id="459f656cac9c4d74b9f3f16ebb2a76c8" category="sidebar">データベースファイルとファイルグループ</block>
  <block id="500c09aa1bb9af431f2c18348e69bfd0" category="sidebar">tempdbフアイル</block>
  <block id="6fb6843bd9a214011969c02729c7d671" category="sidebar">ストレージに関する考慮事項</block>
  <block id="4c5d94eb4dc4bff93f6a96a08ab7b244" category="sidebar">データセキュリティ</block>
  <block id="cf91513c6fc63cebe4b63a6647238d6d" category="sidebar">RAID の場合</block>
  <block id="83db97189c47f7bb4edd879e8756f6e6" category="sidebar">容量制限</block>
  <block id="4d2caccc34711835f6ff99da411ac04e" category="sidebar">Storage Virtual Machineの略</block>
  <block id="af81930661b267e8f1e68c4d66e9ee56" category="sidebar">フェイルオーバーとスイッチオーバー</block>
  <block id="dfd1f50170457b961c15bb13ad7e3bed" category="sidebar">データファイルとRedoブロックのサイズ</block>
  <block id="49f83bf3a15b8626eb91fde93c6b1788" category="sidebar">Oracle RAC</block>
  <block id="13d80777c8fd43e555c1f5b1b72d7ef0" category="sidebar">ホストの設定</block>
  <block id="7e6bb0931a72759d39514aa924b420bc" category="sidebar">AIX の場合</block>
  <block id="6bb83af717367dd4a47f75801ae7a2b0" category="sidebar">ASMlibおよびAFDを使用したLinux</block>
  <block id="619615da0f93507e22a6054ef2aea4f1" category="sidebar">論理インターフェイス</block>
  <block id="aca8e861c6f30fe2d42d0310a387312b" category="sidebar">イーサネット構成</block>
  <block id="63a5b8bd41978e8124f9ccdfa9063e9e" category="sidebar">FC SAN構成</block>
  <block id="d63f66214ae30c5b9b10653f1e503492" category="sidebar">LUNアライメント</block>
  <block id="f6556bc360e8c25d9e29515d2d52cd66" category="sidebar">LUNの数とサイズ</block>
  <block id="d552d63771786b001d365cf747f74f6a" category="sidebar">LUNのサイズ変更</block>
  <block id="c3f378ef942f6bf228a43aaacc628fea" category="sidebar">LVMストライピング</block>
  <block id="254f642527b45bc260048e30704edb39" category="sidebar">設定</block>
  <block id="f3a78e25ce9f95fc3c61ccc39f32fb4d" category="sidebar">Oracle Direct NFS （ dNFS ）</block>
  <block id="989cefa74de0e10a575103f446258d99" category="sidebar">NFSのリースとロック</block>
  <block id="0d695ec265a3b0b5e7e32e33ffe4ed22" category="sidebar">NFSキャッシング</block>
  <block id="eb4d10d6eda7c9266cd36c4eb0a223cf" category="sidebar">ASM再生ユーティリティ</block>
  <block id="297e2ac2ec0bd88ad598062f4c07ee45" category="sidebar">階層化ポリシー</block>
  <block id="9af6f452cd88c83f2bde555de8f93690" category="sidebar">オブジェクトストアへのデータの送信</block>
  <block id="08af6d4e6b562e2d0b418d7198f5a0f7" category="sidebar">オブジェクトストアからのデータの読み出し</block>
  <block id="02d01636975b3ae0c0ab22368cea8d54" category="sidebar">階層化戦略</block>
  <block id="7fbd108e1fc6910c941094e95a677878" category="sidebar">ファイル全体</block>
  <block id="eb43c2427eb06b9f561363863b4a4f0b" category="sidebar">部分ファイル</block>
  <block id="1afe200fa26ba361f59b603b22ad6392" category="sidebar">ファイルを選択します</block>
  <block id="46880cc1d7a1624f1d6fa77e7ee02fb7" category="sidebar">RPO、TRO、SLA</block>
  <block id="448d15345bb99c834095da225c529b8a" category="sidebar">データの可用性</block>
  <block id="5869e10a9dea6d88d61bb10040557f35" category="sidebar">データ整合性</block>
  <block id="e2ac7be9b8940191426986b2ca575aa2" category="sidebar">バックアップとリカバリの基本</block>
  <block id="7b68149402c05a52968bda6af0435c8a" category="sidebar">Snapshotベースのオンラインバックアップ</block>
  <block id="49ba0ee205d016d8236db9c1e8c130e5" category="sidebar">ストレージSnapshotで最適化されたバックアップ</block>
  <block id="2c6d98297c340e390e0783220b038545" category="sidebar">物理アーキテクチャ</block>
  <block id="13a854bdd11f8f57a0b25c00631f1430" category="sidebar">論理アーキテクチャ</block>
  <block id="5e7988aeba0e1d3c15c5c78a0db738d1" category="sidebar">SyncMirror</block>
  <block id="3f23f85f537c810b6eca3c767c3ff00c" category="sidebar">Oracleフェイルオーバー</block>
  <block id="5783cab279142a801ff0fd0a03b607d5" category="sidebar">MetroCluster上の単一インスタンス</block>
  <block id="ea98d1b4d8c0f4b9e705df8dcdf77730" category="sidebar">SM-BCの単一インスタンス</block>
  <block id="39520db4a78ddf352897eac9b11c5890" category="sidebar">SM-BC上のOracle RAC</block>
  <block id="5ba8ee2f32815884475d1f2244ba16a6" category="sidebar">障害シナリオ</block>
  <block id="e31593850dc03f8f10d036df5dc8633b" category="sidebar">Oracleデータベースの移行</block>
  <block id="5102abd5a9cc202678054b832caf678d" category="sidebar">の手順</block>
  <block id="1495d3ed3ebff783c0f480b583372450" category="sidebar">ホストのデータコピー</block>
  <block id="d81ca5686c955ed50927409eb8c14bb0" category="sidebar">ForeignLUNImport</block>
  <block id="2fea59b7e470acac5ec1589d504da14e" category="sidebar">完了</block>
  <block id="e9cc85ef98d982c3c3e53d6b82293126" category="sidebar">プロトコル変更</block>
  <block id="fbbd0e8905df3950eca4d1d8f55881ad" category="sidebar">その他の注意事項</block>
  <block id="ac0465a970688dc3c326dcdd8fe2805e" category="sidebar">パフォーマンスの最適化とベンチマーク</block>
  <block id="7cb9c3cd8b9873d39a1fe87c083cd55c" category="sidebar">フルイNFSロック</block>
  <block id="c0916addb4f26afa58c5a6df4f463fa5" category="sidebar">ユニファイドストレージ</block>
  <block id="c0032c6bab44eeeb6886c7a4aa67cf77" category="sidebar">仮想化ツール</block>
  <block id="1c77ac70000b6804e930748d5df7be5e" category="sidebar">仮想ボリュームとストレージポリシーベースの管理</block>
  <block id="217601d383b816e6a2548e57b5006f92" category="sidebar">クローニング</block>
  <block id="8f2db90dd4a6fbd95ba8f0bc54fd6b27" category="sidebar">QoS</block>
  <block id="09b4a81ec7b05cbacc7cbfa13e006254" category="sidebar">ストレージポリシーベースの管理</block>
  <block id="2e8526cbe762cb1b8393d935a3b0bf16" category="sidebar">推奨設定</block>
  <block id="10a764f91b59ce3c8931d55c2fd54222" category="sidebar">VVOLストレージの導入</block>
  <block id="30f6724a02fc69093960468c0a2fbcd4" category="sidebar">製品のセキュリティ</block>
  <block id="3390e3575b3e341afa2b7172ff5b33a7" category="sidebar">SnapCenter Plug-in for VMware vSphere</block>
  <block id="62a004b95946bb97541afa471dcca73a" category="sidebar">MySQL</block>
  <block id="7f1a6761f7160e33a32105202e47303b" category="sidebar">コンテナ化</block>
  <block id="dee28dd6d1a9ef7bf399f642fd9d588f" category="section-title">NFSテンソウサイス</block>
  <block id="d8299d00f914e35b80644e5781e47a77" category="paragraph"><block ref="d8299d00f914e35b80644e5781e47a77" category="inline-image-macro-rx" type="image"></block></block>
  <block id="14ce62ac76fa34a51093e6bcf11a2fd1" category="paragraph">データベースバックアップの主な考慮事項は、NetAppのSnapshotテクノロジの活用です。アプリケーションと整合性のあるバックアップとデータベースのレイアウトも、NetApp SnapCenterによるオーケストレーションが可能なRTOとRPOを達成するための重要な考慮事項です。</block>
  <block id="08ec4f226440b636860c1faf0bd1b98c" category="paragraph"><block ref="08ec4f226440b636860c1faf0bd1b98c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2c024bdc7d0e87e8ba0f473024d45a4e" category="paragraph">サーバとデータベースの設定を変更すると、データベースのパフォーマンスが向上し、効率が向上します。</block>
  <block id="861f074a1ecd9d1cc088d2fe81903565" category="paragraph"><block ref="861f074a1ecd9d1cc088d2fe81903565" category="inline-image-macro-rx" type="image"></block></block>
  <block id="710e9cd79e3865d47122a799f425b31f" category="paragraph"><block ref="710e9cd79e3865d47122a799f425b31f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5a656ddcc72bacc3a5900c23edf7a08e" category="paragraph"><block ref="5a656ddcc72bacc3a5900c23edf7a08e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="073ce0a0568adc64d52dd9b1d8c02c54" category="paragraph"><block ref="073ce0a0568adc64d52dd9b1d8c02c54" category="inline-image-macro-rx" type="image"></block></block>
  <block id="d5e31e9b7075c2926dba10053509346b" category="paragraph">Storage Efficiencyは、RAID、プロビジョニング（全体的なレイアウトと利用率）、ミラーリング、その他のデータ保護テクノロジを組み合わせたものです。Snapshotコピー、シンプロビジョニング、FlexCloneなどのNetAppテクノロジを使用すると、インフラ内の既存のストレージを最適化し、将来のストレージ支出を先送りまたは回避することで、コスト削減を実現できます。これらのテクノロジを組み合わせて使用するほど、削減効果が大きくなります。</block>
  <block id="3401a9880dfc322da8a56c4d632361f6" category="paragraph"><block ref="3401a9880dfc322da8a56c4d632361f6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="87f823f4f3b4258445d5af029afe5ad9" category="paragraph"><block ref="87f823f4f3b4258445d5af029afe5ad9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9213fe9d391179276ff6c03552486255" category="paragraph"><block ref="9213fe9d391179276ff6c03552486255" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3105b4c0642b9710179c18edcf8e8718" category="paragraph"><block ref="3105b4c0642b9710179c18edcf8e8718" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1a43000eb9893bff7ab7b1ce1d3fd6a8" category="paragraph"><block ref="1a43000eb9893bff7ab7b1ce1d3fd6a8" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4b7a8562c98b8c652bdfb6aa79788222" category="paragraph"><block ref="4b7a8562c98b8c652bdfb6aa79788222" category="inline-image-macro-rx" type="image"></block></block>
  <block id="25cec91f17a8619119f76c8adbace583" category="paragraph">圧縮ブロックのアライメントに関するセクションも参照してください。 <block ref="0faffd62be034c86d531acfee84d252e" category="inline-link-macro-rx"></block>。8KBの圧縮ブロックの境界でアライメントされたレイアウトも、4KBの境界でアライメントされます。</block>
  <block id="38ac6f4e1538397bd4f659237ec03ebf" category="paragraph"><block ref="38ac6f4e1538397bd4f659237ec03ebf" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f01518e5f3b18a9ea241bc63a3475dbd" category="paragraph"><block ref="f01518e5f3b18a9ea241bc63a3475dbd" category="inline-image-macro-rx" type="image"></block></block>
</blocks>